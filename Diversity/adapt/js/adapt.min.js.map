{"version":3,"file":"adapt.min.js","sources":["../../core/js/wait.js","../../core/js/models/lockingModel.js","../../core/js/adapt.js","../../core/js/templateRenderEvent.js","../../core/js/templates.js","../../core/js/fixes/img.lazyload.js","../../core/js/a11y/browserFocus.js","../../core/js/a11y/focusOptions.js","../../core/js/a11y/keyboardFocusOutline.js","../../core/js/a11y/log.js","../../core/js/a11y/scroll.js","../../core/js/a11y/wrapFocus.js","../../core/js/a11y/popup.js","../../core/js/a11y/deprecated.js","../../core/js/a11y.js","../../core/js/accessibility.js","../../core/js/collections/adaptCollection.js","../../core/js/enums/logLevelEnum.js","../../core/js/logging.js","../../core/js/models/buildModel.js","../../core/js/models/configModel.js","../../core/js/modelEvent.js","../../core/js/models/adaptModel.js","../../core/js/models/contentObjectModel.js","../../core/js/models/menuModel.js","../../core/js/models/courseModel.js","../../core/js/startController.js","../../core/js/data.js","../../core/js/offlineStorage.js","../../core/js/enums/completionStateEnum.js","../../core/js/tracking.js","../../core/js/device.js","../../core/js/views/drawerItemView.js","../../core/js/views/drawerView.js","../../core/js/drawer.js","../../core/js/views/notifyPushView.js","../../core/js/models/notifyModel.js","../../core/js/collections/notifyPushCollection.js","../../core/js/childEvent.js","../../core/js/reactHelpers.js","../../core/js/views/adaptView.js","../../core/js/views/notifyView.js","../../core/js/notify.js","../../core/js/models/routerModel.js","../../core/js/router.js","../../core/js/collections/adaptSubsetCollection.js","../../core/js/models/articleModel.js","../../core/js/models/blockModel.js","../../core/js/models/componentModel.js","../../core/js/models/pageModel.js","../../core/js/views/contentObjectView.js","../../core/js/views/pageView.js","../../core/js/views/articleView.js","../../core/js/views/blockView.js","../../core/js/mpabc.js","../../core/js/helpers.js","../../core/js/scrolling.js","../../core/js/views/headingView.js","../../core/js/headings.js","../../core/js/views/navigationView.js","../../core/js/navigation.js","../../core/js/views/componentView.js","../../components/adapt-activator/js/activatorView.js","../../components/adapt-activator/js/activatorTargetModel.js","../../components/adapt-activator/js/ActivatorComponentTargetModel.js","../../components/adapt-activator/js/ActivatorElementTargetModel.js","../../components/adapt-activator/js/activatorModel.js","../../components/adapt-activator/js/activatorHelpers.js","../../components/adapt-activator/js/adapt-activator.js","../../extensions/adapt-playbackControls/js/playbackControlsView.js","../../extensions/adapt-playbackControls/js/playbackControlsModel.js","../../extensions/adapt-playbackControls/js/adapt-playbackControls.js","../../components/adapt-codeAnim/js/codeAnimInspectorVarView.js","../../components/adapt-codeAnim/js/codeAnimView.js","../../components/adapt-codeAnim/js/codeAnimInspectorVarModel.js","../../components/adapt-codeAnim/js/codeAnimModel.js","../../components/adapt-codeAnim/js/adapt-codeAnim.js","../../core/js/models/itemModel.js","../../core/js/models/itemsComponentModel.js","../../components/adapt-contrib-accordion/js/accordionModel.js","../../components/adapt-contrib-accordion/js/accordionView.js","../../components/adapt-contrib-accordion/js/adapt-contrib-accordion.js","../../components/adapt-contrib-assessmentResults/js/assessmentResultsModel.js","../../components/adapt-contrib-assessmentResults/js/assessmentResultsView.js","../../components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults.js","../../components/adapt-contrib-blank/js/adapt-contrib-blank.js","../../core/js/enums/buttonStateEnum.js","../../core/js/views/buttonsView.js","../../core/js/models/questionModel.js","../../core/js/views/questionView.js","../../components/adapt-contrib-mcq/js/mcqView.js","../../core/js/models/itemsQuestionModel.js","../../components/adapt-contrib-mcq/js/mcqModel.js","../../components/adapt-contrib-mcq/js/adapt-contrib-mcq.js","../../components/adapt-contrib-gmcq/js/adapt-contrib-gmcq.js","../../components/adapt-contrib-graphic/js/adapt-contrib-graphic.js","../../components/adapt-contrib-hotgraphic/js/hotgraphicPopupView.js","../../components/adapt-contrib-hotgraphic/js/hotgraphicView.js","../../components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic.js","../../components/adapt-contrib-matching/js/dropdownOption.js","../../components/adapt-contrib-matching/js/dropdown.js","../../components/adapt-contrib-matching/js/matchingView.js","../../components/adapt-contrib-matching/js/matchingModel.js","../../components/adapt-contrib-matching/js/adapt-contrib-matching.js","../../components/adapt-contrib-media/libraries/mediaelement-fullscreen-hook.js","../../components/adapt-contrib-media/js/adapt-contrib-media.js","../../components/adapt-contrib-narrative/js/modeEnum.js","../../components/adapt-contrib-narrative/js/narrativeView.js","../../components/adapt-contrib-narrative/js/adapt-contrib-narrative.js","../../components/adapt-contrib-slider/js/sliderView.js","../../components/adapt-contrib-slider/js/sliderModel.js","../../components/adapt-contrib-slider/js/adapt-contrib-slider.js","../../components/adapt-contrib-text/js/adapt-contrib-text.js","../../components/adapt-contrib-textInput/js/textInputView.js","../../components/adapt-contrib-textInput/js/textInputModel.js","../../components/adapt-contrib-textInput/js/adapt-contrib-textInput.js","../../components/adapt-essay/js/essayView.js","../../components/adapt-essay/js/essayModel.js","../../components/adapt-essay/js/adapt-essay.js","../../components/adapt-finder/js/finderView.js","../../components/adapt-finder/js/finderModel.js","../../components/adapt-finder/js/adapt-finder.js","../../components/adapt-flipCard/js/flipCardView.js","../../components/adapt-flipCard/js/flipCardModel.js","../../components/adapt-flipCard/js/adapt-flipCard.js","../../components/adapt-freeThinking/js/freeThinkingView.js","../../components/adapt-freeThinking/js/freeThinkingModel.js","../../components/adapt-freeThinking/js/adapt-freeThinking.js","../../components/adapt-glabel/js/glabelPopupView.js","../../components/adapt-glabel/js/glabelView.js","../../components/adapt-glabel/js/glabelModel.js","../../components/adapt-glabel/js/adapt-glabel.js","../../components/adapt-hotgraphicFlip/js/hotgraphicFlipView.js","../../components/adapt-hotgraphicFlip/js/adapt-hotgraphicFlip.js","../../components/adapt-hotgraphicMini/js/hotgraphicMiniView.js","../../components/adapt-hotgraphicMini/js/adapt-hotgraphicMini.js","../../components/adapt-hotgraphicPlus/js/hotgraphicPlusPopupView.js","../../components/adapt-hotgraphicPlus/js/hotgraphicPlusView.js","../../components/adapt-hotgraphicPlus/js/adapt-hotgraphicPlus.js","../../components/adapt-imgFinder/js/imgFinderOutlineModel.js","../../components/adapt-imgFinder/js/imgFinderOutlineView.js","../../components/adapt-imgFinder/js/imgFinderView.js","../../components/adapt-imgFinder/js/imgFinderItemModel.js","../../components/adapt-imgFinder/js/imgFinderModel.js","../../components/adapt-imgFinder/js/adapt-imgFinder.js","../../components/adapt-matchingPlus/js/matchingPlusModel.js","../../components/adapt-matchingPlus/js/matchingPlusDropdownView.js","../../components/adapt-matchingPlus/js/matchingPlusView.js","../../components/adapt-matchingPlus/js/adapt-matchingPlus.js","../../components/adapt-mcqCode/js/mcqCodeView.js","../../components/adapt-mcqCode/js/mcqCodeModel.js","../../components/adapt-mcqCode/js/adapt-mcqCode.js","../../components/adapt-mediaPlus/js/adapt-mediaPlus.js","../../components/adapt-mmcq/js/mmcqView.js","../../components/adapt-mmcq/js/mmcqModel.js","../../components/adapt-mmcq/js/adapt-mmcq.js","../../components/adapt-narrativePlus/js/modeEnum.js","../../components/adapt-narrativePlus/js/narrativePlusView.js","../../components/adapt-narrativePlus/js/adapt-narrativePlus.js","../../components/adapt-reorder/js/reorderView.js","../../components/adapt-reorder/js/reorderItemModel.js","../../components/adapt-reorder/js/reorderItemCollection.js","../../components/adapt-reorder/js/reorderModel.js","../../components/adapt-reorder/js/adapt-reorder.js","../../components/adapt-tabs/js/adapt-tabs.js","../../components/adapt-textInputPlus/js/textInputPlusView.js","../../components/adapt-textInputPlus/js/textInputPlusModel.js","../../components/adapt-textInputPlus/js/adapt-textInputPlus.js","../../components/adapt-tryHtml/js/tryHtmlView.js","../../components/adapt-tryHtml/js/tryHtmlModel.js","../../components/adapt-tryHtml/js/adapt-tryHtml.js","../../components/adapt-tryThis/js/adapt-tryThis.js","../../extensions/adapt-annotation/js/annotationView.js","../../extensions/adapt-annotation/js/adapt-annotation.js","../../extensions/adapt-blockBackground/js/blockBackgroundView.js","../../extensions/adapt-blockBackground/js/blockBackgroundModel.js","../../extensions/adapt-blockBackground/js/adapt-blockBackground.js","../../extensions/adapt-codeBox/js/codeBoxFadeBlockView.js","../../extensions/adapt-codeBox/js/codeBoxView.js","../../extensions/adapt-codeBox/js/codeBoxIframeView.js","../../extensions/adapt-codeBox/js/adapt-codeBox.js","../../extensions/adapt-componentRow/js/componentRowModel.js","../../extensions/adapt-componentRow/js/componentRowCollection.js","../../extensions/adapt-componentRow/js/componentRowView.js","../../extensions/adapt-componentRow/js/adapt-componentRow.js","../../extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView.js","../../extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank.js","../../extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel.js","../../extensions/adapt-contrib-assessment/js/assessment.js","../../extensions/adapt-contrib-assessment/js/adapt-assessmentArticleExtension.js","../../extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking.js","../../extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView.js","../../extensions/adapt-contrib-languagePicker/js/languagePickerView.js","../../extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView.js","../../extensions/adapt-contrib-languagePicker/js/languagePickerNavView.js","../../extensions/adapt-contrib-languagePicker/js/languagePickerModel.js","../../extensions/adapt-contrib-languagePicker/js/adapt-languagePicker.js","../../extensions/adapt-contrib-pageLevelProgress/js/completionCalculations.js","../../extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressIndicatorView.js","../../extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressItemView.js","../../extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView.js","../../extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView.js","../../extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressCollection.js","../../extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress.js","../../extensions/adapt-contrib-resources/js/adapt-contrib-resourcesView.js","../../extensions/adapt-contrib-resources/js/adapt-contrib-resourcesHelpers.js","../../extensions/adapt-contrib-resources/js/adapt-contrib-resources.js","../../extensions/adapt-contrib-spoor/js/scorm/logger.js","../../extensions/adapt-contrib-spoor/js/scorm/wrapper.js","../../extensions/adapt-contrib-spoor/js/serializers/SCORMSuspendData.js","../../extensions/adapt-contrib-spoor/js/serializers/ComponentSerializer.js","../../extensions/adapt-contrib-spoor/js/adapt-stateful-session.js","../../extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm.js","../../extensions/adapt-contrib-spoor/js/adapt-contrib-spoor.js","../../extensions/adapt-contrib-trickle/js/trickleView.js","../../extensions/adapt-contrib-trickle/js/pageView.js","../../extensions/adapt-contrib-trickle/js/handlers/buttonView.js","../../extensions/adapt-contrib-trickle/js/handlers/button.js","../../extensions/adapt-contrib-trickle/js/handlers/completion.js","../../extensions/adapt-contrib-trickle/js/handlers/notify.js","../../extensions/adapt-contrib-trickle/js/handlers/resize.js","../../extensions/adapt-contrib-trickle/js/handlers/tutor.js","../../extensions/adapt-contrib-trickle/js/handlers/visibility.js","../../extensions/adapt-contrib-trickle/js/handlers/done.js","../../extensions/adapt-contrib-trickle/js/adapt-contrib-trickle.js","../../extensions/adapt-contrib-tutor/js/adapt-contrib-tutor.js","../../extensions/adapt-dd-componentLogo/js/adapt-dd-componentLogo.js","../../extensions/adapt-dd-download/js/downloadView.js","../../extensions/adapt-dd-download/js/adapt-dd-download.js","../../extensions/adapt-dd-figure/js/figurePopupView.js","../../extensions/adapt-dd-figure/js/figureItemView.js","../../extensions/adapt-dd-figure/js/figureView.js","../../extensions/adapt-dd-figure/js/figureModel.js","../../extensions/adapt-dd-figure/js/adapt-dd-figure.js","../../extensions/adapt-dd-global/js/adapt-dd-global.js","../../extensions/adapt-dd-helpers/js/adapt-dd-helpers.js","../../extensions/adapt-dd-img/js/imgPopupView.js","../../extensions/adapt-dd-img/js/imgView.js","../../extensions/adapt-dd-img/js/respImgView.js","../../extensions/adapt-dd-img/js/adapt-dd-img.js","../../extensions/adapt-dd-inputField/js/inputFieldView.js","../../extensions/adapt-dd-inputField/js/inputFieldModel.js","../../extensions/adapt-dd-inputField/js/outputFieldView.js","../../extensions/adapt-dd-inputField/js/adapt-dd-inputField.js","../../extensions/adapt-dd-loading/js/adapt-dd-loading.js","../../extensions/adapt-dd-notify/js/adapt-dd-notify.js","../../extensions/adapt-dd-pageMode/js/adapt-dd-pageMode.js","../../extensions/adapt-dd-questionPlus/js/questionPlusMultiModel.js","../../extensions/adapt-dd-questionPlus/js/adapt-dd-questionPlus.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryModel.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryCollection.js","../../extensions/adapt-dd-sideMenu/js/SideMenuModel.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryView.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryNavView.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryResourcesView.js","../../extensions/adapt-dd-sideMenu/js/SideMenuCategoryCreditsView.js","../../extensions/adapt-dd-sideMenu/js/SideMenuHelpers.js","../../extensions/adapt-dd-sideMenu/js/SideMenuView.js","../../extensions/adapt-dd-sideMenu/js/adapt-dd-sideMenu.js","../../extensions/adapt-dd-sideNav/js/SideNavCollection.js","../../extensions/adapt-dd-sideNav/js/sideNavProgressView.js","../../extensions/adapt-dd-sideNav/js/sideNavBlocknumView.js","../../extensions/adapt-dd-sideNav/js/SideNavWidgetView.js","../../extensions/adapt-dd-sideNav/js/adapt-dd-sideNav.js","../../extensions/adapt-events/js/adapt-events.js","../../extensions/adapt-extraLearning/js/extraLearningPopupView.js","../../extensions/adapt-extraLearning/js/extraLearningView.js","../../extensions/adapt-extraLearning/js/adapt-extraLearning.js","../../extensions/adapt-lottie/js/lottieModel.js","../../extensions/adapt-lottie/js/lottieControlsView.js","../../extensions/adapt-lottie/js/lottieView.js","../../extensions/adapt-lottie/js/adapt-lottie.js","../../extensions/adapt-markChain/js/markChainModel.js","../../extensions/adapt-markChain/js/markChainView.js","../../extensions/adapt-markChain/js/adapt-markChain.js","../../extensions/adapt-nestComponent/js/nestComponentParentModel.js","../../extensions/adapt-nestComponent/js/adapt-nestComponent.js","../../extensions/adapt-resourcePopup/js/resourcePopupPopupView.js","../../extensions/adapt-resourcePopup/js/resourcePopupBtnView.js","../../extensions/adapt-resourcePopup/js/adapt-resourcePopup.js","../../extensions/adapt-scrollfix/js/adapt-scrollfix.js","../../extensions/adapt-sizing/js/adapt-sizing.js","../../extensions/adapt-stickyBlock/js/modeEnum.js","../../extensions/adapt-stickyBlock/js/stickyBlockView.js","../../extensions/adapt-stickyBlock/js/stickyBlockEpubView.js","../../extensions/adapt-stickyBlock/js/adapt-stickyBlock.js","../../extensions/adapt-stickyElement/js/stickyElementItemView.js","../../extensions/adapt-stickyElement/js/stickyElementItemModel.js","../../extensions/adapt-stickyElement/js/stickyElementModel.js","../../extensions/adapt-stickyElement/js/adapt-stickyElement.js","../../extensions/adapt-tooltip/js/tooltipPopupView.js","../../extensions/adapt-tooltip/js/tooltipView.js","../../extensions/adapt-tooltip/js/adapt-tooltip.js","../../core/js/views/menuItemView.js","../../core/js/views/menuView.js","../../menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenuItemView.js","../../menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenu.js","../../theme/adapt-didasko/js/themeView.js","../../theme/adapt-didasko/js/themePageView.js","../../theme/adapt-didasko/js/themeArticleView.js","../../theme/adapt-didasko/js/themeBlockView.js","../../theme/adapt-didasko/js/themeComponentView.js","../../theme/adapt-didasko/js/theme.js","../../course/en/project/js/helpers.js","../../core/templates/header.jsx","../../core/templates/image.jsx","../../core/js/app.js"],"sourcesContent":["export default class Wait extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._waitCount = 0;\r\n    this._callbackHandle = null;\r\n    this.being = this.begin.bind(this);\r\n    this.end = this.end.bind(this);\r\n  }\r\n\r\n  /**\r\n   * Returns true if there are items in the waiting count.\r\n   *\r\n   * @return {Boolean}\r\n   */\r\n  isWaiting() {\r\n    return (this._waitCount !== 0);\r\n  }\r\n\r\n  /**\r\n   * Add one item to the waiting count.\r\n   *\r\n   * @return {Object}\r\n   */\r\n  begin() {\r\n    if (!this.isWaiting()) this.trigger('wait');\r\n\r\n    this._waitCount++;\r\n\r\n    if (this._callbackHandle) {\r\n      clearTimeout(this._callbackHandle);\r\n      this._callbackHandle = null;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an item from the waiting count and trigger ready asynchronously if no more items are waiting.\r\n   *\r\n   * @return {Object}\r\n   */\r\n  end() {\r\n    if (!this.isWaiting()) return this;\r\n\r\n    this._waitCount--;\r\n\r\n    if (this.isWaiting() || this._callbackHandle) return this;\r\n\r\n    this._callbackHandle = setTimeout(function() {\r\n      this._callbackHandle = null;\r\n      this.trigger('ready');\r\n    }.bind(this), 0);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Queue this function until all open waits have been ended.\r\n   *\r\n   * @param  {Function} [callback]\r\n   * @return {Object|Promise}\r\n   */\r\n  queue(callback) {\r\n    if (!callback) {\r\n      this.begin();\r\n\r\n      return new Promise(resolve => {\r\n        this.once('ready', resolve);\r\n        this.end();\r\n      });\r\n    }\r\n\r\n    this.begin();\r\n    this.once('ready', callback);\r\n    this.end();\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Wait for this asynchronous function to execute before triggering ready event.\r\n   *\r\n   * @param  {Function} callback   [ Function to execute whilst holding queued callback. Once complete run first argument, done(). ]\r\n   * @return {Object}\r\n   */\r\n  for(callback) {\r\n    this.begin();\r\n    _.defer(() => callback(_.once(this.end)));\r\n    return this;\r\n  }\r\n\r\n}\r\n","export default class LockingModel extends Backbone.Model {\r\n\r\n  set(attrName, attrVal, options = {}) {\r\n    const stopProcessing = (typeof attrName === 'object' || typeof attrVal !== 'boolean' || !this.isLocking(attrName));\r\n    if (stopProcessing) return super.set(...arguments);\r\n\r\n    const isSettingValueForSpecificPlugin = options?.pluginName;\r\n    if (!isSettingValueForSpecificPlugin) {\r\n      console.error('Must supply a pluginName to change a locked attribute');\r\n      options.pluginName = 'compatibility';\r\n    }\r\n\r\n    const pluginName = options.pluginName;\r\n    if (this.defaults[attrName] !== undefined) {\r\n      this._lockedAttributes[attrName] = !this.defaults[attrName];\r\n    }\r\n    const lockingValue = this._lockedAttributes[attrName];\r\n    const isAttemptingToLock = (lockingValue === attrVal);\r\n\r\n    if (isAttemptingToLock) {\r\n      this.setLockState(attrName, true, { pluginName: pluginName, skipcheck: true });\r\n      return super.set(attrName, lockingValue);\r\n    }\r\n\r\n    this.setLockState(attrName, false, { pluginName: pluginName, skipcheck: true });\r\n\r\n    const totalLockValue = this.getLockCount(attrName, { skipcheck: true });\r\n    if (totalLockValue === 0) {\r\n      return super.set(attrName, !lockingValue);\r\n    }\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  setLocking(attrName, defaultLockValue) {\r\n    if (this.isLocking(attrName)) return;\r\n    if (!this._lockedAttributes) this._lockedAttributes = {};\r\n    this._lockedAttributes[attrName] = defaultLockValue;\r\n  }\r\n\r\n  unsetLocking(attrName) {\r\n    if (!this.isLocking(attrName)) return;\r\n    if (!this._lockedAttributes) return;\r\n    delete this._lockedAttributes[attrName];\r\n    delete this._lockedAttributesValues[attrName];\r\n    if (Object.keys(this._lockedAttributes).length === 0) {\r\n      delete this._lockedAttributes;\r\n      delete this._lockedAttributesValues;\r\n    }\r\n  }\r\n\r\n  isLocking(attrName) {\r\n    const isCheckingGeneralLockingState = (attrName === undefined);\r\n    const isUsingLockedAttributes = Boolean(this.lockedAttributes || this._lockedAttributes);\r\n\r\n    if (isCheckingGeneralLockingState) {\r\n      return isUsingLockedAttributes;\r\n    }\r\n\r\n    if (!isUsingLockedAttributes) return false;\r\n\r\n    if (!this._lockedAttributes) {\r\n      this._lockedAttributes = _.result(this, 'lockedAttributes');\r\n    }\r\n\r\n    const isAttributeALockingAttribute = this._lockedAttributes.hasOwnProperty(attrName);\r\n    if (!isAttributeALockingAttribute) return false;\r\n\r\n    if (!this._lockedAttributesValues) {\r\n      this._lockedAttributesValues = {};\r\n    }\r\n\r\n    if (!this._lockedAttributesValues[attrName]) {\r\n      this._lockedAttributesValues[attrName] = {};\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  isLocked(attrName, options) {\r\n    const shouldSkipCheck = options?.skipcheck;\r\n    if (!shouldSkipCheck) {\r\n      const stopProcessing = !this.isLocking(attrName);\r\n      if (stopProcessing) return;\r\n    }\r\n\r\n    return this.getLockCount(attrName) > 0;\r\n  }\r\n\r\n  getLockCount(attrName, options) {\r\n    const shouldSkipCheck = options?.skipcheck;\r\n    if (!shouldSkipCheck) {\r\n      const stopProcessing = !this.isLocking(attrName);\r\n      if (stopProcessing) return;\r\n    }\r\n\r\n    const isGettingValueForSpecificPlugin = options?.pluginName;\r\n    if (isGettingValueForSpecificPlugin) {\r\n      return this._lockedAttributesValues[attrName][options.pluginName] ? 1 : 0;\r\n    }\r\n\r\n    const lockingAttributeValues = Object.values(this._lockedAttributesValues[attrName]);\r\n    const lockingAttributeValuesSum = lockingAttributeValues.reduce((sum, value) => sum + (value ? 1 : 0), 0);\r\n\r\n    return lockingAttributeValuesSum;\r\n  }\r\n\r\n  setLockState(attrName, value, options) {\r\n    const shouldSkipCheck = options?.skipcheck;\r\n    if (!shouldSkipCheck) {\r\n      const stopProcessing = !this.isLocking(attrName);\r\n      if (stopProcessing) return this;\r\n    }\r\n\r\n    const isSettingValueForSpecificPlugin = options?.pluginName;\r\n    if (!isSettingValueForSpecificPlugin) {\r\n      console.error('Must supply a pluginName to set a locked attribute lock value');\r\n      options.pluginName = 'compatibility';\r\n    }\r\n\r\n    if (value) {\r\n      this._lockedAttributesValues[attrName][options.pluginName] = value;\r\n    } else {\r\n      delete this._lockedAttributesValues[attrName][options.pluginName];\r\n    }\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}\r\n","import Wait from 'core/js/wait';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\n\r\nclass AdaptSingleton extends LockingModel {\r\n\r\n  initialize() {\r\n    this.loadScript = window.__loadScript;\r\n    this.location = {};\r\n    this.store = {};\r\n    this.setupWait();\r\n  }\r\n\r\n  defaults() {\r\n    return {\r\n      _canScroll: true, // to stop scrollTo behaviour,\r\n      _outstandingCompletionChecks: 0,\r\n      _pluginWaitCount: 0,\r\n      _isStarted: false,\r\n      _shouldDestroyContentObjects: true\r\n    };\r\n  }\r\n\r\n  lockedAttributes() {\r\n    return {\r\n      _canScroll: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @deprecated since v6.0.0 - please use `Adapt.store` instead\r\n   */\r\n  get componentStore() {\r\n    this.log.deprecated('Adapt.componentStore, please use Adapt.store instead');\r\n    return this.store;\r\n  }\r\n\r\n  init() {\r\n    this.addDirection();\r\n    this.disableAnimation();\r\n    this.trigger('adapt:preInitialize');\r\n\r\n    // wait until no more completion checking\r\n    this.deferUntilCompletionChecked(() => {\r\n\r\n      // start adapt in a full restored state\r\n      this.trigger('adapt:start');\r\n\r\n      if (!Backbone.History.started) {\r\n        Backbone.history.start();\r\n      }\r\n\r\n      this.set('_isStarted', true);\r\n\r\n      this.trigger('adapt:initialize');\r\n\r\n    });\r\n  }\r\n\r\n  /**\r\n   * call when entering an asynchronous completion check\r\n   */\r\n  checkingCompletion() {\r\n    const outstandingChecks = this.get('_outstandingCompletionChecks');\r\n    this.set('_outstandingCompletionChecks', outstandingChecks + 1);\r\n  }\r\n\r\n  /**\r\n   * call when exiting an asynchronous completion check\r\n   */\r\n  checkedCompletion() {\r\n    const outstandingChecks = this.get('_outstandingCompletionChecks');\r\n    this.set('_outstandingCompletionChecks', outstandingChecks - 1);\r\n  }\r\n\r\n  /**\r\n   * wait until there are no outstanding completion checks\r\n   * @param {Function} [callback] Function to be called after all completion checks have been completed\r\n   */\r\n  async deferUntilCompletionChecked(callback = () => {}) {\r\n    if (this.get('_outstandingCompletionChecks') === 0) return callback();\r\n    return new Promise(resolve => {\r\n      const checkIfAnyChecksOutstanding = (model, outstandingChecks) => {\r\n        if (outstandingChecks !== 0) return;\r\n        this.off('change:_outstandingCompletionChecks', checkIfAnyChecksOutstanding);\r\n        callback();\r\n        resolve();\r\n      };\r\n      this.on('change:_outstandingCompletionChecks', checkIfAnyChecksOutstanding);\r\n    });\r\n  }\r\n\r\n  setupWait() {\r\n\r\n    this.wait = new Wait();\r\n\r\n    // Setup legacy events and handlers\r\n    const beginWait = () => {\r\n      this.log.deprecated(`Use Adapt.wait.begin() as Adapt.trigger('plugin:beginWait') may be removed in the future`);\r\n      this.wait.begin();\r\n    };\r\n\r\n    const endWait = () => {\r\n      this.log.deprecated(`Use Adapt.wait.end() as Adapt.trigger('plugin:endWait') may be removed in the future`);\r\n      this.wait.end();\r\n    };\r\n\r\n    const ready = () => {\r\n      if (this.wait.isWaiting()) {\r\n        return;\r\n      }\r\n      const isEventListening = (this._events['plugins:ready']);\r\n      if (!isEventListening) {\r\n        return;\r\n      }\r\n      this.log.deprecated(\"Use Adapt.wait.queue(callback) as Adapt.on('plugins:ready', callback) may be removed in the future\");\r\n      this.trigger('plugins:ready');\r\n    };\r\n\r\n    this.listenTo(this.wait, 'ready', ready);\r\n    this.listenTo(this, {\r\n      'plugin:beginWait': beginWait,\r\n      'plugin:endWait': endWait\r\n    });\r\n\r\n  }\r\n\r\n  isWaitingForPlugins() {\r\n    this.log.deprecated('Use Adapt.wait.isWaiting() as Adapt.isWaitingForPlugins() may be removed in the future');\r\n    return this.wait.isWaiting();\r\n  }\r\n\r\n  checkPluginsReady() {\r\n    this.log.deprecated('Use Adapt.wait.isWaiting() as Adapt.checkPluginsReady() may be removed in the future');\r\n    if (this.isWaitingForPlugins()) {\r\n      return;\r\n    }\r\n    this.trigger('plugins:ready');\r\n  }\r\n\r\n  /**\r\n   * Allows a selector to be passed in and Adapt will navigate to this element. Resolves\r\n   * asynchronously when the element has been navigated to.\r\n   * @param {string} selector CSS selector of the Adapt element you want to navigate to e.g. `\".co-05\"`\r\n   * @param {Object} [settings] The settings for the `$.scrollTo` function (See https://github.com/flesler/jquery.scrollTo#settings).\r\n   * @param {Object} [settings.replace=false] Set to `true` if you want to update the URL without creating an entry in the browser's history.\r\n   */\r\n  async navigateToElement() {}\r\n\r\n  /**\r\n   * Allows a selector to be passed in and Adapt will scroll to this element. Resolves\r\n   * asynchronously when the element has been navigated/scrolled to.\r\n   * @param {string} selector CSS selector of the Adapt element you want to navigate to e.g. `\".co-05\"`\r\n   * @param {Object} [settings={}] The settings for the `$.scrollTo` function (See https://github.com/flesler/jquery.scrollTo#settings).\r\n   * @param {Object} [settings.replace=false] Set to `true` if you want to update the URL without creating an entry in the browser's history.\r\n   */\r\n  async scrollTo() {}\r\n\r\n  /**\r\n   * Used to register models and views with `Adapt.store`\r\n   * @param {string|Array} name The name(s) of the model/view to be registered\r\n   * @param {object} object Object containing properties `model` and `view` or (legacy) an object representing the view\r\n   */\r\n  register(name, object) {\r\n    if (Array.isArray(name)) {\r\n      // if an array is passed, iterate by recursive call\r\n      name.forEach(name => this.register(name, object));\r\n      return object;\r\n    }\r\n\r\n    if (name.split(' ').length > 1) {\r\n      // if name with spaces is passed, split and pass as array\r\n      this.register(name.split(' '), object);\r\n      return object;\r\n    }\r\n\r\n    if ((!object.view && !object.model) || object instanceof Backbone.View) {\r\n      this.log.deprecated('View-only registrations are no longer supported');\r\n      object = { view: object };\r\n    }\r\n\r\n    if (object.view && !object.view.template) {\r\n      object.view.template = name;\r\n    }\r\n\r\n    const isModelSetAndInvalid = (object.model &&\r\n      !(object.model.prototype instanceof Backbone.Model) &&\r\n      !(object.model instanceof Function));\r\n    if (isModelSetAndInvalid) {\r\n      throw new Error('The registered model is not a Backbone.Model or Function');\r\n    }\r\n\r\n    const isViewSetAndInvalid = (object.view &&\r\n      !(object.view.prototype instanceof Backbone.View) &&\r\n      !(object.view instanceof Function));\r\n    if (isViewSetAndInvalid) {\r\n      throw new Error('The registered view is not a Backbone.View or Function');\r\n    }\r\n\r\n    this.store[name] = Object.assign({}, this.store[name], object);\r\n\r\n    return object;\r\n  }\r\n\r\n  /**\r\n   * Parses a view class name.\r\n   * @param {string|Backbone.Model|Backbone.View|object} nameModelViewOrData The name of the view class you want to fetch e.g. `\"hotgraphic\"` or its model or its json data\r\n   */\r\n  getViewName(nameModelViewOrData) {\r\n    if (typeof nameModelViewOrData === 'string') {\r\n      return nameModelViewOrData;\r\n    }\r\n    if (nameModelViewOrData instanceof Backbone.Model) {\r\n      nameModelViewOrData = nameModelViewOrData.toJSON();\r\n    }\r\n    if (nameModelViewOrData instanceof Backbone.View) {\r\n      let foundName;\r\n      Object.entries(this.store).forEach(([key, entry]) => {\r\n        if (!entry?.view) return;\r\n        if (!(nameModelViewOrData instanceof entry.view)) return;\r\n        foundName = key;\r\n        return true;\r\n      });\r\n      return foundName;\r\n    }\r\n    if (nameModelViewOrData instanceof Object) {\r\n      const names = [\r\n        typeof nameModelViewOrData._view === 'string' && nameModelViewOrData._view,\r\n        typeof nameModelViewOrData._component === 'string' && nameModelViewOrData._component,\r\n        typeof nameModelViewOrData._type === 'string' && nameModelViewOrData._type\r\n      ].filter(Boolean);\r\n      if (names.length) {\r\n        // find first fitting view name\r\n        const name = names.find(name => this.store[name]?.view);\r\n        return name || names.pop(); // return last available if none found\r\n      }\r\n    }\r\n    throw new Error('Cannot derive view class name from input');\r\n  }\r\n\r\n  /**\r\n   * Fetches a view class from the store. For a usage example, see either HotGraphic or Narrative\r\n   * @param {string|Backbone.Model|Backbone.View|object} nameModelViewOrData The name of the view class you want to fetch e.g. `\"hotgraphic\"` or its model or its json data\r\n   * @returns {Backbone.View} Reference to the view class\r\n   */\r\n  getViewClass(nameModelViewOrData) {\r\n    const name = this.getViewName(nameModelViewOrData);\r\n    const object = this.store[name];\r\n    if (!object) {\r\n      this.log.warnOnce(`A view for '${name}' isn't registered in your project`);\r\n      return;\r\n    }\r\n    const isBackboneView = (object.view?.prototype instanceof Backbone.View);\r\n    if (!isBackboneView && object.view instanceof Function) {\r\n      return object.view();\r\n    }\r\n    return object.view;\r\n  }\r\n\r\n  /**\r\n   * Parses a model class name.\r\n   * @param {string|Backbone.Model|object} name The name of the model you want to fetch e.g. `\"hotgraphic\"`, the model to process or its json data\r\n   */\r\n  getModelName(nameModelOrData) {\r\n    if (typeof nameModelOrData === 'string') {\r\n      return nameModelOrData;\r\n    }\r\n    if (nameModelOrData instanceof Backbone.Model) {\r\n      nameModelOrData = nameModelOrData.toJSON();\r\n    }\r\n    if (nameModelOrData instanceof Object) {\r\n      const name = nameModelOrData._component;\r\n      const entry = this.store[name];\r\n      const isViewOnlyQuestion = entry && !entry.model && entry.view?._isQuestionType;\r\n      if (isViewOnlyQuestion) {\r\n        // Use question model by default\r\n        this.log.deprecated(`Assuming a question model for a view-only question: ${name}`);\r\n        return 'question';\r\n      }\r\n      const names = [\r\n        typeof nameModelOrData._model === 'string' && nameModelOrData._model,\r\n        typeof nameModelOrData._component === 'string' && nameModelOrData._component,\r\n        typeof nameModelOrData._type === 'string' && nameModelOrData._type\r\n      ].filter(Boolean);\r\n      if (names.length) {\r\n        // find first fitting model name\r\n        const name = names.find(name => this.store[name]?.model);\r\n        return name || names.pop(); // return last available if none found\r\n      }\r\n    }\r\n    throw new Error('Cannot derive model class name from input');\r\n  }\r\n\r\n  /**\r\n   * Fetches a model class from the store. For a usage example, see either HotGraphic or Narrative\r\n   * @param {string|Backbone.Model|object} name The name of the model you want to fetch e.g. `\"hotgraphic\"` or its json data\r\n   * @returns {Backbone.Model} Reference to the view class\r\n   */\r\n  getModelClass(nameModelOrData) {\r\n    const name = this.getModelName(nameModelOrData);\r\n    const object = this.store[name];\r\n    if (!object) {\r\n      this.log.warnOnce(`A model for '${name}' isn't registered in your project`);\r\n      return;\r\n    }\r\n    const isBackboneModel = (object.model?.prototype instanceof Backbone.Model);\r\n    if (!isBackboneModel && object.model instanceof Function) {\r\n      return object.model();\r\n    }\r\n    return object.model;\r\n  }\r\n\r\n  /**\r\n   * Looks up a model by its `_id` property\r\n   * @param {string} id The id of the item e.g. \"co-05\"\r\n   * @return {Backbone.Model}\r\n   */\r\n  findById(id) {\r\n    return this.data.findById(id);\r\n  }\r\n\r\n  findViewByModelId(id) {\r\n    const model = this.data.findById(id);\r\n    if (!model) return;\r\n\r\n    if (model === this.parentView.model) return this.parentView;\r\n\r\n    const idPathToView = [id];\r\n    const currentLocationId = this.location._currentId;\r\n    const currentLocationModel = model.getAncestorModels().find(model => {\r\n      const modelId = model.get('_id');\r\n      if (modelId === currentLocationId) return true;\r\n      idPathToView.unshift(modelId);\r\n    });\r\n\r\n    if (!currentLocationModel) {\r\n      return console.warn(`Adapt.findViewByModelId() unable to find view for model id: ${id}`);\r\n    }\r\n\r\n    const foundView = idPathToView.reduce((view, currentId) => {\r\n      if (!view) return;\r\n      const childViews = view.getChildViews();\r\n      return childViews?.find(view => view.model.get('_id') === currentId);\r\n    }, this.parentView);\r\n\r\n    return foundView;\r\n  }\r\n\r\n  /**\r\n   * Returns the model represented by the trackingPosition.\r\n   * @param {Array<Number, Number>} trackingPosition Represents the relative location of a model to a _trackingId\r\n   * @returns {Backbone.Model}\r\n   */\r\n  findByTrackingPosition(trackingPosition) {\r\n    return this.data.findByTrackingPosition(trackingPosition);\r\n  }\r\n\r\n  /**\r\n   * Relative strings describe the number and type of hops in the model hierarchy\r\n   * @param {string} relativeString \"@component +1\" means to move one component forward from the current model\r\n   * This function would return the following:\r\n   * {\r\n   *     type: \"component\",\r\n   *     offset: 1\r\n   * }\r\n   * Trickle uses this function to determine where it should scrollTo after it unlocks\r\n   */\r\n  parseRelativeString(relativeString) {\r\n    const splitIndex = relativeString.search(/[ +\\-\\d]{1}/);\r\n    const type = relativeString.slice(0, splitIndex).replace(/^@/, '');\r\n    const offset = parseInt(relativeString.slice(splitIndex).trim() || 0);\r\n    return {\r\n      type: type,\r\n      offset: offset\r\n    };\r\n  }\r\n\r\n  addDirection() {\r\n    const defaultDirection = this.config.get('_defaultDirection');\r\n\r\n    $('html')\r\n      .addClass('dir-' + defaultDirection)\r\n      .attr('dir', defaultDirection);\r\n  }\r\n\r\n  disableAnimation() {\r\n    const disableAnimationArray = this.config.get('_disableAnimationFor');\r\n    const disableAnimation = this.config.get('_disableAnimation');\r\n\r\n    // Check if animations should be disabled\r\n    if (disableAnimationArray) {\r\n      for (let i = 0, l = disableAnimationArray.length; i < l; i++) {\r\n        if (!$('html').is(disableAnimationArray[i])) continue;\r\n        this.config.set('_disableAnimation', true);\r\n        $('html').addClass('disable-animation');\r\n        console.log('Animation disabled.');\r\n      }\r\n      return;\r\n    }\r\n\r\n    $('html').toggleClass('disable-animation', (disableAnimation === true));\r\n  }\r\n\r\n  async remove() {\r\n    const currentView = this.parentView;\r\n    if (currentView) {\r\n      currentView.model.setOnChildren({\r\n        '_isReady': false,\r\n        '_isRendered': false\r\n      });\r\n    }\r\n    this.trigger('preRemove', currentView);\r\n    await this.wait.queue();\r\n    // Facilitate contentObject transitions\r\n    if (currentView && this.get('_shouldDestroyContentObjects')) {\r\n      currentView.destroy();\r\n    }\r\n    this.trigger('remove', currentView);\r\n    _.defer(this.trigger.bind(this), 'postRemove', currentView);\r\n  }\r\n\r\n}\r\n\r\nexport default new AdaptSingleton();\r\n","export default class TemplateRenderEvent extends Backbone.Controller {\r\n\r\n  /**\r\n   * Template render event\r\n   * @param {string} type Event type\r\n   * @param {string} name Template name\r\n   * @param {string} mode \"template\" / \"partial\"\r\n   * @param {string} value Rendered template string\r\n   * @param {[*]} args Arguments passed to template for render\r\n   */\r\n  initialize(type, name, mode, value, args) {\r\n    /** @type {string} Event type */\r\n    this.type = type;\r\n    /** @type {string} Template name */\r\n    this.name = name;\r\n    /** @type {string} \"template\" / \"partial\" */\r\n    this.mode = mode;\r\n    /** @type {string} Rendered template string */\r\n    this.value = value;\r\n    /** @type {[*]} Arguments passed to template for render */\r\n    this.args = args;\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport TemplateRenderEvent from 'core/js/templateRenderEvent';\r\n\r\n/**\r\n * Adds template and partial, preRender and postRender events to Adapt\r\n */\r\n\r\nfunction onRender(cb) {\r\n  const intercept = (object, name, mode, cb) => {\r\n    return (object[name] = cb.bind(object, object[name], name, mode));\r\n  };\r\n  Object.keys(Handlebars.templates).forEach(name => {\r\n    intercept(Handlebars.templates, name, 'template', cb);\r\n  });\r\n  Object.keys(Handlebars.partials).forEach(name => {\r\n    intercept(Handlebars.partials, name, 'partial', cb);\r\n  });\r\n}\r\n\r\nonRender((template, name, mode, ...args) => {\r\n  // Send preRender event to allow modification of args\r\n  const preRenderEvent = new TemplateRenderEvent(`${mode}:preRender`, name, mode, null, args);\r\n  Adapt.trigger(preRenderEvent.type, preRenderEvent);\r\n\r\n  // Execute template\r\n  const value = template(...preRenderEvent.args);\r\n\r\n  // Send postRender event to allow modification of rendered template\r\n  const postRenderEvent = new TemplateRenderEvent(`${mode}:postRender`, name, mode, value, preRenderEvent.args);\r\n  Adapt.trigger(postRenderEvent.type, postRenderEvent);\r\n\r\n  // Return rendered, modified template\r\n  return postRenderEvent.value;\r\n});\r\n","import Adapt from 'core/js/adapt';\r\nimport 'core/js/templates';\r\n\r\n/**\r\n * 27 April 2020 https://github.com/adaptlearning/adapt_framework/issues/2734\r\n * Chrome on Android defers load events on images when lite mode is enabled\r\n * and as part of a data saving technique.\r\n *\r\n * Add a loading=\"eager\" attribute to all template and partial img tags where\r\n * the loading attribute is missing.\r\n */\r\nAdapt.on('app:dataReady', () => {\r\n  const config = Adapt.config.get('_fixes');\r\n  if (config?._imgLazyLoad === false) return;\r\n  applyImgLoadingFix();\r\n});\r\n\r\nfunction applyImgLoadingFix() {\r\n  const findImgTag = /<img([^>]*)>/gi;\r\n  const hasLoadingAttr = / loading=/gi;\r\n  Adapt.on('template:postRender partial:postRender', event => {\r\n    const imgTagsFound = event.value.match(findImgTag);\r\n    if (!imgTagsFound) {\r\n      return;\r\n    }\r\n    event.value = imgTagsFound.reduce((value, img) => {\r\n      if (hasLoadingAttr.test(img)) {\r\n        return value;\r\n      }\r\n      // Add loading=\"eager\" by default\r\n      return value.replace(img, img.replace(findImgTag, '<img loading=\"eager\"$1>'));\r\n    }, event.value);\r\n  });\r\n  Adapt.on('reactElement:preRender', event => {\r\n    if (event.name !== 'img') return;\r\n    const options = event.args[1] = event.args[1] || {};\r\n    if (options && options.hasOwnProperty('loading')) return;\r\n    options.loading = 'eager';\r\n  });\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Browser modifications to focus handling.\r\n * @class\r\n */\r\nexport default class BrowserFocus extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._onBlur = this._onBlur.bind(this);\r\n    this._onClick = this._onClick.bind(this);\r\n    this.$body = $('body');\r\n    this.listenTo(Adapt, {\r\n      'accessibility:ready': this._attachEventListeners\r\n    });\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    this.$body\r\n      .on('blur', '*', this._onBlur)\r\n      .on('blur', this._onBlur);\r\n    // 'Capture' event attachment for click\r\n    this.$body[0].addEventListener('click', this._onClick, true);\r\n  }\r\n\r\n  /**\r\n   * When any element in the document receives a blur event,\r\n   * check to see if it needs the `data-a11y-force-focus` attribute removing\r\n   * and check to see if it was blurred because a disabled attribute was added.\r\n   * If a disabled attribute was added, the focus will be moved forward.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onBlur(event) {\r\n    const config = Adapt.a11y.config;\r\n    if (!config._isEnabled || !config._options._isFocusNextOnDisabled) {\r\n      return;\r\n    }\r\n    const $element = $(event.target);\r\n    if ($element.is('[data-a11y-force-focus]')) {\r\n      _.defer(() => $element.removeAttr('tabindex data-a11y-force-focus'));\r\n    }\r\n    // From here, only check source elements\r\n    if (event.target !== event.currentTarget) {\r\n      return;\r\n    }\r\n    // Check if element losing focus is losing focus\r\n    // due to the addition of a disabled class\r\n    if (!$element.is('[disabled]')) {\r\n      return;\r\n    }\r\n    // Move focus to next readable element\r\n    Adapt.a11y.focusNext($element);\r\n  }\r\n\r\n  /**\r\n   * Force focus when clicked on a tabbable element,\r\n   * making sure `document.activeElement` is updated.\r\n   * Stop event handling on aria-disabled elements.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onClick(event) {\r\n    const $element = $(event.target);\r\n    if ($element.is('[aria-disabled=true]')) {\r\n      event.preventDefault();\r\n      event.stopImmediatePropagation();\r\n    }\r\n    const config = Adapt.a11y.config;\r\n    if (!config._isEnabled || !config._options._isFocusOnClickEnabled) {\r\n      return;\r\n    }\r\n    const $stack = $([...$element.toArray(), ...$element.parents().toArray()]);\r\n    const $focusable = $stack.filter(config._options._tabbableElements);\r\n    if (!$focusable.length) {\r\n      return;\r\n    }\r\n    // Force focus for screen reader enter / space press\r\n    $focusable[0].focus();\r\n  }\r\n\r\n}\r\n","export default class FocusOptions {\r\n\r\n  /**\r\n   * Options parser for focus functions.\r\n   * @param {Object} options\r\n   * @param {boolean} [options.preventScroll=false] Stops the browser from scrolling to the focused point. https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus\r\n   * @param {boolean} [options.defer=false] Add a defer to the focus call, allowing for user interface settling.\r\n   */\r\n  constructor({\r\n    preventScroll = false,\r\n    defer = false\r\n  } = {}) {\r\n    /**\r\n    * Stops the browser from scrolling to the focused point.\r\n    * https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus\r\n    * @type {boolean}\r\n    */\r\n    this.preventScroll = preventScroll;\r\n    /**\r\n     * Add a defer to the focus call, allowing for user interface settling.\r\n     * @type {boolean}\r\n     */\r\n    this.defer = defer;\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Manages whether or not the focus outline should be entirely removed\r\n * or removed until a key is pressed on a tabbable element.\r\n * @class\r\n */\r\nexport default class KeyboardFocusOutline extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this.$html = $('html');\r\n    this.showOnKeys = {\r\n      9: true, // tab\r\n      13: true, // enter\r\n      32: true, // space\r\n      37: true, // arrow left\r\n      38: true, // arrow up\r\n      39: true, // arrow right\r\n      40: true // arrow down\r\n    };\r\n    this.listenTo(Adapt, {\r\n      'accessibility:ready': this._attachEventListeners\r\n    });\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    document.addEventListener('keydown', this._onKeyDown);\r\n    this._start();\r\n  }\r\n\r\n  /**\r\n   * Add styling classes if required.\r\n   */\r\n  _start() {\r\n    const config = Adapt.a11y.config;\r\n    if (config._options._isFocusOutlineDisabled) {\r\n      this.$html.addClass('a11y-disable-focusoutline');\r\n      return;\r\n    }\r\n    if (!config._isEnabled || !config._options._isFocusOutlineKeyboardOnlyEnabled) {\r\n      return;\r\n    }\r\n    this.$html.addClass('a11y-disable-focusoutline');\r\n  }\r\n\r\n  /**\r\n   * Handle key down events for on a tabbable element.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onKeyDown(event) {\r\n    const config = Adapt.a11y.config;\r\n    if (config._options._isFocusOutlineDisabled) {\r\n      this.$html.addClass('a11y-disable-focusoutline');\r\n      return;\r\n    }\r\n    if (!config._isEnabled || !config._options._isFocusOutlineKeyboardOnlyEnabled || !this.showOnKeys[event.keyCode]) {\r\n      return;\r\n    }\r\n    const $element = $(event.target);\r\n    if (!$element.is(config._options._tabbableElements) || $element.is(config._options._focusOutlineKeyboardOnlyIgnore)) {\r\n      return;\r\n    }\r\n    this.$html.removeClass('a11y-disable-focusoutline');\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Controller for managing accessibilty logging, specifically used for\r\n * controlling the display of removed or deprecated API warnings.\r\n */\r\nexport default class Log extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._warned = {};\r\n  }\r\n\r\n  _hasWarned(args) {\r\n    const config = Adapt.a11y.config;\r\n    if (!config._options._warnFirstOnly) {\r\n      return false;\r\n    }\r\n    const hash = args.map(String).join(':');\r\n    if (this._warned[hash]) {\r\n      return true;\r\n    }\r\n    this._warned[hash] = true;\r\n    return false;\r\n  }\r\n\r\n  _canWarn() {\r\n    const config = Adapt.a11y.config;\r\n    return Boolean(config._options._warn);\r\n  }\r\n\r\n  removed(...args) {\r\n    if (!this._canWarn) {\r\n      return;\r\n    }\r\n    args = ['A11Y'].concat(args);\r\n    if (this._hasWarned(args)) {\r\n      return;\r\n    }\r\n    Adapt.log.removed(...args);\r\n    return this;\r\n  }\r\n\r\n  deprecated(...args) {\r\n    if (!this._canWarn) {\r\n      return;\r\n    }\r\n    args = ['A11Y'].concat(args);\r\n    if (this._hasWarned(args)) {\r\n      return;\r\n    }\r\n    Adapt.log.deprecated(...args);\r\n    return this;\r\n  }\r\n\r\n}\r\n","/**\r\n * Controller for blocking scroll events on specified elements.\r\n * @class\r\n */\r\nexport default class Scroll extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._onTouchStart = this._onTouchStart.bind(this);\r\n    this._onTouchEnd = this._onTouchEnd.bind(this);\r\n    this._onScrollEvent = this._onScrollEvent.bind(this);\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this._scrollDisabledElements = $([]);\r\n    this.$window = $(window);\r\n    this.$body = $('body');\r\n    this._preventScrollOnKeys = {\r\n      37: true, // left\r\n      38: true, // up\r\n      39: true, // right\r\n      40: true // down\r\n    };\r\n    this._ignoreKeysOnElementsMatching = 'textarea, input, select';\r\n    this._isRunning = false;\r\n    this._touchStartEventObject = null;\r\n  }\r\n\r\n  /**\r\n   * Block scrolling on the given elements.\r\n   *\r\n   * @param {Object|string|Array} $elements\r\n   */\r\n  disable($elements) {\r\n    $elements = $($elements);\r\n    this._scrollDisabledElements = this._scrollDisabledElements.add($elements);\r\n    this._checkRunning();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stop blocking scrolling on the given elements.\r\n   *\r\n   * @param {Object|string|Array} $items\r\n   */\r\n  enable($elements) {\r\n    $elements = $($elements);\r\n    if (!$elements.length) {\r\n      this.clear();\r\n      return this;\r\n    }\r\n    this._scrollDisabledElements = this._scrollDisabledElements.not($elements);\r\n    this._checkRunning();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stop blocking all scrolling.\r\n   */\r\n  clear() {\r\n    this._scrollDisabledElements = $([]);\r\n    this._checkRunning();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Start or stop listening for events to block if and when needed.\r\n   */\r\n  _checkRunning() {\r\n    if (!this._scrollDisabledElements.length) {\r\n      this._stop();\r\n      return;\r\n    }\r\n    this._start();\r\n  }\r\n\r\n  /**\r\n   * Start listening for events to block.\r\n   */\r\n  _start() {\r\n    if (this._isRunning) {\r\n      return;\r\n    }\r\n    this._isRunning = true;\r\n    window.addEventListener('touchstart', this._onTouchStart); // mobile\r\n    window.addEventListener('touchend', this._onTouchEnd); // mobile\r\n    window.addEventListener('touchmove', this._onScrollEvent, { passive: false }); // mobile\r\n    window.addEventListener('wheel', this._onScrollEvent, { passive: false });\r\n    document.addEventListener('wheel', this._onScrollEvent, { passive: false });\r\n    document.addEventListener('keydown', this._onKeyDown);\r\n  }\r\n\r\n  /**\r\n   * Capture the touchstart event object for deltaY calculations.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onTouchStart(event) {\r\n    event = $.event.fix(event);\r\n    this._touchStartEventObject = event;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Clear touchstart event object.\r\n   */\r\n  _onTouchEnd() {\r\n    this._touchStartEventObject = null;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Process a native scroll event.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onScrollEvent(event) {\r\n    event = $.event.fix(event);\r\n    return this._preventScroll(event);\r\n  }\r\n\r\n  /**\r\n   * Process a native keydown event.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onKeyDown(event) {\r\n    event = $.event.fix(event);\r\n    if (!this._preventScrollOnKeys[event.keyCode]) {\r\n      return;\r\n    }\r\n    const $target = $(event.target);\r\n    if ($target.is(this._ignoreKeysOnElementsMatching)) {\r\n      return;\r\n    }\r\n    return this._preventScroll(event);\r\n  }\r\n\r\n  /**\r\n   * Process jquery event object.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _preventScroll(event) {\r\n    const isGesture = (event.touches?.length > 1);\r\n    if (isGesture) {\r\n      // allow multiple finger gestures through\r\n      // this will unfortunately allow two finger background scrolling on mobile devices\r\n      // one finger background scrolling will still be disabled\r\n      return;\r\n    }\r\n    const $target = $(event.target);\r\n    if (this._scrollDisabledElements.length) {\r\n      const scrollingParent = this._getScrollingParent(event, $target);\r\n      if (scrollingParent.filter(this._scrollDisabledElements).length === 0) {\r\n        this.$window.scroll();\r\n        return;\r\n      }\r\n    }\r\n    event.preventDefault();\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Return the parent which will be scrolling from the current scroll event.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   * @param {Object} $target jQuery element object.\r\n   */\r\n  _getScrollingParent(event, $target) {\r\n    const isTouchEvent = event.type === 'touchmove';\r\n    const hasTouchStartEvent = this._touchStartEventObject?.originalEvent;\r\n    if (isTouchEvent && !hasTouchStartEvent) {\r\n      return $target;\r\n    }\r\n    const directionY = this._getScrollDirection(event);\r\n    if (directionY === 'none') {\r\n      return this.$body;\r\n    }\r\n    const parents = $target.parents();\r\n    for (let i = 0, l = parents.length; i < l; i++) {\r\n      const $parent = $(parents[i]);\r\n      if ($parent.is('body')) {\r\n        return this.$body;\r\n      }\r\n      if (!this._isScrollable($parent)) {\r\n        continue;\r\n      }\r\n      if (!this._isScrolling($parent, directionY)) {\r\n        continue;\r\n      }\r\n      return $parent;\r\n    }\r\n    return this.$body;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the specified target is scrollable.\r\n   *\r\n   * @param {Object} $target jQuery element object.\r\n   * @returns {boolean}\r\n   */\r\n  _isScrollable($target) {\r\n    const scrollType = $target.css('overflow-y');\r\n    if (scrollType !== 'auto' && scrollType !== 'scroll') {\r\n      return false;\r\n    }\r\n    const pointerEvents = $target.css('pointer-events');\r\n    if (pointerEvents === 'none') {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the specified target is the scrolling target.\r\n   *\r\n   * @param {Object} $target jQuery element object.\r\n   * @param {string} directionY 'none' | 'up' | 'down'\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n  _isScrolling($target, directionY) {\r\n    const scrollTop = Math.ceil($target.scrollTop());\r\n    const innerHeight = $target.outerHeight();\r\n    const scrollHeight = $target[0].scrollHeight;\r\n    let hasScrollingSpace = false;\r\n    switch (directionY) {\r\n      case 'down':\r\n        hasScrollingSpace = scrollTop + innerHeight < scrollHeight;\r\n        if (hasScrollingSpace) {\r\n          return true;\r\n        }\r\n        break;\r\n      case 'up':\r\n        hasScrollingSpace = scrollTop > 0;\r\n        if (hasScrollingSpace) {\r\n          return true;\r\n        }\r\n        break;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns the vertical direction of scroll.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   * @returns {string} 'none' | 'up' | 'down'\r\n   */\r\n  _getScrollDirection(event) {\r\n    const deltaY = this._getScrollDelta(event);\r\n    if (deltaY === 0) {\r\n      return 'none';\r\n    }\r\n    return deltaY > 0 ? 'up' : 'down';\r\n  }\r\n\r\n  /**\r\n   * Returns the number of pixels which is intended to be scrolled.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   * @returns {number}\r\n   */\r\n  _getScrollDelta(event) {\r\n    let deltaY = 0;\r\n    const isTouchEvent = event.type === 'touchmove';\r\n    const originalEvent = event.originalEvent;\r\n    if (isTouchEvent) {\r\n      // Touch events\r\n      // iOS previous + current scroll pos\r\n      const startOriginalEvent = this._touchStartEventObject.originalEvent;\r\n      let currentY = originalEvent.pageY;\r\n      let previousY = startOriginalEvent.pageY;\r\n      if (currentY === 0 || currentY === previousY) {\r\n        // Android chrome current scroll pos\r\n        currentY = originalEvent.touches[0].pageY;\r\n        previousY = startOriginalEvent.touches[0].pageY;\r\n      }\r\n      // Touch: delta calculated from touchstart pos vs touchmove pos\r\n      deltaY = currentY - previousY;\r\n    } else {\r\n      // Mouse events\r\n      const hasDeltaY = (originalEvent.wheelDeltaY || originalEvent.deltaY !== undefined);\r\n      if (hasDeltaY) {\r\n        // Desktop: Firefox & IE delta inverted\r\n        deltaY = -originalEvent.deltaY;\r\n      } else {\r\n        // Desktop: Chrome & Safari wheel delta\r\n        deltaY = (originalEvent.wheelDelta || 0);\r\n      }\r\n    }\r\n    return deltaY;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for events to block.\r\n   */\r\n  _stop() {\r\n    if (!this._isRunning) {\r\n      return;\r\n    }\r\n    this._isRunning = false;\r\n    window.removeEventListener('touchstart', this._onTouchStart); // mobile\r\n    window.removeEventListener('touchend', this._onTouchEnd); // mobile\r\n    // shouldn't need to supply 3rd arg when removing, but IE11 won't remove the event listener if you don't - see https://github.com/adaptlearning/adapt_framework/issues/2466\r\n    window.removeEventListener('touchmove', this._onScrollEvent, { passive: false }); // mobile\r\n    window.removeEventListener('wheel', this._onScrollEvent, { passive: false });\r\n    document.removeEventListener('wheel', this._onScrollEvent, { passive: false });\r\n    document.removeEventListener('keydown', this._onKeyDown);\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Controller for managing tab wrapping for popups.\r\n * @class\r\n */\r\nexport default class WrapFocus extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    _.bindAll(this, '_onWrapAround');\r\n    this.listenTo(Adapt, {\r\n      'accessibility:ready': this._attachEventListeners\r\n    });\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    const config = Adapt.a11y.config;\r\n    $('body').on('click focus', config._options._focusguard, this._onWrapAround);\r\n  }\r\n\r\n  /**\r\n   * If click or focus is received on any element with the focusguard class,\r\n   * loop focus around to the top of the document.\r\n   *\r\n   * @param {JQuery.Event} event\r\n   */\r\n  _onWrapAround(event) {\r\n    const config = Adapt.a11y.config;\r\n    if (!config._isEnabled || !config._options._isPopupWrapFocusEnabled) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    Adapt.a11y.focusFirst('body', { defer: false });\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Tabindex and aria-hidden manager for popups.\r\n * @class\r\n */\r\nexport default class Popup extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    /**\r\n     * List of elements which form the base at which elements are generally tabbale\r\n     * and aria-hidden='false'.\r\n     *\r\n     * @type {Array<Object>}\r\n     */\r\n    this._floorStack = [$('body')];\r\n    /**\r\n     * List of elements to return the focus to once leaving each stack.\r\n     *\r\n     * @type {Array<Object>}\r\n     */\r\n    this._focusStack = [];\r\n    /**\r\n     * Hash of tabindex states for each tabbable element in the popup stack.\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this._tabIndexes = {};\r\n    /**\r\n     * Hash of aria-hidden states for each tabbable element in the popup stack.\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this._ariaHiddens = {};\r\n    /**\r\n     * Incremented unique ids for elements belonging to a popup stack with saved\r\n     * states,\r\n     */\r\n    this._elementUIDIndex = 0;\r\n    this.listenTo(Adapt, {\r\n      'popup:opened'($element, ignoreInternalTrigger) {\r\n        if (ignoreInternalTrigger) {\r\n          return;\r\n        }\r\n        Adapt.a11y.log.deprecated('Adapt.trigger(\"popup:opened\", $element) is replaced with Adapt.a11y.popupOpened($element);');\r\n        this.opened($element, true);\r\n      },\r\n      'popup:closed'($target, ignoreInternalTrigger) {\r\n        if (ignoreInternalTrigger) {\r\n          return;\r\n        }\r\n        Adapt.a11y.log.deprecated('Adapt.trigger(\"popup:closed\", $target) is replaced with Adapt.a11y.popupClosed($target);');\r\n        this.closed($target, true);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Reorganise the tabindex and aria-hidden attributes in the document to\r\n   * restrict user interaction to the element specified.\r\n   *\r\n   * @param {Object} [$popupElement] Element encapulating the popup.\r\n   * @returns {Object} Returns `Adapt.a11y._popup`.\r\n   */\r\n  opened($popupElement, silent) {\r\n    // Capture currently active element or element specified\r\n    $popupElement = $popupElement || $(document.activeElement);\r\n    this._addPopupLayer($popupElement);\r\n    if (!silent) {\r\n      Adapt.trigger('popup:opened', $popupElement, true);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Restrict tabbing and screen reader access to selected element only.\r\n   *\r\n   * @param {Object} $popupElement Element encapulating the popup.\r\n   */\r\n  _addPopupLayer($popupElement) {\r\n    $popupElement = $($popupElement);\r\n    const config = Adapt.a11y.config;\r\n    if (!config._isEnabled || !config._options._isPopupManagementEnabled || $popupElement.length === 0) {\r\n      return $popupElement;\r\n    }\r\n    this._floorStack.push($popupElement);\r\n    this._focusStack.push($(document.activeElement));\r\n    let $elements = $(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);\r\n    const $branch = $popupElement.add($popupElement.parents());\r\n    const $siblings = $branch.siblings().filter(config._options._tabbableElementsExcludes);\r\n    $elements = $elements.add($siblings);\r\n    $elements.each((index, item) => {\r\n      const $item = $(item);\r\n      let elementUID;\r\n      if (typeof item.a11y_uid === 'undefined') {\r\n        item.a11y_uid = 'UID' + ++this._elementUIDIndex;\r\n      }\r\n      elementUID = item.a11y_uid;\r\n      if (this._tabIndexes[elementUID] === undefined) {\r\n        this._tabIndexes[elementUID] = [];\r\n      }\r\n      if (this._ariaHiddens[elementUID] === undefined) {\r\n        this._ariaHiddens[elementUID] = [];\r\n      }\r\n      const tabindex = $item.attr('tabindex');\r\n      const ariaHidden = $item.attr('aria-hidden');\r\n      this._tabIndexes[elementUID].push(tabindex === undefined ? '' : tabindex);\r\n      this._ariaHiddens[elementUID].push(ariaHidden === undefined ? '' : ariaHidden);\r\n      if (config._options._isPopupTabIndexManagementEnabled) {\r\n        $item.attr('tabindex', -1);\r\n      }\r\n      if (config._options._isPopupAriaHiddenManagementEnabled) {\r\n        $item.attr('aria-hidden', true);\r\n      }\r\n    });\r\n    const $items = $popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);\r\n    if (config._options._isPopupTabIndexManagementEnabled) {\r\n      $items.attr('tabindex', 0);\r\n    }\r\n    if (config._options._isPopupAriaHiddenManagementEnabled) {\r\n      $items\r\n        .removeAttr('aria-hidden')\r\n        .removeClass('aria-hidden')\r\n        .parents(config._options._ariaHiddenExcludes)\r\n        .removeAttr('aria-hidden')\r\n        .removeClass('aria-hidden');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close the last popup on the stack, restoring tabindex and aria-hidden\r\n   * attributes.\r\n   *\r\n   * @param {Object} [$focusElement] Element at which to move focus.\r\n   * @returns {Object} Returns `Adapt.a11y._popup`.\r\n   */\r\n  closed($focusElement, silent) {\r\n    const $previousFocusElement = this._removeLastPopupLayer();\r\n    $focusElement = $focusElement || $previousFocusElement || $('body');\r\n    if (!silent) {\r\n      Adapt.trigger('popup:closed', $focusElement, true);\r\n    }\r\n    Adapt.a11y.focusFirst($($focusElement), { preventScroll: true });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Restores tabbing and screen reader access to the state before the last\r\n   * `_addPopupLayer` call.\r\n   *\r\n   * @returns {Object} Returns previously active element.\r\n   */\r\n  _removeLastPopupLayer() {\r\n    const config = Adapt.a11y.config;\r\n    if (!config._isEnabled || !config._options._isPopupManagementEnabled) {\r\n      return $(document.activeElement);\r\n    }\r\n    // the body layer is the first element and must always exist\r\n    if (this._floorStack.length <= 1) {\r\n      return;\r\n    }\r\n    this._floorStack.pop();\r\n    $(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each((index, item) => {\r\n      const $item = $(item);\r\n      let previousTabIndex = '';\r\n      let previousAriaHidden = '';\r\n      let elementUID;\r\n      if (typeof item.a11y_uid === 'undefined') {\r\n        // assign element a unique id\r\n        item.a11y_uid = 'UID' + ++this._elementUIDIndex;\r\n      }\r\n      elementUID = item.a11y_uid;\r\n      if (this._tabIndexes[elementUID]?.length) {\r\n        // get previous tabindex if saved\r\n        previousTabIndex = this._tabIndexes[elementUID].pop();\r\n        previousAriaHidden = this._ariaHiddens[elementUID].pop();\r\n      }\r\n      if (this._tabIndexes[elementUID]?.length) {\r\n        // delete element tabindex store if empty\r\n        delete this._tabIndexes[elementUID];\r\n        delete this._ariaHiddens[elementUID];\r\n      }\r\n      if (config._options._isPopupTabIndexManagementEnabled) {\r\n        if (previousTabIndex === '') {\r\n          $item.removeAttr('tabindex');\r\n        } else {\r\n          $item.attr({\r\n            'tabindex': previousTabIndex\r\n          });\r\n        }\r\n      }\r\n      if (config._options._isPopupAriaHiddenManagementEnabled) {\r\n        if (previousAriaHidden === '') {\r\n          $item.removeAttr('aria-hidden');\r\n        } else {\r\n          $item.attr({\r\n            'aria-hidden': previousAriaHidden\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return this._focusStack.pop();\r\n  }\r\n\r\n  /**\r\n   * When a popup is open, this function makes it possible to swap the element\r\n   * that should receive focus on popup close.\r\n   *\r\n   * @param {Object} $focusElement Set a new element to focus on.\r\n   * @returns {Object} Returns previously set focus element.\r\n   */\r\n  setCloseTo($focusElement) {\r\n    const $original = this._focusStack.pop();\r\n    this._focusStack.push($focusElement);\r\n    return $original;\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * The old API is rerouted to the new API with warnings.\r\n */\r\n\r\nObject.assign($.fn, {\r\n\r\n  isFixedPostion() {\r\n    Adapt.a11y.log.removed('$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.');\r\n    return false;\r\n  },\r\n\r\n  a11y_aria_label() {\r\n    Adapt.a11y.log.removed('$(\"..\").a11y_aria_label was incorrect behaviour.');\r\n    return this;\r\n  },\r\n\r\n  limitedScrollTo() {\r\n    Adapt.a11y.log.removed('$.limitedScrollTo had no impact on the screen reader cursor.');\r\n    return this;\r\n  },\r\n\r\n  a11y_text() {\r\n    Adapt.a11y.log.removed('a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/');\r\n    return this;\r\n  },\r\n\r\n  a11y_selected() {\r\n    Adapt.a11y.log.removed('$(\"..\").a11y_selected is removed. Please use aria-live instead.');\r\n    return this;\r\n  },\r\n\r\n  a11y_on(isOn) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_on, use Adapt.a11y.findTabbable($element); and Adapt.a11y.toggleAccessible($elements, isAccessible); instead.');\r\n    const $tabbable = Adapt.a11y.findTabbable(this);\r\n    Adapt.a11y.toggleAccessible($tabbable, isOn);\r\n    return this;\r\n  },\r\n\r\n  a11y_only() {\r\n    Adapt.a11y.log.removed('$(\"..\").a11y_only, use Adapt.a11y.popupOpened($popupElement); instead.');\r\n    return this;\r\n  },\r\n\r\n  scrollDisable() {\r\n    if (Adapt.a11y.config._options._isScrollDisableEnabled === false) {\r\n      return this;\r\n    }\r\n    Adapt.a11y.log.deprecated('$(\"..\").scrollDisable, use Adapt.a11y.scrollDisable($elements); instead.');\r\n    Adapt.a11y.scrollDisable(this);\r\n    return this;\r\n  },\r\n\r\n  scrollEnable() {\r\n    if (Adapt.a11y.config._options._isScrollDisableEnabled === false) {\r\n      return this;\r\n    }\r\n    Adapt.a11y.log.deprecated('$(\"..\").scrollEnable, use Adapt.a11y.scrollEnable($elements); instead.');\r\n    Adapt.a11y.scrollEnable(this);\r\n    return this;\r\n  },\r\n\r\n  a11y_popup() {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_popup, use Adapt.a11y.popupOpened($popupElement); instead.');\r\n    return Adapt.a11y.popupOpened(this);\r\n  },\r\n\r\n  a11y_cntrl(isOn, withDisabled) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_cntrl, use Adapt.a11y.toggleAccessible($elements, isAccessible); and if needed Adapt.a11y.toggleEnabled($elements, isEnabled); instead.');\r\n    Adapt.a11y.toggleAccessible(this, isOn);\r\n    if (withDisabled) Adapt.a11y.toggleEnabled(this, isOn);\r\n    return this;\r\n  },\r\n\r\n  a11y_cntrl_enabled(isOn) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_cntrl_enabled, use Adapt.a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.');\r\n    Adapt.a11y.toggleAccessibleEnabled(this, isOn);\r\n    return this;\r\n  },\r\n\r\n  isReadable() {\r\n    Adapt.a11y.log.deprecated('$(\"..\").isReadable, use Adapt.a11y.isReadable($element); instead.');\r\n    return Adapt.a11y.isReadable(this);\r\n  },\r\n\r\n  findForward(selector) {\r\n    Adapt.a11y.log.removed('$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.');\r\n    return Adapt.a11y._findFirstForward(this, selector);\r\n  },\r\n\r\n  findWalk(selector) {\r\n    Adapt.a11y.log.removed('$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.');\r\n    return Adapt.a11y._findFindForwardDescendant(this, selector);\r\n  },\r\n\r\n  focusNoScroll() {\r\n    Adapt.a11y.log.deprecated('$(\"..\").focusNoScroll, use Adapt.a11y.focus($element); instead.');\r\n    return Adapt.a11y.focus(this);\r\n  },\r\n\r\n  focusNext(returnOnly) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").focusNext, use Adapt.a11y.focusNext($element); or if needed Adapt.a11y.findFirstReadable($element); instead.');\r\n    if (returnOnly) {\r\n      return Adapt.a11y.findFirstReadable(this);\r\n    }\r\n    return Adapt.a11y.focusNext(this);\r\n  },\r\n\r\n  focusOrNext(returnOnly) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").focusOrNext, use Adapt.a11y.focusFirst($element); or if needed Adapt.a11y.findFirstReadable($element); or Adapt.a11y.isReadable($element); instead.');\r\n    if (returnOnly) {\r\n      if (Adapt.a11y.isReadable(this)) return this;\r\n      return Adapt.a11y.findFirstReadable(this);\r\n    }\r\n    return Adapt.a11y.focusFirst(this);\r\n  },\r\n\r\n  a11y_focus(dontDefer) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_focus, use Adapt.a11y.focusFirst($element, { defer: true }); instead.');\r\n    Adapt.a11y.focusFirst(this, { defer: !dontDefer });\r\n    return this;\r\n  }\r\n\r\n});\r\n\r\nObject.assign($, {\r\n\r\n  a11y_alert() {\r\n    Adapt.a11y.log.removed('$.a11y_alert is removed. Please use aria-live instead.');\r\n    return this;\r\n  },\r\n\r\n  a11y_update() {\r\n    Adapt.a11y.log.removed('a11y_update is no longer required.');\r\n    return this;\r\n  },\r\n\r\n  a11y_text(text) {\r\n    Adapt.a11y.log.removed('a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/');\r\n    return text;\r\n  },\r\n\r\n  a11y_on(isOn, selector) {\r\n    Adapt.a11y.log.deprecated('$(\"..\").a11y_on, use Adapt.a11y.toggleHidden($elements, isHidden); instead.');\r\n    return Adapt.a11y.toggleHidden(selector, !isOn);\r\n  },\r\n\r\n  a11y_popdown($focusTarget) {\r\n    Adapt.a11y.log.removed('$.a11y_popdown, use Adapt.a11y.popupClosed($focusTarget); instead.');\r\n    return Adapt.a11y.popupClosed($focusTarget);\r\n  },\r\n\r\n  a11y_focus(dontDefer) {\r\n    Adapt.a11y.log.deprecated('$.a11y_focus, use Adapt.a11y.focusFirst(\"body\", { defer: true }); instead.');\r\n    Adapt.a11y.focusFirst('body', { defer: !dontDefer });\r\n    return this;\r\n  },\r\n\r\n  a11y_normalize(html) {\r\n    Adapt.a11y.log.deprecated('$.a11y_normalize, use Adapt.a11y.normalize(\"html\"); instead.');\r\n    return Adapt.a11y.normalize(html);\r\n  },\r\n\r\n  a11y_remove_breaks(html) {\r\n    Adapt.a11y.log.deprecated('$.a11y_remove_breaks, use Adapt.a11y.removeBreaks(\"html\"); instead.');\r\n    return Adapt.a11y.removeBreaks(html);\r\n  }\r\n\r\n});\r\n","import Adapt from 'core/js/adapt';\r\nimport BrowserFocus from 'core/js/a11y/browserFocus';\r\nimport FocusOptions from 'core/js/a11y/focusOptions';\r\nimport KeyboardFocusOutline from 'core/js/a11y/keyboardFocusOutline';\r\nimport Log from 'core/js/a11y/log';\r\nimport Scroll from 'core/js/a11y/scroll';\r\nimport WrapFocus from 'core/js/a11y/wrapFocus';\r\nimport Popup from 'core/js/a11y/popup';\r\n\r\nimport 'core/js/a11y/deprecated';\r\n\r\nclass A11y extends Backbone.Controller {\r\n\r\n  defaults() {\r\n    return {\r\n      _isFocusOutlineKeyboardOnlyEnabled: true,\r\n      /**\r\n       * `_isFocusOutlineDisabled` ignores `_isEnabled` and can be used when all other\r\n       * accessibility features have been disabled.\r\n       */\r\n      _isFocusOutlineDisabled: false,\r\n      _isFocusAssignmentEnabled: true,\r\n      _isFocusOnClickEnabled: true,\r\n      _isFocusNextOnDisabled: true,\r\n      _isScrollDisableEnabled: true,\r\n      _isAriaHiddenManagementEnabled: true,\r\n      _isPopupManagementEnabled: true,\r\n      _isPopupWrapFocusEnabled: true,\r\n      _isPopupAriaHiddenManagementEnabled: true,\r\n      _isPopupTabIndexManagementEnabled: true,\r\n      /**\r\n       * Do not change aria-hidden on these elements.\r\n       */\r\n      _ariaHiddenExcludes: ':not(#wrapper):not(body)',\r\n      _tabbableElements: 'a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])',\r\n      _focusOutlineKeyboardOnlyIgnore: 'input,textarea',\r\n      /**\r\n       * Designate these elements as not tabbable.\r\n       */\r\n      _tabbableElementsExcludes: ':not(.a11y-ignore):not([data-a11y-force-focus])',\r\n      _focusableElements: 'a,button,input,select,textarea,[tabindex],label',\r\n      _readableElements: '[role=heading],[aria-label],[aria-labelledby],[alt]',\r\n      /**\r\n       * Selector for elements which cause tab wrapping.\r\n       */\r\n      _focusguard: '.a11y-focusguard',\r\n      /**\r\n       * Specifies all stylistic elements.\r\n       */\r\n      _wrapStyleElements: 'b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb',\r\n\r\n      /**\r\n       * Logging settings\r\n       */\r\n      _warnFirstOnly: true,\r\n      _warn: true\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.isReadable = this.isReadable.bind(this);\r\n    this.isTabbable = this.isTabbable.bind(this);\r\n    this.$html = $('html');\r\n    this._htmlCharRegex = /&.*;/g;\r\n    /** @type {Object} */\r\n    this.config = null;\r\n    this._browserFocus = new BrowserFocus();\r\n    this._keyboardFocusOutline = new KeyboardFocusOutline();\r\n    this._wrapFocus = new WrapFocus();\r\n    this._popup = new Popup();\r\n    this._scroll = new Scroll();\r\n    this.log = new Log();\r\n\r\n    this._removeLegacyElements();\r\n    this.listenToOnce(Adapt, {\r\n      'app:dataLoaded': this._onDataLoaded,\r\n      'navigationView:postRender': this._removeLegacyElements\r\n    }, this);\r\n    Adapt.on('device:changed', this._setupNoSelect);\r\n    this.listenTo(Adapt, {\r\n      'router:location': this._onNavigationStart,\r\n      'contentObjectView:ready router:plugin': this._onNavigationEnd\r\n    });\r\n  }\r\n\r\n  _onDataLoaded() {\r\n    this.config = Adapt.config.get('_accessibility');\r\n    this.config._isActive = false;\r\n    this.config._options = _.defaults(this.config._options || {}, this.defaults());\r\n    Adapt.offlineStorage.set('a11y', false);\r\n    this.$html.toggleClass('has-accessibility', this.isEnabled());\r\n    this._setupNoSelect();\r\n    this._addFocuserDiv();\r\n    if (this._isReady) {\r\n      return;\r\n    }\r\n    this._isReady = true;\r\n    Adapt.trigger('accessibility:ready');\r\n  }\r\n\r\n  _setupNoSelect() {\r\n    if (!this.config?._disableTextSelectOnClasses) {\r\n      return;\r\n    }\r\n    const classes = this.config._disableTextSelectOnClasses.split(' ');\r\n    const isMatch = classes.some(className => this.$html.is(className));\r\n    this.$html.toggleClass('u-no-select', isMatch);\r\n  }\r\n\r\n  _addFocuserDiv() {\r\n    if ($('#a11y-focuser').length) {\r\n      return;\r\n    }\r\n    $('body').append($('<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\">&nbsp;</div>'));\r\n  }\r\n\r\n  _removeLegacyElements() {\r\n    const $legacyElements = $('body').children('#accessibility-toggle, #accessibility-instructions');\r\n    const $navigationElements = $('.nav').find('#accessibility-toggle, #accessibility-instructions');\r\n    if (!$legacyElements.length && !$navigationElements.length) {\r\n      return;\r\n    }\r\n    Adapt.log.warn('REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.');\r\n    $legacyElements.remove();\r\n    $navigationElements.remove();\r\n  }\r\n\r\n  _onNavigationStart() {\r\n    if (!this.isEnabled()) {\r\n      return;\r\n    }\r\n    // Stop document reading\r\n    _.defer(() => this.toggleHidden('.contentobject', true));\r\n  }\r\n\r\n  _onNavigationEnd(view) {\r\n    // Prevent sub-menu items provoking behaviour\r\n    if ((view?.model?.get('_id') !== Adapt.location._currentId) || !this.isEnabled()) {\r\n      return;\r\n    }\r\n    // Allow document to be read\r\n    this.toggleHidden('.contentobject', false);\r\n  }\r\n\r\n  isActive() {\r\n    this.log.removed('Accessibility is now always active when enabled. Please unify your user experiences.');\r\n    return false;\r\n  }\r\n\r\n  isEnabled() {\r\n    return this.config?._isEnabled;\r\n  }\r\n\r\n  /**\r\n   * Adds or removes `aria-hidden` attribute to elements.\r\n   *\r\n   * @param {Object|string|Array} $elements\r\n   * @param {boolean} [isHidden=true]\r\n   * @returns {Object} Chainable\r\n   */\r\n  toggleHidden($elements, isHidden = true) {\r\n    $elements = $($elements);\r\n    const config = this.config;\r\n    if (!config._isEnabled || !config._options._isAriaHiddenManagementEnabled) {\r\n      return this;\r\n    }\r\n    if (isHidden === true) {\r\n      $elements.attr('aria-hidden', true);\r\n    } else {\r\n      $elements.removeAttr('aria-hidden');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds or removes `aria-hidden` and `disabled` attributes and `disabled`\r\n   * classes to elements.\r\n   *\r\n   * @param {Object|string|Array} $elements\r\n   * @param {boolean} [isHidden=true]\r\n   * @returns {Object} Chainable\r\n   */\r\n  toggleAccessibleEnabled($elements, isAccessibleEnabled) {\r\n    this.toggleAccessible($elements, isAccessibleEnabled);\r\n    this.toggleEnabled($elements, isAccessibleEnabled);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds or removes `aria-hidden` attribute and disables `tabindex` on elements.\r\n   *\r\n   * @param {Object|string|Array} $elements\r\n   * @param {boolean} [isReadable=true]\r\n   * @returns {Object} Chainable\r\n   */\r\n  toggleAccessible($elements, isReadable = true) {\r\n    $elements = $($elements);\r\n    const config = this.config;\r\n    if (!config._isEnabled || !config._options._isAriaHiddenManagementEnabled || $elements.length === 0) {\r\n      return this;\r\n    }\r\n    if (!isReadable) {\r\n      $elements.attr({\r\n        tabindex: '-1',\r\n        'aria-hidden': 'true'\r\n      }).addClass('aria-hidden');\r\n    } else {\r\n      $elements.removeAttr('aria-hidden tabindex').removeClass('aria-hidden');\r\n      $elements.parents(config._options._ariaHiddenExcludes).removeAttr('aria-hidden').removeClass('aria-hidden');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds or removes `disabled` attribute and `disabled` class.\r\n   *\r\n   * @param {Object|string|Array} $elements\r\n   * @param {boolean} [isEnabled=true]\r\n   * @returns {Object} Chainable\r\n   */\r\n  toggleEnabled($elements, isEnabled = true) {\r\n    $elements = $($elements);\r\n    if ($elements.length === 0) {\r\n      return this;\r\n    }\r\n    if (!isEnabled) {\r\n      $elements.attr({\r\n        tabindex: '-1',\r\n        'aria-disabled': 'true'\r\n      }).addClass('is-disabled');\r\n    } else {\r\n      $elements.removeAttr('aria-disabled tabindex').removeClass('is-disabled');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Find the first tabbable element after the specified element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @returns {Object}\r\n   */\r\n  findFirstTabbable($element) {\r\n    $element = $($element).first();\r\n    return this._findFirstForward($element, this.isTabbable);\r\n  }\r\n\r\n  /**\r\n   * Find the first readable element after the specified element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @returns {Object}\r\n   */\r\n  findFirstReadable($element) {\r\n    $element = $($element).first();\r\n    return this._findFirstForward($element, this.isReadable);\r\n  }\r\n\r\n  /**\r\n   * Find all tabbable elements in the specified element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @returns {Object}\r\n   */\r\n  findTabbable($element) {\r\n    const config = this.config;\r\n    return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);\r\n  }\r\n\r\n  /**\r\n   * Find all readable elements in the specified element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   */\r\n  findReadable($element) {\r\n    return $($element).find('*').filter((index, element) => this.isReadable(element));\r\n  }\r\n\r\n  /**\r\n   * Check if the element is natively or explicitly tabbable.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @returns {boolean|undefined}\r\n   */\r\n  isTabbable($element) {\r\n    const config = this.config;\r\n    const value = $($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);\r\n    if (!value) {\r\n      return undefined; // Allow _findForward to descend\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Check if the first item is readable by a screen reader.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @param {boolean} [checkParents=true] Check if parents are inaccessible.\r\n   * @returns {boolean}\r\n   */\r\n  isReadable($element, checkParents = true) {\r\n    const config = this.config;\r\n    $element = $($element).first();\r\n\r\n    const $branch = checkParents\r\n      ? $element.add($element.parents())\r\n      : $element;\r\n\r\n    const isNotVisible = $branch.toArray().some(item => {\r\n      const $item = $(item);\r\n      // make sure item is not explicitly invisible\r\n      return $item.css('display') === 'none' ||\r\n        $item.css('visibility') === 'hidden' ||\r\n        $item.attr('aria-hidden') === 'true';\r\n    });\r\n    if (isNotVisible) {\r\n      return false;\r\n    }\r\n\r\n    // check that the component is natively tabbable or\r\n    // will be knowingly read by a screen reader\r\n    const hasNativeFocusOrIsScreenReadable = $element.is(config._options._focusableElements) ||\r\n      $element.is(config._options._readableElements);\r\n    if (hasNativeFocusOrIsScreenReadable) {\r\n      return true;\r\n    }\r\n    const childNodes = $element[0].childNodes;\r\n    for (let c = 0, cl = childNodes.length; c < cl; c++) {\r\n      const childNode = childNodes[c];\r\n      const isTextNode = (childNode.nodeType === 3);\r\n      if (!isTextNode) {\r\n        continue;\r\n      }\r\n      const isOnlyWhiteSpace = /^\\s*$/.test(childNode.nodeValue);\r\n      if (isOnlyWhiteSpace) {\r\n        continue;\r\n      }\r\n      return true;\r\n    }\r\n    return undefined; // Allows _findForward to decend.\r\n  }\r\n\r\n  /**\r\n   * Find forward in the DOM, descending and ascending to move forward\r\n   * as appropriate.\r\n   *\r\n   * If the selector is a function it should returns true, false or undefined.\r\n   * Returning true matches the item and returns it. Returning false means do\r\n   * not match or descend into this item, returning undefined means do not match,\r\n   * but descend into this item.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @param {string|function|undefined} selector\r\n   * @returns {Object} Returns found descendant.\r\n   */\r\n  _findFirstForward($element, selector) {\r\n    $element = $($element).first();\r\n\r\n    // make sure iterator is correct, use boolean or selector comparison\r\n    // appropriately\r\n    let iterator;\r\n    switch (typeof selector) {\r\n      case 'string':\r\n        // make selector iterator\r\n        iterator = function($tag) {\r\n          return $tag.is(selector) || undefined;\r\n        };\r\n        break;\r\n      case 'function':\r\n        iterator = selector;\r\n        break;\r\n      case 'undefined':\r\n        // find first next element\r\n        iterator = Boolean;\r\n    }\r\n\r\n    if ($element.length === 0) {\r\n      return $element.not('*');\r\n    }\r\n\r\n    // check children by walking the tree\r\n    let $found = this._findFirstForwardDescendant($element, iterator);\r\n    if ($found.length) {\r\n      return $found;\r\n    }\r\n\r\n    // check subsequent siblings\r\n    $element.nextAll().toArray().some(sibling => {\r\n      const $sibling = $(sibling);\r\n      const value = iterator($sibling);\r\n\r\n      // skip this sibling if explicitly instructed\r\n      if (value === false) {\r\n        return;\r\n      }\r\n\r\n      if (value) {\r\n        // sibling matched\r\n        $found = $sibling;\r\n        return true;\r\n      }\r\n\r\n      // check parent sibling children by walking the tree\r\n      $found = this._findFirstForwardDescendant($sibling, iterator);\r\n      if ($found.length) return true;\r\n    });\r\n    if ($found.length) {\r\n      return $found;\r\n    }\r\n\r\n    // move through parents towards the body element\r\n    $element.add($element.parents()).toArray().reverse().some(parent => {\r\n      const $parent = $(parent);\r\n      if (iterator($parent) === false) {\r\n        // skip this parent if explicitly instructed\r\n        return false;\r\n      }\r\n\r\n      // move through parents nextAll siblings\r\n      return $parent.nextAll().toArray().some(sibling => {\r\n        const $sibling = $(sibling);\r\n        const value = iterator($sibling);\r\n\r\n        // skip this sibling if explicitly instructed\r\n        if (value === false) {\r\n          return;\r\n        }\r\n\r\n        if (value) {\r\n          // sibling matched\r\n          $found = $sibling;\r\n          return true;\r\n        }\r\n\r\n        // check parent sibling children by walking the tree\r\n        $found = this._findFirstForwardDescendant($sibling, iterator);\r\n        if ($found.length) {\r\n          return true;\r\n        }\r\n      });\r\n    });\r\n\r\n    if (!$found.length) {\r\n      return $element.not('*');\r\n    }\r\n    return $found;\r\n  }\r\n\r\n  /**\r\n   * Find descendant in a DOM tree, work from selected to branch-end, through allowed\r\n   * branch structures in hierarchy order\r\n   *\r\n   * If the selector is a function it should returns true, false or undefined.\r\n   * Returning true matches the item and returns it. Returning false means do\r\n   * not match or descend into this item, returning undefined means do not match,\r\n   * but descend into this item.\r\n   *\r\n   * @param {Object|string|Array} $element jQuery element to start from.\r\n   * @param {string|function|undefined} selector\r\n   * @returns {Object} Returns found descendant.\r\n   */\r\n  _findFirstForwardDescendant($element, selector) {\r\n    $element = $($element).first();\r\n\r\n    // make sure iterator is correct, use boolean or selector comparison\r\n    // appropriately\r\n    let iterator;\r\n    switch (typeof selector) {\r\n      case 'string':\r\n        // make selector iterator\r\n        iterator = function($tag) {\r\n          return $tag.is(selector) || undefined;\r\n        };\r\n        break;\r\n      case 'function':\r\n        iterator = selector;\r\n        break;\r\n      case 'undefined':\r\n        // find first next element\r\n        iterator = Boolean;\r\n    }\r\n\r\n    const $notFound = $element.not('*');\r\n    if ($element.length === 0) {\r\n      return $notFound;\r\n    }\r\n\r\n    // keep walked+passed children in a stack\r\n    const stack = [{\r\n      item: $element[0],\r\n      value: undefined\r\n    }];\r\n    let stackIndexPosition = 0;\r\n    let childIndexPosition = stackIndexPosition + 1;\r\n    do {\r\n\r\n      const stackEntry = stack[stackIndexPosition];\r\n      const $stackItem = $(stackEntry.item);\r\n\r\n      // check current item\r\n      switch (stackEntry.value) {\r\n        case true:\r\n          return $stackItem;\r\n        case false:\r\n          return $notFound;\r\n      }\r\n\r\n      // get i stack children\r\n      $stackItem.children().toArray().forEach(item => {\r\n        const $item = $(item);\r\n        const value = iterator($item);\r\n\r\n        // item explicitly not allowed, don't add to stack,\r\n        // skip children\r\n        if (value === false) {\r\n          return;\r\n        }\r\n\r\n        // item passed or readable, add to stack before any parent\r\n        // siblings\r\n        stack.splice(childIndexPosition++, 0, {\r\n          item: item,\r\n          value: value\r\n        });\r\n      });\r\n\r\n      // move to next stack item\r\n      stackIndexPosition++;\r\n      // keep place to inject children\r\n      childIndexPosition = stackIndexPosition + 1;\r\n    } while (stackIndexPosition < stack.length);\r\n\r\n    return $notFound;\r\n  }\r\n\r\n  /**\r\n   * Assign focus to the next readable element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @param {FocusOptions} options\r\n   * @returns {Object} Chainable\r\n   */\r\n  focusNext($element, options) {\r\n    options = new FocusOptions(options);\r\n    $element = $($element).first();\r\n    $element = this.findFirstReadable($element);\r\n    this.focus($element, options);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Assign focus to either the specified element if it is readable or the\r\n   * next readable element.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @param {FocusOptions} options\r\n   * @returns {Object}\r\n   */\r\n  focusFirst($element, options) {\r\n    options = new FocusOptions(options);\r\n    $element = $($element).first();\r\n    if (this.isReadable($element)) {\r\n      this.focus($element, options);\r\n      return $element;\r\n    }\r\n    $element = this.findFirstReadable($element);\r\n    this.focus($element, options);\r\n    return $element;\r\n  }\r\n\r\n  /**\r\n   * Force focus to the specified element with/without a defer or scroll.\r\n   *\r\n   * @param {Object|string|Array} $element\r\n   * @param {FocusOptions} options\r\n   * @returns {Object} Chainable\r\n   */\r\n  focus($element, options) {\r\n    options = new FocusOptions(options);\r\n    $element = $($element).first();\r\n    const config = this.config;\r\n    if (!config._isEnabled || !config._options._isFocusAssignmentEnabled || $element.length === 0) {\r\n      return this;\r\n    }\r\n    function perform() {\r\n      if ($element.attr('tabindex') === undefined) {\r\n        $element.attr({\r\n          'tabindex': '-1',\r\n          'data-a11y-force-focus': 'true'\r\n        });\r\n      }\r\n      if (options.preventScroll) {\r\n        const y = $(window).scrollTop();\r\n        try {\r\n          $element[0].focus({\r\n            preventScroll: true\r\n          });\r\n        } catch (e) {\r\n          // Drop focus errors as only happens when the element\r\n          // isn't attached to the DOM.\r\n        }\r\n        switch (Adapt.device.browser) {\r\n          case 'internet explorer':\r\n          case 'microsoft edge':\r\n          case 'safari':\r\n            // return to previous scroll position due to no support for preventScroll\r\n            window.scrollTo(null, y);\r\n        }\r\n      } else {\r\n        $element[0].focus();\r\n      }\r\n    }\r\n    if (options.defer) {\r\n      _.defer(perform);\r\n    } else {\r\n      perform();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Used to convert html to text aria-labels.\r\n   *\r\n   * @param {string} htmls Any html strings.\r\n   * @returns {string} Returns text without markup or html encoded characters.\r\n   */\r\n  normalize(htmls) {\r\n    htmls = [...arguments].filter(Boolean).filter(_.isString).join(' ');\r\n    const text = $('<div>' + htmls + '</div>').text();\r\n    // Remove all html encoded characters, such as &apos;\r\n    return text.replace(this._htmlCharRegex, '');\r\n  }\r\n\r\n  /**\r\n   * Removes all html tags except stylistic elements.\r\n   * Useful for producing uninterrupted text for screen readers from\r\n   * any html.\r\n   *\r\n   * @param  {string} htmls Any html strings.\r\n   * @return {string} Returns html string without markup which would cause screen reader to pause.\r\n   */\r\n  removeBreaks(htmls) {\r\n    htmls = [...arguments].filter(Boolean).filter(_.isString).join(' ');\r\n    const $div = $('<div>' + htmls + '</div>');\r\n    const stack = [ $div[0] ];\r\n    let stackIndex = 0;\r\n    const outputs = [];\r\n    do {\r\n      if (stack[stackIndex].childNodes.length) {\r\n        const nodes = stack[stackIndex].childNodes;\r\n        const usable = nodes.filter(node => {\r\n          const isTextNode = (node.nodeType === 3);\r\n          if (isTextNode) {\r\n            return true;\r\n          }\r\n          const isStyleElement = $(node).is(this.config._options._wrapStyleElements);\r\n          if (isStyleElement) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        outputs.push.apply(outputs, usable);\r\n        stack.push.apply(stack, nodes);\r\n      }\r\n      stackIndex++;\r\n    } while (stackIndex < stack.length);\r\n    let rtnText = '';\r\n    outputs.forEach(function(item) {\r\n      rtnText += item.outerHTML || item.textContent;\r\n    });\r\n    return rtnText;\r\n  }\r\n\r\n  /**\r\n   * @param {Object|string|Array} $elements\r\n   * @returns {Object} Chainable\r\n   */\r\n  scrollEnable($elements) {\r\n    this._scroll.enable($elements);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {Object|string|Array} $elements\r\n   * @returns {Object} Chainable\r\n   */\r\n  scrollDisable($elements) {\r\n    this._scroll.disable($elements);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * To apply accessibilty handling to a tag, isolating the user.\r\n   *\r\n   * @param {Object} $popupElement Element encapsulating the popup.\r\n   * @returns {Object} Chainable\r\n   */\r\n  popupOpened($popupElement) {\r\n    this._popup.opened($popupElement);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove the isolation applied with a call to `popupOpened`.\r\n   *\r\n   * @param {Object} [$focusElement] Element to move focus to.\r\n   * @returns {Object} Chainable\r\n   */\r\n  popupClosed($focusElement) {\r\n    this._popup.closed($focusElement);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * When a popup is open, this function makes it possible to swap the element\r\n   * that should receive focus on popup close.\r\n   *\r\n   * @param {Object} $focusElement Set a new element to focus on.\r\n   * @returns {Object} Returns previously set focus element.\r\n   */\r\n  setPopupCloseTo($focusElement) {\r\n    return this._popup.setCloseTo($focusElement);\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.a11y = new A11y());\r\n","import Adapt from 'core/js/adapt';\r\nimport a11y from 'core/js/a11y';\r\n\r\n/**\r\n * Backwards compatibility `Adapt.accessibility` reroutes to `Adapt.a11y`\r\n * with a warning.\r\n */\r\nObject.defineProperty(Adapt, 'accessibility', {\r\n\r\n  get() {\r\n    a11y.log.deprecated('Adapt.accessibility has moved to Adapt.a11y');\r\n    return a11y;\r\n  }\r\n\r\n});\r\n","import Adapt from 'core/js/adapt';\r\n\r\nexport default class AdaptCollection extends Backbone.Collection {\r\n\r\n  initialize(models, options) {\r\n    this.once('reset', this.loadedData, this);\r\n  }\r\n\r\n  loadedData() {\r\n    Adapt.trigger('adaptCollection:dataLoaded');\r\n  }\r\n\r\n}\r\n","// Used to determine if log call should be printed based on log level\r\nconst LOG_LEVEL = ENUM([\r\n  'DEBUG',\r\n  'INFO',\r\n  'WARN',\r\n  'ERROR',\r\n  'FATAL'\r\n]);\r\n\r\nexport default LOG_LEVEL;\r\n","import Adapt from 'core/js/adapt';\r\nimport LOG_LEVEL from 'core/js/enums/logLevelEnum';\r\n\r\nclass Logging extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._config = {\r\n      _isEnabled: true,\r\n      _level: LOG_LEVEL.INFO.asLowerCase, // Default log level\r\n      _console: true, // Log to console\r\n      _warnFirstOnly: true // Show only first of identical removed and deprecated warnings\r\n    };\r\n    this._warned = {};\r\n    this.listenToOnce(Adapt, 'configModel:dataLoaded', this.onLoadConfigData);\r\n  }\r\n\r\n  onLoadConfigData() {\r\n\r\n    this.loadConfig();\r\n\r\n    this.debug('Logging config loaded');\r\n\r\n    this.trigger('log:ready');\r\n\r\n  }\r\n\r\n  loadConfig() {\r\n\r\n    if (Adapt.config.has('_logging')) {\r\n      this._config = Adapt.config.get('_logging');\r\n    }\r\n\r\n    this.checkQueryStringOverride();\r\n\r\n  }\r\n\r\n  checkQueryStringOverride() {\r\n\r\n    // Override default log level with level present in query string\r\n    const matches = window.location.search.match(/[?&]loglevel=([a-z]*)/i);\r\n    if (!matches || matches.length < 2) return;\r\n\r\n    const override = LOG_LEVEL(matches[1].toUpperCase());\r\n    if (!override) return;\r\n\r\n    this._config._level = override.asLowerCase;\r\n    this.debug('Loglevel override in query string:', this._config._level);\r\n\r\n  }\r\n\r\n  debug(...args) {\r\n    this._log(LOG_LEVEL.DEBUG, args);\r\n  }\r\n\r\n  info(...args) {\r\n    this._log(LOG_LEVEL.INFO, args);\r\n  }\r\n\r\n  warn(...args) {\r\n    this._log(LOG_LEVEL.WARN, args);\r\n  }\r\n\r\n  error(...args) {\r\n    this._log(LOG_LEVEL.ERROR, args);\r\n  }\r\n\r\n  fatal(...args) {\r\n    this._log(LOG_LEVEL.FATAL, args);\r\n  }\r\n\r\n  removed(...args) {\r\n    args = ['REMOVED'].concat(args);\r\n    this.warnOnce(...args);\r\n  }\r\n\r\n  deprecated(...args) {\r\n    args = ['DEPRECATED'].concat(args);\r\n    this.warnOnce(...args);\r\n  }\r\n\r\n  warnOnce(...args) {\r\n    if (this._hasWarned(args)) {\r\n      return;\r\n    }\r\n    this._log(LOG_LEVEL.WARN, args);\r\n  }\r\n\r\n  _log(level, data) {\r\n\r\n    const isEnabled = (this._config._isEnabled);\r\n    if (!isEnabled) return;\r\n\r\n    const configLevel = LOG_LEVEL(this._config._level.toUpperCase());\r\n\r\n    const isLogLevelAllowed = (level >= configLevel);\r\n    if (!isLogLevelAllowed) return;\r\n\r\n    this._logToConsole(level, data);\r\n\r\n    // Allow error reporting plugins to hook and report to logging systems\r\n    this.trigger('log', level, data);\r\n    this.trigger('log:' + level.asLowerCase, level, data);\r\n\r\n  }\r\n\r\n  _logToConsole(level, data) {\r\n\r\n    const shouldLogToConsole = (this._config._console);\r\n    if (!shouldLogToConsole) return;\r\n\r\n    const log = [level.asUpperCase + ':'];\r\n    data && log.push(...data);\r\n\r\n    // is there a matching console method we can use e.g. console.error()?\r\n    if (console[level.asLowerCase]) {\r\n      console[level.asLowerCase](...log);\r\n    } else {\r\n      console.log(...log);\r\n    }\r\n  }\r\n\r\n  _hasWarned(args) {\r\n    if (!this._config._warnFirstOnly) {\r\n      return false;\r\n    }\r\n    const hash = args.map(String).join(':');\r\n    if (this._warned[hash]) {\r\n      return true;\r\n    }\r\n    this._warned[hash] = true;\r\n    return false;\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.log = new Logging());\r\n","import Adapt from 'core/js/adapt';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\nimport 'core/js/logging';\r\nimport semver from 'semver';\r\n\r\nexport default class BuildModel extends LockingModel {\r\n\r\n  defaults() {\r\n    return {\r\n      jsonext: 'json'\r\n    };\r\n  }\r\n\r\n  initialize(attrs, options) {\r\n    this.url = options.url;\r\n    // Fetch data & if successful trigger event to enable plugins to stop course files loading\r\n    // Then check if course files can load\r\n    // 'configModel:loadCourseData' event starts the core content collections and models being fetched\r\n    this.fetch({\r\n      success: () => {\r\n        this.isLoaded = true;\r\n        Adapt.trigger('buildModel:dataLoaded');\r\n      },\r\n      error: () => {\r\n        console.log('Unable to load adapt/js/build.js');\r\n        Adapt.trigger('buildModel:dataLoaded');\r\n      }\r\n    });\r\n  }\r\n\r\n  isFrameworkVersion(version) {\r\n    return semver.satisfies(this.get('package').version, version, { includePrerelease: true });\r\n  }\r\n\r\n  isPluginInstalled(name, version = '*') {\r\n    const plugin = this.get('plugins').find(plugin => {\r\n      if (plugin.name !== name) return false;\r\n      return semver.satisfies(plugin.version, version, { includePrerelease: true });\r\n    });\r\n    return Boolean(plugin);\r\n  }\r\n\r\n  whenReady() {\r\n    if (this.isLoaded) return Promise.resolve();\r\n    return new Promise(resolve => {\r\n      Adapt.once('buildModel:dataLoaded', resolve);\r\n    });\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\n\r\nexport default class ConfigModel extends LockingModel {\r\n\r\n  defaults() {\r\n    return {\r\n      screenSize: {\r\n        large: 900,\r\n        medium: 760,\r\n        small: 520\r\n      },\r\n      _forceRouteLocking: false,\r\n      _canLoadData: true,\r\n      _disableAnimation: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Parse the incoming search queries for certain parameter values to use as defaults\r\n   */\r\n  setValuesFromURLParams() {\r\n    const paramMappings = {\r\n      dir: '_defaultDirection',\r\n      lang: '_defaultLanguage'\r\n    };\r\n\r\n    const params = new URLSearchParams(window.location.search);\r\n\r\n    Object.entries(paramMappings).forEach(([key, value]) => {\r\n      const passedVal = params.get(key);\r\n      if (!passedVal) return;\r\n      this.set(value, passedVal);\r\n    });\r\n  }\r\n\r\n  initialize(attrs, options) {\r\n    this.url = options.url;\r\n    // Fetch data & if successful trigger event to enable plugins to stop course files loading\r\n    // Then check if course files can load\r\n    // 'configModel:loadCourseData' event starts the core content collections and models being fetched\r\n    this.fetch({\r\n      success: () => {\r\n        this.setValuesFromURLParams();\r\n\r\n        Adapt.trigger('offlineStorage:prepare');\r\n        Adapt.wait.queue(() => {\r\n          Adapt.trigger('configModel:dataLoaded');\r\n          if (!this.get('_canLoadData')) return;\r\n          Adapt.trigger('configModel:loadCourseData');\r\n        });\r\n      },\r\n      error: () => console.log('Unable to load course/config.json')\r\n    });\r\n  }\r\n\r\n  loadData() {}\r\n\r\n}\r\n","export default class ModelEvent extends Backbone.Controller {\r\n\r\n  /**\r\n   * @param {string} type Event name / type\r\n   * @param {Backbone.Model} target Origin model\r\n   * @param {*} [value] Any value that should be carried through on the event\r\n   */\r\n  initialize(type, target, value) {\r\n    this.type = type;\r\n    this.target = target;\r\n    this.value = value;\r\n    this.canBubble = true;\r\n    this.deepPath = [target];\r\n    this.timeStamp = null;\r\n  }\r\n\r\n  stopPropagation() {\r\n    this.canBubble = false;\r\n  }\r\n\r\n  addPath(target) {\r\n    this.deepPath.unshift(target);\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport ModelEvent from 'core/js/modelEvent';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\nimport 'core/js/logging';\r\n\r\nexport default class AdaptModel extends LockingModel {\r\n\r\n  toJSON() {\r\n    // Perform shallow clone\r\n    const json = { ...this.attributes };\r\n    // Remove deprecated values as they are not true json\r\n    delete json._children;\r\n    delete json._parent;\r\n    // Perform deep clone\r\n    return $.extend(true, {}, json);\r\n  }\r\n\r\n  get(name) {\r\n    switch (name) {\r\n      case '_parent':\r\n      case '_children':\r\n        Adapt.log.deprecated(`Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')`);\r\n    }\r\n    return super.get(name);\r\n  }\r\n\r\n  defaults() {\r\n    return {\r\n      _canShowFeedback: true,\r\n      _classes: '',\r\n      _canReset: false,\r\n      _canRequestChild: false,\r\n      _isComplete: false,\r\n      _isInteractionComplete: false,\r\n      _isA11yRegionEnabled: false,\r\n      _isA11yCompletionDescriptionEnabled: true,\r\n      _requireCompletionOf: -1,\r\n      _isEnabled: true,\r\n      _isResetOnRevisit: false,\r\n      _isAvailable: true,\r\n      _isOptional: false,\r\n      _isRendered: false,\r\n      _isReady: false,\r\n      _isVisible: true,\r\n      _isLocked: false,\r\n      _isHidden: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Fetch an array representing the relative location of the model to the nearest _trackingId\r\n   * @returns {Array<Number, Number>}\r\n   */\r\n  get trackingPosition() {\r\n    const firstDescendant = this.getAllDescendantModels(false).concat([this])[0];\r\n    const nearestTrackingIdModel = [firstDescendant].concat(firstDescendant.getAncestorModels()).find(model => model.has('_trackingId'));\r\n    if (!nearestTrackingIdModel) return;\r\n    const trackingId = nearestTrackingIdModel.get('_trackingId');\r\n    const trackingIdDescendants = [nearestTrackingIdModel].concat(nearestTrackingIdModel.getAllDescendantModels(true));\r\n    const indexInTrackingIdDescendants = trackingIdDescendants.findIndex(descendant => descendant === this);\r\n    if (indexInTrackingIdDescendants >= 0) {\r\n      // Is either the nearestTrackingIdModel (0) or one of its flattened descendants (>0)\r\n      return [ trackingId, indexInTrackingIdDescendants ];\r\n    }\r\n    // Is an ancestor of the nearestTrackingIdModel\r\n    const trackingIdAncestors = nearestTrackingIdModel.getAncestorModels();\r\n    const ancestorDistance = trackingIdAncestors.findIndex(ancestor => ancestor === this);\r\n    return [ trackingId, -(ancestorDistance + 1) ];\r\n  }\r\n\r\n  /**\r\n   * The AAT always sets the value of `_isResetOnRevisit` to a String\r\n   * which is fine for the 'soft' and 'hard' values - but 'false' needs\r\n   * converting to Boolean - see #2825\r\n   */\r\n  parse(data) {\r\n    if (data._isResetOnRevisit === 'false') {\r\n      data._isResetOnRevisit = false;\r\n    }\r\n    return data;\r\n  }\r\n\r\n  trackable() {\r\n    return [\r\n      '_id',\r\n      '_isComplete',\r\n      '_isInteractionComplete'\r\n    ];\r\n  }\r\n\r\n  trackableType() {\r\n    return [\r\n      String,\r\n      Boolean,\r\n      Boolean\r\n    ];\r\n  }\r\n\r\n  bubblingEvents() {\r\n    return [\r\n      'change:_isComplete',\r\n      'change:_isInteractionComplete',\r\n      'change:_isActive'\r\n    ];\r\n  }\r\n\r\n  setupModel() {\r\n    if (this.hasManagedChildren) {\r\n      this.setupChildListeners();\r\n    }\r\n\r\n    this.init();\r\n\r\n    _.defer(() => {\r\n      if (this.hasManagedChildren) {\r\n        this.checkCompletionStatus();\r\n\r\n        this.checkInteractionCompletionStatus();\r\n\r\n        this.checkLocking();\r\n      }\r\n\r\n      this.setupTrackables();\r\n\r\n    });\r\n\r\n  }\r\n\r\n  setupTrackables() {\r\n\r\n    // Limit state trigger calls and make state change callbacks batched-asynchronous\r\n    const originalTrackableStateFunction = this.triggerTrackableState;\r\n    this.triggerTrackableState = _.compose(\r\n      () => {\r\n\r\n        // Flag that the function is awaiting trigger\r\n        this.triggerTrackableState.isQueued = true;\r\n\r\n      },\r\n      _.debounce(() => {\r\n\r\n        // Trigger original function\r\n        originalTrackableStateFunction.apply(this);\r\n\r\n        // Unset waiting flag\r\n        this.triggerTrackableState.isQueued = false;\r\n\r\n      }, 17)\r\n    );\r\n\r\n    // Listen to model changes, trigger trackable state change when appropriate\r\n    this.listenTo(this, 'change', ({ changed }) => {\r\n\r\n      // Skip if trigger queued or adapt hasn't started yet\r\n      if (this.triggerTrackableState.isQueued || !Adapt.attributes._isStarted) {\r\n        return;\r\n      }\r\n\r\n      // Check that property is trackable\r\n      const trackablePropertyNames = _.result(this, 'trackable', []);\r\n      const changedPropertyNames = Object.keys(changed);\r\n      const isTrackable = changedPropertyNames.find(item => {\r\n        return trackablePropertyNames.includes(item);\r\n      });\r\n\r\n      if (isTrackable) {\r\n        // Trigger trackable state change\r\n        this.triggerTrackableState();\r\n      }\r\n    });\r\n  }\r\n\r\n  setupChildListeners() {\r\n    const children = this.getChildren();\r\n    if (!children.length) {\r\n      return;\r\n    }\r\n\r\n    this.listenTo(children, {\r\n      'all': this.onAll,\r\n      'bubble': this.bubble,\r\n      'change:_isReady': this.checkReadyStatus,\r\n      'change:_isComplete': this.onIsComplete,\r\n      'change:_isInteractionComplete': this.checkInteractionCompletionStatus\r\n    });\r\n  }\r\n\r\n  init() {}\r\n\r\n  getTrackableState() {\r\n\r\n    const trackable = this.resultExtend('trackable', []);\r\n    const json = this.toJSON();\r\n\r\n    const args = trackable;\r\n    args.unshift(json);\r\n\r\n    return _.pick(...args);\r\n\r\n  }\r\n\r\n  setTrackableState(state) {\r\n\r\n    const trackable = this.resultExtend('trackable', []);\r\n\r\n    const args = trackable;\r\n    args.unshift(state);\r\n\r\n    state = _.pick(...args);\r\n\r\n    this.set(state);\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  triggerTrackableState() {\r\n\r\n    Adapt.trigger('state:change', this, this.getTrackableState());\r\n\r\n  }\r\n\r\n  reset(type, force) {\r\n    if (!this.get('_canReset') && !force) return;\r\n\r\n    type = type || true;\r\n\r\n    switch (type) {\r\n      case 'hard': case true:\r\n        this.set({\r\n          _isEnabled: true,\r\n          _isComplete: false,\r\n          _isInteractionComplete: false\r\n        });\r\n        break;\r\n      case 'soft':\r\n        this.set({\r\n          _isEnabled: true,\r\n          _isInteractionComplete: false\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if any child models which have been _isRendered are not _isReady.\r\n   * If all rendered child models are marked ready then this model will be\r\n   * marked _isReady: true as well.\r\n   * @param {AdaptModel} [model]\r\n   * @param {boolean} [value]\r\n   * @returns {boolean}\r\n   */\r\n  checkReadyStatus(model, value) {\r\n    if (value === false) {\r\n      // Do not respond to _isReady: false as _isReady is unset throughout\r\n      // the rendering process\r\n      return false;\r\n    }\r\n    // Filter children based upon whether they are available\r\n    // Check if any _isRendered: true children return _isReady: false\r\n    // If not - set this model to _isReady: true\r\n    const children = this.getAvailableChildModels();\r\n    if (children.find(child => child.get('_isReady') === false && child.get('_isRendered'))) {\r\n      return false;\r\n    }\r\n\r\n    this.set('_isReady', true);\r\n    return true;\r\n  }\r\n\r\n  setCompletionStatus() {\r\n    if (!this.get('_isVisible')) return;\r\n\r\n    this.set({\r\n      _isComplete: true,\r\n      _isInteractionComplete: true\r\n    });\r\n  }\r\n\r\n  checkCompletionStatus() {\r\n    // defer to allow other change:_isComplete handlers to fire before cascading to parent\r\n    Adapt.checkingCompletion();\r\n    _.defer(this.checkCompletionStatusFor.bind(this), '_isComplete');\r\n  }\r\n\r\n  checkInteractionCompletionStatus() {\r\n    // defer to allow other change:_isInteractionComplete handlers to fire before cascading to parent\r\n    Adapt.checkingCompletion();\r\n    _.defer(this.checkCompletionStatusFor.bind(this), '_isInteractionComplete');\r\n  }\r\n\r\n  /**\r\n   * Function for checking whether the supplied completion attribute should be set to true or false.\r\n   * It iterates over our immediate children, checking the same completion attribute on any mandatory child\r\n   * to see if enough/all of them them have been completed. If enough/all have, we set our attribute to true;\r\n   * if not, we set it to false.\r\n   * @param {string} [completionAttribute] Either '_isComplete' or '_isInteractionComplete'. Defaults to '_isComplete' if not supplied.\r\n   */\r\n\r\n  checkCompletionStatusFor(completionAttribute = '_isComplete') {\r\n    let completed = false;\r\n    const children = this.getAvailableChildModels();\r\n    const requireCompletionOf = this.get('_requireCompletionOf');\r\n\r\n    if (requireCompletionOf === -1) { // a value of -1 indicates that ALL mandatory children must be completed\r\n      completed = children.every(child => {\r\n        return child.get(completionAttribute) || child.get('_isOptional');\r\n      });\r\n    } else {\r\n      completed = (children.filter(child => {\r\n        return child.get(completionAttribute) && !child.get('_isOptional');\r\n      }).length >= requireCompletionOf);\r\n    }\r\n\r\n    this.set(completionAttribute, completed);\r\n\r\n    Adapt.checkedCompletion();\r\n  }\r\n\r\n  /**\r\n   * Returns a string describing the type group of this model.\r\n   * Strings should be lowercase and not plurlaized.\r\n   * i.e. 'page', 'menu', 'contentobject', 'component', 'article', 'block'\r\n   * Override in inheritance chain.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {}\r\n\r\n  /**\r\n   * Returns true if this model is of the type group described.\r\n   * Automatically manages pluralization typeGroup and matches lowercase only.\r\n   * Pluralized typeGroups and uppercase characters in typeGroups are discouraged.\r\n   * @param {string} type Type group name i.e. course, contentobject, article, block, component\r\n   * @returns {boolean}\r\n   */\r\n  isTypeGroup(typeGroup) {\r\n    const hasUpperCase = /[A-Z]+/.test(typeGroup);\r\n    const isPluralized = typeGroup.slice(-1) === 's';\r\n    const lowerCased = typeGroup.toLowerCase();\r\n    const singular = isPluralized && lowerCased.slice(0, -1); // remove pluralization if ending in s\r\n    const singularLowerCased = (singular || lowerCased).toLowerCase();\r\n    if (isPluralized || hasUpperCase) {\r\n      Adapt.log.deprecated(`'${typeGroup}' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '${singularLowerCased}'.`);\r\n    }\r\n    const pluralizedLowerCaseTypes = [\r\n      singularLowerCased,\r\n      !isPluralized && `${lowerCased}s` // pluralize if not ending in s\r\n    ].filter(Boolean);\r\n    const typeGroups = this.getTypeGroups();\r\n    if (_.intersection(pluralizedLowerCaseTypes, typeGroups).length) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Returns an array of strings describing the model type groups.\r\n   * All strings are lowercase and should not be pluralized.\r\n   * i.e. ['course', 'menu', 'contentobject'], ['page', 'contentobject'], ['component']\r\n   * @returns {[string]}\r\n   */\r\n  getTypeGroups() {\r\n    if (this._typeGroups) return this._typeGroups;\r\n    const typeGroups = [ this.get('_type') ];\r\n    let parentClass = this;\r\n    while ((parentClass = Object.getPrototypeOf(parentClass))) {\r\n      if (!parentClass.hasOwnProperty('getTypeGroup')) continue;\r\n      typeGroups.push(parentClass.getTypeGroup.call(this));\r\n    }\r\n    return (this._typeGroups = _.uniq(typeGroups.filter(Boolean).map(s => s.toLowerCase())));\r\n  }\r\n\r\n  /**\r\n   * Searches the model's ancestors to find the first instance of the specified ancestor type\r\n   * @param {string} [ancestorType] Valid values are 'course', 'pages', 'contentObjects', 'articles' or 'blocks'.\r\n   * If left blank, the immediate ancestor (if there is one) is returned\r\n   * @return {object} Reference to the model of the first ancestor of the specified type that's found - or `undefined` if none found\r\n   */\r\n  findAncestor(ancestorType) {\r\n    const parent = this.getParent();\r\n    if (!parent) return;\r\n    if (!ancestorType || parent.isTypeGroup(ancestorType)) {\r\n      return parent;\r\n    }\r\n    return parent.findAncestor(ancestorType);\r\n  }\r\n\r\n  /**\r\n   * Returns all the descendant models of a specific type\r\n   * @param {string} descendants Valid values are 'contentobject', 'page', 'menu', 'article', 'block', 'component', 'question'\r\n   * @param {object} options an object that defines the search type and the properties/values to search on. Currently only the `where` search type (equivalent to `Backbone.Collection.where()`) is supported.\r\n   * @param {object} options.where\r\n   * @return {array}\r\n   * @example\r\n   * //find all available, non-optional components\r\n   * this.findDescendantModels('component', { where: { _isAvailable: true, _isOptional: false }});\r\n   */\r\n  findDescendantModels(descendants, options) {\r\n    const allDescendantsModels = this.getAllDescendantModels();\r\n    const returnedDescendants = allDescendantsModels.filter(model => {\r\n      return model.isTypeGroup(descendants);\r\n    });\r\n\r\n    if (!options) {\r\n      return returnedDescendants;\r\n    }\r\n\r\n    if (options.where) {\r\n      return returnedDescendants.filter(descendant => {\r\n        for (let property in options.where) {\r\n          const value = options.where[property];\r\n          if (descendant.get(property) !== value) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetches the sub structure of a model as a flattened array\r\n   *\r\n   * Such that the tree:\r\n   *  { a1: { b1: [ c1, c2 ], b2: [ c3, c4 ] }, a2: { b3: [ c5, c6 ] } }\r\n   *\r\n   * will become the array (parent first = false):\r\n   *  [ c1, c2, b1, c3, c4, b2, a1, c5, c6, b3, a2 ]\r\n   *\r\n   * or (parent first = true):\r\n   *  [ a1, b1, c1, c2, b2, c3, c4, a2, b3, c5, c6 ]\r\n   *\r\n   * This is useful when sequential operations are performed on the menu/page/article/block/component hierarchy.\r\n   * @param {boolean} [isParentFirst]\r\n   * @return {array}\r\n   */\r\n  getAllDescendantModels(isParentFirst) {\r\n\r\n    const descendants = [];\r\n\r\n    if (!this.hasManagedChildren) {\r\n      return descendants;\r\n    }\r\n\r\n    const children = this.getChildren();\r\n\r\n    children.models.forEach(child => {\r\n\r\n      if (!child.hasManagedChildren) {\r\n        descendants.push(child);\r\n        return;\r\n      }\r\n\r\n      const subDescendants = child.getAllDescendantModels(isParentFirst);\r\n      if (isParentFirst === true) {\r\n        descendants.push(child);\r\n      }\r\n\r\n      descendants.push(...subDescendants);\r\n\r\n      if (isParentFirst !== true) {\r\n        descendants.push(child);\r\n      }\r\n    });\r\n\r\n    return descendants;\r\n\r\n  }\r\n\r\n  /**\r\n   * Returns a relative model from the Adapt hierarchy\r\n   *\r\n   * Such that in the tree:\r\n   *  { a1: { b1: [ c1, c2 ], b2: [ c3, c4 ] }, a2: { b3: [ c5, c6 ] } }\r\n   *\r\n   *  c1.findRelativeModel('@block +1') = b2;\r\n   *  c1.findRelativeModel('@component +4') = c5;\r\n   *\r\n   * @see Adapt.parseRelativeString for a description of relativeStrings\r\n   * @param {string} relativeString\r\n   * @param {object} options Search configuration settings\r\n   * @param {boolean} options.limitParentId\r\n   * @param {function} options.filter\r\n   * @param {boolean} options.loop\r\n   * @return {array}\r\n   */\r\n  findRelativeModel(relativeString, options = {}) {\r\n    // return a model relative to the specified one if opinionated\r\n    const rootModel = options.limitParentId ?\r\n      Adapt.findById(options.limitParentId) :\r\n      Adapt.course;\r\n\r\n    const relativeDescriptor = Adapt.parseRelativeString(relativeString);\r\n    const searchBackwards = (relativeDescriptor.offset < 0);\r\n    let moveBy = Math.abs(relativeDescriptor.offset);\r\n    let movementCount = 0;\r\n\r\n    const hasDescendantsOfType = Boolean(this.findDescendantModels(relativeDescriptor.type).length);\r\n    if (hasDescendantsOfType) {\r\n      // move by one less as first found is considered next\r\n      // will find descendants on either side but not inside\r\n      moveBy--;\r\n    }\r\n\r\n    let pageDescendants;\r\n    if (searchBackwards) {\r\n      // parents first [p1,a1,b1,c1,c2,a2,b2,c3,c4,p2,a3,b3,c6,c7,a4,b4,c8,c9]\r\n      pageDescendants = [rootModel];\r\n      pageDescendants.push(...rootModel.getAllDescendantModels(true));\r\n\r\n      // reverse so that we don't need a forward and a backward iterating loop\r\n      // reversed [c9,c8,b4,a4,c7,c6,b3,a3,p2,c4,c3,b2,a2,c2,c1,b1,a1,p1]\r\n      pageDescendants.reverse();\r\n    } else {\r\n      // children first [c1,c2,b1,a1,c3,c4,b2,a2,p1,c6,c7,b3,a3,c8,c9,b4,a4,p2]\r\n      pageDescendants = rootModel.getAllDescendantModels(false);\r\n      pageDescendants.push(rootModel);\r\n    }\r\n\r\n    // find current index in array\r\n    const modelId = this.get('_id');\r\n    const modelIndex = pageDescendants.findIndex(pageDescendant => {\r\n      if (pageDescendant.get('_id') === modelId) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    const isFilterFunction = (typeof options.filter === 'function');\r\n\r\n    if (options.loop) {\r\n      // normalize offset position to allow for overflow looping\r\n      const totalOfType = pageDescendants.reduce((count, model) => {\r\n        if (!model.isTypeGroup(relativeDescriptor.type)) return count;\r\n        return ++count;\r\n      }, 0);\r\n      // take the remainder after removing whole units of the type count\r\n      moveBy = moveBy % totalOfType;\r\n      // double up entries to allow for overflow looping\r\n      pageDescendants = pageDescendants.concat(pageDescendants.slice(0));\r\n    }\r\n\r\n    for (let i = modelIndex, l = pageDescendants.length; i < l; i++) {\r\n      const descendant = pageDescendants[i];\r\n      if (!descendant.isTypeGroup(relativeDescriptor.type)) continue;\r\n      const isSelf = (i === modelIndex);\r\n      // https://github.com/adaptlearning/adapt_framework/issues/3031\r\n      if (!isSelf && isFilterFunction && !options.filter(descendant)) continue;\r\n      if (movementCount > moveBy) {\r\n        // there is no descendant which matches this relativeString\r\n        // probably looking for the descendant 0 in a parent\r\n        break;\r\n      }\r\n      if (movementCount === moveBy) {\r\n        return Adapt.findById(descendant.get('_id'));\r\n      }\r\n      movementCount++;\r\n    }\r\n\r\n  }\r\n\r\n  get hasManagedChildren() {\r\n    return true;\r\n  }\r\n\r\n  getChildren() {\r\n    if (this._childrenCollection) {\r\n      return this._childrenCollection;\r\n    }\r\n\r\n    let childrenCollection;\r\n\r\n    if (!this.hasManagedChildren) {\r\n      childrenCollection = new Backbone.Collection();\r\n    } else {\r\n      const id = this.get('_id');\r\n      // Look up child by _parentId from Adapt.data\r\n      const children = Adapt.data.filter(model => model.get('_parentId') === id);\r\n      childrenCollection = new Backbone.Collection(children);\r\n    }\r\n\r\n    if (this.get('_type') === 'block' &&\r\n      childrenCollection.length === 2 &&\r\n      childrenCollection.models[0].get('_layout') !== 'left') {\r\n      // Components may have a 'left' or 'right' _layout,\r\n      // so ensure they appear in the correct order\r\n      // Re-order component models to correct it\r\n      childrenCollection.comparator = '_layout';\r\n      childrenCollection.sort();\r\n    }\r\n\r\n    this.setChildren(childrenCollection);\r\n    return this._childrenCollection;\r\n  }\r\n\r\n  setChildren(children) {\r\n    this._childrenCollection = children;\r\n    // Setup deprecated reference\r\n    this.set('_children', children);\r\n  }\r\n\r\n  getAvailableChildModels() {\r\n    return this.getChildren().where({\r\n      _isAvailable: true\r\n    });\r\n  }\r\n\r\n  getParent() {\r\n    if (this._parentModel) {\r\n      return this._parentModel;\r\n    }\r\n    const parentId = this.get('_parentId');\r\n    if (!parentId) return;\r\n    // Look up parent by id from Adapt.data\r\n    this.setParent(Adapt.findById(parentId));\r\n    return this._parentModel;\r\n  }\r\n\r\n  setParent(parent) {\r\n    this._parentModel = parent;\r\n    this.set('_parentId', this._parentModel.get('_id'));\r\n    // Set up deprecated reference\r\n    this.set('_parent', this._parentModel);\r\n  }\r\n\r\n  getAncestorModels(shouldIncludeChild) {\r\n    const parents = [];\r\n    let context = this;\r\n\r\n    if (shouldIncludeChild) parents.push(context);\r\n\r\n    while (context.has('_parentId')) {\r\n      context = context.getParent();\r\n      parents.push(context);\r\n    }\r\n\r\n    return parents.length ? parents : null;\r\n  }\r\n\r\n  getSiblings(passSiblingsAndIncludeSelf) {\r\n    const id = this.get('_id');\r\n    const parentId = this.get('_parentId');\r\n    let siblings;\r\n    if (!passSiblingsAndIncludeSelf) {\r\n      // returns a collection of siblings excluding self\r\n      if (this._hasSiblingsAndSelf === false) {\r\n        return this.get('_siblings');\r\n      }\r\n      siblings = Adapt.data.filter(model => {\r\n        return model.get('_parentId') === parentId &&\r\n          model.get('_id') !== id;\r\n      });\r\n\r\n      this._hasSiblingsAndSelf = false;\r\n\r\n    } else {\r\n      // returns a collection of siblings including self\r\n      if (this._hasSiblingsAndSelf) {\r\n        return this.get('_siblings');\r\n      }\r\n\r\n      siblings = Adapt.data.filter(model => {\r\n        return model.get('_parentId') === parentId;\r\n      });\r\n      this._hasSiblingsAndSelf = true;\r\n    }\r\n\r\n    const siblingsCollection = new Backbone.Collection(siblings);\r\n    this.set('_siblings', siblingsCollection);\r\n    return siblingsCollection;\r\n  }\r\n\r\n  /**\r\n   * @param  {string} key\r\n   * @param  {any} value\r\n   * @param  {Object} options\r\n   */\r\n  setOnChildren(...args) {\r\n\r\n    this.set(...args);\r\n\r\n    if (!this.hasManagedChildren) return;\r\n\r\n    const children = this.getChildren();\r\n    children.models.forEach(child => child.setOnChildren(...args));\r\n\r\n  }\r\n\r\n  /**\r\n   * @deprecated since v3.2.3 - please use `model.set('_isOptional', value)` instead\r\n   */\r\n  setOptional(value) {\r\n    Adapt.log.deprecated(`Use model.set('_isOptional', value) as setOptional() may be removed in the future`);\r\n    this.set({ _isOptional: value });\r\n  }\r\n\r\n  checkLocking() {\r\n    const lockType = this.get('_lockType');\r\n\r\n    if (!lockType) return;\r\n\r\n    switch (lockType) {\r\n      case 'sequential':\r\n        this.setSequentialLocking();\r\n        break;\r\n      case 'unlockFirst':\r\n        this.setUnlockFirstLocking();\r\n        break;\r\n      case 'lockLast':\r\n        this.setLockLastLocking();\r\n        break;\r\n      case 'custom':\r\n        this.setCustomLocking();\r\n        break;\r\n      default:\r\n        console.warn(`AdaptModel.checkLocking: unknown _lockType '${lockType}' found on ${this.get('_id')}`);\r\n    }\r\n  }\r\n\r\n  setSequentialLocking() {\r\n    const children = this.getAvailableChildModels();\r\n\r\n    for (let i = 1, j = children.length; i < j; i++) {\r\n      children[i].set('_isLocked', !children[i - 1].get('_isComplete'));\r\n    }\r\n  }\r\n\r\n  setUnlockFirstLocking() {\r\n    const children = this.getAvailableChildModels();\r\n    const isFirstChildComplete = children[0].get('_isComplete');\r\n\r\n    for (let i = 1, j = children.length; i < j; i++) {\r\n      children[i].set('_isLocked', !isFirstChildComplete);\r\n    }\r\n  }\r\n\r\n  setLockLastLocking() {\r\n    const children = this.getAvailableChildModels();\r\n    const lastIndex = children.length - 1;\r\n\r\n    for (let i = lastIndex - 1; i >= 0; i--) {\r\n      if (!children[i].get('_isComplete')) {\r\n        return children[lastIndex].set('_isLocked', true);\r\n      }\r\n    }\r\n\r\n    children[lastIndex].set('_isLocked', false);\r\n  }\r\n\r\n  setCustomLocking() {\r\n    const children = this.getAvailableChildModels();\r\n    children.forEach(child => {\r\n      child.set('_isLocked', this.shouldLock(child));\r\n    });\r\n  }\r\n\r\n  shouldLock(child) {\r\n    const lockedBy = child.get('_lockedBy');\r\n\r\n    if (!lockedBy) return false;\r\n\r\n    for (let i = lockedBy.length - 1; i >= 0; i--) {\r\n      const id = lockedBy[i];\r\n\r\n      try {\r\n        const model = Adapt.findById(id);\r\n\r\n        if (!model.get('_isAvailable')) continue;\r\n        if (!model.get('_isComplete')) return true;\r\n      } catch (e) {\r\n        console.warn(`AdaptModel.shouldLock: unknown _lockedBy ID '${id}' found on ${child.get('_id')}`);\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  onIsComplete() {\r\n    this.checkCompletionStatus();\r\n\r\n    this.checkLocking();\r\n  }\r\n\r\n  /**\r\n   * Used before a model is rendered to determine if it should be reset to its\r\n   * default values.\r\n   */\r\n  checkIfResetOnRevisit() {\r\n    const isResetOnRevisit = this.get('_isResetOnRevisit');\r\n    if (!isResetOnRevisit) {\r\n      return;\r\n    }\r\n    // If reset is enabled set defaults\r\n    this.reset(isResetOnRevisit);\r\n  }\r\n\r\n  /**\r\n   * Clones this model and all managed children returning a new branch.\r\n   * Assign new unique ids to each cloned model.\r\n   * @param {Function} [modifier] A callback function for each child to allow for custom modifications\r\n   * @returns {AdaptModel}\r\n   */\r\n  deepClone(modifier = null) {\r\n    // Fetch the class\r\n    const ModelClass = this.constructor;\r\n    // Clone the model\r\n    const clonedModel = new ModelClass(this.toJSON());\r\n    // Run the custom modifier on the clone\r\n    if (modifier) {\r\n      modifier(clonedModel, this);\r\n    }\r\n    let clonedId = clonedModel.get('_id');\r\n    const hasId = Boolean(clonedId);\r\n    const shouldAssignUniqueId = (this.get('_id') === clonedId);\r\n    if (hasId && shouldAssignUniqueId) {\r\n      // Create a unique id if none was set by the modifier\r\n      const cid = _.uniqueId(ModelClass.prototype.cidPrefix || 'c');\r\n      clonedId = `${clonedId}_${cid}`;\r\n      clonedModel.set('_id', clonedId);\r\n    }\r\n    // Add the cloned model to Adapt.data for Adapt.findById resolution\r\n    if (hasId) {\r\n      Adapt.data.add(clonedModel);\r\n    }\r\n    // Clone any children\r\n    if (this.hasManagedChildren) {\r\n      this.getChildren().each(child => {\r\n        if (!child.deepClone) {\r\n          throw new Error('Cannot deepClone child.');\r\n        }\r\n        child.deepClone((clone, child) => {\r\n          if (hasId) {\r\n            // Set the cloned child parent id\r\n            clone.set('_parentId', clonedId);\r\n          }\r\n          if (modifier) {\r\n            // Run the custom modifier function on the cloned child\r\n            modifier(clone, child);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    // Add the cloned model to its parent for model.findDescendants resolution\r\n    clonedModel.getParent().getChildren().add(clonedModel);\r\n    // Setup the cloned model after setting the id, the parent and adding any children\r\n    clonedModel.setupModel();\r\n    return clonedModel;\r\n  }\r\n\r\n  /**\r\n   * Internal event handler for all module events. Triggers event bubbling\r\n   * through the module hierarchy when the event is included in\r\n   * `this.bubblingEvents`.\r\n   * @param {string} type Event name / type\r\n   * @param {Backbone.Model} model Origin backbone model\r\n   * @param {*} value New property value\r\n   */\r\n  onAll(type, model, value) {\r\n    if (!_.result(this, 'bubblingEvents').includes(type)) return;\r\n    const event = new ModelEvent(type, model, value);\r\n    this.bubble(event);\r\n  }\r\n\r\n  /**\r\n   * Internal event handler for bubbling events.\r\n   * @param {ModelEvent} event\r\n   */\r\n  bubble(event) {\r\n    if (!event.canBubble) return;\r\n    event.addPath(this);\r\n    this.trigger(`bubble:${event.type} bubble`, event);\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptModel from 'core/js/models/adaptModel';\r\n\r\nexport default class ContentObjectModel extends AdaptModel {\r\n\r\n  get _parent() {\r\n    Adapt.log.deprecated('contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON');\r\n    const isParentCourse = (this.get('_parentId') === Adapt.course.get('_id'));\r\n    if (isParentCourse) {\r\n      return 'course';\r\n    }\r\n    return 'contentObjects';\r\n  }\r\n\r\n  get _siblings() {\r\n    Adapt.log.deprecated('contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON');\r\n    return 'contentObjects';\r\n  }\r\n\r\n  get _children() {\r\n    Adapt.log.deprecated('contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON');\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'contentobject';\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport ContentObjectModel from 'core/js/models/contentObjectModel';\r\n\r\nclass MenuModel extends ContentObjectModel {\r\n\r\n  get _children() {\r\n    Adapt.log.deprecated('menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON');\r\n    return 'contentObjects';\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'menu';\r\n  }\r\n\r\n  setCustomLocking() {\r\n    const children = this.getAvailableChildModels();\r\n    children.forEach(child => {\r\n      child.set('_isLocked', this.shouldLock(child));\r\n      if (!(child instanceof MenuModel)) return;\r\n      child.checkLocking();\r\n    });\r\n  }\r\n\r\n}\r\n\r\nAdapt.register('menu', { model: MenuModel });\r\n\r\nexport default MenuModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport MenuModel from 'core/js/models/menuModel';\r\n\r\nclass CourseModel extends MenuModel {\r\n\r\n  get _parent() {\r\n    Adapt.log.deprecated('courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON');\r\n    return null;\r\n  }\r\n\r\n  get _siblings() {\r\n    Adapt.log.deprecated('courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON');\r\n    return null;\r\n  }\r\n\r\n}\r\n\r\nAdapt.register('course', { model: CourseModel });\r\n\r\nexport default CourseModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\n\r\nclass StartController extends Backbone.Controller {\r\n\r\n  initialize(...args) {\r\n    super.initialize(...args);\r\n    this.model = null;\r\n  }\r\n\r\n  loadCourseData() {\r\n    this.model = new LockingModel(Adapt.course.get('_start'));\r\n  }\r\n\r\n  setStartLocation() {\r\n    if (!this.isEnabled()) return;\r\n    window.history.replaceState('', '', this.getStartHash());\r\n  }\r\n\r\n  returnToStartLocation() {\r\n    const startIds = this.model.get('_startIds');\r\n    if (startIds) {\r\n      // ensure we can return to the start page even if it is completed\r\n      startIds.forEach(startId => (startId._skipIfComplete = false));\r\n    }\r\n    window.location.hash = this.getStartHash(true);\r\n  }\r\n\r\n  /**\r\n   * Returns a string in URL.hash format representing the route that the course should be sent to\r\n   * @param {boolean} [alwaysForce] Ignore any route specified in location.hash and force use of the start page instead\r\n   * @return {string}\r\n   */\r\n  getStartHash(alwaysForce) {\r\n    const startId = this.getStartId();\r\n    const isRouteSpecified = window.location.href.indexOf('#') > -1;\r\n    const shouldForceStartId = alwaysForce || this.model.get('_force');\r\n    const shouldNavigateToStartId = startId && (!isRouteSpecified || shouldForceStartId);\r\n\r\n    if (shouldNavigateToStartId && startId !== Adapt.course.get('_id')) {\r\n      return '#/id/' + startId;\r\n    }\r\n\r\n    // If there's a route specified in location.hash, use that - otherwise go to main menu\r\n    return window.location.hash || '#/';\r\n  }\r\n\r\n  isEnabled() {\r\n    return Boolean(this.model?.get('_isEnabled'));\r\n  }\r\n\r\n  getStartId() {\r\n    let startId = this.model.get('_id');\r\n    const startIds = this.model.get('_startIds');\r\n\r\n    if (!startIds?.length) return startId;\r\n\r\n    const $html = $('html');\r\n    for (let i = 0, l = startIds.length; i < l; i++) {\r\n      const item = startIds[i];\r\n      const className = item._className;\r\n      const skipIfComplete = item._skipIfComplete;\r\n\r\n      const model = Adapt.findById(item._id);\r\n\r\n      if (!model) {\r\n        console.log('startController: cannot find id', item._id);\r\n        continue;\r\n      }\r\n\r\n      if (skipIfComplete) {\r\n        if (model.get('_isComplete')) continue;\r\n      }\r\n\r\n      if (!className || $html.is(className) || $html.hasClass(className)) {\r\n        // See https://github.com/adaptlearning/adapt_framework/issues/1843\r\n        startId = item._id;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return startId;\r\n  }\r\n\r\n}\r\n\r\nAdapt.once('adapt:start', () => {\r\n  Adapt.startController.loadCourseData();\r\n  Adapt.startController.setStartLocation();\r\n});\r\n\r\n/*\r\n* allows you to call returnToStartLocation either by calling `Adapt.trigger('navigation:returnToStart')`\r\n* or by including in the top navigation bar a button that has the attribute `data-event=\"returnToStart\"`\r\n*/\r\nAdapt.on('navigation:returnToStart', () => {\r\n  Adapt.startController.returnToStartLocation();\r\n});\r\n\r\nexport default (Adapt.startController = new StartController());\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptCollection from 'core/js/collections/adaptCollection';\r\nimport BuildModel from 'core/js/models/buildModel';\r\nimport ConfigModel from 'core/js/models/configModel';\r\nimport LockingModel from 'core/js/models/lockingModel';\r\n\r\nimport 'core/js/models/courseModel';\r\nimport 'core/js/startController';\r\n\r\nclass Data extends AdaptCollection {\r\n\r\n  model(json) {\r\n    const ModelClass = Adapt.getModelClass(json);\r\n    if (!ModelClass) {\r\n      return new LockingModel(json);\r\n    }\r\n    return new ModelClass(json, { parse: true });\r\n  }\r\n\r\n  initialize() {\r\n    super.initialize();\r\n    this.on({\r\n      'add': this.onAdded,\r\n      'remove': this.onRemoved\r\n    });\r\n  }\r\n\r\n  async init () {\r\n    this.reset();\r\n    this._byAdaptID = {};\r\n    Adapt.build = new BuildModel(null, { url: 'adapt/js/build.min.js', reset: true });\r\n    await Adapt.build.whenReady();\r\n    $('html').attr('data-adapt-framework-version', Adapt.build.get('package').version);\r\n    this.loadConfigData();\r\n  }\r\n\r\n  onAdded(model) {\r\n    this._byAdaptID[model.get('_id')] = model;\r\n  }\r\n\r\n  onRemoved(model) {\r\n    delete this._byAdaptID[model.get('_id')];\r\n  }\r\n\r\n  loadConfigData() {\r\n    Adapt.config = new ConfigModel(null, { url: 'course/config.' + Adapt.build.get('jsonext'), reset: true });\r\n    this.listenToOnce(Adapt, 'configModel:loadCourseData', this.onLoadCourseData);\r\n    this.listenTo(Adapt.config, {\r\n      'change:_activeLanguage': this.onLanguageChange,\r\n      'change:_defaultDirection': this.onDirectionChange\r\n    });\r\n  }\r\n\r\n  onDirectionChange(model, direction) {\r\n    if (direction === 'rtl') {\r\n      $('html').removeClass('dir-ltr').addClass('dir-rtl').attr('dir', 'rtl');\r\n    } else {\r\n      $('html').removeClass('dir-rtl').addClass('dir-ltr').attr('dir', 'ltr');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Before we actually go to load the course data, we first need to check to see if a language has been set\r\n   * If it has we can go ahead and start loading; if it hasn't, apply the defaultLanguage from config.json\r\n   */\r\n  onLoadCourseData() {\r\n    if (!Adapt.config.get('_activeLanguage')) {\r\n      Adapt.config.set('_activeLanguage', Adapt.config.get('_defaultLanguage'));\r\n      return;\r\n    }\r\n    this.loadCourseData();\r\n  }\r\n\r\n  onLanguageChange(model, language) {\r\n    Adapt.offlineStorage.set('lang', language);\r\n    // set `_isStarted` back to `false` when changing language so that the learner's answers\r\n    // to questions get restored in the new language when `_restoreStateOnLanguageChange: true`\r\n    // see https://github.com/adaptlearning/adapt_framework/issues/2977\r\n    if (Adapt.get('_isStarted')) {\r\n      Adapt.set('_isStarted', false);\r\n    }\r\n    this.loadCourseData(language);\r\n  }\r\n\r\n  async loadCourseData(newLanguage) {\r\n\r\n    // All code that needs to run before adapt starts should go here\r\n    const language = Adapt.config.get('_activeLanguage');\r\n    const courseFolder = 'course/' + language + '/';\r\n\r\n    $('html').attr('lang', language);\r\n\r\n    await this.loadManifestFiles(courseFolder);\r\n    await this.triggerDataLoaded();\r\n    await this.triggerDataReady(newLanguage);\r\n    this.triggerInit();\r\n\r\n  }\r\n\r\n  getJSON(path) {\r\n    return new Promise((resolve, reject) => {\r\n      $.getJSON(path, data => {\r\n        // Add path to data in case it's necessary later\r\n        data.__path__ = path;\r\n        resolve(data);\r\n      }).fail(reject);\r\n    });\r\n  }\r\n\r\n  async loadManifestFiles(languagePath) {\r\n    this.trigger('loading');\r\n    this.reset();\r\n    const manifestPath = languagePath + 'language_data_manifest.js';\r\n    let manifest;\r\n    try {\r\n      manifest = await this.getJSON(manifestPath);\r\n    } catch (err) {\r\n      manifest = ['course.json', 'contentObjects.json', 'articles.json', 'blocks.json', 'components.json'];\r\n      Adapt.log.warnOnce(`Manifest path '${manifestPath} not found. Using traditional files: ${manifest.join(', ')}`);\r\n    }\r\n    const allFileData = await Promise.all(manifest.map(filePath => {\r\n      return this.getJSON(`${languagePath}${filePath}`);\r\n    }));\r\n    // Flatten all file data into a single array of model data\r\n    const allModelData = allFileData.reduce((result, fileData) => {\r\n      if (Array.isArray(fileData)) {\r\n        result.push(...fileData);\r\n      } else if (fileData instanceof Object) {\r\n        result.push(fileData);\r\n      } else {\r\n        Adapt.log.warnOnce(`File data isn't an array or object: ${fileData.__path__}`);\r\n      }\r\n      return result;\r\n    }, []);\r\n    // Add course model first to allow other model/views to utilize its settings\r\n    const course = allModelData.find(modelData => modelData._type === 'course');\r\n    if (!course) {\r\n      throw new Error(`Expected a model data with \"_type\": \"course\", none found.`);\r\n    }\r\n    Adapt.trigger('courseModel:dataLoading');\r\n    Adapt.course = this.push(course);\r\n    Adapt.trigger('courseModel:dataLoaded');\r\n    // Add other models\r\n    allModelData.forEach(modelData => {\r\n      if (modelData._type === 'course') {\r\n        return;\r\n      }\r\n      this.push(modelData);\r\n    });\r\n    this.trigger('reset');\r\n    this.trigger('loaded');\r\n    await Adapt.wait.queue();\r\n  }\r\n\r\n  async triggerDataLoaded() {\r\n    Adapt.log.debug('Firing app:dataLoaded');\r\n    try {\r\n      // Setup the newly added models\r\n      this.forEach(model => model.setupModel?.());\r\n      Adapt.trigger('app:dataLoaded');\r\n    } catch (e) {\r\n      Adapt.log.error('Error during app:dataLoading trigger', e);\r\n    }\r\n    await Adapt.wait.queue();\r\n  }\r\n\r\n  async triggerDataReady(newLanguage) {\r\n    if (newLanguage) {\r\n      Adapt.trigger('app:languageChanged', newLanguage);\r\n      _.defer(() => {\r\n        Adapt.startController.loadCourseData();\r\n        const hash = Adapt.startController.isEnabled() ? Adapt.startController.getStartHash(false) : '#/';\r\n        Adapt.router.navigate(hash, { trigger: true, replace: true });\r\n      });\r\n    }\r\n    Adapt.log.debug('Firing app:dataReady');\r\n    try {\r\n      Adapt.trigger('app:dataReady');\r\n    } catch (e) {\r\n      Adapt.log.error('Error during app:dataReady trigger', e);\r\n    }\r\n    await Adapt.wait.queue();\r\n  }\r\n\r\n  triggerInit() {\r\n    this.isReady = true;\r\n    this.trigger('ready');\r\n  }\r\n\r\n  whenReady() {\r\n    if (this.isReady) return Promise.resolve();\r\n    return new Promise(resolve => {\r\n      this.once('ready', resolve);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Looks up a model by its `_id` property\r\n   * @param {string} id The id of the item e.g. \"co-05\"\r\n   * @return {Backbone.Model}\r\n   */\r\n  findById(id) {\r\n    const model = this._byAdaptID[id];\r\n    if (!model) {\r\n      console.warn(`Adapt.findById() unable to find id: ${id}`);\r\n      return;\r\n    }\r\n    return model;\r\n  }\r\n\r\n  /**\r\n   * Returns the model represented by the trackingPosition.\r\n   * @param {Array<Number, Number>} trackingPosition Represents the relative location of a model to a _trackingId\r\n   * @returns {Backbone.Model}\r\n   */\r\n  findByTrackingPosition(trackingPosition) {\r\n    const [ trackingId, indexInTrackingIdDescendants ] = trackingPosition;\r\n    const trackingIdModel = this.find(model => model.get('_trackingId') === trackingId);\r\n    if (!trackingIdModel) {\r\n      console.warn(`Adapt.findByTrackingPosition() unable to find trackingPosition: ${trackingPosition}`);\r\n      return;\r\n    }\r\n    if (indexInTrackingIdDescendants >= 0) {\r\n      // Model is either the trackingId model or a descendant\r\n      const trackingIdDescendants = [trackingIdModel].concat(trackingIdModel.getAllDescendantModels(true));\r\n      return trackingIdDescendants[indexInTrackingIdDescendants];\r\n    }\r\n    // Model is an ancestor of the trackingId model\r\n    const trackingIdAncestors = trackingIdModel.getAncestorModels();\r\n    const ancestorDistance = Math.abs(indexInTrackingIdDescendants) - 1;\r\n    return trackingIdAncestors[ancestorDistance];\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.data = new Data());\r\n","import Adapt from 'core/js/adapt';\r\n\r\n// Basic API for setting and getting name+value pairs\r\n// Allows registration of a single handler.\r\n\r\nclass OfflineStorage extends Backbone.Controller {\r\n\r\n  /**\r\n   * set .ready to false if an offlineStorage handler is being attached - we'll need to wait until the handler lets us know\r\n   * it's ready before we can safely use offlineStorage\r\n   */\r\n  initialize(handler) {\r\n    /**\r\n     * set to true initially so that if there are no offlineStorage handlers (i.e. if contrib-spoor is not installed)\r\n     * this can still be accessed OK\r\n     */\r\n    this.ready = true;\r\n    this._handler = undefined;\r\n\r\n    if (!handler) {\r\n      return;\r\n    }\r\n\r\n    this.ready = false;\r\n    this._handler = handler;\r\n  }\r\n\r\n  /**\r\n   * Flag to indicate if an offlineStorage handler has been defined.\r\n   * @returns {boolean} true if an offlineStorage handler has been defined, false otherwise\r\n   */\r\n  hasHandler() {\r\n    return this._handler !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Causes state to be serialized and saved.\r\n   */\r\n  save() {\r\n    Adapt.trigger('tracking:save');\r\n    return this._handler?.save?.apply(this._handler, arguments);\r\n  }\r\n\r\n  /**\r\n   * Serializes nested arrays, booleans and numbers into an encoded string.\r\n   * @param {Array|boolean|number} value\r\n   * @returns {string}\r\n   */\r\n  serialize(value) {\r\n    if (this._handler?.serialize) {\r\n      return this._handler.serialize.apply(this._handler, arguments);\r\n    }\r\n    return JSON.stringify(value);\r\n  }\r\n\r\n  /**\r\n   * Deserializes encoded strings back into nested arrays, booleans and numbers.\r\n   * @param {string} value\r\n   * @returns {Array|boolean|number}\r\n   */\r\n  deserialize(value) {\r\n    if (this._handler?.deserialize) {\r\n      return this._handler.deserialize.apply(this._handler, arguments);\r\n    }\r\n    return JSON.parse(value);\r\n  }\r\n\r\n  set(name, value) {\r\n    if (this._handler?.set) {\r\n      return this._handler.set.apply(this._handler, arguments);\r\n    }\r\n    // if no handler has been defined, just store the data locally\r\n    this[name] = value;\r\n  }\r\n\r\n  get(name) {\r\n    if (this._handler?.get) {\r\n      return this._handler.get.apply(this._handler, arguments);\r\n    }\r\n    // if no handler has been defined, check local data store\r\n    return this[name];\r\n  }\r\n\r\n  /**\r\n   * Some forms of offlineStorage could take time to initialise, this allows us to let plugins know when it's ready to be used\r\n   */\r\n  setReadyStatus() {\r\n    this.ready = true;\r\n    Adapt.trigger('offlineStorage:ready');\r\n  }\r\n\r\n}\r\n\r\nAdapt.offlineStorage = new OfflineStorage();\r\n\r\nexport default Adapt.offlineStorage;\r\n","const COMPLETION_STATE = ENUM([\r\n  'INCOMPLETE',\r\n  'COMPLETED',\r\n  'PASSED',\r\n  'FAILED'\r\n]);\r\n\r\nexport default COMPLETION_STATE;\r\n","import Adapt from 'core/js/adapt';\r\nimport COMPLETION_STATE from 'core/js/enums/completionStateEnum';\r\n\r\nclass Tracking extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._config = {\r\n      _requireContentCompleted: true,\r\n      _requireAssessmentCompleted: false\r\n    };\r\n    this._assessmentState = null;\r\n\r\n    Adapt.once('configModel:dataLoaded', this.loadConfig.bind(this));\r\n    Adapt.on('app:dataReady', this.setupEventListeners.bind(this));\r\n  }\r\n\r\n  setupEventListeners() {\r\n    // Check if completion requires passing an assessment.\r\n    if (this._config._requireAssessmentCompleted) {\r\n      this.listenTo(Adapt, {\r\n        'assessment:complete': this.onAssessmentComplete,\r\n        'assessment:restored': this.onAssessmentRestored\r\n      });\r\n    }\r\n\r\n    // Check if completion requires completing all content.\r\n    if (this._config._requireContentCompleted) {\r\n      this.listenTo(Adapt.course, 'change:_isComplete', this.checkCompletion);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Store the assessment state.\r\n   * @param {object} assessmentState - The object returned by Adapt.assessment.getState()\r\n   */\r\n  onAssessmentComplete(assessmentState) {\r\n    this._assessmentState = assessmentState;\r\n\r\n    this.checkCompletion();\r\n  }\r\n\r\n  /**\r\n   * Restores the _assessmentState object when an assessment is registered.\r\n   * @param {object} assessmentState - An object representing the overall assessment state\r\n   */\r\n  onAssessmentRestored(assessmentState) {\r\n    this._assessmentState = assessmentState;\r\n  }\r\n\r\n  /**\r\n   * Evaluate the course and assessment completion.\r\n   */\r\n  checkCompletion() {\r\n    const completionData = this.getCompletionData();\r\n\r\n    if (completionData.status === COMPLETION_STATE.INCOMPLETE) {\r\n      return;\r\n    }\r\n\r\n    Adapt.trigger('tracking:complete', completionData);\r\n    Adapt.log.debug('tracking:complete', completionData);\r\n  }\r\n\r\n  /**\r\n   * The return value of this function should be passed to the trigger of 'tracking:complete'.\r\n   * @returns An object representing the user's course completion.\r\n   */\r\n  getCompletionData() {\r\n    const completionData = {\r\n      status: COMPLETION_STATE.INCOMPLETE,\r\n      assessment: null\r\n    };\r\n\r\n    // Course complete is required.\r\n    if (this._config._requireContentCompleted && !Adapt.course.get('_isComplete')) {\r\n      // INCOMPLETE: course not complete.\r\n      return completionData;\r\n    }\r\n\r\n    // Assessment completed required.\r\n    if (this._config._requireAssessmentCompleted) {\r\n      if (!this._assessmentState) {\r\n        // INCOMPLETE: assessment is not complete.\r\n        return completionData;\r\n      }\r\n\r\n      // PASSED/FAILED: assessment completed.\r\n      completionData.status = this._assessmentState.isPass ? COMPLETION_STATE.PASSED : COMPLETION_STATE.FAILED;\r\n      completionData.assessment = this._assessmentState;\r\n\r\n      return completionData;\r\n    }\r\n\r\n    // COMPLETED: criteria met, no assessment requirements.\r\n    completionData.status = COMPLETION_STATE.COMPLETED;\r\n\r\n    return completionData;\r\n  }\r\n\r\n  /**\r\n   * Set the _config object to the values retrieved from config.json.\r\n   */\r\n  loadConfig() {\r\n    if (Adapt.config.has('_completionCriteria')) {\r\n      this._config = Adapt.config.get('_completionCriteria');\r\n    }\r\n  }\r\n\r\n}\r\n\r\nAdapt.tracking = new Tracking();\r\n\r\nexport default Adapt.tracking;\r\n","import Adapt from 'core/js/adapt';\r\nimport Bowser from 'bowser';\r\n\r\nclass Device extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this.$html = $('html');\r\n    this.$window = $(window);\r\n    this.touch = Modernizr.touchevents;\r\n    this.screenWidth = this.getScreenWidth();\r\n    this.screenHeight = this.getScreenHeight();\r\n    this.browser = (Bowser.name || '').toLowerCase();\r\n    this.version = (Bowser.version || '').toLowerCase();\r\n    this.OS = this.getOperatingSystem().toLowerCase();\r\n    this.osVersion = Bowser.osversion || '';\r\n    this.renderingEngine = this.getRenderingEngine();\r\n    this.onWindowResize = _.debounce(this.onWindowResize.bind(this), 100);\r\n    this.listenTo(Adapt, {\r\n      'configModel:dataLoaded': this.onConfigDataLoaded\r\n    });\r\n    const browser = this.browser.toLowerCase();\r\n    // Convert 'msie' and 'internet explorer' to 'ie'.\r\n    let browserString = browser.replace(/msie|internet explorer/, 'ie');\r\n    browserString += ` version-${this.version} OS-${this.OS} ${this.getAppleDeviceType()}`;\r\n    browserString += browserString.replace('.', '-').toLowerCase();\r\n    browserString += ` pixel-density-${this.pixelDensity()}`;\r\n    this.$html.addClass(browserString);\r\n  }\r\n\r\n  get orientation() {\r\n    return (this.screenWidth >= this.screenHeight) ? 'landscape' : 'portrait';\r\n  }\r\n\r\n  get aspectRatio() {\r\n    return this.screenWidth / this.screenHeight;\r\n  }\r\n\r\n  onConfigDataLoaded() {\r\n    this.screenSize = this.checkScreenSize();\r\n    this.$html.addClass('size-' + this.screenSize);\r\n    if (this.orientation) {\r\n      this.$html.addClass('orientation-' + this.orientation);\r\n    }\r\n    // As Adapt.config is available it's ok to bind the 'resize'.\r\n    this.$window.on('resize orientationchange', this.onWindowResize);\r\n  }\r\n\r\n  /**\r\n   * Compares the calculated screen width to the breakpoints defined in config.json.\r\n   *\r\n   * @returns {string} 'large', 'medium' or 'small'\r\n   */\r\n  checkScreenSize() {\r\n    const screenSizeConfig = Adapt.config.get('screenSize');\r\n    let screenSize;\r\n\r\n    const screensizeEmThreshold = 300;\r\n    const baseFontSize = 16;\r\n\r\n    // Check to see if the screen size value is larger than the em threshold\r\n    // If value is larger than em threshold, convert value (assumed px) to ems\r\n    // Otherwise assume value is in ems\r\n    const mediumEmBreakpoint = screenSizeConfig.medium > screensizeEmThreshold\r\n      ? screenSizeConfig.medium / baseFontSize\r\n      : screenSizeConfig.medium;\r\n    const smallEmBreakpoint = screenSizeConfig.small > screensizeEmThreshold\r\n      ? screenSizeConfig.small / baseFontSize\r\n      : screenSizeConfig.small;\r\n\r\n    const fontSize = parseFloat($('html').css('font-size'));\r\n    const screenSizeEmWidth = (this.screenWidth / fontSize);\r\n\r\n    // Check to see if client screen width is larger than medium em breakpoint\r\n    // If so apply large, otherwise check to see if client screen width is\r\n    // larger than small em breakpoint. If so apply medium, otherwise apply small\r\n    if (screenSizeEmWidth >= mediumEmBreakpoint) {\r\n      screenSize = 'large';\r\n    } else if (screenSizeEmWidth >= smallEmBreakpoint) {\r\n      screenSize = 'medium';\r\n    } else {\r\n      screenSize = 'small';\r\n    }\r\n\r\n    return screenSize;\r\n  }\r\n\r\n  getScreenWidth() {\r\n    return this.isAppleDevice()\r\n      ? this.getAppleScreenWidth()\r\n      : window.innerWidth || this.$window.width();\r\n  }\r\n\r\n  getScreenHeight() {\r\n    return this.isAppleDevice()\r\n      ? this.getAppleScreenHeight()\r\n      : window.innerHeight || this.$window.height();\r\n  }\r\n\r\n  getOperatingSystem() {\r\n    const flags = ['windows', 'mac', 'linux', 'windowsphone', 'chromeos', 'android',\r\n      'ios', 'blackberry', 'firefoxos', 'webos', 'bada', 'tizen', 'sailfish'];\r\n    let os = flags.find(name => Bowser[name]) || '';\r\n\r\n    if (os === '') {\r\n      // Fall back to using navigator.platform in case Bowser can't detect the OS.\r\n      const platform = navigator.platform.toLowerCase();\r\n      const match = platform.match(/win|mac|linux/);\r\n      if (match) os = match[0];\r\n      // Set consistency with the Bowser flags.\r\n      if (os === 'win') os = 'windows';\r\n      if (!os) os = 'PlatformUnknown';\r\n    }\r\n\r\n    return os;\r\n  }\r\n\r\n  getRenderingEngine() {\r\n    const flags = ['webkit', 'blink', 'gecko', 'msie', 'msedge'];\r\n    return flags.find(name => Bowser[name]) || '';\r\n  }\r\n\r\n  onWindowResize() {\r\n    // Calculate the screen properties.\r\n    const previousWidth = this.screenWidth;\r\n    const previousHeight = this.screenHeight;\r\n\r\n    this.screenWidth = this.getScreenWidth();\r\n    this.screenHeight = this.getScreenHeight();\r\n\r\n    if (previousWidth === this.screenWidth && previousHeight === this.screenHeight) {\r\n      // Do not trigger a change if the viewport hasn't actually changed.  Scrolling on iOS will trigger a resize.\r\n      return;\r\n    }\r\n\r\n    const newScreenSize = this.checkScreenSize();\r\n\r\n    if (newScreenSize !== this.screenSize) {\r\n      this.screenSize = newScreenSize;\r\n\r\n      this.$html.removeClass('size-small size-medium size-large').addClass('size-' + this.screenSize);\r\n\r\n      if (this.orientation) {\r\n        this.$html.removeClass('orientation-landscape orientation-portrait').addClass('orientation-' + this.orientation);\r\n      }\r\n\r\n      Adapt.trigger('device:changed', this.screenSize);\r\n    }\r\n\r\n    Adapt.trigger('device:preResize device:resize device:postResize', this.screenWidth);\r\n\r\n  }\r\n\r\n  isAppleDevice() {\r\n    return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n  }\r\n\r\n  getAppleScreenWidth() {\r\n    return (Math.abs(window.orientation) === 90) ? window.screen.height : window.screen.width;\r\n  }\r\n\r\n  getAppleScreenHeight() {\r\n    return (Math.abs(window.orientation) === 90) ? window.screen.width : window.screen.height;\r\n  }\r\n\r\n  getAppleDeviceType() {\r\n    const flags = ['iphone', 'ipad', 'ipod'];\r\n    return flags.find(name => Bowser[name]) || '';\r\n  }\r\n\r\n  pixelDensity() {\r\n    const pixelDensity = (window.devicePixelRatio || 1);\r\n\r\n    if (pixelDensity >= 3) {\r\n      return 'ultra-high';\r\n    } else if (pixelDensity >= 2) {\r\n      return 'high';\r\n    } else if (pixelDensity >= 1.5) {\r\n      return 'medium';\r\n    } else {\r\n      return 'low';\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.device = new Device());\r\n","import Adapt from 'core/js/adapt';\r\n\r\nclass DrawerItemView extends Backbone.View {\r\n\r\n  className() {\r\n    return 'drawer__menu drawer__item';\r\n  }\r\n\r\n  attributes() {\r\n    return {\r\n      role: 'list'\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.listenTo(Adapt, 'drawer:empty', this.remove);\r\n    this.render();\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click .drawer__item-btn': 'onDrawerItemClicked'\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const data = this.model.toJSON();\r\n    const template = Handlebars.templates['drawerItem'];\r\n    $(this.el).html(template(data)).appendTo('.drawer__holder');\r\n    return this;\r\n  }\r\n\r\n  onDrawerItemClicked(event) {\r\n    event.preventDefault();\r\n    const eventCallback = this.model.get('eventCallback');\r\n    Adapt.trigger(eventCallback);\r\n  }\r\n\r\n}\r\n\r\nDrawerItemView.type = 'drawerItem';\r\n\r\nexport default DrawerItemView;\r\n","import Adapt from 'core/js/adapt';\r\nimport DrawerItemView from 'core/js/views/drawerItemView';\r\n\r\nclass DrawerView extends Backbone.View {\r\n\r\n  className() {\r\n    return 'drawer u-display-none';\r\n  }\r\n\r\n  attributes() {\r\n    return {\r\n      'role': 'dialog',\r\n      'aria-modal': 'true',\r\n      'aria-labelledby': 'drawer-heading',\r\n      'aria-hidden': 'true'\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this._isVisible = false;\r\n    this.disableAnimation = Adapt.config.has('_disableAnimation') ? Adapt.config.get('_disableAnimation') : false;\r\n    this.drawerDir = Adapt.config.get('_defaultDirection') === 'rtl' ? 'left' : 'right';\r\n    this.drawerDuration = Adapt.config.get('_drawer')?._duration ?? 400;\r\n    this.setupEventListeners();\r\n    this.render();\r\n  }\r\n\r\n  setupEventListeners() {\r\n    this.listenTo(Adapt, {\r\n      'navigation:toggleDrawer': this.toggleDrawer,\r\n      'drawer:triggerCustomView': this.openCustomView,\r\n      'drawer:closeDrawer': this.onCloseDrawer,\r\n      'remove': this.onRemove,\r\n      'drawer:remove': this.remove\r\n    });\r\n\r\n    this.onKeyUp = this.onKeyUp.bind(this);\r\n    this.setupEscapeKey();\r\n  }\r\n\r\n  setupEscapeKey() {\r\n    $(window).on('keyup', this.onKeyUp);\r\n  }\r\n\r\n  onKeyUp(event) {\r\n    if (event.which !== 27) return;\r\n    event.preventDefault();\r\n\r\n    this.onCloseDrawer();\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click .drawer__back': 'onBackButtonClicked',\r\n      'click .drawer__close': 'onCloseClicked'\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const template = Handlebars.templates.drawer;\r\n    $(this.el).html(template({ _globals: Adapt.course.get('_globals') })).prependTo('body');\r\n    const shadowTemplate = Handlebars.templates.shadow;\r\n    $(shadowTemplate()).prependTo('body');\r\n    _.defer(this.postRender.bind(this));\r\n    return this;\r\n  }\r\n\r\n  postRender() {\r\n    this.$('a, button, input, select, textarea').attr('tabindex', -1);\r\n\r\n    this.checkIfDrawerIsAvailable();\r\n  }\r\n\r\n  openCustomView(view, hasBackButton) {\r\n    this._hasBackButton = hasBackButton;\r\n    this._isCustomViewVisible = true;\r\n    Adapt.trigger('drawer:empty');\r\n    this.showDrawer();\r\n    this.$('.drawer__holder').html(view);\r\n  }\r\n\r\n  checkIfDrawerIsAvailable() {\r\n    const isEmptyDrawer = (this.collection.length === 0);\r\n    $('.js-nav-drawer-btn').toggleClass('u-display-none', isEmptyDrawer);\r\n    if (isEmptyDrawer) {\r\n      Adapt.trigger('drawer:noItems');\r\n    }\r\n  }\r\n\r\n  onBackButtonClicked(event) {\r\n    event.preventDefault();\r\n    this.showDrawer(true);\r\n  }\r\n\r\n  onCloseClicked(event) {\r\n    event.preventDefault();\r\n    this.hideDrawer();\r\n  }\r\n\r\n  onCloseDrawer($toElement) {\r\n    this.hideDrawer($toElement);\r\n  }\r\n\r\n  onRemove() {\r\n    this.hideDrawer();\r\n  }\r\n\r\n  toggleDrawer() {\r\n    if (this._isVisible && this._isCustomViewVisible === false) {\r\n      this.hideDrawer();\r\n      return;\r\n    }\r\n    this.showDrawer(true);\r\n  }\r\n\r\n  showDrawer(emptyDrawer) {\r\n    this.$el.removeClass('u-display-none').removeAttr('aria-hidden');\r\n    // Only trigger popup:opened if drawer is visible, pass popup manager drawer element\r\n    if (!this._isVisible) {\r\n      Adapt.a11y.popupOpened(this.$el);\r\n      Adapt.a11y.scrollDisable('body');\r\n      this._isVisible = true;\r\n    }\r\n\r\n    // Sets tab index to 0 for all tabbable elements in Drawer\r\n    this.$('a, button, input, select, textarea').attr('tabindex', 0);\r\n\r\n    if (emptyDrawer) {\r\n      this.$('.drawer__back').addClass('u-display-none');\r\n      this._isCustomViewVisible = false;\r\n      this.emptyDrawer();\r\n      if (this.collection.models.length === 1) {\r\n        // This callback triggers openCustomView() and sets\r\n        // _isCustomViewVisible to true, causing toggleDrawer()\r\n        // to re-render the drawer on every toggle button press\r\n        Adapt.trigger(this.collection.models[0].get('eventCallback'));\r\n        // Set _isCustomViewVisible to false to prevent re-rendering\r\n        // the drawer and fix the toggle functionality on toggle button press\r\n        this._isCustomViewVisible = false;\r\n      } else {\r\n        this.renderItems();\r\n        Adapt.trigger('drawer:openedItemView');\r\n      }\r\n    } else {\r\n      const hideDrawerBackButton = (!this._hasBackButton || this.collection.models.length <= 1);\r\n      this.$('.drawer__back').toggleClass('u-display-none', hideDrawerBackButton);\r\n      Adapt.trigger('drawer:openedCustomView');\r\n    }\r\n\r\n    const complete = () => {\r\n      this.addShadowEvent();\r\n      Adapt.trigger('drawer:opened');\r\n\r\n      // focus on first tabbable element in drawer\r\n      Adapt.a11y.focusFirst(this.$el, { defer: true });\r\n    };\r\n\r\n    // delay drawer animation until after background fadeout animation is complete\r\n    const direction = {};\r\n    if (this.disableAnimation) {\r\n      $('.js-shadow').removeClass('u-display-none');\r\n      $('.js-drawer-holder').scrollTop(0);\r\n\r\n      direction[this.drawerDir] = 0;\r\n      this.$el.css(direction);\r\n      complete();\r\n    } else {\r\n      $('.js-shadow').velocity({ opacity: 1 }, {\r\n        duration: this.drawerDuration,\r\n        begin: () => {\r\n          $('.js-shadow').removeClass('u-display-none');\r\n          $('.js-drawer-holder').scrollTop(0);\r\n          complete();\r\n        }\r\n      });\r\n\r\n      const easing = Adapt.config.get('_drawer')?._showEasing || 'easeOutQuart';\r\n      direction[this.drawerDir] = 0;\r\n      this.$el.velocity(direction, this.drawerDuration, easing);\r\n    }\r\n\r\n  }\r\n\r\n  emptyDrawer() {\r\n    this.$('.drawer__holder').empty();\r\n  }\r\n\r\n  renderItems() {\r\n    Adapt.trigger('drawer:empty');\r\n    this.emptyDrawer();\r\n    this.collection.forEach(model => new DrawerItemView({ model }));\r\n  }\r\n\r\n  hideDrawer($toElement) {\r\n    if (!this._isVisible) return;\r\n\r\n    const direction = {};\r\n    Adapt.a11y.popupClosed($toElement);\r\n    this._isVisible = false;\r\n    Adapt.a11y.scrollEnable('body');\r\n\r\n    if (this.disableAnimation) {\r\n\r\n      direction[this.drawerDir] = -this.$el.width();\r\n      this.$el\r\n        .css(direction)\r\n        .addClass('u-display-none')\r\n        .attr('aria-hidden', 'true');\r\n\r\n      $('.js-shadow').addClass('u-display-none');\r\n\r\n      Adapt.trigger('drawer:closed');\r\n\r\n    } else {\r\n      const easing = Adapt.config.get('_drawer')?._hideEasing || 'easeInQuart';\r\n\r\n      direction[this.drawerDir] = -this.$el.width();\r\n      this.$el.velocity(direction, this.drawerDuration, easing, () => {\r\n        this.$el\r\n          .addClass('u-display-none')\r\n          .attr('aria-hidden', 'true');\r\n\r\n        Adapt.trigger('drawer:closed');\r\n      });\r\n\r\n      $('.js-shadow').velocity({ opacity: 0 }, { duration: this.drawerDuration,\r\n        complete() {\r\n          $('.js-shadow').addClass('u-display-none');\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n    this._isCustomViewVisible = false;\r\n    this.removeShadowEvent();\r\n\r\n  }\r\n\r\n  addShadowEvent() {\r\n    $('.js-shadow').one('click touchstart', () => this.onCloseDrawer());\r\n  }\r\n\r\n  removeShadowEvent() {\r\n    $('.js-shadow').off('click touchstart');\r\n  }\r\n\r\n  remove() {\r\n    super.remove();\r\n    $(window).off('keyup', this.onKeyUp);\r\n\r\n    Adapt.trigger('drawer:empty');\r\n    this.collection.reset();\r\n    $('.js-shadow').remove();\r\n  }\r\n\r\n}\r\n\r\nObject.assign(DrawerView, {\r\n  childContainer: '.js-drawer-holder',\r\n  childView: DrawerItemView\r\n});\r\n\r\nexport default DrawerView;\r\n","import Adapt from 'core/js/adapt';\r\nimport DrawerView from 'core/js/views/drawerView';\r\n\r\nconst DrawerCollection = new Backbone.Collection(null, { comparator: 'drawerOrder' });\r\nconst Drawer = {};\r\n\r\nDrawer.addItem = function(drawerObject, eventCallback) {\r\n  drawerObject.eventCallback = eventCallback;\r\n  DrawerCollection.add(drawerObject);\r\n};\r\n\r\nDrawer.triggerCustomView = function(view, hasBackButton) {\r\n  if (hasBackButton !== false) {\r\n    hasBackButton = true;\r\n  }\r\n  Adapt.trigger('drawer:triggerCustomView', view, hasBackButton);\r\n};\r\n\r\nAdapt.on({\r\n  'adapt:start'() {\r\n    new DrawerView({ collection: DrawerCollection });\r\n  },\r\n  'app:languageChanged'() {\r\n    Adapt.trigger('drawer:remove');\r\n  }\r\n});\r\n\r\nexport default (Adapt.drawer = Drawer);\r\n","import Adapt from 'core/js/adapt';\r\n\r\nexport default class NotifyPushView extends Backbone.View {\r\n\r\n  className() {\r\n    let classes = 'notify-push ';\r\n    classes += (this.model.get('_classes') || '');\r\n    return classes;\r\n  }\r\n\r\n  attributes() {\r\n    return {\r\n      'role': 'dialog',\r\n      'aria-labelledby': 'notify-push-heading',\r\n      'aria-modal': 'false'\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.listenTo(Adapt, {\r\n      'notify:pushShown notify:pushRemoved': this.updateIndexPosition,\r\n      'remove': this.remove\r\n    });\r\n\r\n    this.listenTo(this.model.collection, {\r\n      'remove': this.updateIndexPosition,\r\n      'change:_index': this.updatePushPosition\r\n    });\r\n\r\n    this.preRender();\r\n    this.render();\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click .js-notify-push-close-btn': 'closePush',\r\n      'click .js-notify-push-inner': 'triggerEvent'\r\n    };\r\n  }\r\n\r\n  preRender() {\r\n    this.hasBeenRemoved = false;\r\n  }\r\n\r\n  render() {\r\n    const data = this.model.toJSON();\r\n    const template = Handlebars.templates['notifyPush'];\r\n    this.$el.html(template(data)).appendTo('#wrapper');\r\n\r\n    _.defer(this.postRender.bind(this));\r\n\r\n    return this;\r\n  }\r\n\r\n  postRender() {\r\n    this.$el.addClass('is-active');\r\n\r\n    _.delay(this.closePush.bind(this), this.model.get('_timeout'));\r\n\r\n    Adapt.trigger('notify:pushShown');\r\n  }\r\n\r\n  closePush(event) {\r\n    if (event) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    // Check whether this view has been removed as the delay can cause it to be fired twice\r\n    if (this.hasBeenRemoved === false) {\r\n\r\n      this.hasBeenRemoved = true;\r\n\r\n      this.$el.removeClass('is-active');\r\n\r\n      _.delay(() => {\r\n        this.model.collection.remove(this.model);\r\n        Adapt.trigger('notify:pushRemoved', this);\r\n        this.remove();\r\n      }, 600);\r\n    }\r\n  }\r\n\r\n  triggerEvent(event) {\r\n    Adapt.trigger(this.model.get('_callbackEvent'));\r\n    this.closePush();\r\n  }\r\n\r\n  updateIndexPosition() {\r\n    if (this.hasBeenRemoved) return;\r\n    const models = this.model.collection.models;\r\n    models.forEach((model, index) => {\r\n      if (!model.get('_isActive')) return;\r\n      model.set('_index', index);\r\n      this.updatePushPosition();\r\n    });\r\n  }\r\n\r\n  updatePushPosition() {\r\n    if (this.hasBeenRemoved) {\r\n      return;\r\n    }\r\n\r\n    if (typeof this.model.get('_index') !== 'undefined') {\r\n      const elementHeight = this.$el.height();\r\n      const offset = 20;\r\n      const navigationHeight = $('.nav').height();\r\n      const currentIndex = this.model.get('_index');\r\n      let flippedIndex = (currentIndex === 0) ? 1 : 0;\r\n\r\n      if (this.model.collection.where({ _isActive: true }).length === 1) {\r\n        flippedIndex = 0;\r\n      }\r\n\r\n      const positionLowerPush = (elementHeight + offset) * flippedIndex + navigationHeight + offset;\r\n      this.$el.css('top', positionLowerPush);\r\n    }\r\n  }\r\n}\r\n","import LockingModel from 'core/js/models/lockingModel';\r\n\r\nexport default class NotifyModel extends LockingModel {\r\n\r\n  defaults() {\r\n    return {\r\n      _isActive: false,\r\n      _showIcon: false,\r\n      _timeout: 3000\r\n    };\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport NotifyPushView from 'core/js/views/notifyPushView';\r\nimport NotifyModel from 'core/js/models/notifyModel';\r\n\r\n// Build a collection to store push notifications\r\nexport default class NotifyPushCollection extends Backbone.Collection {\r\n\r\n  initialize() {\r\n    this.model = NotifyModel;\r\n    this.listenTo(this, 'add', this.onPushAdded);\r\n    this.listenTo(Adapt, 'notify:pushRemoved', this.onRemovePush);\r\n  }\r\n\r\n  onPushAdded(model) {\r\n    this.checkPushCanShow(model);\r\n  }\r\n\r\n  checkPushCanShow(model) {\r\n    if (!this.canShowPush()) return;\r\n    model.set('_isActive', true);\r\n    this.showPush(model);\r\n  }\r\n\r\n  canShowPush() {\r\n    const availablePushNotifications = this.where({ _isActive: true });\r\n    return (availablePushNotifications.length < 2);\r\n  }\r\n\r\n  showPush(model) {\r\n    new NotifyPushView({\r\n      model: model\r\n    });\r\n  }\r\n\r\n  onRemovePush(view) {\r\n    const inactivePushNotifications = this.where({ _isActive: false });\r\n    if (inactivePushNotifications.length > 0) {\r\n      this.checkPushCanShow(inactivePushNotifications[0]);\r\n    }\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\n\r\n/**\r\n * Event object triggered for controlling child view rendering.\r\n * Sent with 'view:addChild' and 'view:requestChild' events.\r\n * All plugins receive the same object reference in their event handler and\r\n * as such, this object becomes a place of consensus for plugins to decide how\r\n * to handle rendering for this child.\r\n */\r\nexport default class ChildEvent extends Backbone.Controller {\r\n\r\n  /**\r\n   * @param {string} type Event type\r\n   * @param {AdaptView} target Parent view\r\n   * @param {AdaptModel} model Child model\r\n   */\r\n  initialize(type, target, model) {\r\n    /** @type {string} */\r\n    this.type = type;\r\n    /** @type {AdaptView} */\r\n    this.target = target;\r\n    /** @type {boolean} Force the child model to render */\r\n    this.isForced = false;\r\n    /** @type {boolean} Stop rendering before the child model */\r\n    this.isStoppedImmediate = false;\r\n    /** @type {boolean} Stop rendering after the child model */\r\n    this.isStoppedNext = false;\r\n    /** @type {boolean} Contains a model to render in response to a requestChild event */\r\n    this.hasRequestChild = false;\r\n    this._model = model;\r\n  }\r\n\r\n  /**\r\n   * Get the model to be rendered.\r\n   * @returns {AdaptModel}\r\n   */\r\n  get model() {\r\n    return this._model;\r\n  }\r\n\r\n  /**\r\n   * Set the model to render in response to a 'view:requestChild' event.\r\n   * @param {AdaptModel}\r\n   */\r\n  set model(model) {\r\n    if (this.type !== 'requestChild') {\r\n      Adapt.log.warn(`Cannot change model in ${this.type} event.`);\r\n      return;\r\n    }\r\n    if (this._model) {\r\n      Adapt.log.warn(`Cannot inject two models in one sitting. ${model.get('_id')} attempts to overwrite ${this._model.get('_id')}`);\r\n      return;\r\n    }\r\n    this._model = model;\r\n    this.hasRequestChild = true;\r\n  }\r\n\r\n  /**\r\n   * Reset all render stops.\r\n   */\r\n  reset() {\r\n    this.isStoppedImmediate = false;\r\n    this.isStoppedNext = false;\r\n  }\r\n\r\n  /**\r\n   * Force model to render.\r\n   */\r\n  force() {\r\n    this.isForced = true;\r\n  }\r\n\r\n  /**\r\n   * General stop. Stop immediately or stop next with flag to false.\r\n   * @param {boolean} [immediate=true] Flag to stop immediate or next.\r\n   */\r\n  stop(immediate = true) {\r\n    if (!immediate) {\r\n      return this.stopNext();\r\n    }\r\n    this.isStoppedImmediate = true;\r\n  }\r\n\r\n  /**\r\n   * Shortcut to stop(false). Stop the render after the contained model is rendered.\r\n   */\r\n  stopNext() {\r\n    this.isStoppedNext = true;\r\n  }\r\n\r\n  /**\r\n   * Trigger an event to signify that a final decision has been reached.\r\n   */\r\n  close() {\r\n    this.trigger('closed');\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport TemplateRenderEvent from './templateRenderEvent';\r\nimport HTMLReactParser from 'html-react-parser';\r\nimport React from 'react';\r\n\r\n/**\r\n * Used by babel plugin babel-plugin-transform-react-templates to inject react templates\r\n */\r\nexport default function register(name, component) {\r\n  templates[name] = (...args) => {\r\n    // Trap render calls to emit preRender and postRender events\r\n    const mode = 'reactTemplate';\r\n    // Send preRender event to allow modification of args\r\n    const preRenderEvent = new TemplateRenderEvent(`${mode}:preRender`, name, mode, null, args);\r\n    Adapt.trigger(preRenderEvent.type, preRenderEvent);\r\n    // Execute template\r\n    const value = component(...preRenderEvent.args);\r\n    // Send postRender event to allow modification of rendered template\r\n    const postRenderEvent = new TemplateRenderEvent(`${mode}:postRender`, name, mode, value, preRenderEvent.args);\r\n    Adapt.trigger(postRenderEvent.type, postRenderEvent);\r\n    // Return rendered, modified template\r\n    return postRenderEvent.value;\r\n  };\r\n};\r\n\r\n/**\r\n * Override React.createElement to allow trapping and modification of react\r\n * template elements.\r\n */\r\n(function () {\r\n  const original = React.createElement;\r\n  React.createElement = (...args) => {\r\n    const name = args[0];\r\n    // Trap render calls to emit preRender and postRender events\r\n    const mode = 'reactElement';\r\n    // Send preRender event to allow modification of args\r\n    const preRenderEvent = new TemplateRenderEvent(`${mode}:preRender`, name, mode, null, args);\r\n    Adapt.trigger(preRenderEvent.type, preRenderEvent);\r\n    // Execute element creation\r\n    const value = original(...preRenderEvent.args);\r\n    // Send postRender event to allow modification of rendered element\r\n    const postRenderEvent = new TemplateRenderEvent(`${mode}:postRender`, name, mode, value, preRenderEvent.args);\r\n    Adapt.trigger(postRenderEvent.type, postRenderEvent);\r\n    // Return rendered, modified element\r\n    return postRenderEvent.value;\r\n  };\r\n})();\r\n\r\n/**\r\n * Storage for react templates\r\n */\r\nexport const templates = {};\r\n\r\n/**\r\n * Convert html strings to react dom, equivalent to handlebars {{{html}}}\r\n * @param {string} html\r\n */\r\nexport function html(html, ref = null) {\r\n  if (!html) return;\r\n  let node = html ? HTMLReactParser(html) : '';\r\n  if (typeof node === 'object' && ref) {\r\n    node = Array.isArray(node) ? node[0] : node;\r\n    node = React.cloneElement(node, { ref });\r\n  }\r\n  return node;\r\n}\r\n\r\n/**\r\n * Handlebars compile integration\r\n * @param {string} name Handlebars template\r\n * @param {...any} args Template arguments\r\n */\r\nexport function compile(template, ...args) {\r\n  const output = Handlebars.compile(template)(...args);\r\n  return output;\r\n};\r\n\r\n/**\r\n * Handlebars partials integration\r\n * @param {string} name Partial name\r\n * @param {...any} args Partial arguments\r\n */\r\nexport function partial(name, ...args) {\r\n  const output = Handlebars.partials[name](...args);\r\n  return output;\r\n};\r\n\r\n/**\r\n * Handlebars helpers integration\r\n * @param {string} name Helper name\r\n * @param {...any} args Helper arguments\r\n */\r\nexport function helper(name, ...args) {\r\n  const output = Handlebars.helpers[name].call(args[0]);\r\n  return (output && output.string) || output;\r\n};\r\n\r\n/**\r\n * Helper for a list of classes, filtering out falsies and duplicates, and joining with spaces\r\n * @param  {...any} args List or arrays of classes\r\n */\r\nexport function classes(...args) {\r\n  return _.uniq(_.flatten(args).filter(Boolean).join(' ').split(' ')).join(' ');\r\n};\r\n\r\n/**\r\n * Helper for prefixing a list of classes, filtering out falsies and duplicates and joining with spaces\r\n * @param  {[...string]} prefixes Array of class prefixes\r\n * @param  {...any} args List or arrays of classes\r\n */\r\nexport function prefixClasses(prefixes, ...args) {\r\n  const classes = _.flatten(args).filter(Boolean);\r\n  const prefixed = _.flatten(prefixes.map(prefix => classes.map(className => `${prefix}${className}`)));\r\n  return _.uniq(prefixed.join(' ').split(' ')).join(' ');\r\n};\r\n","import Adapt from 'core/js/adapt';\r\nimport ChildEvent from 'core/js/childEvent';\r\nimport { templates } from 'core/js/reactHelpers';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nclass AdaptView extends Backbone.View {\r\n\r\n  attributes() {\r\n    return {\r\n      'data-adapt-id': this.model.get('_id')\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.listenTo(this.model, {\r\n      'change:_isVisible': this.toggleVisibility,\r\n      'change:_isHidden': this.toggleHidden,\r\n      'change:_isComplete': this.onIsCompleteChange\r\n    });\r\n    this.isJSX = (this.constructor.template || '').includes('.jsx');\r\n    if (this.isJSX) {\r\n      this._classSet = new Set(_.result(this, 'className').trim().split(/\\s+/));\r\n      this.listenTo(this.model, 'all', this.changed);\r\n      const children = this.model?.getChildren?.();\r\n      children && this.listenTo(children, 'all', this.changed);\r\n      // Facilitate adaptive react views\r\n      this.listenTo(Adapt, 'device:changed', this.changed);\r\n    }\r\n    this.model.set({\r\n      _globals: Adapt.course.get('_globals'),\r\n      _isReady: false\r\n    });\r\n    this._isRemoved = false;\r\n\r\n    if (Adapt.location._currentId === this.model.get('_id')) {\r\n      Adapt.parentView = this;\r\n    }\r\n\r\n    this.preRender();\r\n    this.render();\r\n    this.setupOnScreenHandler();\r\n  }\r\n\r\n  preRender() {}\r\n\r\n  async postRender() {\r\n    await this.addChildren();\r\n  }\r\n\r\n  render() {\r\n    const type = this.constructor.type;\r\n    Adapt.trigger(`${type}View:preRender view:preRender`, this);\r\n\r\n    if (this.isJSX) {\r\n      this.changed();\r\n    } else {\r\n      const data = this.model.toJSON();\r\n      data.view = this;\r\n      const template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n    }\r\n\r\n    Adapt.trigger(`${type}View:render view:render`, this);\r\n\r\n    _.defer(async () => {\r\n      // don't call postRender after remove\r\n      if (this._isRemoved) return;\r\n\r\n      await this.postRender();\r\n      Adapt.trigger(`${type}View:postRender view:postRender`, this);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Re-render a react template\r\n   * @param {string} eventName=null Backbone change event name\r\n   */\r\n  changed(eventName = null) {\r\n    if (!this.isJSX) {\r\n      throw new Error('Cannot call changed on a non-react view');\r\n    }\r\n    if (typeof eventName === 'string' && eventName.startsWith('bubble')) {\r\n      // Ignore bubbling events as they are outside of this view's scope\r\n      return;\r\n    }\r\n    const props = {\r\n      // Add view own properties, bound functions etc\r\n      ...this,\r\n      // Add model json data\r\n      ...this.model.toJSON(),\r\n      // Add globals\r\n      _globals: Adapt.course.get('_globals')\r\n    };\r\n    const Template = templates[this.constructor.template.replace('.jsx', '')];\r\n    this.updateViewProperties();\r\n    ReactDOM.render(<Template {...props} />, this.el);\r\n  }\r\n\r\n  updateViewProperties() {\r\n    const classesToAdd = _.result(this, 'className').trim().split(/\\s+/);\r\n    classesToAdd.forEach(i => this._classSet.add(i));\r\n    const classesToRemove = [ ...this._classSet ].filter(i => !classesToAdd.includes(i));\r\n    classesToRemove.forEach(i => this._classSet.delete(i));\r\n    this._setAttributes({ ..._.result(this, 'attributes'), id: _.result(this, 'id') });\r\n    this.$el.removeClass(classesToRemove).addClass(classesToAdd);\r\n  }\r\n\r\n  setupOnScreenHandler() {\r\n    const onscreen = this.model.get('_onScreen');\r\n\r\n    if (!onscreen?._isEnabled) return;\r\n\r\n    this.$el.addClass(`has-animation ${onscreen._classes}-before`);\r\n    this.$el.on('onscreen.adaptView', (e, m) => {\r\n      if (!m.onscreen) return;\r\n      const minVerticalInview = onscreen._percentInviewVertical || 33;\r\n      if (m.percentInviewVertical < minVerticalInview) return;\r\n      this.$el.addClass(`${onscreen._classes}-after`).off('onscreen.adaptView');\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add children and descendant views, first-child-first. Wait until all possible\r\n   * views are added before resolving asynchronously.\r\n   * Will trigger 'view:addChild'(ChildEvent), 'view:requestChild'(ChildEvent)\r\n   * and 'view:childAdded'(ParentView, ChildView) accordingly.\r\n   * @returns {number} Count of views added\r\n   */\r\n  async addChildren() {\r\n    this.nthChild = this.nthChild || 0;\r\n    // Check descendants first\r\n    let addedCount = await this.addDescendants(false);\r\n    // Iterate through existing available children and/or request new children\r\n    // if required and allowed\r\n    while (true) {\r\n      const models = this.model.getAvailableChildModels();\r\n      const event = this._getAddChildEvent(models[this.nthChild]);\r\n      if (!event) {\r\n        break;\r\n      }\r\n      if (event.isForced) {\r\n        event.reset();\r\n      }\r\n      if (event.isStoppedImmediate || !event.model) {\r\n        // If addChild has been stopped before it is added then\r\n        // set all subsequent models and their children as not rendered\r\n        const subsequentModels = models.slice(this.nthChild);\r\n        subsequentModels.forEach(model => model.setOnChildren('_isRendered', false));\r\n        break;\r\n      }\r\n      // Set model state\r\n      const model = event.model;\r\n      model.set({\r\n        _isRendered: true,\r\n        _nthChild: ++this.nthChild\r\n      });\r\n      // Create child view\r\n      const ChildView = this.constructor.childView || Adapt.getViewClass(model);\r\n      if (!ChildView) {\r\n        throw new Error(`The component '${model.attributes._id}' ('${model.attributes._component}') has not been installed, and so is not available in your project.`);\r\n      }\r\n      const childView = new ChildView({ model });\r\n      this.addChildView(childView);\r\n      addedCount++;\r\n      if (event.isStoppedNext) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!addedCount) {\r\n      return addedCount;\r\n    }\r\n\r\n    // Children were added, unset _isReady\r\n    this.model.set('_isReady', false);\r\n    return addedCount;\r\n  }\r\n\r\n  /**\r\n   * Child views can be added with '_renderPosition': 'outer-append' or\r\n   * 'inner-append' (default). Each child view will trigger a\r\n   * 'view:childAdded'(ParentView, ChildView) event and be added to the\r\n   * this.getChildViews() array on this parent.\r\n   * @param {AdaptView} childView\r\n   * @returns {AdaptView} Returns this childView\r\n   */\r\n  addChildView(childView) {\r\n    const childViews = this.getChildViews() || [];\r\n    childViews.push(childView);\r\n    this.setChildViews(childViews);\r\n    const $parentContainer = this.$(this.constructor.childContainer);\r\n    switch (childView.model.get('_renderPosition')) {\r\n      case 'outer-append':\r\n        // Useful for trickle buttons, inline feedback etc\r\n        this.$el.append(childView.$el);\r\n        break;\r\n      case 'inner-append':\r\n      default:\r\n        $parentContainer.append(childView.$el);\r\n        break;\r\n    }\r\n    // Signify that a child has been added to the view to enable updates to status bars\r\n    Adapt.trigger('view:childAdded', this, childView);\r\n    return childView;\r\n  }\r\n\r\n  /**\r\n   * Iterates through existing childViews and runs addChildren on them, resolving\r\n   * the total count of views added asynchronously.\r\n   * @returns {number} Count of views added\r\n   */\r\n  async addDescendants() {\r\n    let addedDescendantCount = 0;\r\n    const childViews = this.getChildViews();\r\n    if (!childViews) {\r\n      return addedDescendantCount;\r\n    }\r\n    for (let i = 0, l = childViews.length; i < l; i++) {\r\n      const view = childViews[i];\r\n      addedDescendantCount = view.addChildren ? await view.addChildren() : 0;\r\n      if (addedDescendantCount) {\r\n        break;\r\n      }\r\n    }\r\n    if (!addedDescendantCount) {\r\n      this.model.checkReadyStatus();\r\n      return addedDescendantCount;\r\n    }\r\n    // Descendants were added, unset _isReady\r\n    this.model.set('_isReady', false);\r\n    return addedDescendantCount;\r\n  }\r\n\r\n  /**\r\n   * Resolves after outstanding asynchronous view additions are finished\r\n   * and ready.\r\n   */\r\n  async whenReady() {\r\n    if (this.model.get('_isReady')) return;\r\n    return new Promise(resolve => {\r\n      const onReadyChange = (model, value) => {\r\n        if (!value) return;\r\n        this.stopListening(this.model, 'change:_isReady', onReadyChange);\r\n        resolve();\r\n      };\r\n      this.listenTo(this.model, 'change:_isReady', onReadyChange);\r\n      this.model.checkReadyStatus();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Triggers and returns a new ChildEvent object for render control.\r\n   * This function is used by addChildren to manage event triggering.\r\n   * @param {AdaptModel} model\r\n   * @returns {ChildEvent}\r\n   */\r\n  _getAddChildEvent(model) {\r\n    const isRequestChild = (!model);\r\n    const event = new ChildEvent(null, this, model);\r\n    if (isRequestChild) {\r\n      // No model has been supplied, we are at the end of the available child list\r\n      const canRequestChild = this.model.get('_canRequestChild');\r\n      if (!canRequestChild) {\r\n        // This model cannot request children\r\n        return;\r\n      }\r\n      event.type = 'requestChild';\r\n      // Send a request asking for a new model\r\n      Adapt.trigger('view:requestChild', event);\r\n      if (!event.hasRequestChild) {\r\n        // No new model was supplied\r\n        // Close the event so that the final state can be scrutinized\r\n        event.close();\r\n        return;\r\n      }\r\n      // A new model has been supplied for the end of the list.\r\n    }\r\n    // Trigger an event to signify that a new model is to be added\r\n    event.type = 'addChild';\r\n    Adapt.trigger('view:addChild', event);\r\n    // Close the event so that the final state can be scrutinized\r\n    event.close();\r\n    return event;\r\n  }\r\n\r\n  /**\r\n   * Return an array of all child and descendant views.\r\n   * @param {boolean} [isParentFirst=false] Array returns with parents before children\r\n   * @returns {[AdaptView]}\r\n   */\r\n  findDescendantViews(isParentFirst) {\r\n    const descendants = [];\r\n    const childViews = this.getChildViews();\r\n    childViews?.forEach(view => {\r\n      if (isParentFirst) descendants.push(view);\r\n      const children = view.findDescendantViews?.(isParentFirst);\r\n      if (children) descendants.push(...children);\r\n      if (!isParentFirst) descendants.push(view);\r\n    });\r\n    return descendants;\r\n  }\r\n\r\n  setReadyStatus() {\r\n    this.model.set('_isReady', true);\r\n  }\r\n\r\n  setCompletionStatus() {\r\n    if (!this.model.get('_isVisible')) return;\r\n    this.model.set({\r\n      _isComplete: true,\r\n      _isInteractionComplete: true\r\n    });\r\n  }\r\n\r\n  resetCompletionStatus(type) {\r\n    if (!this.model.get('_canReset')) return;\r\n\r\n    const descendantComponents = this.model.findDescendantModels('component');\r\n    if (descendantComponents.length === 0) {\r\n      this.model.reset(type);\r\n    } else {\r\n      descendantComponents.forEach(model => model.reset(type));\r\n    }\r\n  }\r\n\r\n  preRemove() {\r\n    const type = this.constructor.type;\r\n    Adapt.trigger(`${type}View:preRemove view:preRemove`, this);\r\n  }\r\n\r\n  remove() {\r\n    const type = this.constructor.type;\r\n    this.preRemove();\r\n    Adapt.trigger(`${type}View:remove view:remove`, this);\r\n    this._isRemoved = true;\r\n    this.stopListening();\r\n\r\n    Adapt.wait.for(end => {\r\n      if (this.isJSX) {\r\n        ReactDOM.unmountComponentAtNode(this.el);\r\n      }\r\n      this.$el.off('onscreen.adaptView');\r\n      super.remove();\r\n      _.defer(() => {\r\n        Adapt.trigger(`${type}View:postRemove view:postRemove`, this);\r\n      });\r\n      end();\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  setVisibility() {\r\n    return this.model.get('_isVisible') ? '' : 'u-visibility-hidden';\r\n  }\r\n\r\n  toggleVisibility() {\r\n    this.$el.toggleClass('u-visibility-hidden', !this.model.get('_isVisible'));\r\n  }\r\n\r\n  setHidden() {\r\n    return this.model.get('_isHidden') ? 'u-display-none' : '';\r\n  }\r\n\r\n  toggleHidden() {\r\n    this.$el.toggleClass('u-display-none', this.model.get('_isHidden'));\r\n  }\r\n\r\n  onIsCompleteChange(model, isComplete) {\r\n    this.$el.toggleClass('is-complete', isComplete);\r\n  }\r\n\r\n  /**\r\n   * @returns {[AdaptView]}\r\n   */\r\n  getChildViews() {\r\n    if (!this._childViews) return this._childViews;\r\n    // Allow both a deprecated id/view map or a new array of child views\r\n    return Object.entries(this._childViews).map(([key, value]) => value);\r\n  }\r\n\r\n  /**\r\n   * @param {[AdaptView]} value\r\n   */\r\n  setChildViews(value) {\r\n    this._childViews = value;\r\n  }\r\n\r\n  /**\r\n   * Returns an indexed by id list of child views.\r\n   * @deprecated since 5.7.0\r\n   * @returns {{<string, AdaptView}}\r\n   */\r\n  get childViews() {\r\n    Adapt.log.deprecated('view.childViews use view.getChildViews() and view.setChildViews([])');\r\n    if (Array.isArray(this._childViews)) {\r\n      return _.indexBy(this._childViews, view => view.model.get('_id'));\r\n    }\r\n    return this._childViews;\r\n  }\r\n\r\n  /**\r\n   * Sets an indexed by id list of child views.\r\n   * @deprecated since 5.7.0\r\n   */\r\n  set childViews(value) {\r\n    Adapt.log.deprecated('view.childViews use view.getChildViews() and view.setChildViews([])');\r\n    this.setChildViews(value);\r\n  }\r\n\r\n}\r\n\r\nAdaptView.className = '';\r\n\r\nexport default AdaptView;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptView from 'core/js/views/adaptView';\r\n\r\nexport default class NotifyView extends Backbone.View {\r\n\r\n  className() {\r\n    return `notify ${this.model.get('_classes') || ''}`;\r\n  }\r\n\r\n  attributes () {\r\n    return Object.assign({\r\n      role: 'dialog',\r\n      'aria-labelledby': 'notify-heading',\r\n      'aria-modal': 'true'\r\n    }, this.model.get('_attributes'));\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click .js-notify-btn-alert': 'onAlertButtonClicked',\r\n      'click .js-notify-btn-prompt': 'onPromptButtonClicked',\r\n      'click .js-notify-close-btn': 'onCloseButtonClicked',\r\n      'click .js-notify-shadow-click': 'onShadowClicked'\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    _.bindAll(this, 'resetNotifySize', 'onKeyUp');\r\n    this.disableAnimation = Adapt.config.get('_disableAnimation') || false;\r\n    this.isOpen = false;\r\n    this.hasOpened = false;\r\n    this.setupEventListeners();\r\n    this.render();\r\n  }\r\n\r\n  setupEventListeners() {\r\n    this.listenTo(Adapt, {\r\n      'remove page:scrollTo': this.closeNotify,\r\n      'notify:resize': this.resetNotifySize,\r\n      'notify:cancel': this.cancelNotify,\r\n      'notify:close': this.closeNotify,\r\n      'device:resize': this.resetNotifySize\r\n    });\r\n    this.setupEscapeKey();\r\n  }\r\n\r\n  setupEscapeKey() {\r\n    $(window).on('keyup', this.onKeyUp);\r\n  }\r\n\r\n  onKeyUp(event) {\r\n    if (event.which !== 27) return;\r\n    event.preventDefault();\r\n    this.cancelNotify();\r\n  }\r\n\r\n  render() {\r\n    const data = this.model.toJSON();\r\n    const template = Handlebars.templates.notify;\r\n    // hide notify container\r\n    this.$el.css('visibility', 'hidden');\r\n    // attach popup + shadow\r\n    this.$el.html(template(data)).appendTo('body');\r\n    // hide popup\r\n    this.$('.notify__popup').css('visibility', 'hidden');\r\n    // show notify container\r\n    this.$el.css('visibility', 'visible');\r\n    this.showNotify();\r\n    return this;\r\n  }\r\n\r\n  onAlertButtonClicked(event) {\r\n    event.preventDefault();\r\n    // tab index preservation, notify must close before subsequent callback is triggered\r\n    this.closeNotify();\r\n    Adapt.trigger(this.model.get('_callbackEvent'), this);\r\n  }\r\n\r\n  onPromptButtonClicked(event) {\r\n    event.preventDefault();\r\n    // tab index preservation, notify must close before subsequent callback is triggered\r\n    this.closeNotify();\r\n    Adapt.trigger($(event.currentTarget).attr('data-event'), this);\r\n  }\r\n\r\n  onCloseButtonClicked(event) {\r\n    event.preventDefault();\r\n    // tab index preservation, notify must close before subsequent callback is triggered\r\n    this.cancelNotify();\r\n  }\r\n\r\n  onShadowClicked(event) {\r\n    event.preventDefault();\r\n    if (this.model.get('_closeOnShadowClick') === false) return;\r\n    this.cancelNotify();\r\n  }\r\n\r\n  cancelNotify() {\r\n    if (this.model.get('_isCancellable') === false) return;\r\n    // tab index preservation, notify must close before subsequent callback is triggered\r\n    this.closeNotify();\r\n    Adapt.trigger('notify:cancelled', this);\r\n  }\r\n\r\n  resetNotifySize() {\r\n    if (!this.hasOpened) return;\r\n    this.resizeNotify();\r\n  }\r\n\r\n  resizeNotify() {\r\n    const windowHeight = $(window).height();\r\n    const notifyHeight = this.$('.notify__popup-inner').outerHeight();\r\n    const isFullWindow = (notifyHeight >= windowHeight);\r\n    this.$('.notify__popup').css({\r\n      'height': isFullWindow ? '100%' : 'auto',\r\n      'top': isFullWindow ? 0 : '',\r\n      'margin-top': isFullWindow ? '' : -(notifyHeight / 2),\r\n      'overflow-y': isFullWindow ? 'scroll' : '',\r\n      '-webkit-overflow-scrolling': isFullWindow ? 'touch' : ''\r\n    });\r\n  }\r\n\r\n  async showNotify() {\r\n    this.isOpen = true;\r\n    await this.addSubView();\r\n    // Add to the list of open popups\r\n    Adapt.notify.stack.push(this);\r\n    // Keep focus from previous action\r\n    this.$previousActiveElement = $(document.activeElement);\r\n    Adapt.trigger('notify:opened', this);\r\n    this.$el.imageready(this.onLoaded.bind(this));\r\n  }\r\n\r\n  onLoaded() {\r\n    if (this.disableAnimation) {\r\n      this.$('.notify__shadow').css('display', 'block');\r\n    } else {\r\n      this.$('.notify__shadow').velocity({ opacity: 0 }, { duration: 0 }).velocity({ opacity: 1 }, { duration: 400,\r\n        begin: () => {\r\n          this.$('.notify__shadow').css('display', 'block');\r\n        }\r\n      });\r\n    }\r\n    this.resizeNotify();\r\n    if (this.disableAnimation) {\r\n      this.$('.notify__popup').css('visibility', 'visible');\r\n      this.onOpened();\r\n    } else {\r\n      this.$('.notify__popup').velocity({ opacity: 0 }, { duration: 0 }).velocity({ opacity: 1 }, { duration: 400,\r\n        begin: () => {\r\n          // Make sure to make the notify visible and then set\r\n          // focus, disabled scroll and manage tabs\r\n          this.$('.notify__popup').css('visibility', 'visible');\r\n          this.onOpened();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  onOpened() {\r\n    $.inview();\r\n    this.hasOpened = true;\r\n    // Allows popup manager to control focus\r\n    Adapt.a11y.popupOpened(this.$('.notify__popup'));\r\n    Adapt.a11y.scrollDisable('body');\r\n    $('html').addClass('notify');\r\n    // Set focus to first accessible element\r\n    Adapt.a11y.focusFirst(this.$('.notify__popup'), { defer: false });\r\n  }\r\n\r\n  async addSubView() {\r\n    this.subView = this.model.get('_view');\r\n    if (this.model.get('_id')) {\r\n      // Automatically render the specified id\r\n      const model = Adapt.findById(this.model.get('_id'));\r\n      const View = Adapt.getViewClass(model);\r\n      this.subView = new View({ model });\r\n    }\r\n    if (!this.subView) return;\r\n    this.subView.$el.on('resize', this.resetNotifySize);\r\n    this.$('.notify__content-inner').prepend(this.subView.$el);\r\n    if (!(this.subView instanceof AdaptView) || this.subView.model.get('_isReady')) return;\r\n    // Wait for the AdaptView subview to be ready\r\n    return new Promise(resolve => {\r\n      const check = (model, value) => {\r\n        if (!value) return;\r\n        this.subView.model.off('change:_isReady', check);\r\n        resolve();\r\n      };\r\n      this.subView.model.on('change:_isReady', check);\r\n    });\r\n  }\r\n\r\n  closeNotify() {\r\n    \r\n    // Make sure that only the top most notify is closed\r\n    const stackItem = Adapt.notify.stack[Adapt.notify.stack.length - 1];\r\n    if (this !== stackItem) return;\r\n    Adapt.notify.stack.pop();\r\n    // Prevent from being invoked multiple times - see https://github.com/adaptlearning/adapt_framework/issues/1659\r\n    if (!this.isOpen) return;\r\n\r\n    this.isOpen = false;\r\n    // If closeNotify is called before showNotify has finished then wait\r\n    // until it's open.\r\n    if (this.hasOpened) {\r\n      this.onCloseReady();\r\n      return;\r\n    }\r\n    this.listenToOnce(Adapt, 'popup:opened', () => {\r\n      // Wait for popup:opened to finish processing\r\n      _.defer(this.onCloseReady.bind(this));\r\n    });\r\n  }\r\n\r\n  onCloseReady() {\r\n    if (this.disableAnimation) {\r\n      this.$('.notify__popup').css('visibility', 'hidden');\r\n      this.$el.css('visibility', 'hidden');\r\n      this.remove();\r\n    } else {\r\n      this.$('.notify__popup').velocity({ opacity: 0 }, { duration: 400,\r\n        complete: () => {\r\n          this.$('.notify__popup').css('visibility', 'hidden');\r\n        }\r\n      });\r\n      this.$('.notify__shadow').velocity({ opacity: 0 }, { duration: 400,\r\n        complete: () => {\r\n          this.$el.css('visibility', 'hidden');\r\n          this.remove();\r\n        }\r\n      });\r\n    }\r\n    Adapt.a11y.scrollEnable('body');\r\n    $('html').removeClass('notify');\r\n    // Return focus to previous active element\r\n    Adapt.a11y.popupClosed(this.$previousActiveElement);\r\n    // Return reference to the notify view\r\n    Adapt.trigger('notify:closed', this);\r\n  }\r\n\r\n  remove(...args) {\r\n    this.removeSubView();\r\n    $(window).off('keyup', this.onKeyUp);\r\n    super.remove(...args);\r\n  }\r\n\r\n  removeSubView() {\r\n    if (!this.subView) return;\r\n    this.subView.$el.off('resize', this.resetNotifySize);\r\n    if (this.subView instanceof AdaptView) {\r\n      // Clear up nested views and models\r\n      const views = [...this.subView.findDescendantViews(), this.subView];\r\n      views.forEach(view => {\r\n        view.model.set('_isReady', false);\r\n        view.remove();\r\n      });\r\n    } else {\r\n      this.subView.remove();\r\n    }\r\n    this.subView = null;\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport NotifyPushCollection from 'core/js/collections/notifyPushCollection';\r\nimport NotifyView from 'core/js/views/notifyView';\r\nimport NotifyModel from 'core/js/models/notifyModel';\r\n\r\nclass Notify extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this._stack = [];\r\n    this.notifyPushes = new NotifyPushCollection();\r\n    this.listenTo(Adapt, {\r\n      'notify:popup': this._deprecated.bind(this, 'popup'),\r\n      'notify:alert': this._deprecated.bind(this, 'alert'),\r\n      'notify:prompt': this._deprecated.bind(this, 'prompt'),\r\n      'notify:push': this._deprecated.bind(this, 'push')\r\n    });\r\n  }\r\n\r\n  get stack() {\r\n    return this._stack;\r\n  }\r\n\r\n  _deprecated(type, notifyObject) {\r\n    Adapt.log.deprecated(`NOTIFY DEPRECATED: Adapt.trigger('notify:${type}', notifyObject); is no longer supported, please use Adapt.notify.${type}(notifyObject);`);\r\n    return this.create(notifyObject, { _type: type });\r\n  }\r\n\r\n  create(notifyObject, defaults) {\r\n    notifyObject = _.defaults({}, notifyObject, defaults, {\r\n      _type: 'popup',\r\n      _isCancellable: true,\r\n      _showCloseButton: true,\r\n      _closeOnShadowClick: true\r\n    });\r\n\r\n    if (notifyObject._type === 'push') {\r\n      this.notifyPushes.push(notifyObject);\r\n      return;\r\n    }\r\n\r\n    return new NotifyView({\r\n      model: new NotifyModel(notifyObject)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a 'popup' notify\r\n   * @param {Object} notifyObject An object containing all the settings for the popup\r\n   * @param {string} notifyObject.title Title of the popup\r\n   * @param {string} notifyObject.body Body of the popup\r\n   * @param {Boolean} [notifyObject._showCloseButton=true] If set to `false` the popup will not have a close button. The learner will still be able to dismiss the popup by clicking outside of it or by pressing the Esc key. This setting is typically used mainly for popups that have a subview (where the subview contains the close button)\r\n   * @param {Boolean} [notifyObject._isCancellable=true] If set to `false` the learner will not be able to close the popup - use with caution!\r\n   * @param {string} [notifyObject._classes] A class name or (space separated) list of class names you'd like to be applied to the popup's `<div>`\r\n   * @param {Backbone.View} [notifyObject._view] Subview to display in the popup instead of the standard view\r\n   */\r\n  popup(notifyObject) {\r\n    return this.create(notifyObject, { _type: 'popup' });\r\n  }\r\n\r\n  /**\r\n   * Creates an 'alert' notify popup\r\n   * @param {Object} notifyObject An object containing all the settings for the alert popup\r\n   * @param {string} notifyObject.title Title of the alert popup\r\n   * @param {string} notifyObject.body Body of the alert popup\r\n   * @param {string} notifyObject.confirmText Label for the popup confirm button\r\n   * @param {Boolean} [notifyObject._isCancellable=true] If set to `false` only the confirm button can be used to dismiss/close the popup\r\n   * @param {Boolean} [notifyObject._showIcon=false] If set to `true` an 'alert' icon will be displayed in the popup\r\n   * @param {string} [notifyObject._callbackEvent] Event to trigger when the confirm button is clicked\r\n   * @param {string} [notifyObject._classes] A class name or (space separated) list of class names you'd like to be applied to the popup's `<div>`\r\n   * @param {Backbone.View} [notifyObject._view] Subview to display in the popup instead of the standard view\r\n   */\r\n  alert(notifyObject) {\r\n    return this.create(notifyObject, { _type: 'alert' });\r\n  }\r\n\r\n  /**\r\n   * Creates a 'prompt dialog' notify popup\r\n   * @param {Object} notifyObject An object containing all the settings for the prompt dialog\r\n   * @param {string} notifyObject.title Title of the prompt\r\n   * @param {string} notifyObject.body Body of the prompt\r\n   * @param {Object[]} notifyObject._prompts Array of objects that each define a button (and associated callback event) that you want shown in the prompt\r\n   * @param {string} notifyObject._prompts[].promptText Label for this button\r\n   * @param {string} notifyObject._prompts[]._callbackEvent Event to be triggered when this button is clicked\r\n   * @param {Boolean} [notifyObject._isCancellable=true] If set to `false` only the confirm button can be used to dismiss/close the prompt\r\n   * @param {Boolean} [notifyObject._showIcon=true] If set to `true` a 'query' icon will be displayed in the popup\r\n   * @param {string} [notifyObject._callbackEvent] Event to trigger when the confirm button is clicked\r\n   * @param {string} [notifyObject._classes] A class name or (space separated) list of class names you'd like to be applied to the popup's `<div>`\r\n   * @param {Backbone.View} [notifyObject._view] Subview to display in the popup instead of the standard view\r\n   */\r\n  prompt(notifyObject) {\r\n    return this.create(notifyObject, { _type: 'prompt' });\r\n  }\r\n\r\n  /**\r\n   * Creates a 'push notification'\r\n   * @param {Object} notifyObject An object containing all the settings for the push notification\r\n   * @param {string} notifyObject.title Title of the push notification\r\n   * @param {string} notifyObject.body Body of the push notification\r\n   * @param {Number} [notifyObject._timeout=3000] Length of time (in milliseconds) the notification should left on-screen before automatically fading away\r\n   * @param {string} notifyObject._callbackEvent Event to be triggered if the learner clicks on the push notification (not triggered if they use the close button)\r\n   * @param {string} [notifyObject._classes] A class name or (space separated) list of class names you'd like to be applied to the popup's `<div>`\r\n   */\r\n  push(notifyObject) {\r\n    return this.create(notifyObject, { _type: 'push' });\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.notify = new Notify());\r\n","import LockingModel from 'core/js/models/lockingModel';\r\n\r\nexport default class RouterModel extends LockingModel {\r\n\r\n  defaults() {\r\n    return {\r\n      _canNavigate: true,\r\n      _shouldNavigateFocus: true\r\n    };\r\n  }\r\n\r\n  lockedAttributes() {\r\n    return {\r\n      _canNavigate: false,\r\n      _shouldNavigateFocus: false\r\n    };\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport RouterModel from 'core/js/models/routerModel';\r\nimport CourseModel from 'core/js/models/courseModel';\r\nimport ContentObjectModel from 'core/js/models/contentObjectModel';\r\nimport MenuModel from 'core/js/models/menuModel';\r\nimport 'core/js/startController';\r\n\r\nclass Router extends Backbone.Router {\r\n\r\n  routes() {\r\n    return {\r\n      '': 'handleRoute',\r\n      'id/:id': 'handleRoute',\r\n      ':pluginName(/*location)(/*action)': 'handleRoute'\r\n    };\r\n  }\r\n\r\n  initialize({ model }) {\r\n    this._isBackward = false;\r\n    this.model = model;\r\n    this._navigationRoot = null;\r\n    // Flag to indicate if the router has tried to redirect to the current location.\r\n    this._isCircularNavigationInProgress = false;\r\n    this.showLoading();\r\n    // Store #wrapper element and html to cache for later use.\r\n    this.$wrapper = $('#wrapper');\r\n    this.$html = $('html');\r\n    this.listenToOnce(Adapt, 'app:dataReady', this.setDocumentTitle);\r\n    this.listenTo(Adapt, 'router:navigateTo', this.navigateToArguments);\r\n  }\r\n\r\n  get rootModel() {\r\n    return this._navigationRoot || Adapt.course;\r\n  }\r\n\r\n  set rootModel(model) {\r\n    this._navigationRoot = model;\r\n  }\r\n\r\n  showLoading() {\r\n    $('.js-loading').show();\r\n  }\r\n\r\n  hideLoading() {\r\n    $('.js-loading').hide();\r\n  }\r\n\r\n  setDocumentTitle() {\r\n    const currentModel = Adapt.location._currentModel;\r\n    const hasSubTitle = (currentModel && currentModel !== Adapt.router.rootModel && currentModel.get('title'));\r\n    const title = [\r\n      this.rootModel.get('title'),\r\n      hasSubTitle && currentModel.get('title')\r\n    ].filter(Boolean).join(' | ');\r\n    this.listenToOnce(Adapt, 'contentObjectView:preRender', () => {\r\n      const escapedTitle = $(`<div>${title}</div>`).text();\r\n      document.title = escapedTitle;\r\n    });\r\n  }\r\n\r\n  navigateToArguments(args) {\r\n    args = args.filter(v => v !== null);\r\n    const options = { trigger: false, replace: false };\r\n    if (args.length === 1 && Adapt.findById(args[0])) {\r\n      this.navigate('#/id/' + args[0], options);\r\n      return;\r\n    }\r\n    if (args.length <= 3) {\r\n      this.navigate('#/' + args.join('/'), options);\r\n      return;\r\n    }\r\n    Adapt.log.deprecated(`Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')`);\r\n    this.handleRoute(...args);\r\n  }\r\n\r\n  handleRoute(...args) {\r\n    args = args.filter(v => v !== null);\r\n\r\n    console.log(\"--- Location --------------------------------\");\r\n    /*console.log({\r\n      \"args\": args,\r\n      \"location\": window.location\r\n    });*/\r\n    console.log(JSON.stringify(args));\r\n    console.log(\"---------------------------------------------\");\r\n\r\n    if (this.model.get('_canNavigate')) {\r\n      // Reset _isCircularNavigationInProgress protection as code is allowed to navigate away.\r\n      this._isCircularNavigationInProgress = false;\r\n    }\r\n\r\n    // Check if the current page is in the process of navigating to itself.\r\n    // It will redirect to itself if the URL was changed and _canNavigate is false.\r\n    if (this._isCircularNavigationInProgress === false) {\r\n      // Trigger an event pre 'router:location' to allow extensions to stop routing.\r\n      Adapt.trigger('router:navigate', args);\r\n    }\r\n\r\n    // Re-check as _canNavigate can be set to false on 'router:navigate' event.\r\n    if (this.model.get('_canNavigate')) {\r\n      // Disable navigation whilst rendering.\r\n      this.model.set('_canNavigate', false, { pluginName: 'adapt' });\r\n      this._isBackward = false;\r\n      if (args.length <= 1) {\r\n        return this.handleId(...args);\r\n      }\r\n      return this.handlePluginRouter(...args);\r\n    }\r\n\r\n    if (this._isCircularNavigationInProgress) {\r\n      // Navigation correction finished.\r\n      // Router has successfully re-navigated to the current _id as the URL was changed\r\n      // while _canNavigate: false\r\n      this._isCircularNavigationInProgress = false;\r\n      return;\r\n    }\r\n\r\n    // Cancel navigation to stay at the current location.\r\n    this._isCircularNavigationInProgress = true;\r\n    Adapt.trigger('router:navigationCancelled', args);\r\n\r\n    // DD: Fix issue with isolating blocks while in debug mode.\r\n    if (Adapt.isDebugEnabled()) return;\r\n\r\n    // Reset URL to the current one.\r\n    // https://github.com/adaptlearning/adapt_framework/issues/3061\r\n    Backbone.history.history[this._isBackward ? 'forward' : 'back']();\r\n    this._isBackward = false;\r\n  }\r\n\r\n  async handlePluginRouter(pluginName, location, action) {\r\n    const pluginLocation = [\r\n      pluginName,\r\n      location && `-${location}`,\r\n      action && `-${action}`\r\n    ].filter(Boolean).join('');\r\n    await this.updateLocation(pluginLocation, null, null, null);\r\n\r\n    Adapt.trigger('router:plugin:' + pluginName, pluginName, location, action);\r\n    Adapt.trigger('router:plugin', pluginName, location, action);\r\n    this.model.set('_canNavigate', true, { pluginName: 'adapt' });\r\n  }\r\n\r\n  async handleId(id) {\r\n    const rootModel = Adapt.router.rootModel;\r\n    let model = (!id) ? rootModel : Adapt.findById(id);\r\n\r\n    if (!model) {\r\n      // Bad id\r\n      this.model.set('_canNavigate', true, { pluginName: 'adapt' });\r\n      return;\r\n    }\r\n\r\n    // Keep the routed id incase it needs to be scrolled to later\r\n    const isContentObject = (model instanceof ContentObjectModel);\r\n    const navigateToId = model.get('_id');\r\n\r\n    // Ensure that the router is rendering a contentobject\r\n    model = isContentObject ? model : model.findAncestor('contentobject');\r\n    id = model.get('_id');\r\n\r\n    const isRoot = (model === rootModel);\r\n    if (isRoot && Adapt.course.has('_start')) {\r\n      // Do not allow access to the menu when the start controller is enabled.\r\n      const startController = Adapt.course.get('_start');\r\n      if (startController._isEnabled === true && startController._isMenuDisabled === true) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (model.get('_isLocked') && Adapt.config.get('_forceRouteLocking')) {\r\n      // Locked id\r\n      Adapt.log.warn('Unable to navigate to locked id: ' + id);\r\n      this.model.set('_canNavigate', true, { pluginName: 'adapt' });\r\n      if (Adapt.location._previousId === undefined) {\r\n        return this.navigate('#/', { trigger: true, replace: true });\r\n      }\r\n      return this.navigateBack();\r\n    }\r\n\r\n    // Move to a content object\r\n    this.showLoading();\r\n    await Adapt.remove();\r\n\r\n    /**\r\n     * TODO:\r\n     * As the course object has separate location and type rules,\r\n     * it makes it more difficult to update the Adapt.location object\r\n     * should stop doing this.\r\n     */\r\n    const isCourse = (model instanceof CourseModel);\r\n    const type = isCourse ? 'menu' : model.get('_type');\r\n    const location = isCourse ? 'course' : `${type}-${id}`;\r\n\r\n    model.set('_isVisited', true);\r\n    await this.updateLocation(location, type, id, model);\r\n\r\n    Adapt.once('contentObjectView:ready', () => {\r\n      // Allow navigation.\r\n      this.model.set('_canNavigate', true, { pluginName: 'adapt' });\r\n      this.handleNavigationFocus();\r\n    });\r\n    Adapt.trigger(`router:${type} router:contentObject`, model);\r\n\r\n    const ViewClass = Adapt.getViewClass(model);\r\n    const isMenu = (model instanceof MenuModel);\r\n    if (!ViewClass && isMenu) {\r\n      Adapt.log.deprecated(`Using event based menu view instantiation for '${Adapt.getViewName(model)}'`);\r\n      return;\r\n    }\r\n\r\n    if (!isMenu) {\r\n      // checkIfResetOnRevisit where exists on descendant models before render\r\n      _.invoke(model.getAllDescendantModels(), 'checkIfResetOnRevisit');\r\n      // wait for completion to settle\r\n      await Adapt.deferUntilCompletionChecked();\r\n    }\r\n\r\n    this.$wrapper.append(new ViewClass({ model }).$el);\r\n\r\n    if (!isContentObject && !this.isScrolling) {\r\n      // Scroll to element if not a content object or not already trying to\r\n      await Adapt.navigateToElement('.' + navigateToId, { replace: true, duration: 400 });\r\n    }\r\n\r\n  }\r\n\r\n  async updateLocation(currentLocation, type, id, currentModel) {\r\n    // Handles updating the location.\r\n    Adapt.location._previousModel = Adapt.location._currentModel;\r\n    Adapt.location._previousId = Adapt.location._currentId;\r\n    Adapt.location._previousContentType = Adapt.location._contentType;\r\n\r\n    Adapt.location._currentModel = currentModel;\r\n    Adapt.location._currentId = id;\r\n    Adapt.location._contentType = type;\r\n    Adapt.location._currentLocation = currentLocation;\r\n\r\n    /**\r\n     * TODO:\r\n     * this if block should be removed,\r\n     * these properties are unused in the framework\r\n     */\r\n    if (type === 'menu') {\r\n      Adapt.location._lastVisitedType = 'menu';\r\n      Adapt.location._lastVisitedMenu = id;\r\n    } else if (type === 'page') {\r\n      Adapt.location._lastVisitedType = 'page';\r\n      Adapt.location._lastVisitedPage = id;\r\n    }\r\n\r\n    this.setDocumentTitle();\r\n    this.setGlobalClasses();\r\n\r\n    // Trigger event when location changes.\r\n    Adapt.trigger('router:location', Adapt.location);\r\n\r\n    await Adapt.wait.queue();\r\n  }\r\n\r\n  setGlobalClasses() {\r\n    const currentModel = Adapt.location._currentModel;\r\n\r\n    const htmlClasses = currentModel?.get('_htmlClasses') || '';\r\n    const classes = (Adapt.location._currentId) ?\r\n      `location-${Adapt.location._contentType} location-id-${Adapt.location._currentId}` :\r\n      `location-${Adapt.location._currentLocation}`;\r\n    const currentClasses = `${classes} ${htmlClasses}`;\r\n\r\n    this.$html\r\n      .removeClass(Adapt.location._previousClasses)\r\n      .addClass(currentClasses)\r\n      .attr('data-location', Adapt.location._currentLocation);\r\n\r\n    this.$wrapper\r\n      .removeClass()\r\n      .addClass(classes)\r\n      .attr('data-location', Adapt.location._currentLocation);\r\n\r\n    Adapt.location._previousClasses = currentClasses;\r\n  }\r\n\r\n  handleNavigationFocus() {\r\n    if (!this.model.get('_shouldNavigateFocus')) return;\r\n    // Body will be forced to accept focus to start the\r\n    // screen reader reading the page.\r\n    Adapt.a11y.focus('body');\r\n  }\r\n\r\n  navigateBack() {\r\n    this._isBackward = true;\r\n    Backbone.history.history.back();\r\n  }\r\n\r\n  navigateToCurrentRoute(force) {\r\n    if (!this.model.get('_canNavigate') && !force) {\r\n      return;\r\n    }\r\n    if (!Adapt.location._currentId) {\r\n      return;\r\n    }\r\n    const currentId = Adapt.location._currentModel.get('_id');\r\n    const isRoot = (Adapt.location._currentModel === this.rootModel);\r\n    const route = isRoot ? '#/' : '#/id/' + currentId;\r\n    this.navigate(route, { trigger: true, replace: true });\r\n  }\r\n\r\n  navigateToPreviousRoute(force) {\r\n    // Sometimes a plugin might want to stop the default navigation.\r\n    // Check whether default navigation has changed.\r\n    if (!this.model.get('_canNavigate') && !force) {\r\n      return;\r\n    }\r\n    const currentModel = Adapt.location._currentModel;\r\n    const previousModel = Adapt.location._previousModel;\r\n    if (!currentModel) {\r\n      return this.navigateBack();\r\n    }\r\n    if (Adapt.location._currentModel instanceof MenuModel) {\r\n      return this.navigateToParent();\r\n    }\r\n    if (previousModel) {\r\n      return this.navigateBack();\r\n    }\r\n    this.navigateToParent();\r\n  }\r\n\r\n  navigateToParent(force) {\r\n    if (!this.model.get('_canNavigate') && !force) {\r\n      return;\r\n    }\r\n    const parentId = Adapt.location._currentModel.get('_parentId');\r\n    const parentModel = Adapt.findById(parentId);\r\n    const isRoot = (parentModel === this.rootModel);\r\n    const route = isRoot ? '#/' : '#/id/' + parentId;\r\n    this.navigate(route, { trigger: true });\r\n  }\r\n\r\n  navigateToHomeRoute(force) {\r\n    if (!this.model.get('_canNavigate') && !force) {\r\n      return;\r\n    }\r\n    this.navigate('#/', { trigger: true });\r\n  }\r\n\r\n  /**\r\n   * Allows a selector or id to be passed in and Adapt will navigate to this element. Resolves\r\n   * asynchronously when the element has been navigated to.\r\n   * Backend for Adapt.navigateToElement\r\n   * @param {string} selector CSS selector or id of the Adapt element you want to navigate to e.g. `\".co-05\"` or `\"co-05\"`\r\n   * @param {Object} [settings] The settings for the `$.scrollTo` function (See https://github.com/flesler/jquery.scrollTo#settings).\r\n   * @param {Object} [settings.replace=false] Set to `true` if you want to update the URL without creating an entry in the browser's history.\r\n   */\r\n  async navigateToElement(selector, settings = {}) {\r\n    const currentModelId = selector.replace(/\\./g, '').split(' ')[0];\r\n    const currentModel = Adapt.findById(currentModelId);\r\n\r\n    if (currentModel && (!currentModel.get('_isRendered') || !currentModel.get('_isReady'))) {\r\n      const shouldReplace = settings.replace || false;\r\n      const contentObject = (currentModel instanceof ContentObjectModel) ? currentModel : currentModel.findAncestor('contentobject');\r\n      const contentObjectId = contentObject.get('_id');\r\n      const isNotInCurrentContentObject = (contentObjectId !== Adapt.location._currentId);\r\n      if (isNotInCurrentContentObject) {\r\n        this.isScrolling = true;\r\n        this.navigate(`#/id/${currentModelId}`, { trigger: true, replace: shouldReplace });\r\n        this.model.set('_shouldNavigateFocus', false, { pluginName: 'adapt' });\r\n        await new Promise(resolve => Adapt.once('contentObjectView:ready', _.debounce(() => {\r\n          this.model.set('_shouldNavigateFocus', true, { pluginName: 'adapt' });\r\n          resolve();\r\n        }, 1)));\r\n        this.isScrolling = false;\r\n      }\r\n      await Adapt.parentView.renderTo(currentModelId);\r\n    }\r\n\r\n    // Correct selector when passed a pure id\r\n    if (currentModel && selector === currentModel.get('_id')) {\r\n      selector = `.${selector}`;\r\n    }\r\n\r\n    // Get the current location - this is set in the router\r\n    const location = (Adapt.location._contentType) ?\r\n      Adapt.location._contentType : Adapt.location._currentLocation;\r\n    // Trigger initial scrollTo event\r\n    Adapt.trigger(`${location}:scrollTo`, selector);\r\n    // Setup duration variable\r\n    const disableScrollToAnimation = Adapt.config.has('_disableAnimation') ? Adapt.config.get('_disableAnimation') : false;\r\n    if (disableScrollToAnimation) {\r\n      settings.duration = 0;\r\n    } else if (!settings.duration) {\r\n      settings.duration = $.scrollTo.defaults.duration;\r\n    }\r\n\r\n    let offsetTop = 0;\r\n    if (Adapt.scrolling.isLegacyScrolling) {\r\n      offsetTop = -$('.nav').outerHeight();\r\n      // prevent scroll issue when component description aria-label coincident with top of component\r\n      if ($(selector).hasClass('component')) {\r\n        offsetTop -= $(selector).find('.aria-label').height() || 0;\r\n      }\r\n    }\r\n\r\n    if (!settings.offset) settings.offset = { top: offsetTop, left: 0 };\r\n    if (settings.offset.top === undefined) settings.offset.top = offsetTop;\r\n    if (settings.offset.left === undefined) settings.offset.left = 0;\r\n\r\n    if (settings.offset.left === 0) settings.axis = 'y';\r\n\r\n    if (Adapt.get('_canScroll') !== false) {\r\n      // Trigger scrollTo plugin\r\n      $.scrollTo(selector, settings);\r\n    }\r\n\r\n    // Trigger an event after animation\r\n    // 300 milliseconds added to make sure queue has finished\r\n    await new Promise(resolve => {\r\n      _.delay(() => {\r\n        Adapt.a11y.focusNext(selector);\r\n        Adapt.trigger(`${location}:scrolledTo`, selector);\r\n        resolve();\r\n      }, settings.duration + 300);\r\n    });\r\n  }\r\n\r\n  get(...args) {\r\n    Adapt.log.deprecated('Adapt.router.get, please use Adapt.router.model.get');\r\n    return this.model.get(...args);\r\n  }\r\n\r\n  set(...args) {\r\n    Adapt.log.deprecated('Adapt.router.set, please use Adapt.router.model.set');\r\n    return this.model.set(...args);\r\n  }\r\n\r\n}\r\n\r\nAdapt.router = new Router({\r\n  model: new RouterModel(null, { reset: true })\r\n});\r\n\r\nAdapt.navigateToElement = Adapt.router.navigateToElement.bind(Adapt.router);\r\n\r\nexport default Adapt.router;\r\n","import AdaptCollection from 'core/js/collections/adaptCollection';\r\n\r\nexport default class AdaptSubsetCollection extends AdaptCollection {\r\n\r\n  initialize(models, options) {\r\n    super.initialize(models, options);\r\n    this.parent = options.parent;\r\n    this.listenTo(this.parent, 'reset', this.loadSubset);\r\n  }\r\n\r\n  loadSubset() {\r\n    this.set(this.parent.filter(model => model instanceof this.model));\r\n    this._byAdaptID = this.groupBy('_id');\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptModel from 'core/js/models/adaptModel';\r\n\r\nclass ArticleModel extends AdaptModel {\r\n\r\n  get _parent() {\r\n    Adapt.log.deprecated('articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON');\r\n    return 'contentObjects';\r\n  }\r\n\r\n  get _siblings() {\r\n    Adapt.log.deprecated('articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON');\r\n    return 'articles';\r\n  }\r\n\r\n  get _children() {\r\n    Adapt.log.deprecated('articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON');\r\n    return 'blocks';\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'article';\r\n  }\r\n\r\n}\r\n\r\nAdapt.register('article', { model: ArticleModel });\r\n\r\nexport default ArticleModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptModel from 'core/js/models/adaptModel';\r\n\r\nclass BlockModel extends AdaptModel {\r\n\r\n  get _parent() {\r\n    Adapt.log.deprecated('blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON');\r\n    return 'articles';\r\n  }\r\n\r\n  get _siblings() {\r\n    Adapt.log.deprecated('blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON');\r\n    return 'blocks';\r\n  }\r\n\r\n  get _children() {\r\n    Adapt.log.deprecated('blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON');\r\n    return 'components';\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'block';\r\n  }\r\n\r\n}\r\n\r\nAdapt.register('block', { model: BlockModel });\r\n\r\nexport default BlockModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptModel from 'core/js/models/adaptModel';\r\n\r\nclass ComponentModel extends AdaptModel {\r\n\r\n  get _parent() {\r\n    Adapt.log.deprecated('componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON');\r\n    return 'blocks';\r\n  }\r\n\r\n  get _siblings() {\r\n    Adapt.log.deprecated('componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON');\r\n    return 'components';\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'component';\r\n  }\r\n\r\n  defaults() {\r\n    return AdaptModel.resultExtend('defaults', {\r\n      _isA11yComponentDescriptionEnabled: true,\r\n      _userAnswer: null,\r\n      _attemptStates: null\r\n    });\r\n  }\r\n\r\n  trackable() {\r\n    return AdaptModel.resultExtend('trackable', [\r\n      '_userAnswer',\r\n      '_attemptStates'\r\n    ]);\r\n  }\r\n\r\n  trackableType() {\r\n    return AdaptModel.resultExtend('trackableType', [\r\n      Array,\r\n      Array\r\n    ]);\r\n  }\r\n\r\n  get hasManagedChildren() {\r\n    return false;\r\n  }\r\n\r\n  init() {\r\n    if (Adapt.get('_isStarted')) {\r\n      this.onAdaptInitialize();\r\n      return;\r\n    }\r\n    this.listenToOnce(Adapt, 'adapt:initialize', this.onAdaptInitialize);\r\n  }\r\n\r\n  onAdaptInitialize() {\r\n    this.restoreUserAnswers();\r\n  }\r\n\r\n  /**\r\n   * Restore the user's answer from the _userAnswer property.\r\n   * The _userAnswer value must be in the form of arrays containing\r\n   * numbers, booleans or arrays only.\r\n   */\r\n  restoreUserAnswers() {}\r\n\r\n  /**\r\n   * Store the user's answer in the _userAnswer property.\r\n   * The _userAnswer value must be in the form of arrays containing\r\n   * numbers, booleans or arrays only.\r\n   */\r\n  storeUserAnswer() {}\r\n\r\n  resetUserAnswer() {\r\n    this.set('_userAnswer', null);\r\n  }\r\n\r\n  reset(type, force) {\r\n    if (!this.get('_canReset') && !force) return;\r\n    this.resetUserAnswer();\r\n    super.reset(type, force);\r\n  }\r\n\r\n  /**\r\n   * Returns the current attempt state raw data or the raw data from the supplied attempt state object.\r\n   * @param {Object} [object] JSON object representing the component state. Defaults to current JSON.\r\n   * @returns {Array}\r\n   */\r\n  getAttemptState(object = this.toJSON()) {\r\n    const trackables = this.trackable();\r\n    const types = this.trackableType();\r\n    trackables.find((name, index) => {\r\n      // Exclude _attemptStates as it's trackable but isn't needed here\r\n      if (name !== '_attemptStates') return;\r\n      trackables.splice(index, 1);\r\n      types.splice(index, 1);\r\n      return true;\r\n    });\r\n    const values = trackables.map(n => object[n]);\r\n    const booleans = values.filter((v, i) => types[i] === Boolean).map(Boolean);\r\n    const numbers = values.filter((v, i) => types[i] === Number).map(v => Number(v) || 0);\r\n    const arrays = values.filter((v, i) => types[i] === Array);\r\n    return [\r\n      numbers,\r\n      booleans,\r\n      arrays\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Returns an attempt object representing the current state or a formatted version of the raw state object supplied.\r\n   * @param {Array} [state] JSON object representing the component state, defaults to current state returned from getAttemptState().\r\n   * @returns {Object}\r\n   */\r\n  getAttemptObject(state = this.getAttemptState()) {\r\n    const trackables = this.trackable();\r\n    const types = this.trackableType();\r\n    trackables.find((name, index) => {\r\n      // Exclude _attemptStates as it's trackable but isn't needed here\r\n      if (name !== '_attemptStates') return;\r\n      trackables.splice(index, 1);\r\n      types.splice(index, 1);\r\n      return true;\r\n    });\r\n    const numbers = (state[0] || []).slice(0);\r\n    const booleans = (state[1] || []).slice(0);\r\n    const arrays = (state[2] || []).slice(0);\r\n    const object = {};\r\n    trackables.forEach((n, i) => {\r\n      if (n === '_id') return;\r\n      switch (types[i]) {\r\n        case Number:\r\n          object[n] = numbers.shift();\r\n          break;\r\n        case Boolean:\r\n          object[n] = booleans.shift();\r\n          break;\r\n        case Array:\r\n          object[n] = arrays.shift();\r\n          break;\r\n      }\r\n    });\r\n    return object;\r\n  }\r\n\r\n  /**\r\n   * Sets the current attempt state from the supplied attempt state object.\r\n   * @param {Object} object JSON object representing the component state.\r\n   * @param {boolean} silent Stops change events from triggering\r\n   */\r\n  setAttemptObject(object, silent = true) {\r\n    this.set(object, { silent });\r\n  }\r\n\r\n  /**\r\n   * Adds the current attempt state object or the supplied state object to the attempts store.\r\n   * @param {Object} [object] JSON object representing the component state. Defaults to current JSON.\r\n   */\r\n  addAttemptObject(object = this.getAttemptObject()) {\r\n    const attemptStates = this.get('_attemptStates') || [];\r\n    const state = this.getAttemptState(object);\r\n    attemptStates.push(state);\r\n    this.set('_attemptStates', attemptStates);\r\n  }\r\n\r\n  /**\r\n   * Returns an array of the previous state objects. The most recent state is last in the list.\r\n   * @returns {Array}\r\n   */\r\n  getAttemptObjects() {\r\n    const states = this.get('_attemptStates') || [];\r\n    return states.map(state => this.getAttemptObject(state));\r\n  }\r\n\r\n}\r\n\r\n// This abstract model needs to registered to support deprecated view-only components\r\nAdapt.register('component', { model: ComponentModel });\r\n\r\nexport default ComponentModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport ContentObjectModel from 'core/js/models/contentObjectModel';\r\n\r\nclass PageModel extends ContentObjectModel {\r\n\r\n  get _children() {\r\n    Adapt.log.deprecated('pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON');\r\n    return 'articles';\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'page';\r\n  }\r\n\r\n}\r\n\r\nAdapt.register('page', { model: PageModel });\r\n\r\nexport default PageModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptView from 'core/js/views/adaptView';\r\n\r\nexport default class ContentObjectView extends AdaptView {\r\n\r\n  attributes() {\r\n    return AdaptView.resultExtend('attributes', {\r\n      'role': 'main',\r\n      'aria-labelledby': `${this.model.get('_id')}-heading`\r\n    }, this);\r\n  }\r\n\r\n  className() {\r\n    return [\r\n      this.constructor.type,\r\n      'contentobject',\r\n      this.constructor.className,\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : '')\r\n    ].filter(Boolean).join(' ');\r\n  }\r\n\r\n  preRender() {\r\n    $.inview.lock(this.constructor.type + 'View');\r\n    this.disableAnimation = Adapt.config.has('_disableAnimation') ? Adapt.config.get('_disableAnimation') : false;\r\n    this.$el.css('opacity', 0);\r\n    this.listenTo(this.model, 'change:_isReady', this.isReady);\r\n  }\r\n\r\n  render() {\r\n    const type = this.constructor.type;\r\n    Adapt.trigger(`${type}View:preRender contentObjectView:preRender view:preRender`, this);\r\n\r\n    if (this.isReact) {\r\n      this.changed();\r\n    } else {\r\n      const data = this.model.toJSON();\r\n      data.view = this;\r\n      const template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n    }\r\n\r\n    Adapt.trigger(`${type}View:render contentObjectView:render view:render`, this);\r\n\r\n    _.defer(() => {\r\n      // don't call postRender after remove\r\n      if (this._isRemoved) return;\r\n\r\n      this.postRender();\r\n      Adapt.trigger(`${type}View:postRender contentObjectView:postRender view:postRender`, this);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  async isReady() {\r\n    if (!this.model.get('_isReady') || this._isTriggeredReady) return;\r\n    this._isTriggeredReady = true;\r\n\r\n    const type = this.constructor.type;\r\n    const performIsReady = async () => {\r\n      Adapt.trigger(`${type}View:preReady contentObjectView:preReady view:preReady`, this);\r\n      await Adapt.wait.queue();\r\n      $('.js-loading').hide();\r\n      if (Adapt.get('_shouldContentObjectScrollTop') !== false) {\r\n        $(window).scrollTop(0);\r\n      }\r\n      Adapt.trigger(`${type}View:ready contentObjectView:ready view:ready`, this);\r\n      $.inview.unlock(`${type}View`);\r\n      const styleOptions = { opacity: 1 };\r\n      if (this.disableAnimation) {\r\n        this.$el.css(styleOptions);\r\n        $.inview();\r\n        _.defer(() => {\r\n          Adapt.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`, this);\r\n        });\r\n      } else {\r\n        this.$el.velocity(styleOptions, {\r\n          duration: 'fast',\r\n          complete: () => {\r\n            $.inview();\r\n            Adapt.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`, this);\r\n          }\r\n        });\r\n      }\r\n      $(window).scroll();\r\n    };\r\n\r\n    _.defer(performIsReady);\r\n  }\r\n\r\n  /**\r\n   * Force render up to specified id. Resolves when views are ready.\r\n   * @param {string} id\r\n   */\r\n  async renderTo(id) {\r\n    const isRenderToSelf = (id === this.model.get('_id'));\r\n    if (isRenderToSelf) return;\r\n    let models = this.model.getAllDescendantModels(true).filter(model => model.get('_isAvailable'));\r\n    const index = models.findIndex(model => model.get('_id') === id);\r\n    if (index === -1) {\r\n      throw new Error(`Cannot renderTo \"${id}\" as it isn't a descendant.`);\r\n    }\r\n    // Return early if the model is already rendered and ready\r\n    const model = models[index];\r\n    if (model.get('_isRendered') && model.get('_isReady')) {\r\n      return;\r\n    }\r\n    // Force all models up until the id to render\r\n    models = models.slice(0, index + 1);\r\n    const ids = _.indexBy(models, (model) => model.get('_id'));\r\n    const forceUntilId = (event) => {\r\n      const addingId = event.model.get('_id');\r\n      if (!ids[addingId]) return;\r\n      event.force();\r\n      if (addingId !== id) return;\r\n      Adapt.off('view:addChild', forceUntilId);\r\n    };\r\n    Adapt.on('view:addChild', forceUntilId);\r\n    // Trigger addChildren cascade\r\n    await this.addChildren();\r\n    await this.whenReady();\r\n    // Error if model isn't rendered and ready\r\n    if (!model.get('_isRendered') || !model.get('_isReady')) {\r\n      throw new Error(`Cannot renderTo \"${id}\".`);\r\n    }\r\n  }\r\n\r\n  preRemove() {\r\n    const type = this.constructor.type;\r\n    Adapt.trigger(`${type}View:preRemove contentObjectView:preRemove view:preRemove`, this);\r\n  }\r\n\r\n  remove() {\r\n    const type = this.constructor.type;\r\n    this.preRemove();\r\n    Adapt.trigger(`${type}View:remove contentObjectView:remove view:remove`, this);\r\n    this._isRemoved = true;\r\n\r\n    Adapt.wait.for(end => {\r\n      if (this.isReact) {\r\n        ReactDOM.unmountComponentAtNode(this.el);\r\n      }\r\n      this.$el.off('onscreen.adaptView');\r\n      this.findDescendantViews().reverse().forEach(view => {\r\n        view.remove();\r\n      });\r\n      this.setChildViews(null);\r\n      super.remove();\r\n      _.defer(() => {\r\n        Adapt.trigger(`${type}View:postRemove contentObjectView:postRemove view:postRemove`, this);\r\n        this.trigger('postRemove');\r\n      });\r\n      end();\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    if (Adapt.parentView === this) {\r\n      Adapt.parentView = null;\r\n    }\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport ContentObjectView from 'core/js/views/contentObjectView';\r\n\r\nclass PageView extends ContentObjectView {\r\n\r\n  remove() {\r\n    if (this.$pageLabel) {\r\n      this.$pageLabel.remove();\r\n    }\r\n    super.remove();\r\n  }\r\n\r\n}\r\n\r\nObject.assign(PageView, {\r\n  childContainer: '.article__container',\r\n  type: 'page',\r\n  template: 'page'\r\n});\r\n\r\nAdapt.register('page', { view: PageView });\r\n\r\nexport default PageView;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptView from 'core/js/views/adaptView';\r\n\r\nclass ArticleView extends AdaptView {\r\n\r\n  className() {\r\n    return [\r\n      'article',\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      this.setHidden(),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : '')\r\n    ].join(' ');\r\n  }\r\n\r\n}\r\n\r\nObject.assign(ArticleView, {\r\n  childContainer: '.block__container',\r\n  type: 'article',\r\n  template: 'article'\r\n});\r\n\r\nAdapt.register('article', { view: ArticleView });\r\n\r\nexport default ArticleView;\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptView from 'core/js/views/adaptView';\r\n\r\nclass BlockView extends AdaptView {\r\n\r\n  className() {\r\n    return [\r\n      'block',\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      this.setHidden(),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : '')\r\n    ].join(' ');\r\n  }\r\n\r\n}\r\n\r\nObject.assign(BlockView, {\r\n  childContainer: '.component__container',\r\n  type: 'block',\r\n  template: 'block'\r\n});\r\n\r\nAdapt.register('block', { view: BlockView });\r\n\r\nexport default BlockView;\r\n","import Adapt from 'core/js/adapt';\r\nimport Data from 'core/js/data';\r\nimport AdaptSubsetCollection from 'core/js/collections/adaptSubsetCollection';\r\nimport ContentObjectModel from 'core/js/models/contentObjectModel';\r\nimport ArticleModel from 'core/js/models/articleModel';\r\nimport BlockModel from 'core/js/models/blockModel';\r\nimport ComponentModel from 'core/js/models/componentModel';\r\n\r\nimport 'core/js/models/courseModel';\r\nimport 'core/js/models/menuModel';\r\nimport 'core/js/models/pageModel';\r\nimport 'core/js/views/pageView';\r\nimport 'core/js/views/articleView';\r\nimport 'core/js/views/blockView';\r\n\r\nclass MPABC extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    // Example of how to cause the data loader to wait for another module to setup\r\n    this.listenTo(Data, {\r\n      loading: this.waitForDataLoaded,\r\n      loaded: this.onDataLoaded\r\n    });\r\n    this.setupSubsetCollections();\r\n  }\r\n\r\n  waitForDataLoaded() {\r\n    // Tell the data loader to wait\r\n    Adapt.wait.begin();\r\n  }\r\n\r\n  onDataLoaded() {\r\n    // Tell the data loader that we have finished\r\n    Adapt.wait.end();\r\n  }\r\n\r\n  setupSubsetCollections() {\r\n    Adapt.contentObjects = new AdaptSubsetCollection(null, { parent: Data, model: ContentObjectModel });\r\n    Adapt.articles = new AdaptSubsetCollection(null, { parent: Data, model: ArticleModel });\r\n    Adapt.blocks = new AdaptSubsetCollection(null, { parent: Data, model: BlockModel });\r\n    Adapt.components = new AdaptSubsetCollection(null, { parent: Data, model: ComponentModel });\r\n  }\r\n\r\n}\r\n\r\nexport default (Adapt.mpabc = new MPABC());\r\n","import Adapt from 'core/js/adapt';\r\n\r\nconst defaultAriaLevels = {\r\n  '_menu': 1,\r\n  '_menuGroup': 2,\r\n  '_menuItem': 2,\r\n  '_page': 1,\r\n  '_article': 2,\r\n  '_block': 3,\r\n  '_component': 4,\r\n  '_componentItem': 5,\r\n  '_notify': 1\r\n};\r\n\r\nconst helpers = {\r\n\r\n  lowercase(text) {\r\n    return text.toLowerCase();\r\n  },\r\n\r\n  capitalise(text) {\r\n    return text.charAt(0).toUpperCase() + text.slice(1);\r\n  },\r\n\r\n  inc(index) {\r\n    return index + 1;\r\n  },\r\n\r\n  dec(index) {\r\n    return index - 1;\r\n  },\r\n\r\n  odd (index) {\r\n    return (index + 1) % 2 === 0 ? 'even' : 'odd';\r\n  },\r\n\r\n  equals(value, text, block) {\r\n    return helpers.compare.call(this, value, '==', text, block);\r\n  },\r\n\r\n  compare(value, operator, text, block) {\r\n    // Comparison operators\r\n    switch (operator) {\r\n      case '===':\r\n        if (value === text) return block.fn(this);\r\n        break;\r\n      case '=': case '==':\r\n        // eslint-disable-next-line eqeqeq\r\n        if (value == text) return block.fn(this);\r\n        break;\r\n      case '>=':\r\n        if (value >= text) return block.fn(this);\r\n        break;\r\n      case '<=':\r\n        if (value <= text) return block.fn(this);\r\n        break;\r\n      case '>':\r\n        if (value > text) return block.fn(this);\r\n        break;\r\n      case '<':\r\n        if (value < text) return block.fn(this);\r\n        break;\r\n    }\r\n    return block.inverse(this);\r\n  },\r\n\r\n  math(lvalue, operator, rvalue, options) {\r\n    // Mathematical operators\r\n    lvalue = parseFloat(lvalue);\r\n    rvalue = parseFloat(rvalue);\r\n    switch (operator) {\r\n      case '+': return lvalue + rvalue;\r\n      case '-': return lvalue - rvalue;\r\n      case '*': return lvalue * rvalue;\r\n      case '/': return lvalue / rvalue;\r\n      case '%': return lvalue % rvalue;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Equivalent to:\r\n   *  if (conditionA || conditionB)\r\n   * @example\r\n   * {{#any displayTitle body instruction}}\r\n   * <div class='component__header {{_component}}__header'></div>\r\n   * {{/any}}\r\n   */\r\n  any(...args) {\r\n    const specified = args.slice(0, -1);\r\n    const block = args.slice(-1)[0];\r\n    return specified.some(Boolean) ? (block.fn ? block.fn(this) : true) : (block.inverse ? block.inverse(this) : false);\r\n  },\r\n\r\n  /**\r\n   * Equivalent to:\r\n   *  if (conditionA && conditionB)\r\n   * @example\r\n   * {{#all displayTitle body instruction}}\r\n   * <div class='component__header {{_component}}__header'></div>\r\n   * {{/all}}\r\n   */\r\n  all(...args) {\r\n    const specified = args.slice(0, -1);\r\n    const block = args.slice(-1)[0];\r\n    return specified.every(Boolean) ? (block.fn ? block.fn(this) : true) : (block.inverse ? block.inverse(this) : false);\r\n  },\r\n\r\n  /**\r\n   * Equivalent to:\r\n   *  if (!conditionA && !conditionB)\r\n   * @example\r\n   * {{#none displayTitle body instruction}}\r\n   * <div class='component__header {{_component}}__header'></div>\r\n   * {{/none}}\r\n   */\r\n  none(...args) {\r\n    const specified = args.slice(0, -1);\r\n    const block = args.slice(-1)[0];\r\n    return !specified.some(Boolean) ? (block.fn ? block.fn(this) : true) : (block.inverse ? block.inverse(this) : false);\r\n  },\r\n\r\n  /**\r\n   * Allow JSON to be a template i.e. you can use handlebars {{expressions}} within your JSON\r\n   */\r\n  compile(template, context) {\r\n    if (!template) {\r\n      return '';\r\n    }\r\n    if (template instanceof Object) template = template.toString();\r\n    let data = this;\r\n    if (context) {\r\n      // choose between a passed argument context or the default handlebars helper context\r\n      data = (context.data?.root ?? context);\r\n    }\r\n    return Handlebars.compile(template)(data);\r\n  },\r\n\r\n  /**\r\n   * Allow JSON to be a template and accessible text\r\n   */\r\n  compile_a11y_text(template, context) {\r\n    Adapt.a11y.log.deprecated('a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/');\r\n    return helpers.compile.call(this, template, context);\r\n  },\r\n\r\n  /**\r\n   * Allow JSON to be a template and normalized text\r\n   */\r\n  compile_a11y_normalize(template, context) {\r\n    if (!template) {\r\n      return '';\r\n    }\r\n    if (template instanceof Object) template = template.toString();\r\n    return Handlebars.helpers.a11y_normalize.call(this, helpers.compile.call(this, template, context));\r\n  },\r\n\r\n  /**\r\n   * Remove all html tags except styling tags\r\n   */\r\n  compile_a11y_remove_breaks(template, context) {\r\n    if (!template) {\r\n      return '';\r\n    }\r\n    return Handlebars.helpers.a11y_remove_breaks.call(this, helpers.compile.call(this, template, context));\r\n  },\r\n\r\n  /**\r\n   * makes the _globals object in course.json available to a template\r\n   */\r\n  import_globals(context) {\r\n    if (context.data.root._globals) {\r\n      return '';\r\n    }\r\n    context.data.root._globals = Adapt.course.get('_globals');\r\n    return '';\r\n  },\r\n\r\n  /**\r\n   * makes the Adapt module data available to a template\r\n   */\r\n  import_adapt(context) {\r\n\r\n    if (context.data.root.Adapt) {\r\n      return;\r\n    }\r\n    const adapt = context.data.root.Adapt = {};\r\n\r\n    let i, l, name;\r\n\r\n    const directImport = ['config', 'course'];\r\n    for (i = 0, l = directImport.length; i < l; i++) {\r\n      name = directImport[i];\r\n      // convert the model to a json object and add to the current context\r\n      adapt[name] = Adapt[name].toJSON();\r\n    }\r\n\r\n    const indexedImport = ['contentObjects', 'articles', 'blocks', 'components'];\r\n    for (i = 0, l = indexedImport.length; i < l; i++) {\r\n      name = indexedImport[i];\r\n      // convert the collection of models to an array of json objects\r\n      const importArray = Adapt[name].toJSON();\r\n      // convert the array of json models to an object indexed by id\r\n      const importIndex = {};\r\n      for (let i1 = 0, l1 = importArray.length; i1 < l1; i1++) {\r\n        const item = importArray[i1];\r\n        importIndex[item._id] = item;\r\n      }\r\n      // add the indexed object to the current context\r\n      adapt[name] = importIndex;\r\n    }\r\n\r\n    return '';\r\n\r\n  },\r\n\r\n  /**\r\n   * Allow components to fetch their component description.\r\n   *\r\n   * Creates an aria label using the `a11y_aria_label` helper containing\r\n   * the component description specified in the\r\n   * `_globals._component[componentName].ariaRegion`. This value is defined\r\n   * in the `properties.schema:globals.ariaRegion`.\r\n   *\r\n   * @param {string} [override]\r\n   * @returns {string}\r\n   */\r\n  component_description(override, context) {\r\n    if (!this._isA11yComponentDescriptionEnabled) {\r\n      return;\r\n    }\r\n    const isNotDefined = !this._globals._components?.['_' + this._component];\r\n    if (isNotDefined) {\r\n      return;\r\n    }\r\n    const hasOverride = (arguments.length > 1);\r\n    let description;\r\n    if (hasOverride) {\r\n      description = override;\r\n      description = helpers.compile(description, context);\r\n    } else {\r\n      description = this._globals._components['_' + this._component].ariaRegion;\r\n      description = helpers.compile(description, override);\r\n    }\r\n    if (!description) {\r\n      return;\r\n    }\r\n    return new Handlebars.SafeString('<div class=\"aria-label\">' + description + '</div>');\r\n  },\r\n\r\n  a11y_text(text) {\r\n    Adapt.a11y.log.deprecated('a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/');\r\n    return text;\r\n  },\r\n\r\n  /**\r\n   * Handlebars helper for `Adapt.a11y.normalize(htmls)`.\r\n   *\r\n   * @param {string} htmls Any htmls.\r\n   * @returns {string}\r\n   */\r\n  a11y_normalize(htmls) {\r\n    return Adapt.a11y.normalize.apply(Adapt.a11y, arguments);\r\n  },\r\n\r\n  /**\r\n   * Handlebars helper for `Adapt.a11y.removeBreaks(htmls)`.\r\n   *\r\n   * @param {string} htmls Any htmls.\r\n   * @returns {string}\r\n   */\r\n  a11y_remove_breaks(htmls) {\r\n    return Adapt.a11y.removeBreaks.apply(Adapt.a11y, arguments);\r\n  },\r\n\r\n  /**\r\n   * Creates a div styled with tiny, transparent text.\r\n   * It it absolutely positioned.\r\n   * The text is not visibly readable but is read by screen readers.\r\n   *\r\n   * @param {string} htmls\r\n   * @returns {string}\r\n   */\r\n  a11y_aria_label(htmls) {\r\n    let values = Array.prototype.slice.call(arguments, 0, -1);\r\n    values = values.filter(Boolean);\r\n    return new Handlebars.SafeString('<div class=\"aria-label\">' + values.join(' ') + '</div>');\r\n  },\r\n\r\n  /**\r\n   * Creates a div styled with tiny, transparent text.\r\n   * It it relatively positioned.\r\n   * The text is not visibly readable but is read by screen readers.\r\n   *\r\n   * @param {string} htmls Aria label texts.\r\n   * @returns {string}\r\n   */\r\n  a11y_aria_label_relative(htmls) {\r\n    let values = Array.prototype.slice.call(arguments, 0, -1);\r\n    values = values.filter(Boolean);\r\n    return new Handlebars.SafeString('<div class=\"aria-label relative\">' + values.join(' ') + '</div>');\r\n  },\r\n\r\n  /**\r\n   * Creates a div styled with tiny, transparent text and `role\"=img\"`.\r\n   * It is used for representing an image to a screen reader user in an\r\n   * order which cannot be represented in the DOM in a way that achieves the\r\n   * styling objectives.\r\n   * It it absolutely positioned.\r\n   * The text is not visibly readable but is read by screen readers.\r\n   *\r\n   * @param {string} texts Aria label texts.\r\n   * @returns {string}\r\n   */\r\n  a11y_aria_image(texts) {\r\n    let values = Array.prototype.slice.call(arguments, 0, -1);\r\n    values = values.filter(Boolean);\r\n    return new Handlebars.SafeString('<div class=\"aria-label\" role=\"img\" aria-label=\"' + values.join(' ') + '\"></div>');\r\n  },\r\n\r\n  /**\r\n   * Returns an `a` tag which when receiving focus causes the focus to wrap\r\n   * to the top of the readable document.\r\n   *\r\n   * @returns {string}\r\n   */\r\n  a11y_wrap_focus() {\r\n    const cfg = Adapt.config.get('_accessibility');\r\n    if (cfg._isPopupWrapFocusEnabled === false) return '';\r\n    return new Handlebars.SafeString('<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" role=\"presentation\">&nbsp;</a>');\r\n  },\r\n\r\n  /**\r\n   * Creates the attributes for a subject heading text. `role=\"heading\"` and\r\n   * `aria-level=\"#\"`. It will use the `_ariaLevel` attribute from the current\r\n   * context if specified, a number if given as the `levelOrType` parameter,\r\n   * or a name from the configured aria levels hash.\r\n   *\r\n   * @param {number|string} levelOrType\r\n   * @returns {string}\r\n   */\r\n  a11y_attrs_heading(levelOrType) {\r\n    // get the global configuration from config.json\r\n    const cfg = Adapt.config.get('_accessibility');\r\n    // default level to use if nothing overrides it\r\n    let level = 1;\r\n\r\n    // first check to see if the Handlebars context has an override\r\n    if (this._ariaLevel) {\r\n      levelOrType = this._ariaLevel;\r\n    }\r\n\r\n    if (isNaN(levelOrType) === false) {\r\n      // if a number is passed just use this\r\n      level = levelOrType;\r\n    } else if (_.isString(levelOrType)) {\r\n      // if a string is passed check if it is defined in global configuration\r\n      cfg._ariaLevels = cfg._ariaLevels || defaultAriaLevels;\r\n      if (cfg._ariaLevels?.['_' + levelOrType] !== undefined) {\r\n        level = cfg._ariaLevels['_' + levelOrType];\r\n      }\r\n    }\r\n\r\n    return new Handlebars.SafeString(' role=\"heading\" aria-level=\"' + level + '\" ');\r\n  },\r\n\r\n  a11y_attrs_tabbable() {\r\n    Adapt.a11y.log.deprecated('a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.');\r\n    return new Handlebars.SafeString(' role=\"region\" tabindex=\"0\" ');\r\n  },\r\n\r\n  /**\r\n   * Produce display text with alternative screen reader version.\r\n   * @param {string} visible Text that will be displayed on screen\r\n   * @param {string} alternatives Text that will be read by the screen reader (instead of what's displayed on screen)\r\n   * @example {{a11y_alt_text '$5bn' 'five billion dollars'}} or {{a11y_alt_text 'Here are some bits to read' 'There are' _items.length 'items to read'}}\r\n   */\r\n  a11y_alt_text(visible, alternatives) {\r\n    let values = Array.prototype.slice.call(arguments, 1, -1);\r\n    values = values.filter(Boolean);\r\n    return new Handlebars.SafeString('<span aria-hidden=\"true\">' + visible + '</span><span class=\"aria-label\">' + values.join(' ') + '</span>');\r\n  }\r\n\r\n};\r\n\r\n// Compatibility references\r\nObject.assign(helpers, {\r\n\r\n  if_value_equals() {\r\n    Adapt.a11y.log.deprecated('if_value_equals, use equals instead.');\r\n    return helpers.equals.apply(this, arguments);\r\n  },\r\n\r\n  numbers() {\r\n    Adapt.a11y.log.deprecated('numbers, use inc instead.');\r\n    return helpers.inc.apply(this, arguments);\r\n  },\r\n\r\n  lowerCase() {\r\n    Adapt.a11y.log.deprecated('lowerCase, use lowercase instead.');\r\n    return helpers.lowercase.apply(this, arguments);\r\n  }\r\n\r\n});\r\n\r\nfor (let name in helpers) {\r\n  if (!helpers.hasOwnProperty(name)) continue;\r\n  Handlebars.registerHelper(name, helpers[name]);\r\n}\r\n\r\nexport default helpers;\r\n","import Adapt from 'core/js/adapt';\r\n\r\nclass Scrolling extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this.$html = null;\r\n    this.$app = null;\r\n    this.isLegacyScrolling = true;\r\n    this._checkApp();\r\n    Adapt.once('configModel:dataLoaded', this._loadConfig.bind(this));\r\n  }\r\n\r\n  _checkApp() {\r\n    this.$html = $('html');\r\n    this.$app = $('#app');\r\n    if (this.$app.length) return;\r\n    this.$app = $('<div id=\"app\">');\r\n    $('body').append(this.$app);\r\n    this.$app.append($('#wrapper'));\r\n    Adapt.log.warn('UPDATE - Your html file needs to have #app adding. See https://github.com/adaptlearning/adapt_framework/issues/2168');\r\n  }\r\n\r\n  _loadConfig() {\r\n    const config = Adapt.config.get('_scrollingContainer');\r\n    if (!config?._isEnabled) return;\r\n    const limitTo = config._limitToSelector;\r\n    const isIncluded = !limitTo || (this.$html.is(limitTo) || this.$html.hasClass(limitTo));\r\n    if (!isIncluded) return;\r\n    this.isLegacyScrolling = false;\r\n    this._addStyling();\r\n    this._fixJQuery();\r\n    this._fixScrollTo();\r\n    this._fixBrowser();\r\n  }\r\n\r\n  _addStyling() {\r\n    this.$html.addClass('adapt-scrolling');\r\n  }\r\n\r\n  _fixJQuery() {\r\n    const selectorScrollTop = $.fn.scrollTop;\r\n    const $app = Adapt.scrolling.$app;\r\n    $.fn.scrollTop = function() {\r\n      if (this[0] === window || this[0] === document.body) {\r\n        return selectorScrollTop.apply($app, arguments);\r\n      }\r\n      return selectorScrollTop.apply(this, arguments);\r\n    };\r\n    const selectorOffset = $.fn.offset;\r\n    $.fn.offset = function(coordinates) {\r\n      if (coordinates) {\r\n        return selectorOffset.apply(this, arguments);\r\n      }\r\n      const $app = Adapt.scrolling.$app;\r\n      const $element = this;\r\n      const elementOffset = selectorOffset.call($element);\r\n      const isCorrectedContainer = $element.is('html, body, #app') ||\r\n        $element.parents().is('#app');\r\n      if (!isCorrectedContainer) {\r\n        // Do not adjust the offset measurement as not in $app container and isn't html or body\r\n        return elementOffset;\r\n      }\r\n      // Adjust measurement by scrolling and offset of $app container\r\n      const scrollTop = parseInt($app.scrollTop());\r\n      const scrollLeft = parseInt($app.scrollLeft());\r\n      const appOffset = selectorOffset.call($app);\r\n      elementOffset.top += (scrollTop - appOffset.top);\r\n      elementOffset.left += (scrollLeft - appOffset.left);\r\n      return elementOffset;\r\n    };\r\n  }\r\n\r\n  _fixScrollTo() {\r\n    const selectorScrollTo = $.fn.scrollTo;\r\n    const scrollTo = $.scrollTo;\r\n    const $app = Adapt.scrolling.$app;\r\n    $.fn.scrollTo = function(target, duration, settings) {\r\n      if (this[0] === window || this[0] === document.body) {\r\n        return selectorScrollTo.apply($app, arguments);\r\n      }\r\n      return selectorScrollTo.apply(this, arguments);\r\n    };\r\n    $.scrollTo = function(target, duration, settings) {\r\n      return selectorScrollTo.apply($app, arguments);\r\n    };\r\n    Object.assign($.scrollTo, scrollTo);\r\n  }\r\n\r\n  _fixBrowser() {\r\n    const app = Adapt.scrolling.$app[0];\r\n    window.scrollTo = function(x, y) {\r\n      app.scrollTop = y || 0;\r\n      app.scrollLeft = x || 0;\r\n    };\r\n    const $window = $(window);\r\n    this.$app.on('scroll', () => {\r\n      $window.scroll();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Allows a selector to be passed in and Adapt will scroll to this element. Resolves\r\n   * asynchronously when the element has been navigated/scrolled to.\r\n   * Backend for Adapt.scrollTo\r\n   * @param {string} selector CSS selector of the Adapt element you want to navigate to e.g. `\".co-05\"`\r\n   * @param {Object} [settings={}] The settings for the `$.scrollTo` function (See https://github.com/flesler/jquery.scrollTo#settings).\r\n   * @param {Object} [settings.replace=false] Set to `true` if you want to update the URL without creating an entry in the browser's history.\r\n   */\r\n  async scrollTo(selector, settings = {}) {\r\n    Adapt.log.deprecated('Adapt.scrollTo and Adapt.scrolling.scrollTo, use Adapt.navigateToElement instead.');\r\n    return Adapt.router.navigateToElement(selector, settings);\r\n  }\r\n\r\n}\r\n\r\nAdapt.scrolling = new Scrolling();\r\n\r\nAdapt.scrollTo = Adapt.scrolling.scrollTo.bind(Adapt.scrolling);\r\n\r\nexport default Adapt.scrolling;\r\n","import Adapt from 'core/js/adapt';\r\n\r\nclass HeadingView extends Backbone.View {\r\n\r\n  initialize() {\r\n    this.listenTo(Adapt.parentView, 'postRemove', this.remove);\r\n    this.listenTo(this.model, 'change:_isComplete', this.updateAria);\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    const template = Handlebars.templates[this.constructor.template];\r\n    const data = this.model.toJSON();\r\n    const customHeadingType = this.$el.attr('data-a11y-heading-type');\r\n    if (customHeadingType) data._type = customHeadingType;\r\n    this.$el.html(template(data));\r\n    this.checkCompletion();\r\n  }\r\n\r\n  updateAria() {\r\n    const template = Handlebars.templates[this.constructor.template];\r\n    const data = this.model.toJSON();\r\n    const $rendered = $(`<div>${template(data)}</div>`);\r\n    this.$('.aria-label').html($rendered.find('.aria-label').html());\r\n    this.checkCompletion();\r\n  }\r\n\r\n  checkCompletion() {\r\n    const isComplete = this.model.get('_isComplete');\r\n    this.$el\r\n      .toggleClass('is-complete', isComplete)\r\n      .toggleClass('is-incomplete', !isComplete);\r\n  }\r\n\r\n}\r\n\r\nHeadingView.template = 'heading';\r\n\r\nexport default HeadingView;\r\n","import Adapt from './adapt';\r\nimport HeadingView from './views/headingView';\r\n\r\nclass Headings extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this.listenTo(Adapt, 'view:render', this.onViewRender);\r\n  }\r\n\r\n  onViewRender(view) {\r\n    const $headingSeats = view.$('.js-heading');\r\n    $headingSeats.each((index, el) => new HeadingView({ el, model: view.model }));\r\n  }\r\n\r\n}\r\n\r\nexport default new Headings();\r\n","import Adapt from 'core/js/adapt';\r\n\r\nclass NavigationView extends Backbone.View {\r\n\r\n  className() {\r\n    return 'nav';\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click [data-event]': 'triggerEvent'\r\n    };\r\n  }\r\n\r\n  attributes() {\r\n    return {\r\n      'role': 'navigation'\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.listenToOnce(Adapt, {\r\n      'courseModel:dataLoading': this.remove\r\n    });\r\n    this.listenTo(Adapt, 'router:menu router:page', this.hideNavigationButton);\r\n    this.preRender();\r\n  }\r\n\r\n  preRender() {\r\n    Adapt.trigger('navigationView:preRender', this);\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    const template = Handlebars.templates[this.constructor.template];\r\n    this.$el.html(template({\r\n      _globals: Adapt.course.get('_globals'),\r\n      _accessibility: Adapt.config.get('_accessibility')\r\n    })).insertBefore('#app');\r\n\r\n    _.defer(() => {\r\n      Adapt.trigger('navigationView:postRender', this);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  triggerEvent(event) {\r\n    event.preventDefault();\r\n    const currentEvent = $(event.currentTarget).attr('data-event');\r\n    Adapt.trigger('navigation:' + currentEvent);\r\n    switch (currentEvent) {\r\n      case 'backButton':\r\n        Adapt.router.navigateToPreviousRoute();\r\n        break;\r\n      case 'homeButton':\r\n        Adapt.router.navigateToHomeRoute();\r\n        break;\r\n      case 'parentButton':\r\n        Adapt.router.navigateToParent();\r\n        break;\r\n      case 'skipNavigation':\r\n        this.skipNavigation();\r\n        break;\r\n      case 'returnToStart':\r\n        Adapt.startController.returnToStartLocation();\r\n        break;\r\n    }\r\n  }\r\n\r\n  skipNavigation() {\r\n    Adapt.a11y.focusFirst('.' + Adapt.location._contentType);\r\n  }\r\n\r\n  hideNavigationButton(model) {\r\n    const shouldHide = (model.get('_type') === 'course');\r\n    this.$('.nav__back-btn, .nav__home-btn').toggleClass('u-display-none', shouldHide);\r\n  }\r\n\r\n  showNavigationButton() {\r\n    this.$('.nav__back-btn, .nav__home-btn').removeClass('u-display-none');\r\n  }\r\n\r\n}\r\n\r\nNavigationView.template = 'nav';\r\n\r\nexport default NavigationView;\r\n","import Adapt from 'core/js/adapt';\r\nimport NavigationView from 'core/js/views/navigationView';\r\n\r\nclass NavigationController extends Backbone.Controller {\r\n\r\n  initialize() {\r\n    this.listenTo(Adapt, 'adapt:preInitialize', this.addNavigationBar);\r\n  }\r\n\r\n  addNavigationBar() {\r\n    const adaptConfig = Adapt.course.get('_navigation');\r\n\r\n    if (adaptConfig?._isDefaultNavigationDisabled) {\r\n      Adapt.trigger('navigation:initialize');\r\n      return;\r\n    }\r\n\r\n    Adapt.navigation = new NavigationView();// This should be triggered after 'app:dataReady' as plugins might want to manipulate the navigation\r\n  }\r\n\r\n}\r\n\r\nexport default new NavigationController();\r\n","import Adapt from 'core/js/adapt';\r\nimport AdaptView from 'core/js/views/adaptView';\r\n\r\nclass ComponentView extends AdaptView {\r\n\r\n  attributes() {\r\n    if (!this.model.get('_isA11yRegionEnabled')) {\r\n      return AdaptView.resultExtend('attributes', {}, this);\r\n    }\r\n    return AdaptView.resultExtend('attributes', {\r\n      'aria-labelledby': this.model.get('_id') + '-heading',\r\n      'role': 'region'\r\n    }, this);\r\n  }\r\n\r\n  className() {\r\n    return [\r\n      'component',\r\n      this.model.get('_component').toLowerCase(),\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      this.setHidden(),\r\n      'is-' + this.model.get('_layout'),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : '')\r\n    ].join(' ');\r\n  }\r\n\r\n  renderState() {\r\n    Adapt.log.removed('renderState is removed and moved to item title');\r\n  }\r\n\r\n  /**\r\n   * Allows components that want to use inview for completion to set that up\r\n   * @param {string} [inviewElementSelector] Allows to you to specify (via a selector) which DOM element to use for inview.\r\n   * Defaults to `'.component__inner'` if not supplied.\r\n   * @param {function} [callback] Allows you to specify what function is called when the component has been viewed, should\r\n   * you want to perform additional checks before setting the component to completed - see adapt-contrib-assessmentResults\r\n   * for an example. Defaults to `view.setCompletionStatus` if not specified.\r\n   */\r\n  setupInviewCompletion(inviewElementSelector = '.component__inner', callback = this.setCompletionStatus) {\r\n    this.$inviewElement = this.$(inviewElementSelector);\r\n    this.inviewCallback = callback;\r\n\r\n    this.$inviewElement.on('inview.componentView', this.onInview.bind(this));\r\n  }\r\n\r\n  removeInviewListener() {\r\n    if (!this.$inviewElement) return;\r\n    this.$inviewElement.off('inview.componentView');\r\n    this.$inviewElement = null;\r\n  }\r\n\r\n  onInview(event, visible, visiblePartX, visiblePartY) {\r\n    if (!visible) return;\r\n\r\n    switch (visiblePartY) {\r\n      case 'top':\r\n        this.hasSeenTop = true;\r\n        break;\r\n      case 'bottom':\r\n        this.hasSeenBottom = true;\r\n        break;\r\n      case 'both':\r\n        this.hasSeenTop = this.hasSeenBottom = true;\r\n    }\r\n\r\n    if (!this.hasSeenTop || !this.hasSeenBottom) return;\r\n\r\n    this.inviewCallback();\r\n\r\n    if (this.model.get('_isComplete')) {\r\n      this.removeInviewListener();\r\n    }\r\n  }\r\n\r\n  postRender() {}\r\n\r\n  remove() {\r\n    this.removeInviewListener();\r\n    super.remove();\r\n  }\r\n\r\n}\r\n\r\nComponentView.type = 'component';\r\n\r\nexport default ComponentView;\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  class ActivatorView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        'click .js-activator-click': 'onBtnClicked'\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.model, 'change:_isActivatorActive', this.onActivatorActiveChange);\r\n\r\n      // Start off activated if in PDF mode (once ready).\r\n      if (Adapt.isPDFMode()) {\r\n        this.listenToOnce(this.model, 'change:_isReady', () => {\r\n          this.model.set(\"_isActivatorActive\", true);\r\n          Adapt.log.info(\"Activator: PDF mode detected; activating automatically.\");\r\n        });\r\n      }\r\n\r\n      /*this.listenTo(this.model.get('_children'), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange,\r\n        'change:_isVisible': this.onItemsVisibleChange\r\n      });*/\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    onBtnClicked(event) {\r\n\r\n      this.model.set(\"_isActivatorActive\", !this.model.get(\"_isActivatorActive\")); // This will trigger a change event inside of activatorModel.\r\n      this.setCompletionStatus(); // Mark the component as complete once it's been interacted with.\r\n\r\n      // Single activation implementation.\r\n      if (this.model.get(\"_toggleEnabled\") === false) {\r\n        // FIXME: Not sure if I should be removing the click event entirely (would make resetting the view difficult).\r\n        Adapt.log.warn(\"activatorView._toggleEnabled === false functionality needs re-implementation.\");\r\n        this.$el.off(\"click\", event.currentTarget);\r\n        $(event.currentTarget).attr(\"disabled\", true);\r\n      }\r\n    }\r\n\r\n    onActivatorActiveChange(model, isActive) {\r\n      this.$(\".js-activator-click\")\r\n        .toggleClass(\"is-active\", isActive)\r\n        .toggleClass(\"is-disabled\", isActive);\r\n        //.prop(\"disabled\", isActive);\r\n\r\n\r\n      if (!isActive) return;\r\n\r\n      // Automatically attempt to scroll all the activated targets into view.\r\n      // Slight delay added to give the targets a chance to modify their dimensions from the activation.\r\n      _.debounce(this.scrollToTargets.bind(this), 0)();\r\n    }\r\n\r\n    scrollToTargets() {\r\n      let $targets = $();\r\n      this.model.get(\"_targets\").each((target) => {\r\n        $targets = $targets.add(target.$getTargets());\r\n      });\r\n\r\n      // adapt-scrollfix required for this to work.\r\n      try {\r\n        Adapt.navigateToElement($targets, {\r\n          duration: 400,\r\n          align: \"inview\",\r\n          offset: {\r\n            top: -100,\r\n            left: 0\r\n          },\r\n          priority: -1 // Allow for the targets to override this navigation.\r\n        });\r\n      }\r\n      catch (err) {\r\n        Adapt.log.error(\"An unexpected error prevented adapt-activator from scrolling its targets into view (is \\\"adapt-scrollfix\\\" installed?).\", err);\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      \r\n    }\r\n\r\n    postRender() {\r\n\r\n      // Set ready status immediately (even if the other targets aren't ready at this point; the page won't render until all components are ready anyway).\r\n      this.setReadyStatus();\r\n\r\n      return;\r\n\r\n      // Ensure ALL targets are ready before setting own ready status.\r\n      if (this.model.get(\"_targetsReady\")) {\r\n        this.setReadyStatus();\r\n      }\r\n      else {\r\n          this.listenToOnce(this.model, \"change:_targetsReady\", () => {\r\n          this.setReadyStatus();\r\n        });\r\n      }\r\n    }\r\n\r\n  }\r\n  \r\n  ActivatorView.template = \"activator\";\r\n  return ActivatorView;\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  /**\r\n   * Base class for ActivatorCompontentTargetModel and ActivatorElementTargetModel.\r\n   */\r\n  class ActivatorTargetModel extends Backbone.Model {\r\n\r\n    defaults() {\r\n        return {\r\n          _activatorModel: null,        // Reference to the ActivatorModel that contains this ActivatorTargetModel's collection.\r\n          _activationType: \"default\",   // Can be set to \"custom\" to prevent the default activation behaviour.\r\n\r\n          _isReady: false,      // Needs to be manually set by the children once their target it ready.\r\n          _isActive: false,     // Toggled whenever the Activator button is clicked.\r\n          _duration: 800,       // When a single adapt-activator has many targets,\r\n                                // the activation of each sequential target will wait for the duration of the previous target to elapse.\r\n        }\r\n    }\r\n\r\n    initialize() {\r\n\r\n    }\r\n\r\n    setReadyStatus() {\r\n\r\n      // FALLBACK:\r\n      // Delay added in-case setReadyStatus() is called in initialize\r\n      // (which would cause the activatorModel parent to miss the \"change\" event for \"_isReady\").\r\n      _.delay(() => {\r\n        this.set(\"_isReady\", true);\r\n      }, 0);\r\n    }\r\n\r\n    toggle() {\r\n      \r\n      return new Promise((resolve) => {\r\n        \r\n        this.set(\"_isActive\", !this.get(\"_isActive\"));\r\n        this.onToggle(this.get(\"_isActive\"));\r\n\r\n        _.debounce(resolve, this.get(\"_duration\") || 0)();\r\n      });\r\n    }\r\n\r\n    onToggle(isActive) {\r\n      throw `activatorTargetModel.js: abstract function 'onToggle()' not implemented.`;\r\n    }\r\n\r\n    /**\r\n     * Needs to return the $el of the target(s) that this model will active.\r\n     */\r\n    $getTargets() {\r\n      throw `activatorTargetModel.js: abstract function '$getTargets()' not implemented.`;\r\n    }\r\n  }\r\n\r\n  return ActivatorTargetModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './activatorTargetModel'\r\n], function(Adapt, ActivatorTargetModel) {\r\n\r\n  /**\r\n   * Called \"target\" instead of \"item\", as the activator targets other components\r\n   * (which are not nested inside of it like items would be).\r\n   * \r\n   * Note:\r\n   * I may be setting this up in a weird way.\r\n   * Basically, to make a component model compatible as an activator target,\r\n   * it must define setupActivatorTarget and toggleActivatorTarget.\r\n   */\r\n  class ActivatorComponentTargetModel extends ActivatorTargetModel {\r\n\r\n    defaults() {\r\n        return _.extend(super.defaults(), {\r\n          _parent: undefined   // Reference to the target component that will be activated.\r\n                               // FIXME: Bad name used for this; but might break legacy content if renamed.\r\n        });\r\n    }\r\n\r\n    initialize() {\r\n\r\n      let component = this.get(\"_parent\");\r\n\r\n      this.listenTo(component, \"change:_isReady\", (m, isReady) => {\r\n        this.setReadyStatus();\r\n      });\r\n        \r\n      if (!component.setupActivatorTarget){\r\n          //Adapt.log.error(\"function setupActivatorTarget() has not been implemented for component type: \" + component.get(\"_component\"));\r\n      }\r\n      else {\r\n          component.setupActivatorTarget(this.get(\"_isActive\"));\r\n      }\r\n    }\r\n\r\n    onToggle(isActive) {\r\n      \r\n      let component = this.get(\"_parent\");\r\n      if (!component.toggleActivatorTarget){\r\n          //Adapt.log.error(\"function toggleActivatorTarget() has not been implemented for component type: \" + component.get(\"_component\"));\r\n      }\r\n      else {\r\n          component.toggleActivatorTarget(isActive);\r\n      }\r\n    }\r\n\r\n    $getTargets() {\r\n      return Adapt.findViewByModelId(this.get(\"_parent\").get(\"_id\")).$el;\r\n    }\r\n  }\r\n\r\n  return ActivatorComponentTargetModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './activatorTargetModel'\r\n], function(Adapt, ActivatorTargetModel) {\r\n\r\n  class ActivatorElementTargetModel extends ActivatorTargetModel {\r\n\r\n    defaults() {\r\n      return _.extend(super.defaults(), {\r\n        \"_name\": \"\"     // name attribute(s) of one or more elements in the parent block that this should target.\r\n      });\r\n    }\r\n\r\n    initialize() {\r\n      \r\n      // This targetModel needs to wait for its targetted element(s) to be rendered prior to declaring itself \"ready\".\r\n      // FIXME: At this time, the script assumes the element will be ready by the time the activator is clicked.\r\n      // (Which in all current content, is the case).\r\n      this.setReadyStatus();\r\n    }\r\n\r\n    onToggle(isActive) {\r\n      Adapt.annotation.toggleEl(this.$getTargets(), isActive);\r\n    }\r\n\r\n    // Find the element(s) in this block with the provided name.\r\n    $getTargets() {\r\n      let $targets = $();\r\n      let names = this.get(\"_name\").split(\",\").map(e => {return e.trim();});\r\n\r\n      let parent = this.get(\"_activatorModel\");\r\n      let blockView = Adapt.findViewByModelId(parent.getParent().get(\"_id\"));\r\n\r\n      _.each(names, (name) => {\r\n        $targets = $targets.add(blockView.$(`[name=\"${name}\"]`));\r\n      });\r\n\r\n      return $targets;\r\n    }\r\n  }\r\n\r\n  return ActivatorElementTargetModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel',\r\n  './ActivatorComponentTargetModel',\r\n  './ActivatorElementTargetModel'\r\n], function(Adapt, ComponentModel, ActivatorComponentTargetModel, ActivatorElementTargetModel) {\r\n\r\n  class ActivatorModel extends ComponentModel {\r\n\r\n    // Used to set model defaults\r\n    defaults() {\r\n\r\n      // Extend from the ComponentModel defaults\r\n      return ComponentModel.resultExtend('defaults', {\r\n        _isActivatorActive: false // IMPORTANT! This property used to be called \"_isActive\".\r\n                                  // DO NOT USE THIS KEY! It is used by Adapt's code functionality and can cause errors to be thrown.\r\n      });\r\n    }\r\n\r\n    initialize() {\r\n      \r\n      ComponentModel.prototype.initialize.call(this);\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(Adapt, \"app:dataReady\", this.onDataReady.bind(this));\r\n      this.listenTo(this, \"change:_isActivatorActive\", this.onActivatorActiveChange.bind(this));\r\n    }\r\n\r\n    onDataReady() {\r\n      this.initTargets();\r\n\r\n      // Wait for all targets to be ready before setting this component to be ready.\r\n      this.listenTo(this.get(\"_targets\"), \"change:_isReady\", this.onTargetReadyChange);\r\n    }\r\n\r\n    onTargetReadyChange(targetModel, isReady) {\r\n\r\n      // Wait for all targets to be ready.\r\n      let notReadyModel = this.get(\"_targets\").find(m => {return !m.get(\"_isReady\");});\r\n      if (notReadyModel) {\r\n        return;\r\n      }\r\n\r\n      this.set(\"_targetsReady\", true);\r\n    }\r\n\r\n    /**\r\n     * Send out an event to all components targetted by the activator.\r\n     * It is up to the INDIVIDUAL COMPONENT to implement how it will react.\r\n     * \r\n     * If the no activator reaction is defined for the target component, then a default slideDown animation will be used.\r\n     */\r\n    initTargets(){\r\n\r\n      var targets = this.get(\"_targets\");\r\n      var _targets = [];\r\n\r\n      // Go the _targets dictionary and find all componentModels that this activator will activate.\r\n      let index = 0;\r\n      _.each(targets, (target, key) => {\r\n\r\n          // Store a reference to the component's model.\r\n          let componentId = target._id;\r\n\r\n          // Depracated (in earlier builds, _targets was a dictionary instead of an array).\r\n          if (componentId === undefined && typeof key === \"string\") {\r\n            componentId = key;\r\n            Adapt.log.deprecated(\"Set \\\"_target\\\" as an array with property \\\"_id\\\" in its elements instead of a dictionary.\");\r\n          }\r\n\r\n          // Support targetting elements in the same block (by name).\r\n          if (!componentId && target._name) {\r\n\r\n            let activatorTarget = new ActivatorElementTargetModel({\r\n              _activatorModel: this,\r\n              _name: target._name,\r\n              _activationType: target._activationType ? target._activationType : \"default\",\r\n              _index: index\r\n            });\r\n            _targets.push(activatorTarget);\r\n            index++;\r\n\r\n            return;\r\n          }\r\n\r\n          let componentModel = Adapt.findById(componentId);\r\n          if (!componentModel) throw `activatorModel.js: could not find \"_target\" component with \"_id\": \"${componentId}\".`\r\n\r\n          // Tell that component that it has been marked as activateable.\r\n          //target.component.trigger(\"activator:ready\");\r\n\r\n          // Store an ActivatorComponentTargetModel in it to keep track of its state.\r\n          let activatorTarget = new ActivatorComponentTargetModel({\r\n              _activatorModel: this,\r\n              _parent: componentModel,\r\n              _activationType: target._activationType ? target._activationType : \"default\",\r\n              _index: index\r\n          });\r\n\r\n          componentModel.set(\"_activatorTarget\", activatorTarget);\r\n          _targets.push(activatorTarget);\r\n          index++;\r\n      });\r\n\r\n      // Set the targets to be a collection of ActivatorTarget models.\r\n      this.set(\"_targets\", new Backbone.Collection(_targets));\r\n    }\r\n\r\n    onActivatorActiveChange(model, isActive) {\r\n      this.toggleTargets(isActive);\r\n    }\r\n\r\n    async toggleTargets(isActive) {\r\n      \r\n      let targetModels = this.get(\"_targets\").models;\r\n      for (let i = 0; i < targetModels.length; i++) {\r\n\r\n        // Stagger activation of targets when isActive is false.\r\n        if (isActive) {\r\n          await targetModels[i].toggle();\r\n        }\r\n        else {\r\n          targetModels[i].toggle();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ActivatorModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'handlebars'\r\n], function(Adapt, Handlebars) {\r\n\r\n  // StickyElement transition helpers\r\n  // ---------------------------------------------------------\r\n  var helpers = {\r\n\r\n    /**\r\n     * Needs to be added as an ATTRIBUTE to a HTML element.\r\n     * For example:\r\n     * <div {{{se_active idx=\"0,2\"}}}>Activate me</div>\r\n     * \r\n     * Mark selected element when itemIdx == provided value(s).\r\n     */\r\n    ac_mark: function() {\r\n        return 'data-activator-transition=\"mark\"';\r\n    },\r\n\r\n    ac_show: function() {\r\n        return 'data-activator-transition=\"show\"';\r\n    }\r\n  }\r\n\r\n  for (var name in helpers) {\r\n      if (!helpers.hasOwnProperty(name)) continue;\r\n      Handlebars.registerHelper(name, helpers[name]);\r\n  }\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './activatorView',\r\n  './activatorModel',\r\n  './activatorHelpers'\r\n], function(Adapt, ActivatorView, ActivatorModel) {\r\n\r\n  /**\r\n   * Activator\r\n   * ---------\r\n   * \r\n   * - This component creates a button that triggers state changes on OTHER components that are compatible with it.\r\n   * - The state changes it causes are usually things such as:\r\n   *      - Revealing and playing a timeline (causing an animation to start playing).\r\n   *      - Causing an element to change its appearance.\r\n   *      - Causing text to update itself / solving a math equation.\r\n   *      - Misc. (this component is still in development; features may change over time).\r\n   */\r\n\r\n  // Extensions\r\n  // -----------------------------------------------------\r\n  // Add default activator behaviour to components which haven't implemented any.\r\n  // FIXME: Temp. location for implementation.\r\n  Adapt.on(\"componentView:preRender\", (componentView) => {\r\n\r\n    if (componentView.onActivatorToggle) return; // This component has already implemented the functionality.\r\n    let activatorTarget = componentView.model.get(\"_activatorTarget\");\r\n    if (!activatorTarget) return; // This component isn't being targetted by an activator.\r\n\r\n    // Add a class to identify + stylize the target.\r\n    componentView.$el\r\n      .addClass(\"is-activator-target\")\r\n      .attr(\"data-activator-activation\", activatorTarget.get(\"_activationType\"));\r\n\r\n    // FIXME: Is this the right way to set this?\r\n    // Have each target component toggle its is-activator-active class based on the state of its activator target.\r\n    componentView.listenTo(activatorTarget, \"change:_isActive\", (model, isActive) => {\r\n      componentView.$el.toggleClass(\"is-activator-active\", isActive);\r\n    });\r\n\r\n    // Add default activator functionality to any text being targetted.\r\n    if (componentView.model.get(\"_component\") == \"text\" && activatorTarget.get(\"_activationType\") == \"default\"){\r\n      setUpDefaultTargetComponent(componentView);\r\n    }\r\n  });\r\n\r\n  function setUpDefaultTargetComponent(componentView) {\r\n\r\n    let activatorTarget = componentView.model.get(\"_activatorTarget\");\r\n\r\n    // Compatibility with componentRow: remove the divider line.\r\n    componentView.model.get(\"_componentRow\").set(\"_hasDivider\", false);\r\n\r\n    // Start the componentView off hidden.\r\n    componentView.$el.hide(0);\r\n\r\n    // Since the componentView is hidden, it needs to manually calculate its bounding client rect.\r\n    componentView.getBoundingClientRect = () => {\r\n\r\n      componentView.$el.show(0).css(\"height\", \"\");\r\n      let bb = componentView.$el[0].getBoundingClientRect();\r\n\r\n      // Hide the component again (if applicable).\r\n      if (!activatorTarget.get(\"_isActive\")) {\r\n        componentView.$el.hide(0);\r\n      }\r\n\r\n      return bb;\r\n    }\r\n\r\n    // Have it slideUp/Down when toggled.\r\n    componentView.listenTo(activatorTarget, \"change:_isActive\", (model, isActive) => {\r\n      if (isActive) {\r\n        componentView.$el.slideDown();\r\n          \r\n        // Scroll it and the activator button into view if it's the first child.\r\n        /*if (activatorTarget.get(\"_index\") === 0) {\r\n\r\n          //let $activatorBtn = Adapt.findViewByModelId(activatorTarget.get(\"_activatorModel\").get(\"_id\")).$(\".activator__btn\");\r\n          //let $selector = $activatorBtn.add($(\".\" + componentView.model.get(\"_id\")));\r\n        }*/\r\n      }\r\n      else {\r\n        componentView.$el.slideUp();\r\n      }\r\n    });\r\n  }\r\n\r\n  return Adapt.register('activator', {\r\n    model: ActivatorModel,\r\n    view: ActivatorView\r\n  });\r\n\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class PlaybackControlsView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"playbackcontrols\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"input .playbackcontrols__range\" :       \"onRangeChange\",\r\n                \"click .playbackcontrols__next\" :        \"onClickNext\",\r\n                \"click .playbackcontrols__playpause\" :   \"onClickPlayPause\",\r\n                \"click .playbackcontrols__back\" :        \"onClickBack\",\r\n                \"change .playbackcontrols__range\" :      \"onRangeChange\" // Redundant?\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.render();\r\n            this.setUpEventListeners();\r\n\r\n            this.model.set(\"frameIdx\", 0); // Trigger the initial state change.\r\n        }\r\n\r\n        setUpEventListeners() {\r\n\r\n            this.listenTo(this.model, \"change:frameIdx\", this.onFrameIdxChange);\r\n            this.listenTo(this.model, \"change:isPlaying\", this.onIsPlayingChange);\r\n            this.listenTo(this.model, \"change:isComplete\", this.onIsCompleteChange);\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['playbackControls'];\r\n            this.$el.html(template(data));\r\n        }\r\n\r\n        onFrameIdxChange(model, frameIdx){\r\n\r\n            // Update the range slider's value.\r\n            this.$(\".playbackcontrols__range\").val(frameIdx);\r\n\r\n            // and the states of the buttons.\r\n            this.$(\".playbackcontrols__back\").attr(\"disabled\", function(){\r\n                return frameIdx == 0;\r\n            });\r\n\r\n            this.$(\".playbackcontrols__next\").attr(\"disabled\", function(){\r\n                return frameIdx == this.model.get(\"frameCount\")-1;\r\n            }.bind(this));\r\n        }\r\n\r\n        onClickBack(event){\r\n\r\n            this.model.pause();\r\n            \r\n            // Clamp (just in case).\r\n            if (this.model.get(\"frameIdx\")-1 < 0) return;\r\n\r\n            this.model.set(\"frameIdx\", this.model.get(\"frameIdx\") - 1);\r\n        }\r\n\r\n        onClickNext(event){\r\n\r\n            this.model.pause();\r\n\r\n            // Clamp (just in case).\r\n            var framesCount = this.model.get(\"framesCount\")-1;\r\n            if (this.model.get(\"frameIdx\")+1 > framesCount) return;\r\n\r\n            this.model.set(\"frameIdx\", this.model.get(\"frameIdx\") + 1);\r\n        }\r\n\r\n        onRangeChange(event){\r\n            this.model.pause();\r\n            this.model.set(\"frameIdx\", parseInt($(event.currentTarget).val()));\r\n        }\r\n\r\n        onClickPlayPause() {\r\n            this.togglePlayPause();\r\n        }\r\n\r\n        togglePlayPause(){\r\n            this.model.togglePlayPause();\r\n        }\r\n\r\n        onIsPlayingChange(model, isPlaying){\r\n\r\n            if (isPlaying){\r\n                this.$(\".playbackcontrols__playpause\")\r\n                .removeClass(\"playbackcontrols__play\")\r\n                .addClass(\"playbackcontrols__pause\");\r\n            }\r\n            else {\r\n                this.$(\".playbackcontrols__playpause\")\r\n                .removeClass(\"playbackcontrols__pause\")\r\n                .addClass(\"playbackcontrols__play\");\r\n            }\r\n        }\r\n\r\n        onIsCompleteChange(model, isComplete){\r\n\r\n            this.$(\".playbackcontrols__playpause\").toggleClass(\"playbackcontrols__replay\", isComplete);\r\n        }\r\n    };\r\n\r\n    return PlaybackControlsView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class TimelineModel extends Backbone.Model {\r\n\r\n        /**\r\n         * TODO:\r\n         * - Allow for two modes: linear, and steps (one mode has the timeline clearly go through steps, the other smoothly plays it like a video).\r\n         */\r\n\r\n        defaults() {\r\n\t\t\t\r\n\t\t\treturn {\r\n\t\t\t\tframeCount: 0,          // Total number of frames.\r\n\t\t\t\tframeIdx: -1,           // Index of the current frame in the animation.\r\n\t\t\t\tframeDuration: 500,\t\t// How long each frame should be active for during the animation (steps mode only).\r\n\t\t\t\tmode: \"steps\",          // steps | linear\r\n\t\t\t\t\r\n\t\t\t\t// Calculated //\r\n\t\t\t\tduration: undefined,\t// Total duration of the animation.\r\n\t\t\t\tposition: 0,\t\t\t// Current time in the animation (from 0 to duration).\r\n\t\t\t\t\r\n\t\t\t\tisPlaying: false,\r\n\t\t\t\tisComplete: false,      // Only true if !isPlaying and position == duration.\r\n\r\n\t\t\t\t_prevTimestamp: undefined\t\t// Used for calculating deltatime.\r\n\t\t\t}\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setupFrames();\r\n\t\t\tthis.setupEventListeners();\r\n\t\t\t//this.initFrames();\r\n        }\r\n        \r\n        /**\r\n         * Depending on the settings provided, initialise the range slider with different min/max values.\r\n         */\r\n        setupFrames(){\r\n\r\n            if (this.get(\"mode\") == \"steps\"){\r\n\r\n                var frameCount = this.get(\"frameCount\");\r\n                var frameDuration = this.get(\"frameDuration\");\r\n                var duration = this.get(\"duration\");\r\n                \r\n                // Determine the 3rd value based on the value of the other two.\r\n                if (frameCount && frameDuration) {\r\n                    duration = frameCount * frameDuration;\r\n                }\r\n                else if (frameDuration && duration) {\r\n                    frameCount = frameDuration / duration;\r\n                }\r\n                else {\r\n                    frameDuration = frameCount / duration;\r\n                }\r\n\r\n                this.set(\"frameCount\", frameCount);\r\n                this.set(\"frameDuration\", frameDuration);\r\n                this.set(\"duration\", duration);\r\n\r\n                if (frameCount <= 0)\r\n                    throw \"Timeline calculated frameCount cannot be <= 0 (ensure the \\\"frameDuration\\\" and \\\"duration\\\" properties are manually set).\"\r\n\r\n                return;\r\n            }\r\n\r\n            throw \"Non-\\\"steps\\\" mode support has not yet been implemented.\";\r\n            return;\r\n        }\r\n\r\n\t\tsetupEventListeners() {\r\n            this.listenTo(this, \"change:isPlaying\", this.onIsPlayingChange);\r\n            this.listenTo(this, \"change:position\", this.onPositionChange);\r\n            this.listenTo(this, \"change:frameIdx\", this.onFrameIdxChange);\r\n\t\t}\r\n\t\t\r\n\t\tonIsPlayingChange(model, isPlaying){\r\n\r\n\t\t\t// Start the requestAnimationFrame loop.\r\n\t\t\tif (isPlaying) {\r\n\r\n\t\t\t\t// If the animation was at the end of the timeline, reset it.\r\n\t\t\t\tif (this.get(\"isComplete\")) {\r\n\t\t\t\t\tthis.set(\"position\", 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.set(\"_prevTimestamp\", undefined);\r\n\t\t\t\twindow.requestAnimationFrame(this.step.bind(this));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tonFrameIdxChange(model, frameIdx){\r\n\r\n            this.set(\"position\", frameIdx * this.get(\"frameDuration\"));\r\n            this.set(\"isComplete\", frameIdx == this.get(\"frameCount\")-1);\r\n\t\t}\r\n\r\n\t\tonPositionChange(model, position){\r\n\r\n\t\t\t// TODO: Disable this when not using the steps mode.\r\n\r\n\t\t\t// Set the frameIdx = to the position / frameDuration.\r\n\t\t\tvar frameIdx = Math.floor(position / this.get(\"frameDuration\"));\r\n\t\t\tif (frameIdx >= this.get(\"frameCount\")) frameIdx = this.get(\"frameCount\")-1;\r\n\t\t\tthis.set(\"frameIdx\", frameIdx);\r\n\t\t}\r\n\r\n\t\tstep(timestamp){\r\n\r\n\t\t\tif (!this.get(\"isPlaying\")) return; // Stop if paused.\r\n\t\t\tif (this.get(\"_prevTimestamp\") === undefined) {this.set(\"_prevTimestamp\", timestamp);}\r\n\r\n\t\t\tvar delta = timestamp - this.get(\"_prevTimestamp\"); // FIXME: == 0 on frame 0.\r\n\t\t\tvar position = this.get(\"position\") + delta; // Increment elapsed time.\r\n\t\t\tthis.set(\"_prevTimestamp\", timestamp);\r\n\r\n\t\t\t// If the elapsed time is greater than the duration, stop.\r\n\t\t\tvar duration = this.get(\"duration\");\r\n\t\t\tif (position > duration) {\r\n\t\t\t\tthis.set(\"position\", duration);\r\n\t\t\t\tthis.pause();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Continue to next tick.\r\n\t\t\tthis.set(\"position\", position);\r\n\t\t\twindow.requestAnimationFrame(this.step.bind(this));\r\n\t\t}\r\n\t\t\r\n\t\ttogglePlayPause(){\r\n\t\t\tthis.set(\"isPlaying\", !this.get(\"isPlaying\"));\r\n\t\t}\r\n\r\n\t\treset(){\r\n\t\t\tthis.set(\"isPlaying\", false);\r\n\t\t\tthis.set(\"isComplete\", false);\r\n\t\t\tthis.set(\"position\", 0);\r\n\t\t\tthis.set(\"_prevTimestamp\", undefined);\r\n\t\t}\r\n\r\n\t\tpause(){\r\n\t\t\tthis.set(\"isPlaying\", false);\r\n\t\t}\r\n\r\n\t\tplay(){\r\n\t\t\tthis.set(\"isPlaying\", true);\r\n\t\t}\r\n    };\r\n\r\n    return TimelineModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './playbackControlsView',\r\n    './playbackControlsModel'\r\n], function(Adapt, PlaybackControlsView, PlaybackControlsModel) {\r\n\r\n    /**\r\n     * This extension is a partial. Components which require it will need to load and append it themselves.\r\n     * If no component uses it, then it won't do anything (though, it'll still be loaded in by Adapt, which is a shame.).\r\n     * Note:\r\n     * \r\n     * =====\r\n     * This isn't implemented like the standard Adapt extension.\r\n     * However, there didn't seem to be any other way to implement a partial element that can be used by multiple components.\r\n     */\r\n\r\n    return function(modelSettings) {\r\n        \r\n        var model = new PlaybackControlsModel(modelSettings);\r\n        var view = new PlaybackControlsView({\r\n            model: model\r\n        });\r\n\r\n        //model.$el = view.$el; // FIXME: Bad. But I need some way of getting the element the view creates.\r\n        return view;\r\n    }\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n\tclass CAInspectorVarView extends Backbone.View {\r\n\r\n\t\tclassName() {\r\n\t\t\treturn \"codeanim__inspector-row\";\r\n\t\t}\r\n\r\n\t\tinitialize(){\r\n\t\t\t\r\n\t\t\tthis.setupEventListeners();\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tsetupEventListeners(){\r\n\r\n\t\t\tthis.listenTo(this.model.get(\"_playbackControlsModel\"), \"change:frameIdx\", this.onFrameIdxChange);\r\n\t\t\tthis.listenTo(this.model, \"change:val\", this.onValChange);\r\n\t\t\tthis.listenTo(this.model, \"change:_isVisible\", this.onVisibleChange);\r\n\r\n\t\t\t// FIXME: Set up initial state by triggering the initial change.\r\n\t\t\t_.debounce(() => {this.onFrameIdxChange(this.model.get(\"_playbackControlsModel\"), this.model.get(\"_playbackControlsModel\").get(\"frameIdx\"));})();\r\n\t\t}\r\n\t\t\r\n\t\trender(){\r\n\r\n\t\t\tvar data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['codeAnimInspectorVar'];\r\n            this.$el.html(template(data));\r\n\t\t}\r\n\r\n\t\tonFrameIdxChange(model, frameIdx){\r\n\r\n\t\t\t// Determine what state to show.\r\n\t\t\tvar val = undefined;\r\n\t\t\tvar vals = this.model.get(\"_vals\");\r\n\t\t\tvar idx = -1;\r\n\r\n\t\t\t_.each(vals, function(v){\r\n\t\t\t\tif (v.frameIdx <= frameIdx) {\r\n\t\t\t\t\tval = v._isEnabled ? v.val : undefined;\r\n\t\t\t\t\tidx = val === undefined ? -1 : v.frameIdx;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.model.set(\"val\", val);\r\n\t\t}\r\n\r\n\t\tonVisibleChange(model, isVisible){\r\n\r\n\t\t\t// Whenever this view needs to be hidden, make it invisible instead, and move it to a different element.\r\n\t\t\t// (This will prevent the inspector from resizing its height as the animation plays).\r\n\t\t\tthis.model.get(\"_parentView\")\r\n\t\t\t.$(isVisible ? \".js-codeanim-inspector-vars-inactive\" : \".js-codeanim-inspector-vars-invisible\")\r\n\t\t\t.append(this.$el);\r\n\r\n\t\t\tthis.$el.toggleClass(\"u-visibility-hidden\", !isVisible).hide(0).show(0); // hide + show will trigger a CSS animation if there is one.\r\n\t\t}\r\n\r\n\t\tonValChange(model, val){\r\n\r\n\t\t\tthis.$(\".js-codeanim-inspector-var-val\").html(val !== undefined ? val : \"\");\r\n\t\t\tthis.$(\".codeanim__inspector-cell-value-inner\").hide(0).show(0); // hide + show will trigger a CSS animation if there is one.\r\n\t\t\tthis.model.set(\"_isVisible\", val !== undefined);\r\n\t\t}\r\n\t}\r\n  \r\n  \treturn CAInspectorVarView;\r\n});\r\n","const { html } = require(\"cheerio/lib/api/manipulation\");\r\n\r\ndefine([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'extensions/adapt-playbackControls/js/adapt-playbackControls',\r\n  './codeAnimInspectorVarView'\r\n], function(Adapt, ComponentView, PlaybackControls, CodeAnimInspectorVarView) {\r\n\r\n  class CodeAnimView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        \r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpViewData();\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpViewData() {\r\n      let animation = this.model.get(\"_animation\");\r\n      if (animation && animation._isEnabled) {\r\n        this.$el.addClass(\"is-animated\");\r\n      }\r\n    }\r\n\r\n    setUpEventListeners() {\r\n\r\n      // If this component is the target of an adapt-activator, then it will be given the _activatorTarget property.\r\n      // Listen for changes to it.\r\n      this.listenTo(this.model.get(\"_activatorTarget\"), \"change:_isActive\", this.onActivatorActivate);\r\n\r\n      //this.listenTo(Adapt, 'device:changed', this.reRender);\r\n\r\n      /*this.listenTo(this.model.get('_children'), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange,\r\n        'change:_isVisible': this.onItemsVisibleChange\r\n      });*/\r\n    }\r\n\r\n    /**\r\n     * Compatibility with adapt-activator component.\r\n     * @param {*} _isActive \r\n     */\r\n    onActivatorActivate(activatorTarget, _isActive) {\r\n      \r\n      let navigateSettings = {\r\n        duration: 400,\r\n        align: \"inview\",\r\n        offset: {\r\n          top: -100,\r\n          left: 0\r\n        }\r\n      };\r\n\r\n      if (!this.playbackControlsView) {\r\n\r\n        if (_isActive) {\r\n\r\n          // Scroll the console (which was just activated) into view.\r\n          Adapt.navigateToElement(this.$(\".js-codeanim-console\"), navigateSettings);\r\n        }\r\n\r\n        return; // No playback controls view is being used; no further action needed.\r\n      }\r\n\r\n      // Reset the playbackControls.\r\n      if (!_isActive) {\r\n        this.playbackControlsView.model.pause();\r\n        this.playbackControlsView.model.reset();\r\n      }\r\n      else {\r\n        this.playbackControlsView.model.reset();\r\n        this.playbackControlsView.model.play();\r\n      }\r\n\r\n      // Slide down / up the console and inspector box.\r\n      this.model.get(\"_animation\")._isActive = _isActive;\r\n      if (_isActive) {\r\n\r\n        let $anim = this.$(\".js-codeanim-anim\");\r\n        $anim.show(0);\r\n        let animHeight = this.$(\".js-codeanim-anim\").height();\r\n        $anim.hide(0);\r\n\r\n        $anim.slideDown();\r\n\r\n        // Scroll the playback controls (and the console) into view.\r\n        navigateSettings.offset.height = animHeight + 100; // offset.height = increase the height used for calculating inview.\r\n        Adapt.navigateToElement(this.$(\".playbackcontrols\"), navigateSettings);\r\n      }\r\n      else {\r\n        this.$(\".js-codeanim-anim\").slideUp();\r\n      }\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Due to a portion of this component being hidden prior to activation,\r\n     * adapt-scrollfix cannot automatically calculate its size to scroll it into view.\r\n     * \r\n     * This function is therefore defined to be used by adapt-scrollfix to get the custom value. \r\n     */\r\n    getBoundingClientRect() {\r\n\r\n      let animation = this.model.get(\"_animation\");\r\n      \r\n      // No animation. Give normal rect.\r\n      if (!animation || !animation._isEnabled) {\r\n        return this.$el[0].getBoundingClientRect();\r\n      }\r\n\r\n      // Yes animation. Include the hidden element in the rect.\r\n      let $codeAnimContainer = this.$(\".js-codeanim-anim\");\r\n      $codeAnimContainer.show(0).css(\"height\", \"\");\r\n      let bb = this.$el[0].getBoundingClientRect();\r\n      bb.height += 10; // Just a bit of extra buffer.\r\n\r\n      // Hide the container again (if applicable).\r\n      if (!animation._isActive) {\r\n        $codeAnimContainer.hide(0);\r\n      }\r\n\r\n      return bb;\r\n    }\r\n\r\n    preRender() {\r\n\r\n      // FIXME: Need to add support for if no _lang defined, get the global lang.\r\n      // The global lang should be gettable by using Adapt.codeBox.defaultLang or something like that.\r\n\r\n      // If the console's language is \"html\", don't escape it.\r\n      if (this.model.get(\"_console\")._lang == \"html\") {\r\n\r\n        // Remove any extra HTML that was generated.\r\n        let htmlConsole = Adapt.codeBox.toString(this.model.get(\"_console\").body);\r\n\r\n        // Un-escape all \"<\"\" and \">\" characters.\r\n        htmlConsole = htmlConsole.replace(/&lt;/g, \"<\");\r\n        htmlConsole = htmlConsole.replace(/&gt;/g, \">\");\r\n        \r\n        this.model.get(\"_console\").body = htmlConsole;\r\n      }\r\n    }\r\n\r\n    postRender() {\r\n\r\n      this.renderPlaybackControls();\r\n      this.setReadyStatus();\r\n    }\r\n\r\n    renderPlaybackControls() {\r\n\r\n      let animation = this.model.get(\"_animation\");\r\n      if (!animation || !animation._isEnabled) return;\r\n\r\n      let playbackControlsView = PlaybackControls({\r\n        frameDuration:  animation._frameDuration || 1000,\r\n        duration:       animation._duration,\r\n        frameCount:     animation._frames.length,\r\n        mode:           \"steps\"\r\n      });\r\n      this.playbackControlsView = playbackControlsView;\r\n      this.$(\".codeanim__playbackcontrols-container\").html(playbackControlsView.$el);\r\n\r\n      // Set up view data\r\n      this.frames = animation._frames;\r\n\r\n      // Listen for playbackControls timeline changes.\r\n      this.listenTo(playbackControlsView.model, \"change:frameIdx\", this.onPlaybackControlsFrameChange);\r\n\r\n      // Render inspector vars.\r\n      if (this.model.get(\"_isInspectorEnabled\") !== false) {\r\n        this.renderInspectorVars();\r\n      }\r\n    }\r\n\r\n    renderInspectorVars() {\r\n      \r\n      let $container = this.$(\".js-codeanim-inspector-vars\");\r\n      let varModels = this.model.get(\"_animation\")._inspectorVars;\r\n\r\n      _.each(varModels, (varModel) => {\r\n        varModel.set(\"_playbackControlsModel\", this.playbackControlsView.model); // Have each inspector var have access to the playbackControls (they'll need to listen for timeline changes in order to update their values).\r\n        varModel.set(\"_parentView\", this);\r\n        $container.append(new CodeAnimInspectorVarView({model: varModel}).$el);\r\n      });\r\n    }\r\n\r\n    _getAnimationFrame(idx){\r\n      let targetFrame;\r\n      try {\r\n        targetFrame = this.frames[idx];\r\n      }\r\n      catch (err) {\r\n        throw err;\r\n      }\r\n      return targetFrame;\r\n    }\r\n\r\n    // Whenever the playbackControls timeline moves, update this views state to display the specified frame.\r\n    onPlaybackControlsFrameChange(playbackControlsModel, frameIdx) {\r\n      \r\n      let frame = this._getAnimationFrame(frameIdx);\r\n\r\n      // Highlight the codebox line this frame corresponds to.\r\n      this.$(\".codebox__line\")\r\n      .removeClass(\"is-codeanim-mark\")\r\n      .removeAttr(\"data-codeanim-anim\")\r\n      .filter(\"[data-line-num=\" + frame.line + \"]\")\r\n      .attr(\"data-codeanim-anim\", frame.anim)\r\n      .addClass(\"is-codeanim-mark\");\r\n\r\n      // Show all the console-print elements up to and including this frame's.\r\n      //let print = frame.print;\r\n      \r\n      // FIXME: If the user gives a value of '\"print\": false', then print won't render that line (it needs to be given as \"print\": \"false\" instead).\r\n      let $consolePrints = this.$(\".codeanim__console-print\");\r\n      $consolePrints.addClass(\"u-visibility-hidden\").filter((i, e) => {\r\n        return $(e).attr(\"data-frame-idx\") <= frameIdx;\r\n      }).removeClass(\"u-visibility-hidden\");\r\n    }\r\n  }\r\n  \r\n  CodeAnimView.template = \"codeAnim\";\r\n  return CodeAnimView;\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n\tconst UNDEFINED = \"UNDEFINED\";\r\n\r\n\tclass CAInspectorVarModel extends Backbone.Model {\r\n\r\n\t\tdefaults() {\r\n\t\t\treturn {\r\n\t\t\t\t_playbackControlsModel: undefined, // Reference to the codeAnim's playbackControls model. Set when the View is created.\r\n\t\t\t\t\r\n\t\t\t\tname: \"\",\t\t// Var name.\r\n\r\n\t\t\t\t// The current value from _vals being shown to the user.\r\n\t\t\t\t// Set to this \"UNDEFINED\" to ensure the first value it's set to is guaranteed to trigger a change.\r\n\t\t\t\tval: UNDEFINED, \r\n\r\n\t\t\t\t_vals: [\t\t// Array of all values this var will have and at what frames.\r\n\t\t\t\t\t\t\t// If the val === \"UNDEFINED\", then the view will hide itself for that frame(s).\r\n\t\t\t\t\t\t\t// ASSUMES VALS ARE SORTED IN ASCENDING FRAMEIDX.\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tval: \"\",\r\n\t\t\t\t\t\tframeIdx: 0,\r\n\t\t\t\t\t\t_isEnabled: true\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t\r\n\t\t\t\t// Last frameIdx that a change occured on.\r\n\t\t\t\tlastFrameIdx: -2,\t// Updates as the timeline is moved.\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tinitialize(){\r\n\t\t\tthis.set(\"_vals\", []);\r\n\r\n\t\t\t// Have the var start off invisible on frame 0.\r\n\t\t\t// This can be overridden by setting a value for frame 0 in components.json (probably; untested).\r\n\t\t\tthis.addVal(UNDEFINED, 0);\r\n\t\t}\r\n\r\n\t\tconvertVal(val) {\r\n\r\n\t\t\tswitch (typeof val) {\r\n\r\n\t\t\t\tcase \"string\":\r\n\r\n\t\t\t\t\t// Hide the View if manually set to UNDEFINED.\r\n\t\t\t\t\tif (val === UNDEFINED) {\r\n\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Show \"undefined\" as a string if set to it.\r\n\t\t\t\t\tif (val === \"undefined\") {\r\n\t\t\t\t\t\treturn \"<em>undefined</em>\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the string starts with \"~\", don't wrap it in \"\".\r\n\t\t\t\t\tif (val.length && val[0] == \"~\") {\r\n\t\t\t\t\t\treturn val.substring(1); // Remove the \"~\".\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Ensure all valid strings are wrapped in \"\" in the View.\r\n\t\t\t\t\treturn \"\\\"\" + val + \"\\\"\";\r\n\r\n\t\t\t\tcase \"object\":\r\n\r\n\t\t\t\t\tlet v = val;\r\n\t\t\t\t\t// Recur through all children.\r\n\t\t\t\t\t_.each(v, (val, key) => {\r\n\t\t\t\t\t\tv[key] = this.convertVal(val);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tv = JSON.stringify(v, null, \" \");\r\n\t\t\t\t\t// Remove newline characters.\r\n\t\t\t\t\tv = v.replace(/\\n/g, \"\");\r\n\r\n\t\t\t\t\t// Modify escaped and remove non-escaped doublequotes.\r\n\r\n\t\t\t\t\t// Find any escaped \" characters (these were generated by the above \"string\" case).\r\n\t\t\t\t\tv = v.replace(/(\"\\\\\")(.*?)(\\\\\"\")/g, (match, $1, $2, $3) => {\r\n\t\t\t\t\t\treturn \"!!!'!!!\" + $2 + \"!!!'!!!\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// Remove any remaining non-escaped \" characters.\r\n\t\t\t\t\tv = v.replace(/([^\\\\])(\")/g, (match, $1, $2) => {\r\n\t\t\t\t\t\treturn $1;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// Replace the !!!'!!! placeholders with \".\r\n\t\t\t\t\tv = v.replace(/!!!'!!!/g, '\"');\r\n\r\n\t\t\t\t\t// JSON.stringify will add spaces inside the outer parts of [ ... ] and { ... }, remove them (looks better).\r\n\t\t\t\t\tv = v.replace(/(^[[{])(\\s+)([\\S\\s]*)(\\s+)([}\\]]$)/g, \"$1$3$5\");\r\n\r\n\t\t\t\t\treturn v.replace(/(\\[)(\\s+)/g, \"$1\");\r\n\t\t\t}\r\n\r\n\t\t\treturn val;\r\n\t\t}\r\n\r\n\t\taddVal(val, frameIdx) {\r\n\r\n\t\t\tlet _val = this.convertVal(val);\r\n\r\n\t\t\tlet v = {\r\n\t\t\t\t_isEnabled: _val === false ? false : true,\r\n\t\t\t\tval: _val,\r\n\t\t\t\tframeIdx: frameIdx\r\n\t\t\t};\r\n\r\n\t\t\tlet _vals = this.get(\"_vals\");\r\n\t\t\t_vals.push(v);\r\n\t\t\tthis.set(\"_vals\", _vals);\r\n\t\t}\r\n\r\n\t\t/*setUpVals() {\r\n\t\t\t\r\n\t\t\t_.each(this.get(\"vals\"), function(v){\r\n\r\n\t\t\t\tv._isEnabled = true;\r\n\r\n\t\t\t\tif (typeof v.val == \"string\") {\r\n\r\n\t\t\t\t\t// Hide the View if manually set to UNDEFINED.\r\n\t\t\t\t\tif (v.val === \"UNDEFINED\") {\r\n\t\t\t\t\t\tv._isEnabled == false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Ensure all valid strings are wrapped in \"\".\r\n\t\t\t\t\tv.val = \"\\\"\" + v.val + \"\\\"\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}*/\r\n\t}\r\n  \r\n  \treturn CAInspectorVarModel;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel',\r\n  './codeAnimInspectorVarModel'\r\n], function(Adapt, ComponentModel, CodeAnimInspectorVarModel) {\r\n\r\n  class CodeAnimModel extends ComponentModel {\r\n\r\n    // Used to set model defaults\r\n    defaults() {\r\n\r\n      // Extend from the ComponentModel defaults\r\n      return ComponentModel.resultExtend('defaults', {\r\n        \"_timelineFrames\": undefined\t\t// Collection of frame objects which will be used to make the codeAnimation. \r\n      });\r\n    }\r\n\r\n    initialize() {\r\n\r\n\t\tComponentModel.prototype.initialize.call(this);\r\n\t\tthis.setUpEventListeners();\r\n\t\tthis.setUpAnimation();\r\n    }\r\n\r\n    // Set up the animation of the code \"compiling\".\r\n    setUpAnimation() {\r\n\t\tvar _animation = this.get(\"_animation\");\r\n\t\tif (!_animation || !_animation._isEnabled) return;\r\n\r\n\t\t// Enable inspector by default.\r\n\t\tthis.get(\"_animation\")._isInspectorEnabled = this.get(\"_animation\")._isInspectorEnabled !== false; \r\n\r\n\t\t// Get the keyframes from the .json.\r\n\t\t// They cannot be used in this state, and must be processed for the animation.\r\n\t\tvar keyframes = this.get(\"_animation\")._keyframes;\r\n\t\tif (!keyframes) throw \"codeAnim property _animation._keyframes array must be defined\";\r\n\r\n\t\tvar frames = [];\r\n\r\n\t\t// Insert a blank frame at the start (has no highlights and prints nothing).\r\n\t\tframes.push({\r\n\t\t\tline: 0,\r\n\t\t\tkeyframe: null\r\n\t\t});\r\n\r\n\t\t// Process keyframes.\r\n\t\t_.each(keyframes, (k) => {\r\n\r\n\t\t\tlet allLines = this._stringToNumbers(k.lines);\r\n\t\t\t\r\n\t\t\t// Create a frame for each line in the codebox referenced by this keyframe.\r\n\t\t\t_.each(allLines, (line) => {\r\n\t\t\t\tlet f = _.extend({}, k, {\r\n\t\t\t\t\tline: line,\r\n\t\t\t\t});\r\n\t\t\t\tframes.push(f);\r\n\t\t\t});\r\n\t\t});\r\n\t  \r\n\t\t_animation._frames = frames;\r\n\r\n\t\tlet _maxNameLength = 5; // Used to set the width of the leftmost column.\r\n\t\t\t\t\t\t\t\t// Needs to be done this way due to the way the CSS is set up.\r\n\t\t\t\t\t\t\t\t// (The CSS will try to minimize space used; but as a consequence, it needs this width set manually).\r\n\r\n\t\t// Set up inspector vars.\r\n\t\t// ----------------------------------------------\r\n\t\tlet inspectorVars = {};\r\n\t\t_.each(_animation._frames, (frame, frameIdx) => {\r\n\t\t\t\r\n\t\t\tif (!frame.vars) return; // This frame has no vars being changed in it. Ignore it.\r\n\t\t\t_.each(frame.vars, (val, key) => {\r\n\r\n\t\t\t\t// Create a new CodeAnimInspectorVarModel for each unique variable name provided in the keyframes.\r\n\t\t\t\tif (!inspectorVars[key]) {\r\n\t\t\t\t\tinspectorVars[key] = new CodeAnimInspectorVarModel({\r\n\t\t\t\t\t\tname: key\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (key.length > _maxNameLength) _maxNameLength = key.length;\r\n\t\t\t\t}\r\n\t\t\t\tinspectorVars[key].addVal(val, frameIdx);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.get(\"_animation\")._maxNameLength = _maxNameLength / 1.2;\r\n\t\t_animation._inspectorVars = inspectorVars;\r\n\t}\r\n\r\n    /**\r\n     * Get an array of all the line numbers that this keyframe will repeat itself for.\r\n     * _keyframes.lines supports strings similar to a word processor; example:\r\n     * \"1,3-10,1-2,12\"\r\n     */\r\n    _stringToNumbers(str){\r\n\r\n\t\tvar nums = str.replace(/\\s/g, \"\");\r\n\t\tnums = nums.split(\",\");\r\n\r\n\t\tvar allNums = [];\r\n\t\t_.each(nums, function(n){\r\n\t\t\t\r\n\t\t\t// \"x-y\"\r\n\t\t\tvar match = n.match(/(\\d+)-(\\d+)/);\r\n\t\t\tif (match) {\r\n\t\t\t\tfor (let i = parseInt(match[1]); i <= parseInt(match[2]); i++){\r\n\t\t\t\t\tallNums.push(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// \"x\"\r\n\t\t\tmatch = n.match(/(\\d)+/g);\r\n\t\t\tif (match !== null) {\r\n\t\t\t\tallNums.push(parseInt(match));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Neither (error)\r\n\t\t\tthrow \"Invalid _stringToNumbers value provided: \\\"\" + str + \"\\\"\";\r\n\t\t});\r\n\r\n\t\treturn allNums;\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      //this.listenTo(Adapt, \"app:dataReady\", this.onDataReady.bind(this));\r\n    }\r\n  }\r\n\r\n  return CodeAnimModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './codeAnimView',\r\n  './codeAnimModel'\r\n], function(Adapt, CodeAnimView, CodeAnimModel) {\r\n\r\n  return Adapt.register('codeanim', {\r\n    model: CodeAnimModel,\r\n    view: CodeAnimView\r\n  });\r\n\r\n});\r\n","import LockingModel from 'core/js/models/lockingModel';\r\n\r\nexport default class ItemModel extends LockingModel {\r\n\r\n  defaults() {\r\n    return {\r\n      _isActive: false,\r\n      _isVisited: false\r\n    };\r\n  }\r\n\r\n  reset() {\r\n    this.set({ _isActive: false, _isVisited: false });\r\n  }\r\n\r\n  toggleActive(isActive = !this.get('_isActive')) {\r\n    this.set('_isActive', isActive);\r\n  }\r\n\r\n  toggleVisited(isVisited = !this.get('_isVisited')) {\r\n    this.set('_isVisited', isVisited);\r\n  }\r\n\r\n}\r\n","import ComponentModel from 'core/js/models/componentModel';\r\nimport ItemModel from 'core/js/models/itemModel';\r\n\r\nexport default class ItemsComponentModel extends ComponentModel {\r\n\r\n  toJSON() {\r\n    const json = super.toJSON();\r\n    // Make sure _items is updated from child collection\r\n    json._items = this.getChildren().toJSON();\r\n    return json;\r\n  }\r\n\r\n  init() {\r\n    this.setUpItems();\r\n    this.listenTo(this.getChildren(), {\r\n      'all': this.onAll,\r\n      'change:_isVisited': this.checkCompletionStatus\r\n    });\r\n    super.init();\r\n  }\r\n\r\n  restoreUserAnswers() {\r\n    const booleanArray = this.get('_userAnswer');\r\n    if (!booleanArray) return;\r\n    this.getChildren().forEach((child, index) => child.set('_isVisited', booleanArray[index]));\r\n  }\r\n\r\n  storeUserAnswer() {\r\n    const booleanArray = this.getChildren().map(child => child.get('_isVisited'));\r\n    this.set('_userAnswer', booleanArray);\r\n  }\r\n\r\n  setUpItems() {\r\n    // see https://github.com/adaptlearning/adapt_framework/issues/2480\r\n    const items = this.get('_items') || [];\r\n    items.forEach((item, index) => (item._index = index));\r\n    this.setChildren(new Backbone.Collection(items, { model: ItemModel }));\r\n  }\r\n\r\n  getItem(index) {\r\n    return this.getChildren().findWhere({ _index: index });\r\n  }\r\n\r\n  getVisitedItems() {\r\n    return this.getChildren().where({ _isVisited: true });\r\n  }\r\n\r\n  getActiveItems() {\r\n    return this.getChildren().where({ _isActive: true });\r\n  }\r\n\r\n  getActiveItem() {\r\n    return this.getChildren().findWhere({ _isActive: true });\r\n  }\r\n\r\n  areAllItemsCompleted() {\r\n    return this.getVisitedItems().length === this.getChildren().length;\r\n  }\r\n\r\n  checkCompletionStatus() {\r\n    this.storeUserAnswer();\r\n    if (!this.areAllItemsCompleted()) return;\r\n    this.setCompletionStatus();\r\n  }\r\n\r\n  reset(type, force) {\r\n    this.getChildren().each(item => item.reset());\r\n    super.reset(type, force);\r\n  }\r\n\r\n  resetActiveItems() {\r\n    this.getChildren().each(item => item.toggleActive(false));\r\n  }\r\n\r\n  setActiveItem(index) {\r\n    const item = this.getItem(index);\r\n    if (!item) return;\r\n\r\n    const activeItem = this.getActiveItem();\r\n    if (activeItem) activeItem.toggleActive(false);\r\n    item.toggleActive(true);\r\n  }\r\n\r\n}\r\n","define([\r\n  'core/js/models/itemsComponentModel'\r\n], function(ItemsComponentModel) {\r\n\r\n  var AccordionModel = ItemsComponentModel.extend({\r\n\r\n    defaults: function() {\r\n      return _.extend({}, _.result(ItemsComponentModel.prototype, 'defaults'), {\r\n        _shouldCollapseItems: /*true*/ false, // DD modified.\r\n        _toggleSpeed: 200\r\n      });\r\n    },\r\n\r\n    toggleItemsState: function(index) {\r\n      var item = this.getItem(index);\r\n      var previousActiveItem = this.getActiveItem();\r\n\r\n      item.toggleActive();\r\n      item.toggleVisited(true);\r\n\r\n      if (previousActiveItem && this.get('_shouldCollapseItems')) {\r\n        previousActiveItem.toggleActive(false);\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return AccordionModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  var AccordionView = ComponentView.extend({\r\n\r\n    events: {\r\n      'click .js-toggle-item': 'onClick'\r\n    },\r\n\r\n    preRender: function() {\r\n      this.checkIfResetOnRevisit();\r\n      this.setUpModelData();\r\n\r\n      this.model.resetActiveItems();\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    },\r\n\r\n    // DD: Modified to add support for sizing.\r\n    setUpModelData: function() {\r\n\r\n      if (!Adapt.sizing) return;\r\n\r\n      // adapt-sizing extension compatibility. Allow for individual item sizing.\r\n      let globalSizing = this.model.get(\"_itemSizing\");\r\n      _.each(this.model.get(\"_items\"), item => {\r\n\r\n        let graphic = item._graphic;\r\n        if (!graphic) return; // If no graphic, no need for sizing.\r\n\r\n        // Override the global sizing with the individual item sizing (if any).\r\n        let itemSizing = graphic._sizing || {};\r\n        itemSizing = _.extend(\r\n          {},\r\n          globalSizing,\r\n          itemSizing\r\n        );\r\n\r\n        // Set the item's sizing classes.\r\n        item._graphic._sizing = itemSizing;\r\n        item._graphic._sizing._classes = Adapt.sizing.getSizingClass(item._graphic._sizing);\r\n        item._graphic._sizing._parClasses = Adapt.sizing.getParentClasses(item._graphic._sizing);\r\n      });\r\n    },\r\n\r\n    postRender: function() {\r\n\r\n      this.setReadyStatus();\r\n\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion();\r\n      }\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    onClick: function(event) {\r\n      event.preventDefault();\r\n\r\n      this.model.toggleItemsState($(event.currentTarget).parent().data('index'));\r\n    },\r\n\r\n    onItemsActiveChange: function(item, isActive) {\r\n      this.toggleItem(item, isActive);\r\n    },\r\n\r\n    onItemsVisitedChange: function(item, isVisited) {\r\n      if (!isVisited) return;\r\n\r\n      var $item = this.getItemElement(item);\r\n\r\n      $item.children('.accordion__item-btn').addClass('is-visited');\r\n    },\r\n\r\n    toggleItem: function(item, shouldExpand) {\r\n      var $item = this.getItemElement(item);\r\n      var $body = $item.children('.accordion__item-content').stop(true, true);\r\n\r\n      $item.children('.accordion__item-btn')\r\n        .toggleClass('is-selected is-open', shouldExpand)\r\n        .toggleClass('is-closed', !shouldExpand)\r\n        .attr('aria-expanded', shouldExpand);\r\n\r\n      if (!shouldExpand) {\r\n        $body.slideUp(this.model.get('_toggleSpeed'));\r\n        return;\r\n      }\r\n\r\n      $body.slideDown(this.model.get('_toggleSpeed'));\r\n    },\r\n\r\n    getItemElement: function(item) {\r\n      var index = item.get('_index');\r\n\r\n      return this.$('.accordion__item').filter('[data-index=\"' + index +'\"]');\r\n    }\r\n\r\n  });\r\n\r\n  return AccordionView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './accordionModel',\r\n  './accordionView'\r\n], function(Adapt, AccordionModel, AccordionView) {\r\n\r\n  return Adapt.register('accordion', {\r\n    model: AccordionModel,\r\n    view: AccordionView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentModel) {\r\n\r\n  class AssessmentResultsModel extends ComponentModel {\r\n\r\n    init(...args) {\r\n      this.set('originalBody', this.get('body'));// save the original body text so we can restore it when the assessment is reset\r\n\r\n      this.listenTo(Adapt, {\r\n        'assessments:complete': this.onAssessmentComplete,\r\n        'assessments:reset': this.onAssessmentReset\r\n      });\r\n\r\n      super.init(...args);\r\n    }\r\n\r\n    /**\r\n     * Checks to see if the assessment was completed in a previous session or not\r\n     */\r\n    checkIfAssessmentComplete() {\r\n      if (!Adapt.assessment || this.get('_assessmentId') === undefined) {\r\n        return;\r\n      }\r\n\r\n      const assessmentModel = Adapt.assessment.get(this.get('_assessmentId'));\r\n      if (!assessmentModel || assessmentModel.length === 0) return;\r\n\r\n      const state = assessmentModel.getState();\r\n      const isResetOnRevisit = assessmentModel.get('_assessment')._isResetOnRevisit;\r\n      if (state.isComplete && (!state.allowResetIfPassed || !isResetOnRevisit)) {\r\n        this.onAssessmentComplete(state);\r\n        return;\r\n      }\r\n\r\n      this.setVisibility();\r\n    }\r\n\r\n    onAssessmentComplete(state) {\r\n      if (this.get('_assessmentId') === undefined ||\r\n          this.get('_assessmentId') != state.id) return;\r\n\r\n      /*\r\n      make shortcuts to some of the key properties in the state object so that\r\n      content developers can just use {{attemptsLeft}} in json instead of {{state.attemptsLeft}}\r\n      */\r\n      this.set( {\r\n        _state: state,\r\n        attempts: state.attempts,\r\n        attemptsSpent: state.attemptsSpent,\r\n        attemptsLeft: state.attemptsLeft,\r\n        score: state.score,\r\n        scoreAsPercent: state.scoreAsPercent,\r\n        maxScore: state.maxScore,\r\n        isPass: state.isPass\r\n      });\r\n\r\n      this.setFeedbackBand(state);\r\n\r\n      this.checkRetryEnabled(state);\r\n\r\n      this.setFeedbackText();\r\n\r\n      this.toggleVisibility(true);\r\n    }\r\n\r\n    setFeedbackBand(state) {\r\n      const scoreProp = state.isPercentageBased ? 'scoreAsPercent' : 'score';\r\n      const bands = _.sortBy(this.get('_bands'), '_score');\r\n\r\n      for (let i = (bands.length - 1); i >= 0; i--) {\r\n        const isScoreInBandRange =  (state[scoreProp] >= bands[i]._score);\r\n        if (!isScoreInBandRange) continue;\r\n\r\n        this.set('_feedbackBand', bands[i]);\r\n        break;\r\n      }\r\n    }\r\n\r\n    checkRetryEnabled(state) {\r\n      const assessmentModel = Adapt.assessment.get(state.id);\r\n      if (!assessmentModel.canResetInPage()) return false;\r\n\r\n      const feedbackBand = this.get('_feedbackBand');\r\n      const isRetryEnabled = (feedbackBand && feedbackBand._allowRetry) !== false;\r\n      const isAttemptsLeft = (state.attemptsLeft > 0 || state.attemptsLeft === 'infinite');\r\n      const showRetry = isRetryEnabled && isAttemptsLeft && (!state.isPass || state.allowResetIfPassed);\r\n\r\n      this.set({\r\n        _isRetryEnabled: showRetry,\r\n        retryFeedback: showRetry ? this.get('_retry').feedback : ''\r\n      });\r\n    }\r\n\r\n    setFeedbackText() {\r\n      const feedbackBand = this.get('_feedbackBand');\r\n\r\n      // ensure any handlebars expressions in the .feedback are handled...\r\n      const feedback = feedbackBand ? Handlebars.compile(feedbackBand.feedback)(this.toJSON()) : '';\r\n\r\n      this.set({\r\n        feedback,\r\n        body: this.get('_completionBody')\r\n      });\r\n    }\r\n\r\n    setVisibility() {\r\n      if (!Adapt.assessment) return;\r\n\r\n      const isVisibleBeforeCompletion = this.get('_isVisibleBeforeCompletion') || false;\r\n      const wasVisible = this.get('_isVisible');\r\n\r\n      const assessmentModel = Adapt.assessment.get(this.get('_assessmentId'));\r\n      if (!assessmentModel || assessmentModel.length === 0) return;\r\n\r\n      const state = assessmentModel.getState();\r\n      const isComplete = state.isComplete;\r\n      const isAttemptInProgress = state.attemptInProgress;\r\n      const attemptsSpent = state.attemptsSpent;\r\n      const hasHadAttempt = (!isAttemptInProgress && attemptsSpent > 0);\r\n\r\n      const isVisible = (isVisibleBeforeCompletion && !isComplete) || hasHadAttempt;\r\n\r\n      if (!wasVisible && isVisible) isVisible = false;\r\n\r\n      this.toggleVisibility(isVisible);\r\n    }\r\n\r\n    toggleVisibility (isVisible) {\r\n      if (isVisible === undefined) {\r\n        isVisible = !this.get('_isVisible');\r\n      }\r\n\r\n      this.set('_isVisible', isVisible, { pluginName: 'assessmentResults' });\r\n    }\r\n\r\n    checkCompletion() {\r\n      if (this.get('_setCompletionOn') === 'pass' && !this.get('isPass')) {\r\n        return;\r\n      }\r\n\r\n      this.setCompletionStatus();\r\n    }\r\n\r\n    /**\r\n     * Handles resetting the component whenever its corresponding assessment is reset\r\n     * The component can either inherit the assessment's reset type or define its own\r\n     */\r\n    onAssessmentReset(state) {\r\n      if (this.get('_assessmentId') === undefined ||\r\n          this.get('_assessmentId') != state.id) return;\r\n\r\n      let resetType = this.get('_resetType');\r\n      if (!resetType || resetType === 'inherit') {\r\n        resetType = state.resetType || 'hard';// backwards compatibility - state.resetType was only added in assessment v2.3.0\r\n      }\r\n      this.reset(resetType, true);\r\n    }\r\n\r\n    reset(...args) {\r\n      this.set({\r\n        body: this.get('originalBody'),\r\n        state: null,\r\n        feedback: '',\r\n        _feedbackBand: null,\r\n        retryFeedback: '',\r\n        _isRetryEnabled: false\r\n      });\r\n\r\n      super.reset(...args);\r\n    }\r\n  }\r\n\r\n  return AssessmentResultsModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  class AssessmentResultsView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        'click .js-assessment-retry-btn': 'onRetryClicked'\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      this.model.setLocking('_isVisible', false);\r\n\r\n      this.listenTo(Adapt.parentView, 'preRemove', function () {\r\n        this.model.unsetLocking('_isVisible');\r\n      });\r\n\r\n      this.listenTo(this.model, {\r\n        'change:_feedbackBand': this.addClassesToArticle,\r\n        'change:body': this.render\r\n      });\r\n    }\r\n\r\n    postRender() {\r\n      this.model.checkIfAssessmentComplete();\r\n      this.setReadyStatus();\r\n      this.setupInviewCompletion('.component__inner', this.model.checkCompletion.bind(this.model));\r\n    }\r\n\r\n    /**\r\n     * Resets the state of the assessment and optionally redirects the user\r\n     * back to the assessment for another attempt.\r\n     */\r\n    onRetryClicked() {\r\n      const state = this.model.get('_state');\r\n\r\n      Adapt.assessment.get(state.id).reset(null, wasReset => {\r\n        if (!wasReset) {\r\n          return;\r\n        }\r\n        if (this.model.get('_retry')._routeToAssessment === true) {\r\n          Adapt.navigateToElement('.' + state.articleId);\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * If there are classes specified for the feedback band, apply them to the containing article\r\n     * This allows for custom styling based on the band the user's score falls into\r\n     */\r\n    addClassesToArticle(model, value) {\r\n      if (!value || !value._classes) return;\r\n\r\n      this.$el.parents('.article').addClass(value._classes);\r\n    }\r\n\r\n  }\r\n\r\n  AssessmentResultsView.template = 'assessmentResults';\r\n\r\n  return AssessmentResultsView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './assessmentResultsModel',\r\n  './assessmentResultsView'\r\n], function(Adapt, AssessmentResultsModel, AssessmentResultsView) {\r\n\r\n  return Adapt.register(\"assessmentResults\", {\r\n    model: AssessmentResultsModel,\r\n    view: AssessmentResultsView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentView, ComponentModel) {\r\n\r\n  var BlankView = ComponentView.extend({\r\n\r\n    preRender: function() {\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    postRender: function() {\r\n      this.setReadyStatus();\r\n      this.setupInviewCompletion();\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return Adapt.register('blank', {\r\n    model: ComponentModel.extend({}),// create a new class in the inheritance chain so it can be extended per component type if necessary later\r\n    view: BlankView\r\n  });\r\n\r\n});\r\n","const BUTTON_STATE = ENUM([\r\n  'SUBMIT',\r\n  'CORRECT',\r\n  'INCORRECT',\r\n  'SHOW_CORRECT_ANSWER',\r\n  'HIDE_CORRECT_ANSWER',\r\n  'SHOW_FEEDBACK',\r\n  'RESET'\r\n]);\r\n\r\nexport default BUTTON_STATE;\r\n","import Adapt from 'core/js/adapt';\r\nimport BUTTON_STATE from 'core/js/enums/buttonStateEnum';\r\n\r\n// convert BUTTON_STATE to property name\r\nconst textPropertyName = {\r\n  'SUBMIT': 'submit',\r\n  'CORRECT': 'correct',\r\n  'INCORRECT': 'incorrect',\r\n  'SHOW_CORRECT_ANSWER': 'showCorrectAnswer',\r\n  'HIDE_CORRECT_ANSWER': 'hideCorrectAnswer',\r\n  'SHOW_FEEDBACK': 'showFeedback',\r\n  'RESET': 'reset'\r\n};\r\n\r\nexport default class ButtonsView extends Backbone.View {\r\n\r\n  initialize(options) {\r\n    this.parent = options.parent;\r\n    this.listenTo(Adapt.parentView, 'postRemove', this.remove);\r\n    this.listenTo(this.model, {\r\n      'change:_buttonState': this.onButtonStateChanged,\r\n      'change:feedbackMessage': this.onFeedbackMessageChanged,\r\n      'change:_attemptsLeft': this.onAttemptsChanged,\r\n      'change:_canSubmit': this.onCanSubmitChange\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  events() {\r\n    return {\r\n      'click .js-btn-action': 'onActionClicked',\r\n      'click .js-btn-feedback': 'onFeedbackClicked'\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const data = this.model.toJSON();\r\n    const template = Handlebars.templates.buttons;\r\n    _.defer(() => {\r\n      this.postRender();\r\n      Adapt.trigger('buttonsView:postRender', this);\r\n    });\r\n    this.$el.html(template(data));\r\n  }\r\n\r\n  postRender() {\r\n    this.refresh();\r\n  }\r\n\r\n  checkResetSubmittedState() {\r\n    const isSubmitted = this.model.get('_isSubmitted');\r\n    if (isSubmitted) {\r\n      this.$el.addClass('is-submitted');\r\n      return;\r\n    }\r\n\r\n    this.$('.js-btn-marking').removeClass('is-incorrect is-correct').addClass('u-display-none');\r\n    this.$el.removeClass('is-submitted');\r\n    this.model.set('feedbackMessage', undefined);\r\n    Adapt.a11y.toggleEnabled(this.$('.js-btn-feedback'), false);\r\n  }\r\n\r\n  onActionClicked() {\r\n    const buttonState = BUTTON_STATE(this.model.get('_buttonState'));\r\n    this.trigger('buttons:stateUpdate', buttonState);\r\n    this.checkResetSubmittedState();\r\n\r\n    if (buttonState === BUTTON_STATE.SHOW_CORRECT_ANSWER) {\r\n      const correctAnswer = this.model.getCorrectAnswerAsText?.();\r\n      this.updateAnswerLiveRegion(correctAnswer);\r\n    }\r\n\r\n    if (buttonState === BUTTON_STATE.HIDE_CORRECT_ANSWER) {\r\n      const userAnswer = this.model.getUserAnswerAsText?.();\r\n      this.updateAnswerLiveRegion(userAnswer);\r\n    }\r\n  }\r\n\r\n  onFeedbackClicked() {\r\n    this.trigger('buttons:stateUpdate', BUTTON_STATE.SHOW_FEEDBACK);\r\n  }\r\n\r\n  onFeedbackMessageChanged(model, changedAttribute) {\r\n    if (changedAttribute && this.model.get('_canShowFeedback')) {\r\n      // enable feedback button\r\n      Adapt.a11y.toggleEnabled(this.$('.js-btn-feedback'), true);\r\n      return;\r\n    }\r\n    // disable feedback button\r\n    Adapt.a11y.toggleEnabled(this.$('.js-btn-feedback'), false);\r\n  }\r\n\r\n  onCanSubmitChange() {\r\n    this.onButtonStateChanged(this.model, this.model.get('_buttonState'));\r\n  }\r\n\r\n  onButtonStateChanged(model, changedAttribute) {\r\n\r\n    this.updateAttemptsCount();\r\n\r\n    // Use 'correct' instead of 'complete' to signify button state\r\n    const $buttonsAction = this.$('.js-btn-action');\r\n    const buttonState = BUTTON_STATE(changedAttribute);\r\n    if (changedAttribute === BUTTON_STATE.CORRECT || changedAttribute === BUTTON_STATE.INCORRECT) {\r\n      // Both 'correct' and 'incorrect' states have no model answer, so disable the submit button\r\n      Adapt.a11y.toggleEnabled($buttonsAction, false);\r\n      return;\r\n    }\r\n\r\n    const propertyName = textPropertyName[buttonState.asString];\r\n    const ariaLabel = this.model.get('_buttons')['_' + propertyName].ariaLabel;\r\n    const buttonText = this.model.get('_buttons')['_' + propertyName].buttonText;\r\n\r\n    // Enable the button, make accessible and update aria labels and text\r\n    Adapt.a11y.toggleEnabled($buttonsAction, this.model.get('_canSubmit'));\r\n    $buttonsAction.html(buttonText).attr('aria-label', ariaLabel);\r\n  }\r\n\r\n  checkFeedbackState() {\r\n    const canShowFeedback = this.model.get('_canShowFeedback');\r\n\r\n    this.$('.js-btn-action').toggleClass('is-full-width', !canShowFeedback);\r\n    this.$('.js-btn-feedback').toggleClass('u-display-none', !canShowFeedback);\r\n    this.$('.js-btn-marking').toggleClass('is-full-width u-display-none', !canShowFeedback);\r\n  }\r\n\r\n  updateAttemptsCount() {\r\n    const isInteractionComplete = this.model.get('_isInteractionComplete');\r\n    const attemptsLeft = (this.model.get('_attemptsLeft')) ? this.model.get('_attemptsLeft') : this.model.get('_attempts');\r\n    const shouldDisplayAttempts = this.model.get('_shouldDisplayAttempts');\r\n    let attemptsString;\r\n\r\n    this.checkResetSubmittedState();\r\n\r\n    if (!isInteractionComplete && attemptsLeft !== 0) {\r\n      attemptsString = attemptsLeft + ' ';\r\n      attemptsString += attemptsLeft === 1 ?\r\n        this.model.get('_buttons').remainingAttemptText :\r\n        this.model.get('_buttons').remainingAttemptsText;\r\n    } else {\r\n      this.$('.js-display-attempts').addClass('u-visibility-hidden');\r\n      this.showMarking();\r\n    }\r\n\r\n    if (shouldDisplayAttempts) {\r\n      this.$('.js-insert-attempts-string').html(attemptsString);\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Updates the ARIA 'live region' with the correct/user answer when that button\r\n   * is selected by the learner.\r\n   * @param {string} answer Textual representation of the correct/user answer\r\n   */\r\n  updateAnswerLiveRegion(answer) {\r\n    if (!answer) return;\r\n    this.$('.js-answer-live-region').html(answer);\r\n  }\r\n\r\n  showMarking() {\r\n    if (!this.model.shouldShowMarking) return;\r\n\r\n    const isCorrect = this.model.get('_isCorrect');\r\n    const ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n    this.$('.js-btn-marking')\r\n      .removeClass('u-display-none')\r\n      .addClass(isCorrect ? 'is-correct' : 'is-incorrect')\r\n      .attr('aria-label', isCorrect ? ariaLabels.answeredCorrectly : ariaLabels.answeredIncorrectly);\r\n  }\r\n\r\n  refresh() {\r\n    this.updateAttemptsCount();\r\n    this.checkResetSubmittedState();\r\n    this.checkFeedbackState();\r\n    this.onButtonStateChanged(null, this.model.get('_buttonState'));\r\n    this.onFeedbackMessageChanged(null, this.model.get('feedbackMessage'));\r\n  }\r\n\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport ComponentModel from 'core/js/models/componentModel';\r\nimport BUTTON_STATE from 'core/js/enums/buttonStateEnum';\r\n\r\nclass QuestionModel extends ComponentModel {\r\n\r\n  /// ///\r\n  // Setup question types\r\n  /// /\r\n\r\n  // Used to set model defaults\r\n  defaults() {\r\n    // Extend from the ComponentModel defaults\r\n    return ComponentModel.resultExtend('defaults', {\r\n      _isQuestionType: true,\r\n      _shouldDisplayAttempts: false,\r\n      _canShowModelAnswer: true,\r\n      _canShowFeedback: true,\r\n      _canShowMarking: true,\r\n      _canSubmit: true,\r\n      _isSubmitted: false,\r\n      _questionWeight: Adapt.config.get('_questionWeight'),\r\n      _items: []\r\n    });\r\n  }\r\n\r\n  // Extend from the ComponentModel trackable\r\n  trackable() {\r\n    return ComponentModel.resultExtend('trackable', [\r\n      '_isSubmitted',\r\n      '_score',\r\n      '_isCorrect',\r\n      '_attemptsLeft'\r\n    ]);\r\n  }\r\n\r\n  trackableType() {\r\n    return ComponentModel.resultExtend('trackableType', [\r\n      Boolean,\r\n      Number,\r\n      Boolean,\r\n      Number\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Returns a string of the model type group.\r\n   * @returns {string}\r\n   */\r\n  getTypeGroup() {\r\n    return 'question';\r\n  }\r\n\r\n  init() {\r\n    this.setupDefaultSettings();\r\n    this.setLocking('_canSubmit', true);\r\n    super.init();\r\n  }\r\n\r\n  // Calls default methods to setup on questions\r\n  setupDefaultSettings() {\r\n    // Not sure this is needed anymore, keeping to maintain API\r\n    this.setupWeightSettings();\r\n    this.setupButtonSettings();\r\n  }\r\n\r\n  // Used to setup either global or local button text\r\n  setupButtonSettings() {\r\n    const globalButtons = Adapt.course.get('_buttons');\r\n\r\n    // Check if  '_buttons' attribute exists and if not use the globally defined buttons.\r\n    if (!this.has('_buttons')) {\r\n      this.set('_buttons', globalButtons);\r\n    } else {\r\n      // Check all the components buttons.\r\n      // If they are empty use the global defaults.\r\n      const componentButtons = this.get('_buttons');\r\n\r\n      for (let key in componentButtons) {\r\n        if (typeof componentButtons[key] === 'object') {\r\n          // Button text.\r\n          if (!componentButtons[key].buttonText && globalButtons[key].buttonText) {\r\n            componentButtons[key].buttonText = globalButtons[key].buttonText;\r\n          }\r\n\r\n          // ARIA labels.\r\n          if (!componentButtons[key].ariaLabel && globalButtons[key].ariaLabel) {\r\n            componentButtons[key].ariaLabel = globalButtons[key].ariaLabel;\r\n          }\r\n        }\r\n\r\n        if (!componentButtons[key] && globalButtons[key]) {\r\n          componentButtons[key] = globalButtons[key];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Used to setup either global or local question weight/score\r\n  setupWeightSettings() {\r\n    // Not needed as handled by model defaults, keeping to maintain API\r\n  }\r\n\r\n  /// ///\r\n  // Submit process\r\n  /// /\r\n\r\n  // Use to check if the user is allowed to submit the question\r\n  // Maybe the user has to select an item?\r\n  canSubmit() {}\r\n\r\n  checkCanSubmit() {\r\n    this.set('_canSubmit', this.canSubmit(), { pluginName: 'adapt' });\r\n  }\r\n\r\n  // Used to update the amount of attempts the user has left\r\n  updateAttempts() {\r\n    if (!this.get('_attemptsLeft')) {\r\n      this.set('_attemptsLeft', this.get('_attempts'));\r\n    }\r\n    this.set('_attemptsLeft', this.get('_attemptsLeft') - 1);\r\n  }\r\n\r\n  // Used to set _isEnabled and _isSubmitted on the model\r\n  setQuestionAsSubmitted() {\r\n    this.set({\r\n      _isEnabled: false,\r\n      _isSubmitted: true\r\n    });\r\n  }\r\n\r\n  // Sets _isCorrect:true/false based upon isCorrect method below\r\n  markQuestion() {\r\n\r\n    if (this.isCorrect()) {\r\n      this.set('_isCorrect', true);\r\n    } else {\r\n      this.set('_isCorrect', false);\r\n    }\r\n\r\n  }\r\n\r\n  // Should return a boolean based upon whether to question is correct or not\r\n  isCorrect() {}\r\n\r\n  // Used to set the score based upon the _questionWeight\r\n  setScore() {}\r\n\r\n  // Checks if the question should be set to complete\r\n  // Calls setCompletionStatus and adds complete classes\r\n  checkQuestionCompletion() {\r\n\r\n    const isComplete = (this.get('_isCorrect') || this.get('_attemptsLeft') === 0);\r\n\r\n    if (isComplete) {\r\n      this.setCompletionStatus();\r\n    }\r\n\r\n    return isComplete;\r\n\r\n  }\r\n\r\n  // Updates buttons based upon question state by setting\r\n  // _buttonState on the model which buttonsView listens to\r\n  updateButtons() {\r\n\r\n    const isInteractionComplete = this.get('_isInteractionComplete');\r\n    const isCorrect = this.get('_isCorrect');\r\n    const isEnabled = this.get('_isEnabled');\r\n    const buttonState = this.get('_buttonState');\r\n    const canShowModelAnswer = this.get('_canShowModelAnswer');\r\n\r\n    if (isInteractionComplete) {\r\n\r\n      if (isCorrect || !canShowModelAnswer) {\r\n        // Use correct instead of complete to signify button state\r\n        this.set('_buttonState', BUTTON_STATE.CORRECT);\r\n\r\n      } else {\r\n\r\n        switch (buttonState) {\r\n          case BUTTON_STATE.SUBMIT:\r\n          case BUTTON_STATE.HIDE_CORRECT_ANSWER:\r\n            this.set('_buttonState', BUTTON_STATE.SHOW_CORRECT_ANSWER);\r\n            break;\r\n          default:\r\n            this.set('_buttonState', BUTTON_STATE.HIDE_CORRECT_ANSWER);\r\n        }\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      if (isEnabled) {\r\n        this.set('_buttonState', BUTTON_STATE.SUBMIT);\r\n      } else {\r\n        this.set('_buttonState', BUTTON_STATE.RESET);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  // Used to setup the correct, incorrect and partly correct feedback\r\n  setupFeedback() {\r\n    if (!this.has('_feedback')) return;\r\n\r\n    if (this.get('_isCorrect')) {\r\n      this.setupCorrectFeedback();\r\n    } else if (this.isPartlyCorrect()) {\r\n      this.setupPartlyCorrectFeedback();\r\n    } else {\r\n      this.setupIncorrectFeedback();\r\n    }\r\n  }\r\n\r\n  // Used by the question to determine if the question is incorrect or partly correct\r\n  // Should return a boolean\r\n  isPartlyCorrect() {}\r\n\r\n  setupCorrectFeedback() {\r\n    this.set({\r\n      feedbackTitle: this.getFeedbackTitle(),\r\n      feedbackMessage: this.get('_feedback').correct\r\n    });\r\n  }\r\n\r\n  setupPartlyCorrectFeedback() {\r\n\r\n    const feedback = this.get('_feedback')._partlyCorrect;\r\n\r\n    if (feedback?.final) {\r\n      this.setAttemptSpecificFeedback(feedback);\r\n    } else {\r\n      this.setupIncorrectFeedback();\r\n    }\r\n  }\r\n\r\n  setupIncorrectFeedback() {\r\n    this.setAttemptSpecificFeedback(this.get('_feedback')._incorrect);\r\n  }\r\n\r\n  setAttemptSpecificFeedback(feedback) {\r\n    const body = (this.get('_attemptsLeft') && feedback.notFinal) || feedback.final;\r\n\r\n    this.set({\r\n      feedbackTitle: this.getFeedbackTitle(),\r\n      feedbackMessage: body\r\n    });\r\n  }\r\n\r\n  getFeedbackTitle() {\r\n    return this.get('_feedback').title || this.get('displayTitle') || this.get('title') || '';\r\n  }\r\n\r\n  /**\r\n   * Used to determine whether the learner is allowed to interact with the question component or not.\r\n   * @return {Boolean}\r\n   */\r\n  isInteractive() {\r\n    return !this.get('_isComplete') || (this.get('_isEnabled') && !this.get('_isSubmitted'));\r\n  }\r\n\r\n  // Reset the model to let the user have another go (not the same as attempts)\r\n  reset(type, force) {\r\n    if (!this.get('_canReset') && !force) return;\r\n\r\n    type = type || true; // hard reset by default, can be \"soft\", \"hard\"/true\r\n\r\n    super.reset(type, force);\r\n\r\n    const attempts = this.get('_attempts');\r\n    this.set({\r\n      _attemptsLeft: attempts,\r\n      _isCorrect: undefined,\r\n      _isSubmitted: false,\r\n      _buttonState: BUTTON_STATE.SUBMIT\r\n    });\r\n  }\r\n\r\n  // Reset question for subsequent attempts\r\n  setQuestionAsReset() {\r\n    this.set({\r\n      _isEnabled: true,\r\n      _isSubmitted: false\r\n    });\r\n  }\r\n\r\n  refresh() {\r\n    this.trigger('question:refresh');\r\n  }\r\n\r\n  getButtonState() {\r\n    if (this.get('_isCorrect')) {\r\n      return BUTTON_STATE.CORRECT;\r\n    }\r\n\r\n    if (this.get('_attemptsLeft') === 0) {\r\n      return this.get('_canShowModelAnswer') ? BUTTON_STATE.SHOW_CORRECT_ANSWER : BUTTON_STATE.INCORRECT;\r\n    }\r\n\r\n    return this.get('_isSubmitted') ? BUTTON_STATE.RESET : BUTTON_STATE.SUBMIT;\r\n  }\r\n\r\n  // Returns an object specific to the question type, e.g. if the question\r\n  // is a 'choice' this should contain an object with:\r\n  // - correctResponsesPattern[]\r\n  // - choices[]\r\n  getInteractionObject() {\r\n    return {};\r\n  }\r\n\r\n  // Returns a string detailing how the user answered the question.\r\n  getResponse() {}\r\n\r\n  // Returns a string describing the type of interaction: \"choice\" and \"matching\" supported (see scorm wrapper)\r\n  getResponseType() {}\r\n\r\n  /**\r\n   * Called at the end of the onSubmitClicked view function.\r\n   */\r\n  onSubmitted() {\r\n    // Stores the current attempt state\r\n    this.addAttemptObject();\r\n  }\r\n\r\n  /** @type {boolean} */\r\n  get shouldShowMarking() {\r\n    if (!this.get('_canShowMarking')) {\r\n      return false;\r\n    }\r\n\r\n    return this.get('_isInteractionComplete');\r\n  }\r\n\r\n}\r\n\r\n// This abstract model needs to registered to support deprecated view-only questions\r\nAdapt.register('question', { model: QuestionModel });\r\n\r\nexport default QuestionModel;\r\n","import Adapt from 'core/js/adapt';\r\nimport ComponentView from 'core/js/views/componentView';\r\nimport ButtonsView from 'core/js/views/buttonsView';\r\nimport BUTTON_STATE from 'core/js/enums/buttonStateEnum';\r\n\r\nimport 'core/js/models/questionModel';\r\n\r\nclass QuestionView extends ComponentView {\r\n\r\n  className() {\r\n    return [\r\n      'component',\r\n      'is-question',\r\n      this.model.get('_component').toLowerCase(),\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      'is-' + this.model.get('_layout'),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : ''),\r\n      (this.model.get('_canShowModelAnswer') ? 'can-show-model-answer' : ''),\r\n      (this.model.get('_canShowFeedback') ? 'can-show-feedback' : ''),\r\n      (this.model.get('_canShowMarking') ? 'can-show-marking' : '')\r\n    ].join(' ');\r\n  }\r\n\r\n  initialize(...args) {\r\n    // Allow isInteractive to be used in jsx templates\r\n    this.isInteractive = this.isInteractive.bind(this);\r\n    super.initialize(...args);\r\n  }\r\n\r\n  /**\r\n   * Used to determine whether the learner is allowed to interact with the question component or not.\r\n   * @return {Boolean}\r\n  */\r\n  isInteractive() {\r\n    return this.model.isInteractive();\r\n  }\r\n\r\n  preRender() {\r\n    // Setup listener for _isEnabled\r\n    this.listenTo(this.model, 'change:_isEnabled', this.onEnabledChanged);\r\n\r\n    this.listenTo(this.model, 'question:refresh', this.refresh);\r\n\r\n    // Checks to see if the question should be reset on revisit\r\n    this.checkIfResetOnRevisit();\r\n    // This method helps setup default settings on the model\r\n    this._runModelCompatibleFunction('setupDefaultSettings');\r\n    // Blank method for setting up questions before rendering\r\n    this.setupQuestion();\r\n  }\r\n\r\n  // Used in the question view to disabled the question when _isEnabled has been set to false\r\n  onEnabledChanged(model, changedAttribute) {\r\n\r\n    // If isEnabled == false add disabled class\r\n    // else remove disabled class\r\n    if (!changedAttribute) {\r\n      this.$('.component__widget').addClass('is-disabled');\r\n      this.disableQuestion();\r\n    } else {\r\n      this.$('.component__widget').removeClass('is-disabled');\r\n      this.enableQuestion();\r\n    }\r\n\r\n  }\r\n\r\n  // Used by the question to disable the question during submit and complete stages\r\n  disableQuestion() {}\r\n\r\n  // Used by the question to enable the question during interactions\r\n  enableQuestion() {}\r\n\r\n  // Used to check if the question should reset on revisit\r\n  checkIfResetOnRevisit() {\r\n    const isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n    // If reset is enabled set defaults\r\n    // Call blank method for question to handle\r\n    if (isResetOnRevisit) {\r\n      this.model.reset(isResetOnRevisit, true);\r\n\r\n      // Defer is added to allow the component to render\r\n      _.defer(() => {\r\n        this.resetQuestionOnRevisit(isResetOnRevisit);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    // If complete - display learner's answer\r\n    // or reset the question if not complete\r\n    const isInteractionComplete = this.model.get('_isInteractionComplete');\r\n    if (isInteractionComplete) {\r\n      this.model.set('_buttonState', BUTTON_STATE.HIDE_CORRECT_ANSWER);\r\n      // Defer is added to allow the component to render\r\n      _.defer(() => {\r\n        this.onHideCorrectAnswerClicked();\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.model.set('_buttonState', BUTTON_STATE.SUBMIT);\r\n    // Defer is added to allow the component to render\r\n    _.defer(() => {\r\n      this.onResetClicked();\r\n    });\r\n  }\r\n\r\n  // Used by the question to reset the question when revisiting the component\r\n  resetQuestionOnRevisit(type) {}\r\n\r\n  // Left blank for question setup - should be used instead of preRender\r\n  setupQuestion() {}\r\n\r\n  // Calls default methods to setup after the question is rendered\r\n  postRender() {\r\n    this.addButtonsView();\r\n    this.onQuestionRendered();\r\n  }\r\n\r\n  // Used to setup buttonsView and sets up the internal events for the question\r\n  addButtonsView() {\r\n    this.buttonsView = new ButtonsView({ model: this.model, el: this.$('.btn__container') });\r\n\r\n    this.listenTo(this.buttonsView, 'buttons:stateUpdate', this.onButtonStateUpdate);\r\n\r\n  }\r\n\r\n  onButtonStateUpdate(buttonState) {\r\n\r\n    switch (buttonState) {\r\n      case BUTTON_STATE.SUBMIT:\r\n        this.onSubmitClicked();\r\n        break;\r\n      case BUTTON_STATE.RESET:\r\n        this.onResetClicked();\r\n        break;\r\n      case BUTTON_STATE.SHOW_CORRECT_ANSWER:\r\n        this.onShowCorrectAnswerClicked();\r\n        break;\r\n      case BUTTON_STATE.HIDE_CORRECT_ANSWER:\r\n        this.onHideCorrectAnswerClicked();\r\n        break;\r\n      case BUTTON_STATE.SHOW_FEEDBACK:\r\n        this.showFeedback();\r\n        break;\r\n    }\r\n\r\n  }\r\n\r\n  // Blank method used just like postRender is for presentational components\r\n  onQuestionRendered() {}\r\n\r\n  // Triggered when the submit button is clicked\r\n  onSubmitClicked() {\r\n    // canSubmit is setup in questions and should return a boolean\r\n    // If the question stops the user form submitting - show instruction error\r\n    // and give a blank method, onCannotSubmit to the question\r\n    const canSubmit = this._runModelCompatibleFunction('canSubmit');\r\n\r\n    if (!canSubmit) {\r\n      this.showInstructionError();\r\n      this.onCannotSubmit();\r\n      return;\r\n    }\r\n\r\n    // Used to update the amount of attempts the question has\r\n    this._runModelCompatibleFunction('updateAttempts');\r\n\r\n    // Used to set attributes on the model after being submitted\r\n    // Also adds a class of submitted\r\n    this._runModelCompatibleFunction('setQuestionAsSubmitted');\r\n\r\n    // Used to remove instruction error that is set when\r\n    // the user has interacted in the wrong way\r\n    this.removeInstructionError();\r\n\r\n    // Used to store the users answer for later\r\n    // This is a blank method given to the question\r\n    this._runModelCompatibleFunction('storeUserAnswer');\r\n\r\n    // Used to set question as correct:true/false\r\n    // Calls isCorrect which is blank for the question\r\n    // to fill out and return a boolean\r\n    this._runModelCompatibleFunction('markQuestion', 'isCorrect');\r\n\r\n    // Used by the question to set the score on the model\r\n    this._runModelCompatibleFunction('setScore');\r\n\r\n    // Used to check if the question is complete\r\n    // Triggers setCompletionStatus and adds class to widget\r\n    this._runModelCompatibleFunction('checkQuestionCompletion');\r\n\r\n    // Used by the question to display markings on the component\r\n    if (this.model.shouldShowMarking) {\r\n      this.showMarking();\r\n    }\r\n\r\n    this.recordInteraction();\r\n\r\n    // Used to setup the feedback by checking against\r\n    // question isCorrect or isPartlyCorrect\r\n    this._runModelCompatibleFunction('setupFeedback');\r\n\r\n    // Used to trigger an event so plugins can display feedback\r\n    // Do this before updating the buttons so that the focus can be\r\n    // shifted immediately\r\n    this.showFeedback();\r\n\r\n    // Force height re-calculations before the submit button\r\n    // becomes disabled.\r\n    $(window).resize();\r\n\r\n    // Used to update buttonsView based upon question state\r\n    // Update buttons happens before showFeedback to preserve tabindexes and after setupFeedback to allow buttons to use feedback attribute\r\n    this._runModelCompatibleFunction('updateButtons');\r\n\r\n    this.model.onSubmitted();\r\n    this.onSubmitted();\r\n  }\r\n\r\n  showInstructionError() {\r\n    Adapt.trigger('questionView:showInstructionError', this);\r\n  }\r\n\r\n  // Blank method for question to fill out when the question cannot be submitted\r\n  onCannotSubmit() {}\r\n\r\n  // Blank method for question to fill out when the question was successfully submitted\r\n  onSubmitted() {}\r\n\r\n  // Used to set _isEnabled and _isSubmitted on the model\r\n  // Also adds a 'submitted' class to the widget\r\n  setQuestionAsSubmitted() {\r\n    this.model.setQuestionAsSubmitted();\r\n    this.$('.component__widget').addClass('is-submitted');\r\n  }\r\n\r\n  // Removes validation error class when the user canSubmit\r\n  removeInstructionError() {\r\n    this.$('.component__instruction-inner').removeClass('validation-error');\r\n  }\r\n\r\n  // This is important and should give the user feedback on how they answered the question\r\n  // Normally done through ticks and crosses by adding classes\r\n  showMarking() {}\r\n\r\n  // Checks if the question should be set to complete\r\n  // Calls setCompletionStatus and adds complete classes\r\n  checkQuestionCompletion() {\r\n\r\n    const isComplete = this.model.checkQuestionCompletion();\r\n\r\n    if (isComplete) {\r\n      this.$('.component__widget').addClass('is-complete show-user-answer');\r\n    }\r\n\r\n  }\r\n\r\n  recordInteraction() {\r\n    if (this.model.get('_recordInteraction') === true || !this.model.has('_recordInteraction')) {\r\n      Adapt.trigger('questionView:recordInteraction', this);\r\n    }\r\n  }\r\n\r\n  // Used to show feedback based upon whether _canShowFeedback is true\r\n  showFeedback() {\r\n\r\n    if (this.model.get('_canShowFeedback')) {\r\n      Adapt.trigger('questionView:showFeedback', this);\r\n    } else {\r\n      Adapt.trigger('questionView:disabledFeedback', this);\r\n    }\r\n\r\n  }\r\n\r\n  onResetClicked() {\r\n    this.setQuestionAsReset();\r\n\r\n    this._runModelCompatibleFunction('resetUserAnswer');\r\n\r\n    this.resetQuestion();\r\n\r\n    this.model.checkCanSubmit();\r\n\r\n    this._runModelCompatibleFunction('updateButtons');\r\n\r\n    // onResetClicked is called as part of the checkIfResetOnRevisit\r\n    // function and as a button click. if the view is already rendered,\r\n    // then the button was clicked, focus on the first tabbable element\r\n    if (!this.model.get('_isReady')) return;\r\n    // Attempt to get the current page location\r\n    const currentModel = Adapt.findById(Adapt.location._currentId);\r\n    // Make sure the page is ready\r\n    if (!currentModel?.get('_isReady')) return;\r\n    // Focus on the first readable item in this element\r\n    Adapt.a11y.focusNext(this.$el);\r\n\r\n  }\r\n\r\n  setQuestionAsReset() {\r\n    this.model.setQuestionAsReset();\r\n    this.$('.component__widget').removeClass('is-submitted');\r\n  }\r\n\r\n  // Used by the question view to reset the look and feel of the component.\r\n  // This could also include resetting item data\r\n  // This is triggered when the reset button is clicked so it shouldn't\r\n  // be a full reset\r\n  resetQuestion() {}\r\n\r\n  refresh() {\r\n    this.model.set('_buttonState', this.model.getButtonState());\r\n\r\n    if (this.model.shouldShowMarking && this.model.get('_isSubmitted')) {\r\n      this.showMarking();\r\n    }\r\n\r\n    if (this.buttonsView) {\r\n      _.defer(this.buttonsView.refresh.bind(this.buttonsView));\r\n    }\r\n  }\r\n\r\n  onShowCorrectAnswerClicked() {\r\n    this.setQuestionAsShowCorrect();\r\n\r\n    this._runModelCompatibleFunction('updateButtons');\r\n\r\n    this.showCorrectAnswer();\r\n  }\r\n\r\n  setQuestionAsShowCorrect() {\r\n    this.$('.component__widget')\r\n      .addClass('is-submitted show-correct-answer')\r\n      .removeClass('show-user-answer');\r\n  }\r\n\r\n  // Used by the question to display the correct answer to the user\r\n  showCorrectAnswer() {}\r\n\r\n  onHideCorrectAnswerClicked() {\r\n    this.setQuestionAsHideCorrect();\r\n\r\n    this._runModelCompatibleFunction('updateButtons');\r\n\r\n    this.hideCorrectAnswer();\r\n  }\r\n\r\n  setQuestionAsHideCorrect() {\r\n    this.$('.component__widget')\r\n      .addClass('is-submitted show-user-answer')\r\n      .removeClass('show-correct-answer');\r\n  }\r\n\r\n  // Used by the question to display the users answer and\r\n  // hide the correct answer\r\n  // Should use the values stored in storeUserAnswer\r\n  hideCorrectAnswer() {}\r\n\r\n  // Time elapsed between the time the interaction was made available to the learner for response and the time of the first response\r\n  getLatency() {\r\n    return null;\r\n  }\r\n\r\n  // This function is overridden if useQuestionModeOnly: false. see below.\r\n  _runModelCompatibleFunction(name, lookForViewOnlyFunction) {\r\n    return this.model[name](); // questionModel Only\r\n  }\r\n}\r\n\r\nQuestionView._isQuestionType = true;\r\n\r\n/* BACKWARDS COMPATIBILITY SECTION\r\n* This section below is only for compatibility between the separated questionView+questionModel and the old questionView\r\n* Remove this section in when all components use questionModel and there is no need to have model behaviour in the questionView\r\n*/\r\n\r\nclass ViewOnlyQuestionViewCompatibilityLayer extends QuestionView {\r\n\r\n  /* All of these functions have been moved to the questionModel.js file.\r\n    * On the rare occasion that they have not been overridden by the component and\r\n          that they call the view only questionView version,\r\n          these functions are included as redirects to the new Question Model.\r\n          It is very unlikely that these are needed but they are included to ensure compatibility.\r\n    * If you need to override these in your component you should now make and register a component model.\r\n    * Please remove them from your question component's view.\r\n  */\r\n\r\n  // Returns an object specific to the question type.\r\n  getInteractionObject() {\r\n    Adapt.log.deprecated('QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject');\r\n    return this.model.getInteractionObject();\r\n  }\r\n\r\n  // Retturns a string detailing how the user answered the question.\r\n  getResponse() {\r\n    Adapt.log.deprecated('QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject');\r\n    return this.model.getResponse();\r\n  }\r\n\r\n  // Returns a string describing the type of interaction: \"choice\" and \"matching\" supported (see scorm wrapper)\r\n  getResponseType() {\r\n    Adapt.log.deprecated('QuestionView.getResponseType, please use QuestionModel.getResponseType');\r\n    return this.model.getResponseType();\r\n  }\r\n\r\n  // Calls default methods to setup on questions\r\n  setupDefaultSettings() {\r\n    Adapt.log.deprecated('QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings');\r\n    return this.model.setupDefaultSettings();\r\n  }\r\n\r\n  // Used to setup either global or local button text\r\n  setupButtonSettings() {\r\n    Adapt.log.deprecated('QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings');\r\n    return this.model.setupButtonSettings();\r\n  }\r\n\r\n  // Used to setup either global or local question weight/score\r\n  setupWeightSettings() {\r\n    Adapt.log.deprecated('QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings');\r\n    return this.model.setupWeightSettings();\r\n  }\r\n\r\n  // Use to check if the user is allowed to submit the question\r\n  // Maybe the user has to select an item?\r\n  canSubmit() {\r\n    Adapt.log.deprecated('QuestionView.canSubmit, please use QuestionModel.canSubmit');\r\n    return this.model.canSubmit();\r\n  }\r\n\r\n  // Used to update the amount of attempts the user has left\r\n  updateAttempts() {\r\n    Adapt.log.deprecated('QuestionView.updateAttempts, please use QuestionModel.updateAttempts');\r\n    return this.model.updateAttempts();\r\n  }\r\n\r\n  // This is important for returning or showing the users answer\r\n  // This should preserve the state of the users answers\r\n  storeUserAnswer() {\r\n    Adapt.log.deprecated('QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer');\r\n    return this.model.storeUserAnswer();\r\n  }\r\n\r\n  // Used by the question view to reset the stored user answer\r\n  resetUserAnswer() {\r\n    Adapt.log.deprecated('QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer');\r\n    return this.model.resetUserAnswer();\r\n  }\r\n\r\n  // Sets _isCorrect:true/false based upon isCorrect method below\r\n  markQuestion() {\r\n\r\n    if (this._isInViewOnlyCompatibleMode('isCorrect')) {\r\n\r\n      if (this.isCorrect()) {\r\n        this.model.set('_isCorrect', true);\r\n      } else {\r\n        this.model.set('_isCorrect', false);\r\n      }\r\n\r\n    } else {\r\n      return this.model.markQuestion();\r\n    }\r\n  }\r\n\r\n  // Should return a boolean based upon whether to question is correct or not\r\n  isCorrect() {\r\n    Adapt.log.deprecated('QuestionView.isCorrect, please use QuestionModel.isCorrect');\r\n    return this.model.isCorrect();\r\n  }\r\n\r\n  // Used to set the score based upon the _questionWeight\r\n  setScore() {\r\n    Adapt.log.deprecated('QuestionView.setScore, please use QuestionModel.setScore');\r\n    return this.model.setScore();\r\n  }\r\n\r\n  // Updates buttons based upon question state by setting\r\n  // _buttonState on the model which buttonsView listens to\r\n  updateButtons() {\r\n    Adapt.log.deprecated('QuestionView.updateButtons, please use QuestionModel.updateButtons');\r\n    return this.model.updateButtons();\r\n  }\r\n\r\n  // Used to setup the correct, incorrect and partly correct feedback\r\n  setupFeedback() {\r\n\r\n    if (this._isInViewOnlyCompatibleMode('isPartlyCorrect')) {\r\n\r\n      // Use view based feedback where necessary\r\n      if (this.model.get('_isCorrect')) {\r\n        this._runModelCompatibleFunction('setupCorrectFeedback');\r\n      } else if (this.isPartlyCorrect()) {\r\n        this._runModelCompatibleFunction('setupPartlyCorrectFeedback');\r\n      } else {\r\n        this._runModelCompatibleFunction('setupIncorrectFeedback');\r\n      }\r\n\r\n    } else {\r\n      // Use model based feedback\r\n      this.model.setupFeedback();\r\n    }\r\n\r\n  }\r\n\r\n  // Used by the question to determine if the question is incorrect or partly correct\r\n  // Should return a boolean\r\n  isPartlyCorrect() {\r\n    Adapt.log.deprecated('QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect');\r\n    return this.model.isPartlyCorrect();\r\n  }\r\n\r\n  setupCorrectFeedback() {\r\n    Adapt.log.deprecated('QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback');\r\n    return this.model.setupCorrectFeedback();\r\n  }\r\n\r\n  setupPartlyCorrectFeedback() {\r\n    Adapt.log.deprecated('QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback');\r\n    return this.model.setupPartlyCorrectFeedback();\r\n  }\r\n\r\n  setupIncorrectFeedback() {\r\n    Adapt.log.deprecated('QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback');\r\n    return this.model.setupIncorrectFeedback();\r\n  }\r\n\r\n  // Helper functions for compatibility layer\r\n  _runModelCompatibleFunction(name, lookForViewOnlyFunction) {\r\n    if (this._isInViewOnlyCompatibleMode(name, lookForViewOnlyFunction)) {\r\n      return this[name](); // questionView\r\n    } else {\r\n      return this.model[name](); // questionModel\r\n    }\r\n  }\r\n\r\n  _isInViewOnlyCompatibleMode(name, lookForViewOnlyFunction) {\r\n    // return false uses the model function questionModel\r\n    // return true uses the view only function questionView\r\n\r\n    const checkForFunction = (lookForViewOnlyFunction || name);\r\n\r\n    // if the function does NOT exist on the view at all, use the model only\r\n    if (!this.constructor.prototype[checkForFunction]) return false; // questionModel\r\n\r\n    // if the function DOES exist on the view and MATCHES the compatibility function above, use the model only\r\n    const hasCompatibleVersion = (ViewOnlyQuestionViewCompatibilityLayer.prototype.hasOwnProperty(checkForFunction));\r\n    const usingCompatibleVersion = (this.constructor.prototype[checkForFunction] === ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction]);\r\n    if (hasCompatibleVersion && usingCompatibleVersion) {\r\n      switch (checkForFunction) {\r\n        case 'setupFeedback':\r\n        case 'markQuestion':\r\n          return true; // questionView\r\n      }\r\n      return false; // questionModel\r\n    }\r\n\r\n    // if the function DOES exist on the view and does NOT match the compatibility function above, use the view function\r\n    return true; // questionView\r\n  }\r\n\r\n};\r\n\r\n// return question view class extended with the compatibility layer\r\nexport default ViewOnlyQuestionViewCompatibilityLayer;\r\n\r\n/* END OF BACKWARDS COMPATIBILITY SECTION */\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  /**\r\n   * DD: Component submit behaviour modified to adapt-dd-questionPlus standards. \r\n   */\r\n\r\n  var McqView = QuestionView.extend({\r\n\r\n    events: {\r\n      'focus .js-item-input': 'onItemFocus',\r\n      'blur .js-item-input': 'onItemBlur',\r\n      'change .js-item-input': 'onItemSelect',\r\n      'keyup .js-item-input': 'onKeyPress'\r\n    },\r\n\r\n    isCorrectAnswerShown: false,\r\n\r\n    initialize: function() {\r\n\r\n      QuestionView.prototype.initialize.apply(this, arguments);\r\n      this.update = _.debounce(this.update.bind(this), 1);\r\n      this.listenTo(this.model, {\r\n        \"change:_isEnabled change:_isComplete change:_isSubmitted\": this.update\r\n      });\r\n      this.listenTo(this.model.getChildren(), {\r\n        \"change:_isActive\": this.update\r\n      });\r\n    },\r\n\r\n    resetQuestionOnRevisit: function() {\r\n      this.resetQuestion();\r\n    },\r\n\r\n    setupQuestion: function() {\r\n      this.model.setupRandomisation();\r\n\r\n      // Modified:\r\n      // This view's model inherits itemsComponentModel, and as such will consider itself complete if all items have _isVisited: true.\r\n      // adapt-dd-questionPlus doesn't want this, so stop listening for _isVisited events on the items.\r\n      this.model.stopListening(this.model.getChildren(), \"change:_isVisited\", this.model.checkCompletionStatus);\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    },\r\n\r\n    onKeyPress: function(event) {\r\n      if (event.which !== 13) return;\r\n      //<ENTER> keypress\r\n      this.onItemSelect(event);\r\n    },\r\n\r\n    onItemFocus: function(event) {\r\n      if (!this.model.isInteractive()) return;\r\n\r\n      $('.js-item-label[for='+$(event.currentTarget).attr('id')+']').addClass('is-highlighted');\r\n    },\r\n\r\n    onItemBlur: function(event) {\r\n      $('.js-item-label[for='+$(event.currentTarget).attr('id')+']').removeClass('is-highlighted');\r\n    },\r\n\r\n    onItemSelect: function(event) {\r\n      if (!this.model.isInteractive()) return;\r\n\r\n      var index = $(event.currentTarget).data('adapt-index');\r\n      var itemModel = this.model.getItem(index);\r\n      var shouldSelect = !itemModel.get(\"_isActive\");\r\n\r\n      if (this.model.isSingleSelect()) {\r\n        // Assume a click is always a selection\r\n        shouldSelect = true;\r\n        this.model.resetActiveItems();\r\n      } else if (shouldSelect && this.model.isAtActiveLimit()) {\r\n        // At the selection limit, deselect the last item\r\n        this.model.getLastActiveItem().toggleActive(false);\r\n      }\r\n\r\n      // Select or deselect accordingly\r\n      itemModel.toggleActive(shouldSelect);\r\n    },\r\n\r\n    // Blank method to add functionality for when the user cannot submit\r\n    // Could be used for a popup or explanation dialog/hint\r\n    onCannotSubmit: function() {},\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking: function() {\r\n      this.update();\r\n      // adapt-dd-questionPlus:\r\n      this.updateMarking();\r\n    },\r\n\r\n    // Used by the question view to reset the look and feel of the component.\r\n    resetQuestion: function() {\r\n      this.model.resetActiveItems();\r\n      this.model.resetItems();\r\n    },\r\n\r\n    showCorrectAnswer: function() {\r\n      this.isCorrectAnswerShown = true;\r\n      this.update();\r\n    },\r\n\r\n    hideCorrectAnswer: function() {\r\n      this.isCorrectAnswerShown = false;\r\n      this.update();\r\n    },\r\n\r\n    update: function() {\r\n      this.updateSelection();\r\n      // \\/ questionPlus will call this.updateMarking() when necessary. It shouldn't be invoked here while it's in use.\r\n      //this.updateMarking();\r\n    },\r\n\r\n    /**\r\n     * DD: Modified.\r\n     */\r\n    updateSelection: function() {\r\n\r\n      var modelEnabled = this.model.get(\"_isEnabled\");\r\n\r\n      this.model.getChildren().each(function(itemModel) {\r\n\r\n        let isEnabled = !Boolean(itemModel.get(\"_isCorrect\")); // Disable items only when the item has been completed.\r\n        if (!modelEnabled) isEnabled = false;\r\n\r\n        var isSelected = this.isCorrectAnswerShown ?\r\n            itemModel.get(\"_shouldBeSelected\") :\r\n            itemModel.get(\"_isActive\");\r\n\r\n        var index = itemModel.get('_index');\r\n        this.$('.js-item-label').filter('[data-adapt-index=\"' + index + '\"]')\r\n            .toggleClass('is-selected', isSelected)\r\n            .toggleClass('is-disabled', !isEnabled)\r\n            // Custom \\/\r\n            .find(\".mcq__item-answer-icon, .mcqcode__item-answer-icon\")\r\n            .toggleClass('is-disabled', !isEnabled);\r\n\r\n        this.$('.js-item-input').filter('[data-adapt-index=\"' + index + '\"]')\r\n            .prop('checked', isSelected)\r\n            .prop('disabled', !isEnabled);\r\n\r\n      }.bind(this));\r\n\r\n    },\r\n\r\n    /**\r\n     * DD: Modified.\r\n     */\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-mcq-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n    },\r\n\r\n    /**\r\n     * DD: Modified.\r\n     */\r\n    updateMarking: function() {\r\n\r\n      var isInteractive = this.model.isInteractive();\r\n      var canShowMarking = this.model.get('_canShowMarking');\r\n      var ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n      this.model.getChildren().each((itemModel) => {\r\n\r\n        var index = itemModel.get('_index');\r\n        var $itemInput = this.$('.js-item-input').filter('[data-adapt-index=\"' + index + '\"]');\r\n        var $item = this.getItemElement(itemModel);\r\n\r\n        var shouldBeSelected = itemModel.get(\"_shouldBeSelected\");\r\n        var isCorrect = Boolean(itemModel.get(\"_isCorrect\"));\r\n        var isActive = Boolean(itemModel.get(\"_isActive\"));\r\n        if (isActive) itemModel.set(\"_isVisited\", true);\r\n        let isVisited = Boolean(itemModel.get(\"_isVisited\"));\r\n\r\n        // Only visited items should show their marking.\r\n        // (An item is considered as \"visited\" when it's been submitted while selected).\r\n\r\n        // Remove marking from non-visited items.\r\n        if (/*isInteractive || */ !isVisited || !canShowMarking) {\r\n          // Remove item marking\r\n          $item.removeClass('is-correct is-incorrect');\r\n          $itemInput.attr('aria-label', $.a11y_normalize(itemModel.get(\"text\")));\r\n          return;\r\n        }\r\n\r\n        // Mark visited items (that are selected).\r\n        // (DD questionPlus design choice).\r\n        if (!isActive) return;\r\n\r\n        $item\r\n          .toggleClass('is-correct', isCorrect)\r\n          .toggleClass('is-incorrect', !isCorrect);\r\n\r\n        var $itemlabel = $item.find(\".js-item-label\");\r\n        $itemlabel\r\n          .toggleClass('is-correct', isCorrect)\r\n          .toggleClass('is-incorrect', !isCorrect);\r\n\r\n        $itemInput.attr('aria-label', [\r\n          (shouldBeSelected ? ariaLabels.correct : ariaLabels.incorrect),\r\n          \", \",\r\n          (isActive ? ariaLabels.selectedAnswer : ariaLabels.unselectedAnswer),\r\n          \". \",\r\n          $.a11y_normalize(itemModel.get(\"text\"))\r\n        ].join(\"\"));\r\n\r\n      });\r\n\r\n      this.updateSelection();\r\n    }\r\n\r\n  });\r\n\r\n  return McqView;\r\n\r\n});\r\n","import Adapt from 'core/js/adapt';\r\nimport QuestionModel from 'core/js/models/questionModel';\r\nimport ItemsComponentModel from 'core/js/models/itemsComponentModel';\r\n\r\nclass BlendedItemsComponentQuestionModel extends QuestionModel {\r\n\r\n  init() {\r\n    ItemsComponentModel.prototype.init.call(this);\r\n    super.init();\r\n  }\r\n\r\n  reset(type, force) {\r\n    ItemsComponentModel.prototype.reset.call(this, type, force);\r\n    super.reset(type, force);\r\n  }\r\n\r\n}\r\n// extend BlendedItemsComponentQuestionModel with ItemsComponentModel\r\nObject.getOwnPropertyNames(ItemsComponentModel.prototype).forEach(name => {\r\n  if (name === 'constructor' || name === 'init' || name === 'reset') return;\r\n  Object.defineProperty(BlendedItemsComponentQuestionModel.prototype, name, {\r\n    value: ItemsComponentModel.prototype[name]\r\n  });\r\n});\r\n\r\nexport default class ItemsQuestionModel extends BlendedItemsComponentQuestionModel {\r\n\r\n  init() {\r\n    super.init();\r\n    this.set('_isRadio', this.isSingleSelect());\r\n    this.listenTo(this.getChildren(), 'change:_isActive', this.checkCanSubmit);\r\n    this.checkCanSubmit();\r\n  }\r\n\r\n  restoreUserAnswers() {\r\n    if (!this.get('_isSubmitted')) return;\r\n\r\n    const itemModels = this.getChildren();\r\n    const userAnswer = this.get('_userAnswer');\r\n    itemModels.each(item => {\r\n      item.toggleActive(userAnswer[item.get('_index')]);\r\n    });\r\n\r\n    this.setQuestionAsSubmitted();\r\n    this.markQuestion();\r\n    this.setScore();\r\n    this.setupFeedback();\r\n  }\r\n\r\n  setupRandomisation() {\r\n    if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n    const children = this.getChildren();\r\n    children.set(children.shuffle());\r\n  }\r\n\r\n  // check if the user is allowed to submit the question\r\n  canSubmit() {\r\n    const activeItems = this.getActiveItems();\r\n    return activeItems.length > 0;\r\n  }\r\n\r\n  // This is important for returning or showing the users answer\r\n  // This should preserve the state of the users answers\r\n  storeUserAnswer() {\r\n    const items = this.getChildren().slice(0);\r\n    items.sort((a, b) => a.get('_index') - b.get('_index'));\r\n    const userAnswer = items.map(itemModel => itemModel.get('_isActive'));\r\n    this.set('_userAnswer', userAnswer);\r\n  }\r\n\r\n  isCorrect() {\r\n    const allChildren = this.getChildren();\r\n    const activeChildren = allChildren.filter(itemModel => itemModel.get('_isActive'));\r\n\r\n    const isItemCorrect = itemModel => itemModel.get('_shouldBeSelected') && !itemModel.get('_isPartlyCorrect');\r\n    const isItemPartlyCorrect = itemModel => itemModel.get('_isPartlyCorrect');\r\n    const isItemIncorrect = itemModel => !itemModel.get('_shouldBeSelected') && !itemModel.get('_isPartlyCorrect');\r\n\r\n    const sum = (list, predicate) => list.reduce((sum, item) => sum + (predicate(item) ? 1 : 0), 0);\r\n\r\n    const props = {\r\n      _numberOfRequiredAnswers: sum(allChildren, isItemCorrect),\r\n      _numberOfCorrectAnswers: sum(activeChildren, isItemCorrect),\r\n      _numberOfPartlyCorrectAnswers: sum(activeChildren, isItemPartlyCorrect),\r\n      _numberOfIncorrectAnswers: sum(activeChildren, isItemIncorrect)\r\n    };\r\n\r\n    activeChildren.forEach(itemModel => itemModel.set('_isCorrect', itemModel.get('_shouldBeSelected')));\r\n\r\n    props._isAtLeastOneCorrectSelection = (props._numberOfCorrectAnswers || props._numberOfPartlyCorrectAnswers);\r\n\r\n    const numberOfSelectableAnswers = this.get('_selectable');\r\n    const hasSelectableCorrectAnswers = (props._numberOfCorrectAnswers === numberOfSelectableAnswers);\r\n    const hasAllCorrectAnswers = (props._numberOfCorrectAnswers === props._numberOfRequiredAnswers);\r\n    const hasCorrectAnswers = (hasSelectableCorrectAnswers || hasAllCorrectAnswers);\r\n    const hasIncorrectAnswers = props._numberOfIncorrectAnswers;\r\n    const hasPartlyCorrectAnswers = props._numberOfPartlyCorrectAnswers;\r\n\r\n    this.set(props);\r\n\r\n    return hasCorrectAnswers && !hasIncorrectAnswers && !hasPartlyCorrectAnswers;\r\n  }\r\n\r\n  // Sets the score based upon the questionWeight\r\n  // Can be overwritten if the question needs to set the score in a different way\r\n  setScore() {\r\n    const questionWeight = this.get('_questionWeight');\r\n    const answeredCorrectly = this.get('_isCorrect');\r\n    const score = answeredCorrectly ? questionWeight : 0;\r\n    this.set('_score', score);\r\n  }\r\n\r\n  setupFeedback() {\r\n    if (!this.has('_feedback')) return;\r\n\r\n    if (this.get('_isCorrect')) {\r\n      this.setupCorrectFeedback();\r\n      return;\r\n    }\r\n\r\n    if (this.isPartlyCorrect()) {\r\n      this.setupPartlyCorrectFeedback();\r\n      return;\r\n    }\r\n\r\n    // apply individual item feedback\r\n    const activeItem = this.getActiveItem();\r\n    if (this.isSingleSelect() && activeItem.get('feedback')) {\r\n      this.setupIndividualFeedback(activeItem);\r\n      return;\r\n    }\r\n\r\n    this.setupIncorrectFeedback();\r\n  }\r\n\r\n  setupIndividualFeedback(selectedItem) {\r\n    this.set({\r\n      feedbackTitle: this.getFeedbackTitle(this.get('_feedback')),\r\n      feedbackMessage: selectedItem.get('feedback')\r\n    });\r\n  }\r\n\r\n  isPartlyCorrect() {\r\n    return this.get('_isAtLeastOneCorrectSelection');\r\n  }\r\n\r\n  resetUserAnswer() {\r\n    this.set('_userAnswer', []);\r\n  }\r\n\r\n  isAtActiveLimit() {\r\n    const selectedItems = this.getActiveItems();\r\n    return (selectedItems.length === this.get('_selectable'));\r\n  }\r\n\r\n  isSingleSelect() {\r\n    return (this.get('_selectable') === 1);\r\n  }\r\n\r\n  getLastActiveItem() {\r\n    const selectedItems = this.getActiveItems();\r\n    return selectedItems[selectedItems.length - 1];\r\n  }\r\n\r\n  resetItems() {\r\n    this.resetActiveItems();\r\n    this.set('_isAtLeastOneCorrectSelection', false);\r\n  }\r\n\r\n  getInteractionObject() {\r\n    const interactions = {\r\n      correctResponsesPattern: [],\r\n      choices: []\r\n    };\r\n\r\n    interactions.choices = this.getChildren().map(itemModel => {\r\n      return {\r\n        id: (itemModel.get('_index') + 1).toString(),\r\n        description: itemModel.get('text')\r\n      };\r\n    });\r\n\r\n    const correctItems = this.getChildren().filter(itemModel => {\r\n      return itemModel.get('_shouldBeSelected');\r\n    });\r\n\r\n    interactions.correctResponsesPattern = [\r\n      correctItems.map(itemModel => {\r\n        // indexes are 0-based, we need them to be 1-based for cmi.interactions\r\n        return String(itemModel.get('_index') + 1);\r\n      }).join('[,]')\r\n    ];\r\n\r\n    return interactions;\r\n  }\r\n\r\n  /**\r\n  * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n  * returns the user's answers as a string in the format '1,5,2'\r\n  */\r\n  getResponse() {\r\n    const activeItems = this.getActiveItems();\r\n    const activeIndexes = activeItems.map(itemModel => {\r\n      // indexes are 0-based, we need them to be 1-based for cmi.interactions\r\n      return itemModel.get('_index') + 1;\r\n    });\r\n    return activeIndexes.join(',');\r\n  }\r\n\r\n  /**\r\n  * used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n  */\r\n  getResponseType() {\r\n    return 'choice';\r\n  }\r\n\r\n  /**\r\n   * Creates a string explaining the answer(s) the learner should have chosen\r\n   * Used by ButtonsView to retrieve question-specific correct answer text for the ARIA\r\n   * 'live region' that gets updated when the learner selects the 'show correct answer' button\r\n   * @return {string}\r\n   */\r\n  getCorrectAnswerAsText() {\r\n    const globals = Adapt.course.get('_globals')._components['_' + this.get('_component')];\r\n    let ariaAnswer;\r\n    let correctAnswer;\r\n\r\n    if (this.isSingleSelect()) {\r\n      ariaAnswer = globals.ariaCorrectAnswer;\r\n      const correctOption = this.getChildren().findWhere({ _shouldBeSelected: true });\r\n      correctAnswer = correctOption.get('text');\r\n    } else {\r\n      ariaAnswer = globals.ariaCorrectAnswers;\r\n      const correctOptions = this.getChildren().where({ _shouldBeSelected: true });\r\n      correctAnswer = correctOptions.map(correctOption => correctOption.get('text')).join('<br/>');\r\n    }\r\n\r\n    return Handlebars.compile(ariaAnswer)({ correctAnswer });\r\n  }\r\n\r\n  /**\r\n   * Creates a string listing the answer(s) the learner chose\r\n   * Used by ButtonsView to retrieve question-specific user answer text for the ARIA\r\n   * 'live region' that gets updated when the learner selects the 'hide correct answer' button\r\n   * @return {string}\r\n   */\r\n  getUserAnswerAsText() {\r\n    const globals = Adapt.course.get('_globals')._components['_' + this.get('_component')];\r\n    let ariaAnswer;\r\n    let userAnswer;\r\n\r\n    const selectedItems = this.getActiveItems();\r\n    if (selectedItems.length === 1) {\r\n      ariaAnswer = globals.ariaUserAnswer;\r\n      userAnswer = selectedItems[0].get('text');\r\n    } else {\r\n      ariaAnswer = globals.ariaUserAnswers;\r\n      userAnswer = selectedItems.map(selectedItem => selectedItem.get('text')).join('<br/>');\r\n    }\r\n\r\n    return Handlebars.compile(ariaAnswer)({ userAnswer });\r\n  }\r\n\r\n}\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/itemsQuestionModel'\r\n], function(Adapt, ItemsQuestionModel) {\r\n\r\n  /**\r\n   * DD Modified:\r\n   * ------------\r\n   * Set the value of \"_selectable\" to be = to the amount of items this model has.\r\n   * This is done due to the value of \"_isRadio\" being automatically set in Adapts itemsQuestionModel.js initialize() based on its value.\r\n   * (And we want the reverse; for the value of \"_selectable\" to be determined by the value of \"_isRadio\").\r\n   */\r\n\r\n  var McqModel = ItemsQuestionModel.extend({\r\n\r\n    initialize: function() {\r\n\r\n      this.set(\"_selectable\", this.get(\"_isRadio\") ? 1 : this.get(\"_items\").length);\r\n\r\n      if (this.isSingleSelect()){\r\n        // DD modified:\r\n        // ------------\r\n        // Need to copy each item's \"_feedback\" property into \"feedback\".\r\n        // This is done for compatibility with QuestionPlus.\r\n        // (core/js/models/itemsQuestionModel.js checks both, and this is the best way to override it without modifying it).\r\n        _.each(this.get(\"_items\"), (item) => {\r\n          \r\n          if (item._feedback){\r\n            if (!item._feedback.title)        delete item._feedback.title;\r\n            if (!item._feedback.body)         delete item._feedback.body;\r\n            if (!item._feedback.instruction)  delete item._feedback.instruction;\r\n          }\r\n\r\n          // Set up unique feedback defaults.\r\n          if (item._shouldBeSelected) {item._feedback = _.extend({}, this.get(\"_feedback\")._correct, item._feedback);}\r\n          else {item._feedback = _.extend({}, this.get(\"_feedback\")._incorrect, item._feedback);}\r\n\r\n          item.feedback = item._feedback;\r\n        });\r\n\r\n        // DD modified:\r\n        // -----------\r\n        // Override component _feedback with item specific feedback if applicable (singleSelect only).\r\n        let itemCorrectFeedback = _.find(this.get(\"_items\"), (item) => {return item._shouldBeSelected;})._feedback;\r\n        let globalCorrectFeedback = this.get(\"_feedback\")._correct;\r\n        \r\n        this.get(\"_feedback\")._correct = {\r\n          title: itemCorrectFeedback?.title || globalCorrectFeedback?.title,\r\n          body: itemCorrectFeedback?.body || globalCorrectFeedback?.body\r\n        }\r\n      }\r\n\r\n      ItemsQuestionModel.prototype.initialize.apply(this, arguments);\r\n    },\r\n\r\n    // DD modified:\r\n    // ------------\r\n    // Override ItemsQuestionModel's function for QuestionPlus compatibility.\r\n    setupIndividualFeedback(selectedItem) {\r\n\r\n      if (this.get(\"_isCorrect\")) return;\r\n      if (!this.isSingleSelect()) return;\r\n\r\n      // Set the global component _feedback._incorrect values (this is what QuestionPlus will read).\r\n      let itemFeedback = selectedItem.get(\"_feedback\");\r\n      this.get(\"_feedback\")._incorrect = _.extend({}, this.get(\"_feedback\")._incorrect, itemFeedback);\r\n\r\n      // Re-set up the feedback for this component.\r\n      Adapt.questionPlus.setUpFeedback(this);\r\n\r\n      this.set({\r\n        feedbackTitle: selectedItem.get(\"_feedback\")?.title || this.getFeedbackTitle(this.get('_feedback')),\r\n        feedbackMessage: this.get(\"_feedback\")._incorrect.final\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n  return McqModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './mcqView',\r\n  './mcqModel'\r\n], function(Adapt, McqView, McqModel) {\r\n\r\n  return Adapt.register(\"mcq\", {\r\n    view: McqView,\r\n    model: McqModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'components/adapt-contrib-mcq/js/adapt-contrib-mcq'\r\n], function(Adapt, Mcq) {\r\n\r\n  var Gmcq = Mcq.view.extend({\r\n\r\n    setupQuestion: function() {\r\n      Mcq.view.prototype.setupQuestion.call(this);\r\n\r\n      this.listenTo(Adapt, {\r\n        'device:changed': this.resizeImage,\r\n        'device:resize': this.onDeviceResize\r\n      });\r\n\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n\r\n      this.resizeImage(Adapt.device.screenSize);\r\n      this.setUpColumns();\r\n\r\n      this.$('.js-item-label').imageready(this.setReadyStatus.bind(this));\r\n\r\n    },\r\n\r\n    onDeviceResize: function() {\r\n      this.setUpColumns();\r\n    },\r\n\r\n    resizeImage: function(width) {\r\n      var imageWidth = width === 'medium' ? 'small' : width;\r\n\r\n      this.$('.js-item-label').each(function(index) {\r\n        var $img = $(this).find('img');\r\n        var newSrc = $img.attr('data-' + imageWidth);\r\n        if (!newSrc) return;\r\n        $img.attr('src', newSrc);\r\n      });\r\n\r\n    },\r\n\r\n    setUpColumns: function() {\r\n      var columns = this.model.get('_columns');\r\n\r\n      if (!columns) return;\r\n\r\n      var isLarge = Adapt.device.screenSize === 'large';\r\n\r\n      this.$el.toggleClass('has-column-layout', isLarge);\r\n      this.$('.js-mcq-item').css('width', isLarge ? (100 / columns) + '%' : '');\r\n    }\r\n\r\n  }, {\r\n    template: 'gmcq'\r\n  });\r\n\r\n  return Adapt.register(\"gmcq\", {\r\n    view: Gmcq,\r\n    model: Mcq.model.extend({})\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentView, ComponentModel) {\r\n\r\n  /**\r\n   * Modified to support the adapt-dd-img extension (if the src has the *--r.svg suffix).\r\n   */\r\n\r\n  var GraphicView = ComponentView.extend({\r\n\r\n    preRender: function() {\r\n\r\n      // DD: Modified:\r\n      // -------------------------------------------------------------\r\n      // Replace the image with an adapt-dd-img helper if the src suffix is *--r.svg.\r\n      // FIXME: Maybe all images should just use the img helper for consistency.\r\n      if (this.model.get(\"_graphic\")?.large.match(/--r\\.svg$/)) {\r\n        this.model.set(\"_isDDImg\", true);\r\n      }\r\n      // Allow for image sizing to be used on the image itself.\r\n      /*let sizing = this.model.get(\"_graphic\")?._sizing;\r\n      if (sizing) {\r\n        sizing._classes = Adapt.sizing.getSizingClass(sizing);\r\n        this.model.get(\"_graphic\")._sizing = sizing;\r\n      }*/\r\n      // -------------------------------------------------------------\r\n\r\n      this.listenTo(Adapt, 'device:changed', this.resizeImage);\r\n\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    postRender: function() {\r\n      this.resizeImage(Adapt.device.screenSize, true);\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    resizeImage: function(width, setupInView) {\r\n      var imageWidth = width === 'medium' ? 'small' : width;\r\n      var imageSrc = (this.model.get('_graphic')) ? this.model.get('_graphic')[imageWidth] : '';\r\n      this.$('.js-graphic-set-image-src, .js-graphic-set-image-src img').attr('src', imageSrc); // Modified\r\n\r\n      this.$('.graphic__widget').imageready(function() {\r\n        this.setReadyStatus();\r\n\r\n        if (setupInView) {\r\n          // DD: Modified (if there's no graphic; track completion on the header instead)\r\n          this.setupInviewCompletion(this.model.get(\"_graphic\") ? '.graphic__widget' : '.graphic__header');\r\n        }\r\n      }.bind(this));\r\n    }\r\n  });\r\n\r\n  return Adapt.register('graphic', {\r\n    model: ComponentModel.extend({}),// create a new class in the inheritance chain so it can be extended per component type if necessary later\r\n    view: GraphicView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n  'use strict';\r\n\r\n  var HotgraphicPopupView = Backbone.View.extend({\r\n\r\n    className: 'hotgraphic-popup',\r\n\r\n    events: {\r\n      'click .js-hotgraphic-popup-close': 'closePopup',\r\n      'click .js-hotgraphic-controls-click': 'onControlClick'\r\n    },\r\n\r\n    initialize: function() {\r\n      // Debounce required as a second (bad) click event is dispatched on iOS causing a jump of two items.\r\n      this.onControlClick = _.debounce(this.onControlClick.bind(this), 100);\r\n      this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n      this.render();\r\n    },\r\n\r\n    onOpened: function() {\r\n      this.applyNavigationClasses(this.model.getActiveItem().get('_index'));\r\n      this.updatePageCount();\r\n      this.handleTabs();\r\n    },\r\n\r\n    applyNavigationClasses: function (index) {\r\n      var itemCount = this.model.get('_items').length;\r\n      var canCycleThroughPagination = this.model.get('_canCycleThroughPagination');\r\n\r\n      var shouldEnableBack = index > 0 || canCycleThroughPagination;\r\n      var shouldEnableNext = index < itemCount - 1 || canCycleThroughPagination;\r\n      var $controls = this.$('.hotgraphic-popup__controls');\r\n\r\n      this.$('hotgraphic-popup__nav')\r\n          .toggleClass('first', !shouldEnableBack)\r\n          .toggleClass('last', !shouldEnableNext);\r\n\r\n      Adapt.a11y.toggleAccessibleEnabled($controls.filter('.back'), shouldEnableBack);\r\n      Adapt.a11y.toggleAccessibleEnabled($controls.filter('.next'), shouldEnableNext);\r\n    },\r\n\r\n    updatePageCount: function() {\r\n      var template = Adapt.course.get(\"_globals\")._components._hotgraphic.popupPagination || '{{itemNumber}} / {{totalItems}}';\r\n      var labelText = Handlebars.compile(template)({\r\n        itemNumber: this.model.getActiveItem().get('_index') + 1,\r\n        totalItems: this.model.get(\"_items\").length\r\n      });\r\n      this.$('.hotgraphic-popup__count').html(labelText);\r\n    },\r\n\r\n    handleTabs: function() {\r\n      Adapt.a11y.toggleHidden(this.$('.hotgraphic-popup__item:not(.is-active) *'), true);\r\n      Adapt.a11y.toggleHidden(this.$('.hotgraphic-popup__item.is-active *'), false);\r\n    },\r\n\r\n    onItemsActiveChange: function(item, _isActive) {\r\n      if (!_isActive) return;\r\n      var index = item.get('_index');\r\n      this.updatePageCount();\r\n      this.applyItemClasses(index);\r\n      this.handleTabs();\r\n      this.handleFocus(index);\r\n    },\r\n\r\n    applyItemClasses: function(index) {\r\n      this.$('.hotgraphic-popup__item[data-index=\"' + index + '\"]').addClass('is-active').removeAttr('aria-hidden');\r\n      this.$('.hotgraphic-popup__item[data-index=\"' + index + '\"] .hotgraphic-popup__item-title').attr(\"id\", \"notify-heading\");\r\n      this.$('.hotgraphic-popup__item:not([data-index=\"' + index + '\"])').removeClass('is-active').attr('aria-hidden', 'true');\r\n      this.$('.hotgraphic-popup__item:not([data-index=\"' + index + '\"]) .hotgraphic-popup__item-title').removeAttr(\"id\");\r\n    },\r\n\r\n    handleFocus: function(index) {\r\n      Adapt.a11y.focusFirst(this.$('.hotgraphic-popup__inner .is-active'));\r\n      this.applyNavigationClasses(index);\r\n    },\r\n\r\n    onItemsVisitedChange: function(item, _isVisited) {\r\n      if (!_isVisited) return;\r\n\r\n      this.$('.hotgraphic-popup__item')\r\n          .filter('[data-index=\"' + item.get('_index') + '\"]')\r\n          .addClass('is-visited');\r\n    },\r\n\r\n    render: function() {\r\n      var data = this.model.toJSON();\r\n      data.view = this;\r\n      var template = Handlebars.templates['hotgraphicPopup'];\r\n      this.$el.html(template(data));\r\n    },\r\n\r\n    closePopup: function(event) {\r\n      Adapt.trigger('notify:close');\r\n    },\r\n\r\n    onControlClick: function(event) {\r\n      var direction = $(event.currentTarget).hasClass('back') ? 'back' : 'next';\r\n      var index = this.getNextIndex(direction);\r\n\r\n      if (index !== -1) {\r\n        this.setItemState(index);\r\n      }\r\n    },\r\n\r\n    getNextIndex: function(direction) {\r\n      var index = this.model.getActiveItem().get('_index');\r\n      var lastIndex = this.model.get('_items').length - 1;\r\n\r\n      switch (direction) {\r\n        case 'back':\r\n          if (index > 0) return --index;\r\n          if (this.model.get('_canCycleThroughPagination')) return lastIndex;\r\n          break;\r\n        case 'next':\r\n          if (index < lastIndex) return ++index;\r\n          if (this.model.get('_canCycleThroughPagination')) return 0;\r\n      }\r\n      return -1;\r\n    },\r\n\r\n    setItemState: function(index) {\r\n      this.model.getActiveItem().toggleActive();\r\n\r\n      var nextItem = this.model.getItem(index);\r\n      nextItem.toggleActive();\r\n      nextItem.toggleVisited(true);\r\n    }\r\n\r\n  });\r\n\r\n  return HotgraphicPopupView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  './hotgraphicPopupView'\r\n], function(Adapt, ComponentView, HotgraphicPopupView) {\r\n  'use strict';\r\n\r\n  var HotGraphicView = ComponentView.extend({\r\n\r\n    events: {\r\n      'click .js-hotgraphic-item-click': 'onPinClicked'\r\n    },\r\n\r\n    initialize: function() {\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpViewData();\r\n      this.setUpModelData();\r\n      this.setUpEventListeners();\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    setUpViewData: function() {\r\n      this.popupView = null;\r\n      this._isPopupOpen = false;\r\n    },\r\n\r\n    setUpModelData: function() {\r\n      if (this.model.get('_canCycleThroughPagination') === undefined) {\r\n        this.model.set('_canCycleThroughPagination', false);\r\n      }\r\n    },\r\n\r\n    setUpEventListeners: function() {\r\n      this.listenTo(Adapt, 'device:changed', this.reRender);\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    },\r\n\r\n    reRender: function() {\r\n      if (Adapt.device.screenSize !== 'large') {\r\n        this.replaceWithNarrative();\r\n      }\r\n    },\r\n\r\n    replaceWithNarrative: function() {\r\n      var NarrativeView = Adapt.getViewClass('narrative');\r\n\r\n      var model = this.prepareNarrativeModel();\r\n      var newNarrative = new NarrativeView({ model: model });\r\n      var $container = $(\".component__container\", $(\".\" + this.model.get(\"_parentId\")));\r\n\r\n      newNarrative.reRender();\r\n      newNarrative.setupNarrative();\r\n      $container.append(newNarrative.$el);\r\n      Adapt.trigger('device:resize');\r\n      _.defer(this.remove.bind(this));\r\n    },\r\n\r\n    prepareNarrativeModel: function() {\r\n      var model = this.model;\r\n      model.set({\r\n        '_component': 'narrative',\r\n        '_wasHotgraphic': true,\r\n        'originalBody': model.get('body'),\r\n        'originalInstruction': model.get('instruction')\r\n      });\r\n\r\n      // Check if active item exists, default to 0\r\n      var activeItem = model.getActiveItem();\r\n      if (!activeItem) {\r\n        model.getItem(0).toggleActive(true);\r\n      }\r\n\r\n      // Swap mobile body and instructions for desktop variants.\r\n      if (model.get('mobileBody')) {\r\n        model.set('body', model.get('mobileBody'));\r\n      }\r\n      if (model.get('mobileInstruction')) {\r\n        model.set('instruction', model.get('mobileInstruction'));\r\n      }\r\n\r\n      return model;\r\n    },\r\n\r\n    onItemsActiveChange: function(model, _isActive) {\r\n      this.getItemElement(model).toggleClass('is-active', _isActive);\r\n    },\r\n\r\n    getItemElement: function(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-hotgraphic-item-click').filter('[data-index=\"' + index + '\"]');\r\n    },\r\n\r\n    onItemsVisitedChange: function(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $pin = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the pin's aria-label\r\n      var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $pin.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });\r\n\r\n      $pin.addClass('is-visited');\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    preRender: function() {\r\n      if (Adapt.device.screenSize === 'large') {\r\n        this.render();\r\n      } else {\r\n        this.reRender();\r\n      }\r\n    },\r\n\r\n    postRender: function() {\r\n      this.$('.hotgraphic__widget').imageready(this.setReadyStatus.bind(this));\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n    },\r\n\r\n    onPinClicked: function (event) {\r\n      if (event) event.preventDefault();\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('index'));\r\n      item.toggleActive(true);\r\n      item.toggleVisited(true);\r\n\r\n      this.openPopup();\r\n    },\r\n\r\n    openPopup: function() {\r\n      if (this._isPopupOpen) return;\r\n\r\n      this._isPopupOpen = true;\r\n\r\n      this.popupView = new HotgraphicPopupView({\r\n        model: this.model\r\n      });\r\n\r\n      Adapt.trigger(\"notify:popup\", {\r\n        _view: this.popupView,\r\n        _isCancellable: true,\r\n        _showCloseButton: false,\r\n        _classes: 'hotgraphic ' + this.model.get('_classes')\r\n      });\r\n\r\n      this.listenToOnce(Adapt, {\r\n        'popup:closed': this.onPopupClosed\r\n      });\r\n    },\r\n\r\n    onPopupClosed: function() {\r\n      this.model.getActiveItem().toggleActive();\r\n      this._isPopupOpen = false;\r\n    }\r\n\r\n  });\r\n\r\n  return HotGraphicView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './hotgraphicView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, HotgraphicView, ItemsComponentModel) {\r\n\r\n  return Adapt.register('hotgraphic', {\r\n    model: ItemsComponentModel.extend({}),\r\n    view: HotgraphicView\r\n  });\r\n\r\n});\r\n","define(function() {\r\n\r\n  var DropDownItem = Backbone.View.extend({\r\n\r\n    events: {\r\n      'click': 'onClick',\r\n      'click *': 'onClick'\r\n    },\r\n\r\n    initialize: function(settings) {\r\n      this.settings = settings;\r\n      this.$inner = this.$('.js-dropdown-list-item-inner');\r\n    },\r\n\r\n    isPlaceholder: function() {\r\n      return this.$el.is('[hidden]');\r\n    },\r\n\r\n    parent: function() {\r\n      return this.settings.parent;\r\n    },\r\n\r\n    onClick: function(event) {\r\n      var parent = this.parent();\r\n      event.preventDefault();\r\n      this.select().scrollTo();\r\n      parent.$button.focus();\r\n    },\r\n\r\n    getValue: function() {\r\n      return this.$el.attr('value').trim();\r\n    },\r\n\r\n    select: function() {\r\n      var parent = this.parent();\r\n      parent.deselectAll();\r\n      parent.setActiveDescendantId(this.el.id);\r\n      this.$el.attr({\r\n        selected: '',\r\n        'aria-selected': 'true'\r\n      });\r\n      parent.$inner.html(this.$el.attr('text'));\r\n      var value = this.isPlaceholder() ? '' : this.getValue();\r\n      parent.$input.val(value).trigger('change');\r\n      parent.trigger('change', parent);\r\n      return this;\r\n    },\r\n\r\n    deselect: function() {\r\n      if (!this.isSelected()) return this;\r\n      var parent = this.parent();\r\n      parent.removeActiveDescendantId();\r\n      this.$el.removeAttr('selected');\r\n      this.$el.attr('aria-selected', 'false');\r\n      parent.$inner.html('');\r\n      parent.$input.val('').trigger('change');\r\n      parent.trigger('change', parent);\r\n      return this;\r\n    },\r\n\r\n    reselect: function() {\r\n      var parent = this.parent();\r\n      parent.setActiveDescendantId(this.$el[0].id);\r\n      if (this.isSelected()) return this;\r\n      this.select();\r\n      return this;\r\n    },\r\n\r\n    isSelected: function() {\r\n      return Boolean(this.$el.attr('selected'));\r\n    },\r\n\r\n    getIndex: function() {\r\n      var parent = this.parent();\r\n      return _.findIndex(parent.options, function(option) {\r\n        return (option === this);\r\n      }.bind(this));\r\n    },\r\n\r\n    getNext: function() {\r\n      var parent = this.parent();\r\n      return parent.options[this.getIndex() + 1];\r\n    },\r\n\r\n    getPrevious: function() {\r\n      var parent = this.parent();\r\n      return parent.options[this.getIndex() - 1];\r\n    },\r\n\r\n    getFirst: function() {\r\n      var parent = this.parent();\r\n      return parent.options[0];\r\n    },\r\n\r\n    getLast: function() {\r\n      var parent = this.parent();\r\n      return parent.options[parent.options.length - 1];\r\n    },\r\n\r\n    scrollTo: function() {\r\n      var parent = this.parent();\r\n      parent.settings.scrollToItem.call(parent, this);\r\n    },\r\n\r\n    destroy: function() {\r\n      var parent = this.parent();\r\n      this.remove();\r\n      if (this.isPlaceholder()) {\r\n        parent.placeholder = null;\r\n      } else {\r\n        for (var i = 0, l = parent.options.length; i < l; i++) {\r\n          var item = parent.options[i];\r\n          if (item !== this) continue;\r\n          parent.options.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n      delete this.settings;\r\n    }\r\n\r\n  });\r\n\r\n  return DropDownItem;\r\n\r\n});\r\n","define([\r\n  './dropdownOption'\r\n], function(DropDownOption) {\r\n\r\n  var DropDown = Backbone.View.extend({\r\n\r\n    initialize: function(settings) {\r\n      _.bindAll(this, 'onStartInteraction', 'onButtonClick', 'onListBlur', 'onKeyDown');\r\n      this.settings = _.defaults(settings, this.getDefaults());\r\n      this.placeholder = null;\r\n      this.options = [];\r\n      this.setUpElements();\r\n      this.setUpItems();\r\n      this.select(this.settings.value);\r\n      this.addEventListeners();\r\n      this.toggleOpen(false);\r\n      this.settings.load.call(this, this);\r\n      this.trigger('load', this);\r\n    },\r\n\r\n    getDefaults: function() {\r\n      return {\r\n        load: DropDown.defaults.load,\r\n        openList: DropDown.defaults.openList,\r\n        closeList: DropDown.defaults.closeList,\r\n        scrollToItem: DropDown.defaults.scrollToItem\r\n      };\r\n    },\r\n\r\n    setUpElements: function() {\r\n      this.$list = this.$('.js-dropdown-list');\r\n      this.$button = this.$('.js-dropdown-btn');\r\n      this.$inner = this.$button.find('.js-dropdown-inner');\r\n      this.$input = this.$('.js-data-output');\r\n    },\r\n\r\n    setUpItems: function() {\r\n      var $options = this.$('.js-dropdown-list-item');\r\n      $options.each(function(index, el) {\r\n        var option = new DropDownOption({\r\n          parent: this,\r\n          el: el\r\n        });\r\n        if (option.isPlaceholder()) {\r\n          this.placeholder = option;\r\n          return;\r\n        }\r\n        this.options.push(option);\r\n      }.bind(this));\r\n    },\r\n\r\n    addEventListeners: function() {\r\n      this.$button.on({\r\n        'mousedown touchstart': this.onStartInteraction,\r\n        click: this.onButtonClick\r\n      });\r\n      this.$list.on('blur', this.onListBlur);\r\n      $(document).on('keydown', this.onKeyDown);\r\n    },\r\n\r\n    onStartInteraction: function() {\r\n      this.wasOpen = this.isOpen();\r\n    },\r\n\r\n    deselectAll: function() {\r\n      this.placeholder.deselect();\r\n      this.options.forEach(function(option) {\r\n        option.deselect();\r\n      });\r\n    },\r\n\r\n    onButtonClick: function(event) {\r\n      if (this.wasOpen || this.isOpen()) {\r\n        // click toggle list:\r\n        // if the list is open and the button is clicked\r\n        // the blur event will fire first closing the list.\r\n        // this code is to prevent the list from reopening\r\n        // in that situation\r\n        this.wasOpen = false;\r\n        return;\r\n      }\r\n      this.toggleOpen();\r\n      var option = this.getFirstSelectedItem() || this.placeholder;\r\n      if (!option) return;\r\n      option.reselect();\r\n      option.scrollTo();\r\n      this.$list.focus();\r\n    },\r\n\r\n    isOpen: function() {\r\n      return !this.$list.hasClass('u-display-none');\r\n    },\r\n\r\n    toggleOpen: function(open) {\r\n      if (open === undefined) open = !this.isOpen();\r\n      if (open) clearTimeout(this.blurTimeout);\r\n      this.$button.attr('aria-expanded', open ? 'true' : 'false');\r\n      var name = open ? 'openList' : 'closeList';\r\n      this.settings[name].call(this, this);\r\n      this.trigger(name, this);\r\n    },\r\n\r\n    onListBlur: function(event) {\r\n      // IE11: Allow option click handler to execute before blur and close list\r\n      var handleBlur = function() {\r\n        this.toggleOpen(false);\r\n        this.removeActiveDescendantId();\r\n      }.bind(this);\r\n      this.blurTimeout = setTimeout(handleBlur, 100);\r\n    },\r\n\r\n    onKeyDown: function(event) {\r\n      if (!this.isOpen()) return;\r\n      var option = this.getFirstSelectedItem() || this.placeholder;\r\n      switch (event.keyCode) {\r\n        case 38: // UP\r\n          event.preventDefault();\r\n          option = option.getPrevious() || option.getLast();\r\n          break;\r\n        case 40: // DOWN\r\n          event.preventDefault();\r\n          option = option.getNext() || option.getFirst();\r\n          break;\r\n        case 13: // ENTER\r\n        case 32: // SPACE\r\n        case 27: // ESCAPE\r\n          event.preventDefault();\r\n          this.$button.focus();\r\n          return;\r\n        default:\r\n          return;\r\n      }\r\n      option.select().scrollTo();\r\n    },\r\n\r\n    getFirstSelectedItem: function() {\r\n      return _.find(this.options, function(option) {\r\n        return option.isSelected();\r\n      }) || this.options[0];\r\n    },\r\n\r\n    setActiveDescendantId: function(id) {\r\n      this.$list.attr('aria-activedescendant', id);\r\n    },\r\n\r\n    removeActiveDescendantId: function() {\r\n      this.$list.removeAttr('aria-activedescendant');\r\n    },\r\n\r\n    select: function(value) {\r\n      value = String(value);\r\n      var option = _.find(this.options, function(option) {\r\n        return option.getValue() === value;\r\n      });\r\n      if (option) {\r\n        option.select();\r\n        return;\r\n      }\r\n      this.placeholder.select();\r\n    },\r\n\r\n    toggleDisabled: function(value) {\r\n      if (value === undefined) {\r\n        value = !this.$input.attr('disabled');\r\n      }\r\n      if (value === false) {\r\n        this.$input.removeAttr('disabled');\r\n        this.$button\r\n            .removeAttr('disabled')\r\n            .removeClass('is-disabled');\r\n        this.$el.removeAttr('disabled');\r\n        return;\r\n      }\r\n      this.$input.attr('disabled', '');\r\n      this.$button\r\n          .attr('disabled', '')\r\n          .addClass('is-disabled');\r\n      this.$el.attr('disabled', '');\r\n    },\r\n\r\n    isEmpty: function() {\r\n      return !this.getFirstSelectedItem();\r\n    },\r\n\r\n    val: function() {\r\n      return this.$input.val();\r\n    },\r\n\r\n    destroy: function() {\r\n      this.removeEventListeners();\r\n      this.$el.remove();\r\n      delete this.options;\r\n      delete this.$input;\r\n      delete this.$inner;\r\n      delete this.$button;\r\n      delete this.$list;\r\n      delete this.$el;\r\n    },\r\n\r\n    removeEventListeners: function() {\r\n      this.$button.off({\r\n        'mousedown touchstart': this.onStartInteraction,\r\n        click: this.onButtonClick\r\n      });\r\n      this.$list.off('blur', this.onListBlur);\r\n      $(document).off('keydown', this.onKeyDown);\r\n    }\r\n\r\n  }, {\r\n\r\n    defaults: {\r\n\r\n      load: function() {},\r\n\r\n      openList: function() {\r\n        this.$list\r\n          .css({\r\n            top: '',\r\n            left: this.$button[0].offsetLeft,\r\n            width: this.$button.outerWidth()\r\n          })\r\n          .addClass('u-visibility-hidden')\r\n          .removeClass('u-display-none');\r\n\r\n        var offset = this.$list[0].getBoundingClientRect();\r\n        var height = this.$list.height();\r\n        var windowHeight = $(window).height();\r\n        var isOffscreen = (offset.top + height > windowHeight);\r\n\r\n        this.$list\r\n          .css('top', isOffscreen ? -height : '')\r\n          .removeClass('u-visibility-hidden')\r\n          .focus();\r\n\r\n      },\r\n\r\n      closeList: function() {\r\n        this.$list\r\n          .removeClass('u-visibility-hidden')\r\n          .addClass('u-display-none')\r\n          .css('top', '');\r\n      },\r\n\r\n      scrollToItem: function(option) {\r\n        var height = this.$list[0].clientHeight;\r\n        var pos = option.$el[0].offsetTop-(height/2);\r\n        this.$list[0].scrollTop = pos;\r\n      }\r\n\r\n    }\r\n\r\n  });\r\n\r\n  return DropDown;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView',\r\n  './dropdown'\r\n], function(Adapt, QuestionView, DropDown) {\r\n\r\n  var MatchingView = QuestionView.extend({\r\n\r\n    dropdowns: [],\r\n\r\n    disableQuestion: function() {\r\n      this.dropdowns.forEach(function(dropdown) {\r\n        dropdown.toggleDisabled(true);\r\n      });\r\n    },\r\n\r\n    enableQuestion: function() {\r\n      this.dropdowns.forEach(function(dropdown) {\r\n        dropdown.toggleDisabled(false);\r\n      });\r\n    },\r\n\r\n    resetQuestionOnRevisit: function() {\r\n      this.resetQuestion();\r\n    },\r\n\r\n    setupQuestion: function() {\r\n      this.listenToOnce(Adapt.parentView, 'postRemove', this.onPostRemove);\r\n      this.model.setupRandomisation();\r\n    },\r\n\r\n    onPostRemove: function() {\r\n      this.dropdowns.forEach(function(dropdown) {\r\n        dropdown.off('change', this.onOptionSelected);\r\n        dropdown.destroy();\r\n      }, this);\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n      this.setReadyStatus();\r\n      this.setUpDropdowns();\r\n    },\r\n\r\n    setUpDropdowns: function() {\r\n      _.bindAll(this, 'onOptionSelected');\r\n      this.dropdowns = [];\r\n      var items = this.model.get('_items');\r\n      this.$('.matching__item').each(function(i, el) {\r\n        var item = items[i];\r\n        var selectedOption = _.find(item._options, function(option) {\r\n          return option._isSelected;\r\n        });\r\n        var value = selectedOption ? selectedOption._index : null;\r\n        var dropdown = new DropDown({\r\n          el: $(el).find('.dropdown')[0],\r\n          placeholder: this.model.get('placeholder'),\r\n          value: value\r\n        });\r\n        this.dropdowns.push(dropdown);\r\n        dropdown.on('change', this.onOptionSelected);\r\n      }.bind(this));\r\n      this.enableQuestion();\r\n      if (this.model.get('_isEnabled') !== true) {\r\n        this.disableQuestion();\r\n      }\r\n    },\r\n\r\n    onCannotSubmit: function() {\r\n      this.dropdowns.forEach(function(dropdown) {\r\n        if (!dropdown.isEmpty()) return;\r\n        dropdown.$el.parents('.matching__select-container').addClass('has-error');\r\n      });\r\n    },\r\n\r\n    onOptionSelected: function(dropdown) {\r\n      if (this.model.get('_isInteractionComplete')) return;\r\n      var $container = dropdown.$el.parents('.matching__select-container');\r\n      $container.removeClass('error');\r\n      var itemIndex = dropdown.$el.parents('.matching__item').index();\r\n      if (dropdown.isEmpty()) return;\r\n      var optionIndex = parseInt(dropdown.val());\r\n      this.model.setOptionSelected(itemIndex, optionIndex, true);\r\n    },\r\n\r\n    showMarking: function() {\r\n      if (!this.model.get('_canShowMarking')) return;\r\n\r\n      this.model.get('_items').forEach(function(item, i) {\r\n        var $item = this.$('.matching__item').eq(i);\r\n        $item.removeClass('is-correct is-incorrect').addClass(item._isCorrect ? 'is-correct' : 'is-incorrect');\r\n      }, this);\r\n    },\r\n\r\n    resetQuestion: function() {\r\n      this.$('.matching__item').removeClass('is-correct is-incorrect');\r\n      this.model.set('_isAtLeastOneCorrectSelection', false);\r\n      var resetAll = this.model.get('_shouldResetAllAnswers');\r\n\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        if (item._isCorrect && resetAll === false) return;\r\n        this.selectValue(index, null);\r\n        item._options.forEach(function(option, index) {\r\n          option._isSelected = false;\r\n        });\r\n        item._selected = null;\r\n      }, this);\r\n    },\r\n\r\n    showCorrectAnswer: function() {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        var correctOption = _.findWhere(item._options, { _isCorrect: true });\r\n        this.selectValue(index, correctOption._index);\r\n      }, this);\r\n    },\r\n\r\n    hideCorrectAnswer: function() {\r\n      var answerArray = this.model.has('_tempUserAnswer') ?\r\n        this.model.get('_tempUserAnswer') :\r\n        this.model.get('_userAnswer');\r\n\r\n      this.model.get('_items').forEach(function (item, index) {\r\n        var key = answerArray[index];\r\n        var value = item._options[key]._index;\r\n        this.selectValue(index, value);\r\n      }, this);\r\n    },\r\n\r\n    /**\r\n     * Sets the selected item of a dropdown\r\n     * @param {number} index The index (0-based) of the dropdown\r\n     * @param {string} value The option _index\r\n     * @example\r\n     * // Sets the third dropdown to option _index 1\r\n     * this.selectValue(2, 1);\r\n     */\r\n    selectValue: function(index, optionIndex) {\r\n      if (!this.dropdowns) return;\r\n      var dropdown = this.dropdowns[index];\r\n      if (!dropdown) return;\r\n      dropdown.select(optionIndex);\r\n    }\r\n\r\n  });\r\n\r\n  return MatchingView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel'\r\n], function(Adapt, QuestionModel) {\r\n\r\n  var MatchingModel = QuestionModel.extend({\r\n\r\n    init: function() {\r\n      QuestionModel.prototype.init.call(this);\r\n      this.setupQuestionItemIndexes();\r\n    },\r\n\r\n    setupQuestionItemIndexes: function() {\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n        if (item._index === undefined) {\r\n          item._index = index;\r\n          item._selected = false;\r\n        }\r\n        item._options.forEach(function(option, index) {\r\n          if (option._index === undefined) {\r\n            option._index = index;\r\n            option._isSelected = false;\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    setupRandomisation: function() {\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n\r\n      this.get('_items').forEach(function(item) {\r\n        item._options = _.shuffle(item._options);\r\n      });\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      var userAnswer = this.get('_userAnswer');\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n        item._options.forEach(function(option, index) {\r\n          if (option._index === userAnswer[item._index]) {\r\n            option._isSelected = true;\r\n            item._selected = option;\r\n          }\r\n        });\r\n      });\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.checkCanSubmit();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    canSubmit: function() {\r\n      // can submit if every item has a selection\r\n      var canSubmit = _.every(this.get('_items'), function(item) {\r\n        return _.findWhere(item._options, { '_isSelected': true }) !== undefined;\r\n      });\r\n\r\n      return canSubmit;\r\n    },\r\n\r\n    setOptionSelected: function(itemIndex, optionIndex, isSelected) {\r\n      var item = this.get('_items')[itemIndex];\r\n      if (isNaN(optionIndex)) {\r\n        item._options.forEach(option => option._isSelected = false);\r\n        item._selected = null;\r\n        return this.checkCanSubmit();\r\n      }\r\n      var option = _.findWhere(item._options, { '_index': optionIndex });\r\n      option._isSelected = isSelected;\r\n      item._selected = option;\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    storeUserAnswer: function() {\r\n\r\n      var userAnswer = new Array(this.get('_items').length);\r\n      var tempUserAnswer = new Array(this.get('_items').length);\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n        var optionIndex = _.findIndex(item._options, function(o) { return o._isSelected; });\r\n\r\n        tempUserAnswer[item._index] = optionIndex;\r\n        userAnswer[item._index] = item._options[optionIndex]._index;\r\n      }, this);\r\n\r\n      this.set({\r\n        _userAnswer: userAnswer,\r\n        _tempUserAnswer: tempUserAnswer\r\n      });\r\n    },\r\n\r\n    isCorrect: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n\r\n        var isCorrect = (item._selected && item._selected._isCorrect);\r\n\r\n        if (!isCorrect) {\r\n          item._isCorrect = false;\r\n          return;\r\n        }\r\n\r\n        numberOfCorrectAnswers++;\r\n        item._isCorrect = true;\r\n        this.set({\r\n          _numberOfCorrectAnswers: numberOfCorrectAnswers,\r\n          _isAtLeastOneCorrectSelection: true\r\n        });\r\n\r\n      }, this);\r\n\r\n      this.set('_numberOfCorrectAnswers', numberOfCorrectAnswers);\r\n\r\n      if (numberOfCorrectAnswers === this.get('_items').length) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    },\r\n\r\n    setScore: function() {\r\n      var questionWeight = this.get('_questionWeight');\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.set('_score', questionWeight);\r\n        return;\r\n      }\r\n\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var itemLength = this.get('_items').length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n      this.set('_userAnswer', []);\r\n    },\r\n\r\n    /**\r\n    * Used by tracking extensions to return an object containing the component's specific interactions.\r\n    */\r\n    getInteractionObject: function() {\r\n      var interactions = {\r\n        correctResponsesPattern: null,\r\n        source: null,\r\n        target: null\r\n      };\r\n      var items = this.get('_items');\r\n      // This contains an array with a single string value, matching the source 'id' with the correct\r\n      // matching target 'id' value. An example is as follows:\r\n      // [ \"1[.]1_2[,]2[.]2_3\" ]\r\n      interactions.correctResponsesPattern = [\r\n        items.map(function(item, questionIndex) {\r\n          // Offset the item index and use it as a group identifier.\r\n          questionIndex = questionIndex + 1;\r\n          return [\r\n            questionIndex,\r\n            item._options.filter(function(item) {\r\n              // Get the correct item(s).\r\n              return item._isCorrect;\r\n            }).map(function(item) {\r\n              // Prefix the option's index and offset by 1.\r\n              return questionIndex + '_' + (item._index + 1).toString();\r\n            })\r\n          ].join('[.]');\r\n        }).join('[,]')\r\n      ];\r\n      // The 'source' property contains an array of all the stems/questions, e.g.\r\n      // [{id: \"1\", description: \"First question\"}, {id: \"2\", description: \"Second question\"}]\r\n      interactions.source = _.flatten(items.map(function(item) {\r\n        return {\r\n          // Offset by 1.\r\n          id: (item._index + 1).toString(),\r\n          description: item.text\r\n        };\r\n      }));\r\n      // The 'target' property contains an array of all the option responses, with the 'id'\r\n      // prefixed to indicate the grouping, e.g.\r\n      // [  {id: \"1_1\": description: \"First option, group 1\"},\r\n      //    {id: \"1_2\": description: \"Second option, group 1\"}\r\n      //    {id: \"2_1\": description: \"First option, group 2\"}  ]\r\n      interactions.target = _.flatten(items.map(function(item, index) {\r\n        // Offset by 1, as these values are not zero-indexed.\r\n        index = index + 1;\r\n        return item._options.map(function(option) {\r\n          return {\r\n            id: index + '_' + (option._index + 1),\r\n            description: option.text\r\n          };\r\n        });\r\n      }));\r\n      return interactions;\r\n    },\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * @return {string} the user's answers as a string in the format \"1.1#2.3#3.2\" assuming user selected option 1 in drop-down 1,\r\n    * option 3 in drop-down 2 and option 2 in drop-down 3. The '#' character will be changed to either ',' or '[,]' by adapt-contrib-spoor,\r\n    * depending on which SCORM version is being used.\r\n    */\r\n    getResponse: function() {\r\n      var responses = [];\r\n\r\n      this.get('_userAnswer').forEach(function(userAnswer, index) {\r\n        responses.push((index + 1) + '.' + (userAnswer + 1));// convert from 0-based to 1-based counting\r\n      });\r\n\r\n      return responses.join('#');\r\n    },\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    * @return {string}\r\n    */\r\n    getResponseType: function() {\r\n      return 'matching';\r\n    },\r\n\r\n    /**\r\n     * Creates a string explaining the answers the learner should have chosen\r\n     * Used by ButtonsView to retrieve question-specific correct answer text for the ARIA\r\n     * 'live region' that gets updated when the learner selects the 'show correct answer' button\r\n     * @return {string}\r\n     */\r\n    getCorrectAnswerAsText: function() {\r\n      const correctAnswerTemplate = Adapt.course.get('_globals')._components._matching.ariaCorrectAnswer;\r\n      const ariaAnswer = this.get('_items').map(item => {\r\n        const correctOption = _.findWhere(item._options, { _isCorrect: true });\r\n        return Handlebars.compile(correctAnswerTemplate)({\r\n          itemText: item.text,\r\n          correctAnswer: correctOption.text\r\n        });\r\n      }).join('<br>');\r\n\r\n      return ariaAnswer;\r\n    },\r\n\r\n    /**\r\n     * Creates a string listing the answers the learner chose\r\n     * Used by ButtonsView to retrieve question-specific user answer text for the ARIA\r\n     * 'live region' that gets updated when the learner selects the 'hide correct answer' button\r\n     * @return {string}\r\n     */\r\n    getUserAnswerAsText: function() {\r\n      const userAnswerTemplate = Adapt.course.get('_globals')._components._matching.ariaUserAnswer;\r\n      const answerArray = this.has('_tempUserAnswer') ?\r\n        this.get('_tempUserAnswer') :\r\n        this.get('_userAnswer');\r\n\r\n      const ariaAnswer = this.get('_items').map((item, index) => {\r\n        const key = answerArray[index];\r\n        return Handlebars.compile(userAnswerTemplate)({\r\n          itemText: item.text,\r\n          userAnswer: item._options[key].text\r\n        });\r\n      }).join('<br>');\r\n\r\n      return ariaAnswer;\r\n    }\r\n\r\n  });\r\n\r\n  return MatchingModel;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './matchingView',\r\n  './matchingModel'\r\n], function(Adapt, MatchingView, MatchingModel) {\r\n\r\n  return Adapt.register('matching', {\r\n    view: MatchingView,\r\n    model: MatchingModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'libraries/mediaelement-and-player'\r\n], function(Adapt) {\r\n  var mepPrototype = $.extend({}, mejs.MediaElementPlayer.prototype);\r\n\r\n  $.extend(mejs.MediaElementPlayer.prototype, {\r\n    /**\r\n    * fixes a bug (adaptlearning/adapt_framework#1478)\r\n    * where the media player going into/coming out of full-screen mode would trigger inview on\r\n    * components below it; we therefore need to switch off inview when entering full screen mode\r\n    * and switch it back on again after exiting full screen mode\r\n    */\r\n    detectFullscreenMode: function() {\r\n      var vendorPrefix = this.getVendorPrefix();\r\n      var fsEventName = 'on' + vendorPrefix + 'fullscreenchange';\r\n\r\n      if (document[fsEventName] === null) {\r\n        document[fsEventName] = function fullScreenEventHandler() {\r\n\r\n          var elementName = (vendorPrefix === '' ? 'fullscreenElement' : vendorPrefix + 'FullscreenElement');\r\n\r\n          if (document[elementName] !== null) {\r\n            $.inview.lock('mediaelement');\r\n            Adapt.trigger('media:fullscreen:enter');\r\n          } else {\r\n            $.inview.unlock('mediaelement');\r\n            Adapt.trigger('media:fullscreen:exit');\r\n          }\r\n        };\r\n      }\r\n\r\n      // DD: MODIFIED: EPUB (Desktop Bookshelf) override.\r\n\t\t  // Desktop Bookshelf doesn't render fullscreen videos correctly, so do NOT use the native FullScreen for it.\r\n      // This can be achieved by returning the following:\r\n      if (Adapt.config.get('_isDesktopBookshelf')) {\r\n\r\n        var t = this;\r\n        let mode = \"fullwindow\";\r\n        t.fullscreenMode = mode;\t\t\r\n\t\t\t  return mode;\r\n      }\r\n\r\n      return mepPrototype.detectFullscreenMode.apply(this, arguments);\r\n    },\r\n\r\n    /**\r\n    * because the fullscreen events and properties are still vendor-prefixed in some browsers...\r\n    */\r\n    getVendorPrefix: function() {\r\n      var browser = Adapt.device.browser;\r\n\r\n      if (browser === 'internet explorer') {\r\n        return 'ms';\r\n      }\r\n\r\n      if (browser === 'microsoft edge' || browser === 'safari') {\r\n        return 'webkit';\r\n      }\r\n\r\n      return ''; // Chrome, Opera and Firefox no longer require a vendor prefix\r\n    }\r\n  });\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'core/js/models/componentModel',\r\n  'libraries/mediaelement-and-player',\r\n  'libraries/mediaelement-fullscreen-hook'\r\n], function(Adapt, ComponentView, ComponentModel) {\r\n\r\n  var froogaloopAdded = false;\r\n\r\n  // The following function is used to to prevent a memory leak in Internet Explorer\r\n  // See: http://javascript.crockford.com/memory/leak.html\r\n  function purge(d) {\r\n    var a = d.attributes;\r\n    if (a) {\r\n      for (let i = a.length - 1; i >= 0; i -= 1) {\r\n        let n = a[i].name;\r\n        if (typeof d[n] === 'function') {\r\n          d[n] = null;\r\n        }\r\n      }\r\n    }\r\n    a = d.childNodes;\r\n    if (a) {\r\n      for (let i = 0, count = a.length; i < count; i += 1) {\r\n        purge(d.childNodes[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Default shortcut keys trap a screen reader user inside the player once in focus. These keys are unnecessary\r\n   * as one may traverse the player in a linear fashion without needing to know or use shortcut keys. Below is\r\n   * the removal of the default shortcut keys.\r\n   *\r\n   * The default seek interval functions are passed two different data types from mejs which they handle incorrectly. One\r\n   * is a duration integer the other is the player object. The default functions error on slider key press and so break\r\n   * accessibility. Below is a correction.\r\n   */\r\n  _.extend(window.mejs.MepDefaults, {\r\n    keyActions: [],\r\n    defaultSeekForwardInterval: function(duration) {\r\n      if (typeof duration === 'object') return duration.duration * 0.05;\r\n      return duration * 0.05;\r\n    },\r\n    defaultSeekBackwardInterval: function(duration) {\r\n      if (typeof duration === 'object') return duration.duration * 0.05;\r\n      return duration * 0.05;\r\n    }\r\n  });\r\n\r\n  var MediaView = ComponentView.extend({\r\n\r\n    events: {\r\n      'click .js-media-inline-transcript-toggle': 'onToggleInlineTranscript',\r\n      'click .js-media-external-transcript-click': 'onExternalTranscriptClicked',\r\n      'click .js-skip-to-transcript': 'onSkipToTranscript'\r\n    },\r\n\r\n    className: function() {\r\n      var classes = ComponentView.prototype.className.call(this);\r\n      var playerOptions = this.model.get('_playerOptions');\r\n      if (playerOptions && playerOptions.toggleCaptionsButtonWhenOnlyOne) {\r\n        classes += ' toggle-captions';\r\n      }\r\n      return classes;\r\n    },\r\n\r\n    preRender: function() {\r\n      this.listenTo(Adapt, {\r\n        'device:resize': this.onScreenSizeChanged,\r\n        'device:changed': this.onDeviceChanged,\r\n        'media:stop': this.onMediaStop\r\n      });\r\n\r\n      _.bindAll(this, 'onMediaElementPlay', 'onMediaElementPause', 'onMediaElementEnded', 'onMediaElementTimeUpdate', 'onMediaElementSeeking');\r\n\r\n      // set initial player state attributes\r\n      this.model.set({\r\n        '_isMediaEnded': false,\r\n        '_isMediaPlaying': false\r\n      });\r\n\r\n      if (this.model.get('_media').source) {\r\n        var media = this.model.get('_media');\r\n\r\n        // Avoid loading of Mixed Content (insecure content on a secure page)\r\n        if (window.location.protocol === 'https:' && media.source.indexOf('http:') === 0) {\r\n          media.source = media.source.replace(/^http:/, 'https:');\r\n        }\r\n\r\n        this.model.set('_media', media);\r\n      }\r\n\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    postRender: function() {\r\n      this.setupPlayer();\r\n      this.addMejsButtonClass();\r\n    },\r\n\r\n    addMejsButtonClass: function() {\r\n      this.$('.mejs-overlay-button').addClass('icon');\r\n    },\r\n\r\n    setupPlayer: function() {\r\n      if (!this.model.get('_playerOptions')) this.model.set('_playerOptions', {});\r\n\r\n      var modelOptions = this.model.get('_playerOptions');\r\n\r\n      if (modelOptions.pluginPath === undefined) {\r\n        // on the off-chance anyone still needs to use the Flash-based player...\r\n        _.extend(modelOptions, {\r\n          pluginPath: 'https://cdnjs.cloudflare.com/ajax/libs/mediaelement/2.21.2/',\r\n          flashName: 'flashmediaelement-cdn.swf',\r\n          flashScriptAccess: 'always'\r\n        });\r\n      }\r\n\r\n      if (modelOptions.features === undefined) {\r\n        modelOptions.features = ['playpause', 'progress', 'current', 'duration'];\r\n        if (this.model.get('_useClosedCaptions')) {\r\n          modelOptions.features.unshift('tracks');\r\n        }\r\n        if (this.model.get('_allowFullScreen')) {\r\n          modelOptions.features.push('fullscreen');\r\n        }\r\n        if (this.model.get('_showVolumeControl')) {\r\n          modelOptions.features.push('volume');\r\n        }\r\n      }\r\n\r\n      /*\r\n      Unless we are on Android/iOS and using native controls, when MediaElementJS initializes the player\r\n      it will invoke the success callback prior to performing one last call to setPlayerSize.\r\n      This call to setPlayerSize is deferred by 50ms so we add a delay of 100ms here to ensure that\r\n      we don't invoke setReadyStatus until the player is definitely finished rendering.\r\n      */\r\n      modelOptions.success = _.debounce(this.onPlayerReady.bind(this), 100);\r\n\r\n      if (this.model.get('_useClosedCaptions')) {\r\n        var startLanguage = this.model.get('_startLanguage') || 'en';\r\n        if (!Adapt.offlineStorage.get('captions')) {\r\n          Adapt.offlineStorage.set('captions', startLanguage);\r\n        }\r\n        modelOptions.startLanguage = this.checkForSupportedCCLanguage(Adapt.offlineStorage.get('captions'));\r\n      }\r\n\r\n      if (modelOptions.alwaysShowControls === undefined) {\r\n        modelOptions.alwaysShowControls = false;\r\n      }\r\n      if (modelOptions.hideVideoControlsOnLoad === undefined) {\r\n        modelOptions.hideVideoControlsOnLoad = true;\r\n      }\r\n\r\n      this.addMediaTypeClass();\r\n\r\n      this.addThirdPartyFixes(modelOptions, function createPlayer() {\r\n        // create the player\r\n        this.$('audio, video').mediaelementplayer(modelOptions);\r\n        this.cleanUpPlayer();\r\n\r\n        var _media = this.model.get('_media');\r\n        // if no media is selected - set ready now, as success won't be called\r\n        if (!_media.mp3 && !_media.mp4 && !_media.ogv && !_media.webm && !_media.source) {\r\n          Adapt.log.warn('ERROR! No media is selected in components.json for component ' + this.model.get('_id'));\r\n          this.setReadyStatus();\r\n          return;\r\n        }\r\n        // Check if we're streaming\r\n        if (_media.source) {\r\n          this.$('.media__widget').addClass('external-source');\r\n        }\r\n      }.bind(this));\r\n    },\r\n\r\n    addMediaTypeClass: function() {\r\n      var media = this.model.get('_media');\r\n      if (media && media.type) {\r\n        var typeClass = media.type.replace(/\\//, '-');\r\n        this.$('.media__widget').addClass(typeClass);\r\n      }\r\n    },\r\n\r\n    addThirdPartyFixes: function(modelOptions, callback) {\r\n      var media = this.model.get('_media');\r\n      if (!media) return callback();\r\n\r\n      switch (media.type) {\r\n        case 'video/vimeo':\r\n          modelOptions.alwaysShowControls = false;\r\n          modelOptions.hideVideoControlsOnLoad = true;\r\n          modelOptions.features = [];\r\n          if (froogaloopAdded) return callback();\r\n          $.getScript('assets/froogaloop.js')\r\n            .done(function() {\r\n              froogaloopAdded = true;\r\n              callback();\r\n            })\r\n            .fail(function() {\r\n              froogaloopAdded = false;\r\n              console.log('Could not load froogaloop.js');\r\n            });\r\n          break;\r\n        default:\r\n          callback();\r\n      }\r\n    },\r\n\r\n    cleanUpPlayer: function() {\r\n      this.$('.media__widget').children('.mejs-offscreen').remove();\r\n      this.$('[role=application]').removeAttr('role tabindex');\r\n      this.$('[aria-controls]').removeAttr('aria-controls');\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.completionEvent = (this.model.get('_setCompletionOn') || 'play');\r\n\r\n      if (this.completionEvent === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n\r\n      // wrapper to check if preventForwardScrubbing is turned on.\r\n      if ((this.model.get('_preventForwardScrubbing')) && (!this.model.get('_isComplete'))) {\r\n        $(this.mediaElement).on({\r\n          'seeking': this.onMediaElementSeeking,\r\n          'timeupdate': this.onMediaElementTimeUpdate\r\n        });\r\n      }\r\n\r\n      // handle other completion events in the event Listeners\r\n      $(this.mediaElement).on({\r\n        'play': this.onMediaElementPlay,\r\n        'pause': this.onMediaElementPause,\r\n        'ended': this.onMediaElementEnded\r\n      });\r\n\r\n      // occasionally the mejs code triggers a click of the captions language\r\n      // selector during setup, this slight delay ensures we skip that\r\n      _.delay(this.listenForCaptionsChange.bind(this), 250);\r\n    },\r\n\r\n    /**\r\n     * Sets up the component to detect when the user has changed the captions so that it can store the user's\r\n     * choice in offlineStorage and notify other media components on the same page of the change\r\n     * Also sets the component up to listen for this event from other media components on the same page\r\n     */\r\n    listenForCaptionsChange: function() {\r\n      if (!this.model.get('_useClosedCaptions')) return;\r\n\r\n      var selector = this.model.get('_playerOptions').toggleCaptionsButtonWhenOnlyOne ?\r\n        '.mejs-captions-button button' :\r\n        '.mejs-captions-selector';\r\n\r\n      this.$(selector).on('click.mediaCaptionsChange', _.debounce(function() {\r\n        var srclang = this.mediaElement.player.selectedTrack ? this.mediaElement.player.selectedTrack.srclang : 'none';\r\n        Adapt.offlineStorage.set('captions', srclang);\r\n        Adapt.trigger('media:captionsChange', this, srclang);\r\n      }.bind(this), 250)); // needs debouncing because the click event fires twice\r\n\r\n      this.listenTo(Adapt, 'media:captionsChange', this.onCaptionsChanged);\r\n    },\r\n\r\n    /**\r\n     * Handles updating the captions in this instance when learner changes captions in another\r\n     * media component on the same page\r\n     * @param {Backbone.View} view The view instance that triggered the event\r\n     * @param {string} lang The captions language the learner chose in the other media component\r\n     */\r\n    onCaptionsChanged: function(view, lang) {\r\n      if (view && view.cid === this.cid) return; // ignore the event if we triggered it\r\n\r\n      lang = this.checkForSupportedCCLanguage(lang);\r\n\r\n      this.mediaElement.player.setTrack(lang);\r\n\r\n      // because calling player.setTrack doesn't update the cc button's languages popup...\r\n      var $inputs = this.$('.mejs-captions-selector input');\r\n      $inputs.filter(':checked').prop('checked', false);\r\n      $inputs.filter('[value=\"' + lang + '\"]').prop('checked', true);\r\n    },\r\n\r\n    /**\r\n     * When the learner selects a captions language in another media component, that language may not be available\r\n     * in this instance, in which case default to the `_startLanguage` if that's set - or \"none\" if it's not\r\n     * @param {string} lang The language we're being asked to switch to e.g. \"de\"\r\n     * @return {string} The language we're actually going to switch to - or \"none\" if there's no good match\r\n     */\r\n    checkForSupportedCCLanguage: function (lang) {\r\n      if (!lang || lang === 'none') return 'none';\r\n\r\n      if (_.findWhere(this.model.get('_media').cc, { srclang: lang })) return lang;\r\n\r\n      return this.model.get('_startLanguage') || 'none';\r\n    },\r\n\r\n    onMediaElementPlay: function(event) {\r\n      this.queueGlobalEvent('play');\r\n\r\n      Adapt.trigger('media:stop', this);\r\n\r\n      if (this.model.get('_pauseWhenOffScreen')) $(this.mediaElement).on('inview', this.onMediaElementInview);\r\n\r\n      this.model.set({\r\n        '_isMediaPlaying': true,\r\n        '_isMediaEnded': false\r\n      });\r\n\r\n      if (this.completionEvent === 'play') {\r\n        this.setCompletionStatus();\r\n      }\r\n    },\r\n\r\n    onMediaElementPause: function(event) {\r\n      this.queueGlobalEvent('pause');\r\n\r\n      $(this.mediaElement).off('inview', this.onMediaElementInview);\r\n\r\n      this.model.set('_isMediaPlaying', false);\r\n    },\r\n\r\n    onMediaElementEnded: function(event) {\r\n      this.queueGlobalEvent('ended');\r\n\r\n      this.model.set('_isMediaEnded', true);\r\n\r\n      if (this.completionEvent === 'ended') {\r\n        this.setCompletionStatus();\r\n      }\r\n    },\r\n\r\n    onMediaElementInview: function(event, isInView) {\r\n      if (!isInView && !event.currentTarget.paused) event.currentTarget.pause();\r\n    },\r\n\r\n    onMediaElementSeeking: function(event) {\r\n      var maxViewed = this.model.get('_maxViewed');\r\n      if (!maxViewed) {\r\n        maxViewed = 0;\r\n      }\r\n      if (event.target.currentTime > maxViewed) {\r\n        event.target.currentTime = maxViewed;\r\n      }\r\n    },\r\n\r\n    onMediaElementTimeUpdate: function(event) {\r\n      var maxViewed = this.model.get('_maxViewed');\r\n      if (!maxViewed) {\r\n        maxViewed = 0;\r\n      }\r\n      if (event.target.currentTime > maxViewed) {\r\n        this.model.set('_maxViewed', event.target.currentTime);\r\n      }\r\n    },\r\n\r\n    // Overrides the default play/pause functionality to stop accidental playing on touch devices\r\n    setupPlayPauseToggle: function() {\r\n      // bit sneaky, but we don't have a this.mediaElement.player ref on iOS devices\r\n      var player = this.mediaElement.player;\r\n\r\n      if (!player) {\r\n        console.log(\"Media.setupPlayPauseToggle: OOPS! there's no player reference.\");\r\n        return;\r\n      }\r\n\r\n      // stop the player dealing with this, we'll do it ourselves\r\n      player.options.clickToPlayPause = false;\r\n\r\n      this.onOverlayClick = this.onOverlayClick.bind(this);\r\n      this.onMediaElementClick = this.onMediaElementClick.bind(this);\r\n\r\n      // play on 'big button' click\r\n      this.$('.mejs-overlay-button').on('click', this.onOverlayClick);\r\n\r\n      // pause on player click\r\n      this.$('.mejs-mediaelement').on('click', this.onMediaElementClick);\r\n    },\r\n\r\n    onMediaStop: function(view) {\r\n\r\n      // Make sure this view isn't triggering media:stop\r\n      if (view && view.cid === this.cid) return;\r\n\r\n      if (!this.mediaElement || !this.mediaElement.player) return;\r\n\r\n      this.mediaElement.player.pause();\r\n\r\n    },\r\n\r\n    onOverlayClick: function() {\r\n      var player = this.mediaElement.player;\r\n      if (!player) return;\r\n\r\n      player.play();\r\n    },\r\n\r\n    onMediaElementClick: function(event) {\r\n      var player = this.mediaElement.player;\r\n      if (!player) return;\r\n\r\n      var isPaused = player.media.paused;\r\n      if (!isPaused) player.pause();\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    remove: function() {\r\n      this.$('.mejs-overlay-button').off('click', this.onOverlayClick);\r\n      this.$('.mejs-mediaelement').off('click', this.onMediaElementClick);\r\n\r\n      if (this.model.get('_useClosedCaptions')) {\r\n        var selector = this.model.get('_playerOptions').toggleCaptionsButtonWhenOnlyOne ?\r\n          '.mejs-captions-button button' :\r\n          '.mejs-captions-selector';\r\n        this.$(selector).off('click.mediaCaptionsChange');\r\n      }\r\n\r\n      var modelOptions = this.model.get('_playerOptions');\r\n      delete modelOptions.success;\r\n\r\n      var media = this.model.get('_media');\r\n      if (media) {\r\n        switch (media.type) {\r\n          case 'video/vimeo':\r\n            this.$('iframe')[0].isRemoved = true;\r\n        }\r\n      }\r\n\r\n      if (this.mediaElement && this.mediaElement.player) {\r\n        var playerId = this.mediaElement.player.id;\r\n\r\n        purge(this.$el[0]);\r\n        this.mediaElement.player.remove();\r\n\r\n        if (window.mejs.players[playerId]) {\r\n          delete window.mejs.players[playerId];\r\n        }\r\n      }\r\n\r\n      if (this.mediaElement) {\r\n        $(this.mediaElement).off({\r\n          'play': this.onMediaElementPlay,\r\n          'pause': this.onMediaElementPause,\r\n          'ended': this.onMediaElementEnded,\r\n          'seeking': this.onMediaElementSeeking,\r\n          'timeupdate': this.onMediaElementTimeUpdate,\r\n          'inview': this.onMediaElementInview\r\n        });\r\n\r\n        this.mediaElement.src = '';\r\n        $(this.mediaElement.pluginElement).remove();\r\n        delete this.mediaElement;\r\n      }\r\n\r\n      ComponentView.prototype.remove.call(this);\r\n    },\r\n\r\n    onDeviceChanged: function() {\r\n      if (this.model.get('_media').source) {\r\n        this.$('.mejs-container').width(this.$('.component__widget').width());\r\n      }\r\n    },\r\n\r\n    onPlayerReady: function (mediaElement, domObject) {\r\n      this.mediaElement = mediaElement;\r\n\r\n      var player = this.mediaElement.player;\r\n      if (!player) player = window.mejs.players[this.$('.mejs-container').attr('id')];\r\n\r\n      var hasTouch = window.mejs.MediaFeatures.hasTouch;\r\n      if (hasTouch) {\r\n        this.setupPlayPauseToggle();\r\n      }\r\n\r\n      this.addThirdPartyAfterFixes();\r\n      this.cleanUpPlayerAfter();\r\n\r\n      if (player && this.model.has('_startVolume')) {\r\n        // Setting the start volume only works with the Flash-based player if you do it here rather than in setupPlayer\r\n        player.setVolume(parseInt(this.model.get('_startVolume')) / 100);\r\n      }\r\n\r\n      this.setReadyStatus();\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    addThirdPartyAfterFixes: function() {\r\n      var media = this.model.get('_media');\r\n      switch (media.type) {\r\n        case 'video/vimeo':\r\n          this.$('.mejs-container').attr('tabindex', 0);\r\n      }\r\n    },\r\n\r\n    cleanUpPlayerAfter: function() {\r\n      this.$(\"[aria-valuemax='NaN']\").attr('aria-valuemax', 0);\r\n    },\r\n\r\n    onScreenSizeChanged: function() {\r\n      this.$('audio, video').width(this.$('.component__widget').width());\r\n    },\r\n\r\n    onSkipToTranscript: function() {\r\n      // need slight delay before focussing button to make it work when JAWS is running\r\n      // see https://github.com/adaptlearning/adapt_framework/issues/2427\r\n      _.delay(function() {\r\n        this.$('.media__transcript-btn').a11y_focus();\r\n      }.bind(this), 250);\r\n    },\r\n\r\n    onToggleInlineTranscript: function(event) {\r\n      if (event) event.preventDefault();\r\n      var $transcriptBodyContainer = this.$('.media__transcript-body-inline');\r\n      var $button = this.$('.media__transcript-btn-inline');\r\n      var $buttonText = this.$('.media__transcript-btn-inline .media__transcript-btn-text');\r\n\r\n      if ($transcriptBodyContainer.hasClass('inline-transcript-open')) {\r\n        $transcriptBodyContainer.stop(true, true).slideUp(function() {\r\n          $(window).resize();\r\n        });\r\n        $button.attr('aria-expanded', false);\r\n        $transcriptBodyContainer.removeClass('inline-transcript-open');\r\n        $buttonText.html(this.model.get('_transcript').inlineTranscriptButton);\r\n      } else {\r\n        $transcriptBodyContainer.stop(true, true).slideDown(function() {\r\n          $(window).resize();\r\n        });\r\n        $button.attr('aria-expanded', true);\r\n        $transcriptBodyContainer.addClass('inline-transcript-open');\r\n        $buttonText.html(this.model.get('_transcript').inlineTranscriptCloseButton);\r\n\r\n        if (this.model.get('_transcript')._setCompletionOnView !== false) {\r\n          this.setCompletionStatus();\r\n        }\r\n      }\r\n    },\r\n\r\n    onExternalTranscriptClicked: function(event) {\r\n      if (this.model.get('_transcript')._setCompletionOnView !== false) {\r\n        this.setCompletionStatus();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Queue firing a media event to prevent simultaneous events firing, and provide a better indication of how the\r\n     * media  player is behaving\r\n     * @param {string} eventType\r\n     */\r\n    queueGlobalEvent: function(eventType) {\r\n      var t = Date.now();\r\n      var lastEvent = this.lastEvent || { time: 0 };\r\n      var timeSinceLastEvent = t - lastEvent.time;\r\n      var debounceTime = 500;\r\n\r\n      this.lastEvent = {\r\n        time: t,\r\n        type: eventType\r\n      };\r\n\r\n      // Clear any existing timeouts\r\n      clearTimeout(this.eventTimeout);\r\n\r\n      // Always trigger 'ended' events\r\n      if (eventType === 'ended') {\r\n        return this.triggerGlobalEvent(eventType);\r\n      }\r\n\r\n      // Fire the event after a delay, only if another event has not just been fired\r\n      if (timeSinceLastEvent > debounceTime) {\r\n        this.eventTimeout = setTimeout(this.triggerGlobalEvent.bind(this, eventType), debounceTime);\r\n      }\r\n    },\r\n\r\n    triggerGlobalEvent: function(eventType) {\r\n      var player = this.mediaElement.player;\r\n\r\n      var eventObj = {\r\n        type: eventType,\r\n        src: this.mediaElement.src,\r\n        platform: this.mediaElement.pluginType\r\n      };\r\n\r\n      if (player) eventObj.isVideo = player.isVideo;\r\n\r\n      Adapt.trigger('media', eventObj);\r\n    }\r\n\r\n  });\r\n\r\n  return Adapt.register('media', {\r\n    model: ComponentModel.extend({}), // create a new class in the inheritance chain so it can be extended per component type if necessary later\r\n    view: MediaView\r\n  });\r\n\r\n});\r\n","define(function() {\r\n\r\n  return new ENUM([\r\n    'SMALL',\r\n    'LARGE'\r\n  ]);\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  './modeEnum'\r\n], function(Adapt, ComponentView, MODE) {\r\n  'use strict';\r\n\r\n  var NarrativeView = ComponentView.extend({\r\n\r\n    _isInitial: true,\r\n\r\n    events: {\r\n      'click .js-narrative-strapline-open-popup': 'openPopup',\r\n      'click .js-narrative-controls-click': 'onNavigationClicked',\r\n      'click .js-narrative-progress-click': 'onProgressClicked'\r\n    },\r\n\r\n    preRender: function() {\r\n      this.listenTo(Adapt, {\r\n        'device:changed device:resize': this.reRender,\r\n        'notify:closed': this.closeNotify\r\n      });\r\n      this.renderMode();\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n\r\n      this.checkIfResetOnRevisit();\r\n      this.calculateWidths();\r\n    },\r\n\r\n    onItemsActiveChange: function(item, _isActive) {\r\n      if (_isActive === true) {\r\n        this.setStage(item);\r\n      }\r\n    },\r\n\r\n    onItemsVisitedChange: function(item, isVisited) {\r\n      if (!isVisited) return;\r\n      this.$('[data-index=\"' + item.get('_index') + '\"]').addClass('is-visited');\r\n    },\r\n\r\n    calculateMode: function() {\r\n      var mode = Adapt.device.screenSize === 'large' ?\r\n          MODE.LARGE :\r\n          MODE.SMALL;\r\n      this.model.set('_mode', mode);\r\n    },\r\n\r\n    renderMode: function() {\r\n      this.calculateMode();\r\n      if (this.isLargeMode()) {\r\n        this.$el.addClass('mode-large').removeClass('mode-small');\r\n      } else {\r\n        this.$el.addClass('mode-small').removeClass('mode-large');\r\n      }\r\n    },\r\n\r\n    isLargeMode: function() {\r\n      return this.model.get('_mode') === MODE.LARGE;\r\n    },\r\n\r\n    postRender: function() {\r\n      this.renderMode();\r\n      this.setupNarrative();\r\n\r\n      this.$('.narrative__slider').imageready(this.setReadyStatus.bind(this));\r\n\r\n      if (Adapt.config.get('_disableAnimation')) {\r\n        this.$el.addClass('disable-animation');\r\n      }\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    setupNarrative: function() {\r\n      this.renderMode();\r\n      var items = this.model.getChildren();\r\n      if (!items || !items.length) return;\r\n\r\n      var activeItem = this.model.getActiveItem();\r\n      if (!activeItem) {\r\n        activeItem = this.model.getItem(0);\r\n        activeItem.toggleActive(true);\r\n      } else {\r\n        // manually trigger change as it is not fired on reentry\r\n        items.trigger('change:_isActive', activeItem, true);\r\n      }\r\n\r\n      this.calculateWidths();\r\n\r\n      if (!this.isLargeMode() && !this.model.get('_wasHotgraphic')) {\r\n        this.replaceInstructions();\r\n      }\r\n      this.setupEventListeners();\r\n      this._isInitial = false;\r\n    },\r\n\r\n    calculateWidths: function() {\r\n      var itemCount = this.model.getChildren().length;\r\n      this.model.set({\r\n        '_totalWidth': 100 * itemCount,\r\n        '_itemWidth': 100 / itemCount\r\n      });\r\n    },\r\n\r\n    resizeControl: function() {\r\n      var previousMode = this.model.get('_mode');\r\n      this.renderMode();\r\n      if (previousMode !== this.model.get('_mode')) this.replaceInstructions();\r\n      this.evaluateNavigation();\r\n      var activeItem = this.model.getActiveItem();\r\n      if (activeItem) this.setStage(activeItem);\r\n    },\r\n\r\n    reRender: function() {\r\n      if (this.model.get('_wasHotgraphic') && this.isLargeMode()) {\r\n        this.replaceWithHotgraphic();\r\n      } else {\r\n        this.resizeControl();\r\n      }\r\n    },\r\n\r\n    closeNotify: function() {\r\n      this.evaluateCompletion();\r\n    },\r\n\r\n    replaceInstructions: function() {\r\n      if (this.isLargeMode()) {\r\n        this.$('.narrative__instruction-inner').html(this.model.get('instruction'));\r\n      } else if (this.model.get('mobileInstruction') && !this.model.get('_wasHotgraphic')) {\r\n        this.$('.narrative__instruction-inner').html(this.model.get('mobileInstruction'));\r\n      }\r\n    },\r\n\r\n    replaceWithHotgraphic: function() {\r\n      if (!Adapt.componentStore.hotgraphic) throw \"Hotgraphic not included in build\";\r\n      var HotgraphicView = Adapt.componentStore.hotgraphic.view;\r\n\r\n      var model = this.prepareHotgraphicModel();\r\n      var newHotgraphic = new HotgraphicView({ model: model });\r\n      var $container = $(\".component__container\", $(\".\" + this.model.get(\"_parentId\")));\r\n\r\n      $container.append(newHotgraphic.$el);\r\n      this.remove();\r\n      $.a11y_update();\r\n      _.defer(function() {\r\n        Adapt.trigger('device:resize');\r\n      });\r\n    },\r\n\r\n    prepareHotgraphicModel: function() {\r\n      var model = this.model;\r\n      model.resetActiveItems();\r\n      model.set({\r\n        '_isPopupOpen': false,\r\n        '_component': 'hotgraphic',\r\n        'body': model.get('originalBody'),\r\n        'instruction': model.get('originalInstruction')\r\n      });\r\n\r\n      return model;\r\n    },\r\n\r\n    moveSliderToIndex: function(itemIndex) {\r\n      var offset = this.model.get('_itemWidth') * itemIndex;\r\n      if (Adapt.config.get('_defaultDirection') === 'ltr') {\r\n        offset *= -1;\r\n      }\r\n      var cssValue = 'translateX('+offset+'%)';\r\n      var $sliderElm = this.$('.narrative__slider');\r\n      var $straplineHeaderElm = this.$('.narrative__strapline-header-inner');\r\n\r\n      $sliderElm.css('transform', cssValue);\r\n      $straplineHeaderElm.css('transform', cssValue);\r\n\r\n      if (Adapt.config.get('_disableAnimation') || this._isInitial) {\r\n        this.onTransitionEnd();\r\n      } else {\r\n        $sliderElm.one('transitionend', this.onTransitionEnd.bind(this));\r\n      }\r\n    },\r\n\r\n    onTransitionEnd: function() {\r\n      if (this._isInitial) return;\r\n\r\n      var index = this.model.getActiveItem().get('_index');\r\n      if (this.isLargeMode()) {\r\n        this.$('.narrative__content-item[data-index=\"'+index+'\"]').a11y_focus();\r\n      } else {\r\n        this.$('.narrative__strapline-btn').a11y_focus();\r\n      }\r\n    },\r\n\r\n    setStage: function(item) {\r\n      var index = item.get('_index');\r\n      if (this.isLargeMode()) {\r\n        // Set the visited attribute for large screen devices\r\n        item.toggleVisited(true);\r\n      }\r\n\r\n      var $slideGraphics = this.$('.narrative__slider-image-container');\r\n      this.$('.narrative__progress:visible').removeClass('is-selected').filter('[data-index=\"'+index+'\"]').addClass('is-selected');\r\n      $slideGraphics.children('.controls').a11y_cntrl_enabled(false);\r\n      $slideGraphics.filter('[data-index=\"'+index+'\"]').children('.controls').a11y_cntrl_enabled(true);\r\n      this.$('.narrative__content-item').addClass('u-visibility-hidden u-display-none').a11y_on(false).filter('[data-index=\"'+index+'\"]').removeClass('u-visibility-hidden u-display-none').a11y_on(true);\r\n      this.$('.narrative__strapline-btn').a11y_cntrl_enabled(false).filter('[data-index=\"'+index+'\"]').a11y_cntrl_enabled(true);\r\n\r\n      this.evaluateNavigation();\r\n      this.evaluateCompletion();\r\n      this.moveSliderToIndex(index);\r\n    },\r\n\r\n    evaluateNavigation: function() {\r\n      var active = this.model.getActiveItem();\r\n      if (!active) return;\r\n\r\n      var currentStage = active.get('_index');\r\n      var itemCount = this.model.getChildren().length;\r\n\r\n      var isAtStart = currentStage === 0;\r\n      var isAtEnd = currentStage === itemCount - 1;\r\n\r\n      this.$('.narrative__controls-left').toggleClass('u-visibility-hidden', isAtStart);\r\n      this.$('.narrative__controls-right').toggleClass('u-visibility-hidden', isAtEnd);\r\n    },\r\n\r\n    evaluateCompletion: function() {\r\n      if (this.model.areAllItemsCompleted()) {\r\n        this.trigger('allItems');\r\n      }\r\n    },\r\n\r\n    openPopup: function(event) {\r\n      event && event.preventDefault();\r\n\r\n      var currentItem = this.model.getActiveItem();\r\n      Adapt.trigger('notify:popup', {\r\n        title: currentItem.get('title'),\r\n        body: currentItem.get('body')\r\n      });\r\n\r\n      Adapt.on('popup:opened', function() {\r\n        // Set the visited attribute for small and medium screen devices\r\n        currentItem.toggleVisited(true);\r\n      });\r\n    },\r\n\r\n    onNavigationClicked: function(event) {\r\n      var stage = this.model.getActiveItem().get('_index');\r\n\r\n      if ($(event.currentTarget).hasClass('narrative__controls-right')) {\r\n        this.model.setActiveItem(++stage);\r\n      } else if ($(event.currentTarget).hasClass('narrative__controls-left')) {\r\n        this.model.setActiveItem(--stage);\r\n      }\r\n    },\r\n\r\n    onProgressClicked: function(event) {\r\n      event && event.preventDefault();\r\n      var clickedIndex = $(event.target).data('index');\r\n      this.model.setActiveItem(clickedIndex);\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return NarrativeView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './narrativeView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, NarrativeView, ItemsComponentModel) {\r\n\r\n  return Adapt.register('narrative', {\r\n    model: ItemsComponentModel,\r\n    view: NarrativeView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  var SliderView = QuestionView.extend({\r\n\r\n    events: {\r\n      'click .js-slider-number-click': 'onNumberSelected',\r\n      'focus .js-slider-item-input': 'onHandleFocus',\r\n      'blur .js-slider-item-input': 'onHandleBlur'\r\n    },\r\n\r\n    // Used by the question to reset the question when revisiting the component\r\n    resetQuestionOnRevisit: function() {\r\n      this.setAllItemsEnabled();\r\n      this.model.deselectAllItems();\r\n      this.resetQuestion();\r\n    },\r\n\r\n    // Used by question to setup itself just before rendering\r\n    setupQuestion: function() {\r\n      if (this.model.get('_isSubmitted')) return;\r\n\r\n      this.selectItem(this.getIndexFromValue(this.model.get('_selectedItem').value), true);\r\n    },\r\n\r\n    setupRangeslider: function () {\r\n      this.$sliderScaleMarker = this.$('.js-slider-number-selection');\r\n      this.$slider = this.$('.js-slider-item-input');\r\n      if (this.model.has('_scaleStep')) {\r\n        this.$slider.attr({\"step\": this.model.get('_scaleStep')});\r\n      }\r\n\r\n      this.$slider.rangeslider({\r\n        polyfill: false,\r\n        onSlide: _.bind(this.handleSlide, this)\r\n      });\r\n      this.oldValue = 0;\r\n\r\n      if (this._deferEnable) {\r\n        this.setAllItemsEnabled();\r\n      }\r\n    },\r\n\r\n    handleSlide: function (position, value) {\r\n      if (this.oldValue === value) {\r\n        return;\r\n      }\r\n      var itemIndex = this.getIndexFromValue(value);\r\n      var pixels = this.mapIndexToPixels(itemIndex);\r\n      this.selectItem(itemIndex, false);\r\n      this.animateToPosition(pixels);\r\n      this.oldValue = value;\r\n    },\r\n\r\n    disableQuestion: function() {\r\n      this.setAllItemsEnabled();\r\n    },\r\n\r\n    enableQuestion: function() {\r\n      this.setAllItemsEnabled();\r\n    },\r\n\r\n    setAllItemsEnabled: function() {\r\n      var isEnabled = this.model.get('_isEnabled');\r\n\r\n      if (!this.$slider) {\r\n        this._deferEnable = true; // slider is not yet ready\r\n        return;\r\n      }\r\n\r\n      if (!isEnabled) {\r\n        this.$('.slider__widget').addClass('is-disabled');\r\n        this.$slider.prop('disabled', true).rangeslider('update', true);\r\n        return;\r\n      }\r\n\r\n      this.$('.slider__widget').removeClass('is-disabled');\r\n      this.$slider.prop('disabled', false).rangeslider('update', true);\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n      this.setupRangeslider();\r\n      this.setScalePositions();\r\n      this.onScreenSizeChanged();\r\n      this.showScaleMarker(true);\r\n      this.listenTo(Adapt, 'device:resize', this.onScreenSizeChanged);\r\n      this.setReadyStatus();\r\n    },\r\n\r\n    // this should make the slider handle, slider marker and slider bar to animate to give position\r\n    animateToPosition: function(newPosition) {\r\n      if (!this.$sliderScaleMarker) return;\r\n\r\n      this.$sliderScaleMarker\r\n        .velocity('stop')\r\n        .velocity({\r\n          left: newPosition\r\n        }, {\r\n          duration: 200,\r\n          easing: \"linear\",\r\n          mobileHA: false\r\n        });\r\n    },\r\n\r\n    // this shoud give the index of item using given slider value\r\n    getIndexFromValue: function(itemValue) {\r\n      var scaleStart = this.model.get('_scaleStart');\r\n      var scaleEnd = this.model.get('_scaleEnd');\r\n      return Math.round(this.mapValue(itemValue, scaleStart, scaleEnd, 0, this.model.get('_items').length - 1));\r\n    },\r\n\r\n    mapIndexToPixels: function(value, $widthObject) {\r\n      var numberOfItems = this.model.get('_items').length;\r\n      var width = $widthObject ? $widthObject.width() : this.$('.js-slider-scale').width();\r\n\r\n      return Math.round(this.mapValue(value, 0, numberOfItems - 1, 0, width));\r\n    },\r\n\r\n    mapPixelsToIndex: function(value) {\r\n      var numberOfItems = this.model.get('_items').length;\r\n      var width = this.$('.slider-sliderange').width();\r\n\r\n      return Math.round(this.mapValue(value, 0, width, 0, numberOfItems - 1));\r\n    },\r\n\r\n    normalise: function(value, low, high) {\r\n      var range = high - low;\r\n      return (value - low) / range;\r\n    },\r\n\r\n    mapValue: function(value, inputLow, inputHigh, outputLow, outputHigh) {\r\n      var normal = this.normalise(value, inputLow, inputHigh);\r\n      return normal * (outputHigh - outputLow) + outputLow;\r\n    },\r\n\r\n    onHandleFocus: function(event) {\r\n      event.preventDefault();\r\n      this.$slider.on('keydown', _.bind(this.onKeyDown, this));\r\n    },\r\n\r\n    onHandleBlur: function(event) {\r\n      event.preventDefault();\r\n      this.$slider.off('keydown');\r\n    },\r\n\r\n    onKeyDown: function(event) {\r\n      if (event.which === 9) return; // tab key\r\n      event.preventDefault();\r\n\r\n      var newItemIndex = this.getIndexFromValue(this.model.get('_selectedItem').value);\r\n\r\n      switch (event.which) {\r\n        case 40: //  down\r\n        case 37: //  left\r\n          newItemIndex = Math.max(newItemIndex - 1, 0);\r\n          break;\r\n        case 38: //  up\r\n        case 39: //  right\r\n          newItemIndex = Math.min(newItemIndex + 1, this.model.get('_items').length - 1);\r\n          break;\r\n      }\r\n\r\n      this.selectItem(newItemIndex);\r\n      if (typeof newItemIndex === 'number') this.showScaleMarker(true);\r\n      this.animateToPosition(this.mapIndexToPixels(newItemIndex));\r\n      this.setSliderValue(this.getValueFromIndex(newItemIndex));\r\n    },\r\n\r\n    onNumberSelected: function(event) {\r\n      event.preventDefault();\r\n\r\n      if (this.model.get('_isInteractionComplete')) {\r\n        return;\r\n      }\r\n\r\n      // when component is not reset, selecting a number should be prevented\r\n      if (this.$slider.prop('disabled')) {\r\n        return;\r\n      }\r\n\r\n      var itemValue = parseFloat($(event.currentTarget).attr('data-id'));\r\n      var index = this.getIndexFromValue(itemValue);\r\n      this.selectItem(index);\r\n      this.animateToPosition(this.mapIndexToPixels(index));\r\n      this.setSliderValue(itemValue);\r\n    },\r\n\r\n    getValueFromIndex: function(index) {\r\n      return this.model.get('_items')[index].value;\r\n    },\r\n\r\n    resetControlStyles: function() {\r\n      this.$('.slider-handle').empty();\r\n      this.showScaleMarker(false);\r\n      this.$('.slider-bar').animate({width:'0px'});\r\n      this.setSliderValue(this.model.get('_items')[0].value);\r\n    },\r\n\r\n    onCannotSubmit: function() {},\r\n\r\n    setSliderValue: function (value) {\r\n      if (this.$slider) {\r\n        this.$slider.val(value).change();\r\n      }\r\n    },\r\n\r\n    showMarking: function() {\r\n      if (!this.model.get('_canShowMarking')) return;\r\n\r\n      this.$('.slider__widget').removeClass('is-correct is-incorrect')\r\n          .addClass(this.model.get('_selectedItem').correct ? 'is-correct' : 'is-incorrect');\r\n    },\r\n\r\n    resetQuestion: function() {\r\n      this.selectItem(0, true);\r\n      this.animateToPosition(0);\r\n      this.resetControlStyles();\r\n      this.showScaleMarker(true);\r\n    },\r\n\r\n    setScalePositions: function() {\r\n      var numberOfItems = this.model.get('_items').length;\r\n      _.each(this.model.get('_items'), function(item, index) {\r\n        var normalisedPosition = this.normalise(index, 0, numberOfItems -1);\r\n        this.$('.js-slider-number').eq(index).data('normalisedPosition', normalisedPosition);\r\n      }, this);\r\n    },\r\n\r\n    showScale: function () {\r\n      var $markers = this.$('.js-slider-scale-notch-container').empty();\r\n\r\n      if (this.model.get('_showScale') === false) {\r\n        $markers.eq(0).css({display: 'none'});\r\n        this.$('.js-slider-number').css(\r\n          this.model.get('_showScaleIndicator') ? {visibility: 'hidden'} : {display: 'none'}\r\n        );\r\n        return;\r\n      }\r\n\r\n      var $scaler = this.$('.js-slider-scale');\r\n      for (var i = 1, count = this.model.get('_items').length - 1; i < count; i++) {\r\n        $markers.append(\"<div class='slider__scale-notch' style='left: \" + this.mapIndexToPixels(i, $scaler) + \"px'>\");\r\n      }\r\n      // Do we show scale numbers\r\n      this.showScaleNumbers();\r\n    },\r\n\r\n    showScaleNumbers: function () {\r\n      var $scaler = this.$('.js-slider-scale');\r\n      var $numbers = this.$('.js-slider-number');\r\n\r\n      if (this.model.get('_showScaleNumbers') === false) {\r\n        $numbers.css('display', 'none');\r\n        return;\r\n      }\r\n\r\n      var scaleWidth = $scaler.width();\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        var $number = $numbers.eq(index);\r\n        var newLeft = Math.round($number.data('normalisedPosition') * scaleWidth);\r\n        $number.css({left: newLeft});\r\n      });\r\n    },\r\n\r\n    //Labels are enabled in slider.hbs. Here we manage their containing div.\r\n    showLabels: function () {\r\n      if (!this.model.get('labelStart') && !this.model.get('labelEnd')) {\r\n        this.$('.js-slider-label-container').eq(0).css({display: 'none'});\r\n      }\r\n    },\r\n\r\n    remapSliderBar: function() {\r\n      var $scaler = this.$('.js-slider-scale');\r\n      var currentIndex = this.getIndexFromValue(this.model.get('_selectedItem').value);\r\n      var left = this.mapIndexToPixels(currentIndex, $scaler);\r\n      this.$('.slider-handle').css({left: left + 'px'});\r\n      this.$('.js-slider-number-selection').css({left: left + 'px'});\r\n      this.$('.slider-bar').width(left);\r\n    },\r\n\r\n    onScreenSizeChanged: function() {\r\n      this.showScale();\r\n      this.showLabels();\r\n      this.remapSliderBar();\r\n      if (this.$('.slider__widget').hasClass('show-user-answer')) {\r\n        this.hideCorrectAnswer();\r\n      } else if (this.$('.slider__widget').hasClass('show-correct-answer')) {\r\n        this.showCorrectAnswer();\r\n      }\r\n    },\r\n\r\n    showCorrectAnswer: function() {\r\n      var answers = [];\r\n\r\n      if (this.model.has('_correctAnswer')) {\r\n        var correctAnswer = this.model.get('_correctAnswer');\r\n      }\r\n\r\n      if (this.model.has('_correctRange')) {\r\n        var bottom = this.model.get('_correctRange')._bottom;\r\n        var top = this.model.get('_correctRange')._top;\r\n        var step = (this.model.has('_scaleStep') ? this.model.get('_scaleStep') : 1);\r\n      }\r\n\r\n      this.showScaleMarker(false);\r\n\r\n      //are we dealing with a single correct answer or a range?\r\n      if (correctAnswer) {\r\n        answers.push(correctAnswer);\r\n      } else if (bottom !== undefined && top !== undefined) {\r\n        var answer = this.model.get('_correctRange')._bottom;\r\n        var topOfRange = this.model.get('_correctRange')._top;\r\n        while (answer <= topOfRange) {\r\n          answers.push(answer);\r\n          answer += step;\r\n        }\r\n      } else {\r\n        console.log(\"adapt-contrib-slider::WARNING: no correct answer or correct range set in JSON\");\r\n      }\r\n\r\n      var middleAnswer = answers[Math.floor(answers.length / 2)];\r\n      this.animateToPosition(this.mapIndexToPixels(this.getIndexFromValue(middleAnswer)));\r\n\r\n      this.showModelAnswers(answers);\r\n\r\n      this.setSliderValue(middleAnswer);\r\n    },\r\n\r\n    showModelAnswers: function(correctAnswerArray) {\r\n      var $parentDiv = this.$('.js-slider-model-range');\r\n      _.each(correctAnswerArray, function(correctAnswer, index) {\r\n        $parentDiv.append($(\"<div class='slider__number-model-answer'>\"));\r\n\r\n        var $element = $(this.$('.js-slider-model-range .slider__number-model-answer')[index]);\r\n        var startingLeft = this.mapIndexToPixels(this.getIndexFromValue(this.model.get('_selectedItem').value));\r\n\r\n        if (this.model.get('_showNumber')) $element.html(correctAnswer);\r\n\r\n        $element.css({left:startingLeft}).fadeIn(0, _.bind(function() {\r\n          $element.animate({left: this.mapIndexToPixels(this.getIndexFromValue(correctAnswer))});\r\n        }, this));\r\n      }, this);\r\n    },\r\n\r\n    hideCorrectAnswer: function() {\r\n      var userAnswerIndex = this.getIndexFromValue(this.model.get('_userAnswer'));\r\n      this.$('.js-slider-model-range').empty();\r\n\r\n      this.showScaleMarker(true);\r\n      this.selectItem(userAnswerIndex, true);\r\n      this.animateToPosition(this.mapIndexToPixels(userAnswerIndex));\r\n      this.setSliderValue(this.model.get('_userAnswer'));\r\n    },\r\n\r\n    // according to given item index this should make the item as selected\r\n    selectItem: function(itemIndex, noFocus) {\r\n      _.each(this.model.get('_items'), function(item, index) {\r\n        item.selected = (index === itemIndex);\r\n        if (item.selected) {\r\n          this.model.set('_selectedItem', item);\r\n          this.$('.js-slider-item-input').attr({\r\n            \"value\": item.value,\r\n            \"aria-valuenow\": item.value\r\n          });\r\n        }\r\n      }, this);\r\n      this.showNumber(true);\r\n    },\r\n\r\n    // this makes the marker visible or hidden\r\n    showScaleMarker: function(show) {\r\n      var $scaleMarker = this.$('.js-slider-number-selection');\r\n      if (this.model.get('_showScaleIndicator')) {\r\n        this.showNumber(show);\r\n        if(show) {\r\n          $scaleMarker.addClass('display-block');\r\n        } else {\r\n          $scaleMarker.removeClass('display-block');\r\n        }\r\n      }\r\n    },\r\n\r\n    // this should add the current slider value to the marker\r\n    showNumber: function(show) {\r\n      var $scaleMarker = this.$('.js-slider-number-selection');\r\n      if (this.model.get('_showNumber')) {\r\n        if (show) {\r\n          $scaleMarker.html(this.model.get('_selectedItem').value);\r\n        } else {\r\n          $scaleMarker.html = \"\";\r\n        }\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return SliderView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel'\r\n], function(Adapt, QuestionModel) {\r\n\r\n  var SliderModel = QuestionModel.extend({\r\n\r\n    init:function() {\r\n      QuestionModel.prototype.init.call(this);\r\n\r\n      this.setupModelItems();\r\n\r\n      this.set('_selectedItem', this.get('_items')[0]);\r\n    },\r\n\r\n    /**\r\n     * Returns the number of decimal places in a specified number\r\n     */\r\n    getDecimalPlaces: function(num) {\r\n      return (num.toString().split('.')[1] || []).length;\r\n    },\r\n\r\n    setupModelItems: function() {\r\n      var items = [];\r\n      var answer = this.get('_correctAnswer');\r\n      var range = this.get('_correctRange');\r\n      var start = this.get('_scaleStart');\r\n      var end = this.get('_scaleEnd');\r\n      var step = this.get('_scaleStep') || 1;\r\n\r\n      var dp = this.getDecimalPlaces(step);\r\n\r\n      for (var i = start; i <= end; i += step) {\r\n        if (dp !== 0) {\r\n          // Ensure that steps with decimal places are handled correctly.\r\n          i = parseFloat(i.toFixed(dp));\r\n        }\r\n\r\n        items.push({\r\n          value: i,\r\n          selected: false,\r\n          // _correctAnswer/answer is a String - this allows AAT users to assign it no value when _correctRange needs to be used instead\r\n          // we therefore need to convert it to Number when checking the answer (see https://github.com/adaptlearning/adapt_framework/issues/2259)\r\n          correct : answer ? i === Number(answer) : (i >= range._bottom && i <= range._top)\r\n        });\r\n      }\r\n\r\n      this.set({\r\n        '_items': items,\r\n        '_marginDir': Adapt.config.get('_defaultDirection') === 'rtl' ? 'right' : 'left'\r\n      });\r\n    },\r\n\r\n    /**\r\n    * allow the user to submit immediately; the slider handle may already be in the position they want to choose\r\n    */\r\n    canSubmit: function() {\r\n      return true;\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n      if (!this.get('_isSubmitted')) {\r\n        this.set({\r\n          _selectedItem: {},\r\n          _userAnswer: undefined\r\n        });\r\n        return;\r\n      }\r\n\r\n      var items = this.get('_items');\r\n      var userAnswer = this.get('_userAnswer');\r\n      for (var i = 0, l = items.length; i < l; i++) {\r\n        var item = items[i];\r\n        if (item.value === userAnswer) {\r\n          item.selected = true;\r\n          this.set('_selectedItem', item);\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    //This preserves the state of the users answers for returning or showing the users answer\r\n    storeUserAnswer: function() {\r\n      this.set('_userAnswer', this.get('_selectedItem').value);\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n      this.set({\r\n        _isAtLeastOneCorrectSelection: false,\r\n        _selectedItem: {},\r\n        _userAnswer: undefined\r\n      });\r\n    },\r\n\r\n    deselectAllItems: function() {\r\n      _.each(this.get('_items'), function(item) {\r\n        item.selected = false;\r\n      }, this);\r\n    },\r\n\r\n    isCorrect: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n\r\n      _.each(this.get('_items'), function(item, index) {\r\n        if (item.selected && item.correct) {\r\n          this.set('_isAtLeastOneCorrectSelection', true);\r\n          numberOfCorrectAnswers++;\r\n        }\r\n      }, this);\r\n\r\n      this.set('_numberOfCorrectAnswers', numberOfCorrectAnswers);\r\n\r\n      return this.get('_isAtLeastOneCorrectSelection') ? true : false;\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    // Used to set the score based upon the _questionWeight\r\n    setScore: function() {\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var questionWeight = this.get('_questionWeight');\r\n      var score = questionWeight * numberOfCorrectAnswers;\r\n      this.set('_score', score);\r\n    },\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    */\r\n    getResponse:function() {\r\n      return this.get('_userAnswer').toString();\r\n    },\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    */\r\n    getResponseType:function() {\r\n      return \"numeric\";\r\n    }\r\n\r\n  });\r\n\r\n  return SliderModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './sliderView',\r\n  './sliderModel',\r\n  'libraries/rangeslider'\r\n], function(Adapt, SliderView, SliderModel) {\r\n\r\n  return Adapt.register(\"slider\", {\r\n    view: SliderView,\r\n    model: SliderModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentView, ComponentModel) {\r\n\r\n  var TextView = ComponentView.extend({\r\n\r\n    preRender: function() {\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    postRender: function() {\r\n      this.setReadyStatus();\r\n\r\n      this.setupInview();\r\n    },\r\n\r\n    setupInview: function() {\r\n      var selector = this.getInviewElementSelector();\r\n      if (!selector) {\r\n        this.setCompletionStatus();\r\n        return;\r\n      }\r\n\r\n      this.setupInviewCompletion(selector);\r\n    },\r\n\r\n    /**\r\n     * determines which element should be used for inview logic - body, instruction or title - and returns the selector for that element\r\n     */\r\n    getInviewElementSelector: function() {\r\n      if (this.model.get('body')) return '.component__body';\r\n\r\n      if (this.model.get('instruction')) return '.component__instruction';\r\n\r\n      if (this.model.get('title') || this.model.get('displayTitle')) return '.component__title';\r\n\r\n      return null;\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n  },\r\n  {\r\n    template: 'text'\r\n  });\r\n\r\n  return Adapt.register('text', {\r\n    model: ComponentModel.extend({}),// create a new class in the inheritance chain so it can be extended per component type if necessary later\r\n    view: TextView\r\n  });\r\n});\r\n","define([\r\n  'core/js/views/questionView'\r\n], function(QuestionView) {\r\n\r\n  var TextInputView = QuestionView.extend({\r\n\r\n    events: {\r\n      'focus .js-textinput-textbox': 'clearValidationError',\r\n      'change .js-textinput-textbox': 'onInputChanged',\r\n      'keyup .js-textinput-textbox': 'onInputChanged'\r\n    },\r\n\r\n    resetQuestionOnRevisit: function() {\r\n      this.setAllItemsEnabled(false);\r\n      this.resetQuestion();\r\n    },\r\n\r\n    setupQuestion: function() {\r\n      this.model.setupRandomisation();\r\n    },\r\n\r\n    disableQuestion: function() {\r\n      this.setAllItemsEnabled(false);\r\n    },\r\n\r\n    enableQuestion: function() {\r\n      this.setAllItemsEnabled(true);\r\n    },\r\n\r\n    setAllItemsEnabled: function(isEnabled) {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        var $itemInput = this.$('.js-textinput-textbox').eq(index);\r\n\r\n        $itemInput.prop('disabled', !isEnabled);\r\n      }, this);\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n      this.setReadyStatus();\r\n    },\r\n\r\n    clearValidationError: function() {\r\n      this.$('.js-textinput-textbox').removeClass('has-error');\r\n    },\r\n\r\n    // Blank method for question to fill out when the question cannot be submitted\r\n    onCannotSubmit: function() {\r\n      this.showValidationError();\r\n    },\r\n\r\n    showValidationError: function() {\r\n      this.$('.js-textinput-textbox').addClass('has-error');\r\n    },\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking: function() {\r\n      if (!this.model.get('_canShowMarking')) return;\r\n\r\n      this.model.get('_items').forEach(function(item, i) {\r\n        var $item = this.$('.js-textinput-item').eq(i);\r\n        $item.removeClass('is-correct is-incorrect').addClass(item._isCorrect ? 'is-correct' : 'is-incorrect');\r\n      }, this);\r\n    },\r\n\r\n    // Used by the question view to reset the look and feel of the component.\r\n    resetQuestion: function() {\r\n      this.$('.js-textinput-textbox').prop('disabled', !this.model.get('_isEnabled')).val('');\r\n\r\n      this.model.set({\r\n        _isAtLeastOneCorrectSelection: false,\r\n        _isCorrect: undefined\r\n      });\r\n    },\r\n\r\n    showCorrectAnswer: function() {\r\n\r\n      if (this.model.get('_answers'))  {\r\n\r\n        var correctAnswers = this.model.get('_answers');\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinput-textbox').eq(index).val(correctAnswers[index][0]);\r\n        }, this);\r\n\r\n      } else {\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinput-textbox').eq(index).val(item._answers[0]);\r\n        }, this);\r\n      }\r\n\r\n    },\r\n\r\n    hideCorrectAnswer: function() {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        this.$('.js-textinput-textbox').eq(index).val(item.userAnswer);\r\n      }, this);\r\n    },\r\n\r\n    onInputChanged: function(e) {\r\n      var $input = $(e.target);\r\n      this.model.setItemUserAnswer($input.parents('.js-textinput-item').index(), $input.val());\r\n    }\r\n\r\n  });\r\n\r\n  return TextInputView;\r\n\r\n});\r\n","define([\r\n  'core/js/models/questionModel'\r\n], function(QuestionModel) {\r\n\r\n  var TextInputModel = QuestionModel.extend({\r\n\r\n    init: function() {\r\n      QuestionModel.prototype.init.call(this);\r\n\r\n      this.set( '_genericAnswerIndexOffset', TextInputModel.genericAnswerIndexOffset );\r\n\r\n      this.setupQuestionItemIndexes();\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    setupQuestionItemIndexes: function() {\r\n      this.get('_items').forEach(function(item, index) {\r\n\r\n        if (item._index === undefined) item._index = index;\r\n        if (item._answerIndex === undefined) item._answerIndex = -1;\r\n\r\n      });\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      var userAnswer = this.get('_userAnswer');\r\n      var genericAnswers = this.get('_answers');\r\n      this.get('_items').forEach(function(item) {\r\n        var answerIndex = userAnswer[item._index];\r\n        if (answerIndex >= TextInputModel.genericAnswerIndexOffset) {\r\n          item.userAnswer = genericAnswers[answerIndex - TextInputModel.genericAnswerIndexOffset];\r\n          item._answerIndex = answerIndex;\r\n        } else if (answerIndex > -1) {\r\n          item.userAnswer = item._answers[answerIndex];\r\n          item._answerIndex = answerIndex;\r\n        } else {\r\n          if (item.userAnswer === undefined) item.userAnswer = '******';\r\n          item._answerIndex = -1;\r\n        }\r\n        if (item.userAnswer instanceof Array) item.userAnswer = item.userAnswer[0];\r\n      });\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    setupRandomisation: function() {\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n\r\n      this.set('_items', _.shuffle(this.get('_items')));\r\n    },\r\n\r\n    // Use to check if the user is allowed to submit the question\r\n    canSubmit: function() {\r\n      // can submit if every item has user input\r\n      return this.get('_items').every(({ userAnswer }) => userAnswer);\r\n    },\r\n\r\n    setItemUserAnswer:function(itemIndex, userAnswer) {\r\n      var item = this.get('_items')[itemIndex];\r\n      item.userAnswer = userAnswer;\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    //This preserve the state of the users answers for returning or showing the users answer\r\n    storeUserAnswer: function() {\r\n      var items = this.get('_items');\r\n\r\n      this.isCorrect();\r\n\r\n      var userAnswer = new Array( items.length );\r\n      items.forEach(function(item, index) {\r\n        userAnswer[ item._index ] = item._answerIndex;\r\n      });\r\n      this.set('_userAnswer', userAnswer);\r\n    },\r\n\r\n    isCorrect: function() {\r\n      if (this.get('_answers')) {\r\n        this.markGenericAnswers();\r\n      } else {\r\n        this.markSpecificAnswers();\r\n      }\r\n      // do we have any _isCorrect == false?\r\n      return !_.contains(_.pluck(this.get('_items'), '_isCorrect'), false);\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    // Allows the learner to give answers into any input, ignoring the order.\r\n    // (this excludes any inputs which have their own specific answers).\r\n    markGenericAnswers: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n      var correctAnswers = this.get('_answers').slice();\r\n      var usedAnswerIndexes = [];\r\n\r\n      this.get('_items').forEach(function(item) {\r\n        correctAnswers.forEach(function(answerGroup, answerIndex) {\r\n          if (_.indexOf(usedAnswerIndexes, answerIndex) > -1) return;\r\n\r\n          if (this.checkAnswerIsCorrect(answerGroup, item.userAnswer) == false) return;\r\n\r\n          usedAnswerIndexes.push(answerIndex);\r\n          item._isCorrect = true;\r\n          item._answerIndex = answerIndex + TextInputModel.genericAnswerIndexOffset;\r\n\r\n          this.set({\r\n            _numberOfCorrectAnswers: ++numberOfCorrectAnswers,\r\n            _isAtLeastOneCorrectSelection: true\r\n          });\r\n\r\n        }, this);\r\n        if(!item._isCorrect) item._isCorrect = false;\r\n      }, this);\r\n    },\r\n\r\n    // Marks any items which have answers specific to it\r\n    // (i.e. item has a _answers array)\r\n    markSpecificAnswers: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n      this.get('_items').forEach(function(item) {\r\n        if (!item._answers) return;\r\n        var userAnswer = item.userAnswer || '';\r\n        if (this.checkAnswerIsCorrect(item._answers, userAnswer)) {\r\n          item._isCorrect = true;\r\n          item._answerIndex = _.indexOf(item._answers, this.cleanupUserAnswer(userAnswer));\r\n          this.set({\r\n            _numberOfCorrectAnswers: ++numberOfCorrectAnswers,\r\n            _isAtLeastOneCorrectSelection: true\r\n          });\r\n        } else {\r\n          item._isCorrect = false;\r\n          item._answerIndex = -1;\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    checkAnswerIsCorrect: function(possibleAnswers, userAnswer) {\r\n      var uAnswer = this.cleanupUserAnswer(userAnswer);\r\n      var matched = possibleAnswers.filter(function(cAnswer) {\r\n        return this.cleanupUserAnswer(cAnswer) == uAnswer;\r\n      }, this);\r\n\r\n      var answerIsCorrect = matched && matched.length > 0;\r\n      if (answerIsCorrect) this.set('_hasAtLeastOneCorrectSelection', true);\r\n      return answerIsCorrect;\r\n    },\r\n\r\n    cleanupUserAnswer: function(userAnswer) {\r\n      if (this.get('_allowsAnyCase')) {\r\n        userAnswer = userAnswer.toLowerCase();\r\n      }\r\n      if (this.get('_allowsPunctuation')) {\r\n        userAnswer = userAnswer.replace(/[\\.,-\\/#!$%\\^&\\*;:{}=\\-_`~()]/g, '');\r\n        //remove any orphan double spaces and replace with single space (B & Q)->(B  Q)->(B Q)\r\n        userAnswer = userAnswer.replace(/(  +)+/g, ' ');\r\n      }\r\n      // removes whitespace from beginning/end (leave any in the middle)\r\n      return $.trim(userAnswer);\r\n    },\r\n\r\n    // Used to set the score based upon the _questionWeight\r\n    setScore: function() {\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var questionWeight = this.get('_questionWeight');\r\n      var itemLength = this.get('_items').length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n      this.get('_items').forEach(function(item) {\r\n        item._isCorrect = false;\r\n        item.userAnswer = '';\r\n      });\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * returns the user's answers as a string in the format 'answer1[,]answer2[,]answer3'\r\n    * the use of [,] as an answer delimiter is from the SCORM 2004 specification for the fill-in interaction type\r\n    */\r\n    getResponse: function() {\r\n      return _.pluck(this.get('_items'), 'userAnswer').join('[,]');\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    */\r\n    getResponseType: function() {\r\n      return 'fill-in';\r\n    }\r\n  }, {\r\n    genericAnswerIndexOffset: 65536\r\n  });\r\n\r\n  return TextInputModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './textInputView',\r\n  './textInputModel',\r\n], function(Adapt, TextInputView, TextInputModel) {\r\n\r\n  return Adapt.register('textinput', {\r\n    view: TextInputView,\r\n    model: TextInputModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  /**\r\n   * Modified version of adapt-contrib-textInput/js/textInputView\r\n   * \r\n   * DD SPECIFIC! WILL NOT WORK WITH VANILLA ADAPT!\r\n   * \r\n   * FIXME:\r\n   * ------\r\n   * Due to being a copy paste; this script needs a good cleanup.\r\n   */\r\n\r\n  class TextInputPlusView extends QuestionView {\r\n\r\n    events() {\r\n      return {\r\n        \"input .js-essay-textarea\" : \"onTextAreaInput\",\r\n        \"click .js-essay-answer-btn\" : \"onAnswerBtnClick\"\r\n      }\r\n    }\r\n\r\n    onTextAreaInput(event) {\r\n      this.model.set(\"_userInput\", $(event.currentTarget).val());\r\n    }\r\n\r\n    setupEventListeners() {\r\n\r\n      this.listenTo(this.model, \"change:_userInput\", this.onUserInputChange)\r\n      this.listenTo(this.model, \"change:_isShowingAnswer\", this.onShowingAnswerChange)\r\n    }\r\n\r\n    onUserInputChange(model, userInput) {\r\n\r\n      this.$(\".js-essay-length\")\r\n        .toggleClass(\"has-error\", \r\n          userInput.length < this.model.get(\"_answerLength\")._min || \r\n          userInput.length > this.model.get(\"_answerLength\")._max);\r\n\r\n      this.$(\".js-essay-length-count\").text(userInput.length);\r\n    }\r\n\r\n    // FIXME: _isShowingAnswer is a temp name for the variable.\r\n    onAnswerBtnClick() {\r\n      this.model.set(\"_isShowingAnswer\", !Boolean(this.model.get(\"_isShowingAnswer\")));\r\n    }\r\n\r\n    onShowingAnswerChange(model, isShowingAnswer) {\r\n      this.$el.toggleClass(\"is-answer-shown\", isShowingAnswer);\r\n      this.$(\".js-essay-answer-btn\").text(\r\n        isShowingAnswer ? \"Hide example essay\" : \"Show example essay\"\r\n      )\r\n    }\r\n\r\n    postRender() {\r\n      super.postRender();\r\n\r\n      this.setupEventListeners();\r\n    }\r\n\r\n    resetQuestionOnRevisit() {\r\n      this.setAllItemsEnabled(false);\r\n      this.resetQuestion();\r\n    }\r\n\r\n    setupQuestion() {\r\n      this.model.setupRandomisation();\r\n    }\r\n\r\n    disableQuestion() {\r\n      this.setAllItemsEnabled(false);\r\n    }\r\n\r\n    enableQuestion() {\r\n      this.setAllItemsEnabled(true);\r\n    }\r\n\r\n    setAllItemsEnabled(isEnabled) {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        var $itemInput = this.$('.js-textinputplus-textbox').eq(index);\r\n\r\n        $itemInput.prop('disabled', !isEnabled);\r\n      }, this);\r\n    }\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n    }\r\n\r\n    clearValidationError() {\r\n      //this.$('.js-textinputplus-textbox-container').removeClass('is-incorrect');\r\n    }\r\n\r\n    // Blank method for question to fill out when the question cannot be submitted\r\n    onCannotSubmit() {\r\n      this.showValidationError();\r\n    }\r\n\r\n    showValidationError() {\r\n      //this.$('.js-textinputplus-textbox-container').addClass('is-incorrect');\r\n    }\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking() {\r\n\r\n    }\r\n\r\n    updateMarking() {\r\n      \r\n    }\r\n\r\n    // Used by the question view to reset the look and feel of the component.\r\n    resetQuestion() {\r\n      this.$('.js-textinputplus-textbox')\r\n        .prop('disabled', !this.model.get('_isEnabled'))\r\n        .val('');\r\n\r\n      /*this.$(\".js-textinputplus-textbox-container\")\r\n        .removeClass('is-incorrect is-correct');*/\r\n\r\n      this.attemptsBeforeHint = 3;\r\n\r\n      this.model.set({\r\n        _isAtLeastOneCorrectSelection: false,\r\n        _isCorrect: undefined\r\n      });\r\n    }\r\n\r\n    showCorrectAnswer() {\r\n\r\n      if (this.model.get('_answers'))  {\r\n\r\n        var correctAnswers = this.model.get('_answers');\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinputplus-textbox').eq(index).val(correctAnswers[index][0]);\r\n        }, this);\r\n\r\n      } else {\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinputplus-textbox').eq(index).val(item._answers[0]);\r\n        }, this);\r\n      }\r\n\r\n    }\r\n\r\n    hideCorrectAnswer() {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        this.$('.js-textinputplus-textbox').eq(index).val(item.userAnswer);\r\n      }, this);\r\n    }\r\n\r\n    onInputChanged(e) {\r\n      var $input = $(e.target);\r\n      this.model.setItemUserAnswer($input.attr('data-adapt-index'), $input.val());\r\n    }\r\n\r\n    // Completely reset an item its initial state (visibly; its record of incorrect answers will remain).\r\n    clearItemState(index) {\r\n      \r\n      let $input = this.$('.js-textinputplus-textbox');\r\n      let $item = this.$('.js-textinputplus-item');\r\n\r\n      // Allow for a specific index to be used if the parameter is provided.\r\n      if (index !== undefined) {\r\n        $item = $item.filter(\"[data-adapt-index=\" + index + \"]\");\r\n        $input = $input.filter(\"[data-adapt-index=\" + index + \"]\");\r\n      }\r\n\r\n      $input\r\n        .prop('disabled', !this.model.get('_isEnabled'))\r\n        .val('') // Clear value\r\n        .parent().removeClass('is-incorrect is-correct') // Remove error class.\r\n\r\n      this.model.setItemUserAnswer(index, '');\r\n\r\n      $item.removeClass('is-correct is-incorrect');\r\n    }\r\n\r\n    /**\r\n     * Note: hidden feature.\r\n     * If the user thinks the 'X' over the input is a button, they may try to click it.\r\n     * Have the action simply clear the input field if they do (since the X is there, it means it's wrong anyway). \r\n     */\r\n    onIncorrectIconClick(event) {\r\n      let index = $(event.currentTarget).attr(\"data-adapt-index\");\r\n      this.clearItemState(index);\r\n    }\r\n\r\n  }\r\n\r\n  return TextInputPlusView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel'\r\n], function(Adapt, QuestionModel) {\r\n\r\n  var TextInputPlusModel = QuestionModel.extend({\r\n\r\n    init: function() {\r\n      QuestionModel.prototype.init.call(this);\r\n      this.checkCanSubmit();\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners() {\r\n      this.listenTo(this, \"change:_userInput\", this.checkCanSubmit);\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      var userAnswer = this.get('_userAnswer');\r\n      var genericAnswers = this.get('_answers');\r\n      this.get('_items').forEach(function(item) {\r\n        var answerIndex = userAnswer[item._index];\r\n        if (answerIndex >= TextInputPlusModel.genericAnswerIndexOffset) {\r\n          item.userAnswer = genericAnswers[answerIndex - TextInputPlusModel.genericAnswerIndexOffset];\r\n          item._answerIndex = answerIndex;\r\n        } else if (answerIndex > -1) {\r\n          item.userAnswer = item._answers[answerIndex];\r\n          item._answerIndex = answerIndex;\r\n        } else {\r\n          if (item.userAnswer === undefined) item.userAnswer = '******';\r\n          item._answerIndex = -1;\r\n        }\r\n        if (item.userAnswer instanceof Array) item.userAnswer = item.userAnswer[0];\r\n      });\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    setupFeedback() {\r\n\r\n      let customFeedback = \"\";\r\n\r\n      this.get(\"_incorrectItems\").forEach((item) => {\r\n        let incorrectText = item?._feedback?._incorrect?.body;\r\n        if (incorrectText) {\r\n          customFeedback += `<p>${incorrectText}</p>`;\r\n        }\r\n      });\r\n      this.get(\"_correctItems\").forEach((item) => {\r\n        let correText = item?._feedback?._correct?.body;\r\n        if (correText) {\r\n          customFeedback += `<p>${correText}</p>`;\r\n        }\r\n      });\r\n\r\n      this.get(\"_feedback\")._incorrect = _.extend({}, this.get(\"_feedback\")._incorrect, {\r\n        body: customFeedback\r\n      });\r\n\r\n      // Re-set up the feedback for this component.\r\n      Adapt.questionPlus.setUpFeedback(this);\r\n\r\n      QuestionModel.prototype.setupFeedback.call(this);\r\n    },\r\n\r\n    setupRandomisation() {\r\n      \r\n    },\r\n\r\n    // Can submit if the user has typed enough characters into the input field.\r\n    canSubmit: function() {\r\n\r\n      let userInputLength = this.get('_userInput')?.length;\r\n\r\n      return userInputLength > this.get(\"_answerLength\")._min && \r\n             userInputLength < this.get(\"_answerLength\")._max;\r\n    },\r\n\r\n    setItemUserAnswer:function(itemIndex, userAnswer) {\r\n      var item = this.get('_items')[itemIndex];\r\n      item.userAnswer = userAnswer;\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    //This preserve the state of the users answers for returning or showing the users answer\r\n    storeUserAnswer: function() {\r\n      var items = this.get('_items');\r\n\r\n      this.isCorrect();\r\n\r\n      var userAnswer = new Array( items.length );\r\n      items.forEach(function(item, index) {\r\n        userAnswer[ item._index ] = item._answerIndex;\r\n      });\r\n      this.set('_userAnswer', userAnswer);\r\n    },\r\n\r\n    isCorrect: function() {\r\n\r\n      let userInput = this.get(\"_userInput\");\r\n      let items = this.get(\"_items\");\r\n\r\n      let correctItems = [];\r\n      let incorrectItems = [];\r\n\r\n      // For each item...\r\n      items.forEach(item => {\r\n\r\n        // See if any of its terms appear in the userInput.\r\n        let found = Boolean(item._terms.find(term => {\r\n          \r\n          let termFound = userInput.match(new RegExp(\"\\\\b\" + term + \"\\\\b\", \"i\"));\r\n\r\n          return Boolean(termFound);\r\n        }));\r\n\r\n        if (found) correctItems.push(item);\r\n        else       incorrectItems.push(item);\r\n      });\r\n\r\n      this.set({\r\n        _correctItems: correctItems,\r\n        _incorrectItems: incorrectItems\r\n      })\r\n\r\n      return incorrectItems.length === 0;\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    checkAnswerIsCorrect: function(possibleAnswers, userAnswer) {\r\n      var uAnswer = this.cleanupUserAnswer(userAnswer);\r\n      var matched = possibleAnswers.filter(function(cAnswer) {\r\n        return this.cleanupUserAnswer(cAnswer) == uAnswer;\r\n      }, this);\r\n\r\n      var answerIsCorrect = matched && matched.length > 0;\r\n      if (answerIsCorrect) this.set('_hasAtLeastOneCorrectSelection', true);\r\n      return answerIsCorrect;\r\n    },\r\n\r\n    cleanupUserAnswer: function(userAnswer) {\r\n      if (this.get('_allowsAnyCase')) {\r\n        userAnswer = userAnswer.toLowerCase();\r\n      }\r\n      if (this.get('_allowsPunctuation')) {\r\n        userAnswer = userAnswer.replace(/[\\.,-\\/#!$%\\^&\\*;:{}=\\-_`~()]/g, '');\r\n        //remove any orphan double spaces and replace with single space (B & Q)->(B  Q)->(B Q)\r\n        userAnswer = userAnswer.replace(/(  +)+/g, ' ');\r\n      }\r\n      // removes whitespace from beginning/end (leave any in the middle)\r\n      return $.trim(userAnswer);\r\n    },\r\n\r\n    // Used to set the score based upon the _questionWeight\r\n    setScore: function() {\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var questionWeight = this.get('_questionWeight');\r\n      var itemLength = this.get('_items').length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n      this.get('_items').forEach(function(item) {\r\n        item._isCorrect = false;\r\n        item.userAnswer = '';\r\n      });\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * returns the user's answers as a string in the format 'answer1[,]answer2[,]answer3'\r\n    * the use of [,] as an answer delimiter is from the SCORM 2004 specification for the fill-in interaction type\r\n    */\r\n    getResponse: function() {\r\n      return _.pluck(this.get('_items'), 'userAnswer').join('[,]');\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    */\r\n    getResponseType: function() {\r\n      return 'fill-in';\r\n    }\r\n  }, {\r\n    genericAnswerIndexOffset: 65536\r\n  });\r\n\r\n  return TextInputPlusModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './essayView',\r\n  './essayModel',\r\n], function(Adapt, EssayView, EssayModel) {\r\n\r\n  return Adapt.register('essay', {\r\n    view: EssayView,\r\n    model: EssayModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  /**\r\n   * A Question component which shows many items, of which all of the \"correct\" ones (and none of the incorrect ones) must be clicked on by the user to proceed.\r\n   * Script(s) based on adapt-contrib-mcq component implementation.\r\n   * \r\n   * Based on the adapt-contrib-mcq scripts.\r\n   * \r\n   * Notes:\r\n   * \r\n   * TODO:\r\n   * - Add support for images instead of text for the items.\r\n   * - Add tick and cross icons to the left of the text to indicate correctness (for accessibility). \r\n   */\r\n\r\n  const DESELECT_INCORRECT_DELAY = 1000; // Delay increased to fully wait for the notify__popup to fade out\r\n                                         // (fading it out causes older devices to stutter).\r\n\r\n  class FinderView extends QuestionView {\r\n    \r\n    events() {\r\n      return {\r\n        \"click .finder__item\" : \"onItemClick\"\r\n      };\r\n    }\r\n\r\n    initialize() {\r\n      super.initialize();\r\n      this.update = _.debounce(this.update.bind(this), 1);\r\n\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setupQuestion() {\r\n      this.model.setupRandomisation();\r\n\r\n      // Modified:\r\n      // This view's model inherits itemsComponentModel, and as such will consider itself complete if all items have _isVisited: true.\r\n      // adapt-dd-questionPlus doesn't want this, so stop listening for _isVisited events on the items.\r\n      this.model.stopListening(this.model.getChildren(), \"change:_isVisited\", this.model.checkCompletionStatus);\r\n    }\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking() {\r\n      //this.update();\r\n      \r\n      // adapt-dd-questionPlus:\r\n      this.updateMarking();\r\n    }\r\n\r\n    update() {\r\n      this.updateMarking();\r\n    }\r\n\r\n    postRender() {\r\n      super.postRender();\r\n      this.setUpGridSize();\r\n    }\r\n\r\n    /**\r\n     * When the user closes the feedback notify, wait X seconds, then de-activate incorrectly activated items.\r\n     * This was done to improve the UI experience, as some users didn't realize they needed to manually de-select\r\n     * the incorrectly selected items.\r\n     * \r\n     * DD: DD specific implementation.\r\n     */\r\n    onSubmitted() {\r\n      super.onSubmitted();\r\n      this.listenToOnce(Adapt, \"notify:closed\", this.onFeedbackClosed);\r\n    }\r\n\r\n    onFeedbackClosed() {\r\n      this.deselectIncorrectAnswers();\r\n    }\r\n\r\n    deselectIncorrectAnswers() {\r\n      \r\n      _.debounce(() => {\r\n        this.model.getChildren().each((itemModel) => {\r\n\r\n          // Only deselect visited answers.\r\n          let isVisited = Boolean(itemModel.get(\"_isVisited\"));\r\n          if (!isVisited) return;\r\n\r\n          let shouldBeSelected = Boolean(itemModel.get(\"_shouldBeSelected\"));\r\n          let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n          let isCorrect = shouldBeSelected && isActive;\r\n\r\n          if (!isCorrect && isActive) itemModel.set(\"_isActive\", false);\r\n        })\r\n      }, DESELECT_INCORRECT_DELAY)();\r\n    }\r\n    \r\n    showCorrectAnswer() {\r\n      this.update();\r\n    }\r\n\r\n    hideCorrectAnswer() {\r\n      this.update();\r\n    }\r\n\r\n    setUpEventListeners(){\r\n      \r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    }\r\n\r\n    onItemClick(event) {\r\n      if (event) event.preventDefault();\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('adapt-index'));\r\n      item.toggleActive();\r\n    }\r\n\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-finder-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n    }\r\n\r\n    onItemsActiveChange(model, _isActive) {\r\n\r\n      this.getItemElement(model)\r\n        .toggleClass('is-active', _isActive)\r\n        .find(\".js-item-label\").toggleClass('is-selected', _isActive);\r\n      this.updateContainer();\r\n    }\r\n\r\n    onItemsVisitedChange(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $item = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the aria-label\r\n      /*var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $item.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });*/\r\n\r\n      $item.addClass('is-visited');\r\n    }\r\n\r\n    /**\r\n     * adapt-dd-questionPlus will called this whenever the user clicks Submit.\r\n     */\r\n    updateMarking() {\r\n\r\n      let isInteractive = this.model.isInteractive();\r\n      let canShowMarking = this.model.get('_canShowMarking');\r\n      let ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n      // FIXME: Checkbox state changes are a bit messily implemented.\r\n\r\n      this.model.getChildren().each((itemModel) => {\r\n\r\n        let index = itemModel.get('_index');\r\n        let $item = this.getItemElement(itemModel);\r\n        let $itemLabel = $item.find(\".js-item-label\");\r\n\r\n        let shouldBeSelected = Boolean(itemModel.get(\"_shouldBeSelected\"));\r\n        let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n        // An item is only considered \"visited\" once it has been submitted at least once.\r\n        let isVisited = Boolean(itemModel.get(\"_isVisited\") || isActive); itemModel.set(\"_isVisited\", isVisited);\r\n        let isCorrect = shouldBeSelected && isActive; // Only mark active items as correct.\r\n\r\n        // Disable items only when the item has been completed, or when the entire component has been completed.\r\n        let isDisabled = !isInteractive || isCorrect;\r\n        $item\r\n          .prop('disabled', isDisabled)\r\n          .toggleClass('is-disabled', isDisabled)\r\n          .find(\".finder__item-answer-icon\")\r\n          .toggleClass('is-disabled', isDisabled);\r\n\r\n        // Remove marking from non-visited items.\r\n        if (/*isInteractive || */ !isVisited || !canShowMarking) {\r\n          $item.removeClass('is-correct is-incorrect');\r\n          $itemLabel.removeClass('is-correct is-incorrect');\r\n          return;\r\n        }\r\n\r\n        // Mark visited items (that are selected).\r\n        // (DD questionPlus design choice).\r\n        if (!isActive) return;\r\n\r\n        $item\r\n          .toggleClass('is-correct', isCorrect)\r\n          .toggleClass('is-incorrect', !isCorrect)\r\n          .toggleClass('is-disabled', isDisabled)\r\n          .prop('disabled', isDisabled);\r\n\r\n        $itemLabel\r\n        .toggleClass('is-correct', isCorrect)\r\n        .toggleClass('is-incorrect', !isCorrect)\r\n        .toggleClass('is-disabled', isDisabled);\r\n      });\r\n\r\n      this.updateContainer();\r\n    }\r\n\r\n    /**\r\n     * The container for the items will gain the .is-incorrect class while it contains any active incorrect items.\r\n     * The container for the items will gain the .is-correct class only when the component is completed.\r\n     */\r\n    updateContainer() {\r\n\r\n      let isAtLeastOneIncorrect = Boolean(\r\n        this.model.getChildren().find((itemModel) => {\r\n          return itemModel.get(\"_isVisited\") && itemModel.get(\"_isActive\") && !itemModel.get(\"_shouldBeSelected\");\r\n        })\r\n      );\r\n\r\n      let $container = this.$(\".finder__items-container\");\r\n      $container\r\n        .toggleClass(\"is-incorrect\", isAtLeastOneIncorrect)\r\n        .toggleClass(\"is-correct\", Boolean(this.model.get(\"_isCorrect\")));\r\n    }\r\n\r\n    /*onDeviceResize() {\r\n      this.recalcItemSize();\r\n    }*/\r\n\r\n    /**\r\n     * FIXME: Temp (niche; only applies if each item is one word).\r\n     * Set up the wrapping CSS grid based on the widest item.\r\n     */\r\n    setUpGridSize() {\r\n\r\n      /*\r\n      // Find the widest item.\r\n      let maxSize = 0;\r\n      this.model.getChildren().each((itemModel) => {\r\n        \r\n        let text = itemModel.get(\"text\");\r\n        if (text.length > maxSize) maxSize = text.length;\r\n      });\r\n\r\n      // Set the grid column width.\r\n      this.$(\".finder__items-container\").css({\r\n        \"grid-template-columns\": \"repeat(auto-fit, minmax(\" + maxSize + \"em, 1fr))\" \r\n      });\r\n      */\r\n    }\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  FinderView.template = \"finder\";\r\n  return FinderView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/itemsQuestionModel'\r\n], function(Adapt, ItemsQuestionModel) {\r\n\r\n  /**\r\n   * FIXME: Not compatible with screen readers + colour blindness at the moment.\r\n   */\r\n\r\n  class FinderModel extends ItemsQuestionModel{\r\n\r\n    /**\r\n     * Correct:         ALL and ONLY the _shouldBeSelected items have been selected.\r\n     * PartlyCorrect:   ONLY _shouldBeSelected items have been selected, but not all of them.\r\n     * Incorrect:       ANY !_shouldBeSelected items have been selected.\r\n     */\r\n    isCorrect() {\r\n\r\n      const props = {\r\n        _numberOfIncorrectAnswers: 0, // Number of items selected that shouldn't have been.\r\n        _numberOfCorrectAnswers: 0,   // Number of items selected that should have been.\r\n        _numberOfRequiredAnswers: 0,  // Number of items which need to have been selected.\r\n        _isAtLeastOneIncorrectSelection: false, // _numberOfIncorrectAnswers != 0\r\n      };\r\n\r\n      this.getChildren().each(itemModel => {\r\n        \r\n        let shouldBeSelected = Boolean(itemModel.get('_shouldBeSelected'));\r\n        let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n        \r\n        itemModel.set('_isCorrect', shouldBeSelected == isActive);\r\n\r\n        if (shouldBeSelected) {\r\n          props._numberOfRequiredAnswers++;\r\n        }\r\n\r\n        if (!isActive) return; // Only mark selected anwswers.\r\n\r\n        // This item was selected and it shouldn't have been.\r\n        if (!shouldBeSelected) {\r\n          props._numberOfIncorrectAnswers++;\r\n          props._isAtLeastOneIncorrectSelection = true;\r\n          return;\r\n        }\r\n\r\n        // This item was selected and it should have been.\r\n        props._numberOfCorrectAnswers++;\r\n      });\r\n\r\n      this.set(props);\r\n\r\n      const hasRightNumberOfCorrectAnswers = (props._numberOfCorrectAnswers === props._numberOfRequiredAnswers);\r\n      const hasNoIncorrectAnswers = !props._isAtLeastOneIncorrectSelection;\r\n\r\n      return hasRightNumberOfCorrectAnswers && hasNoIncorrectAnswers;\r\n    }\r\n    \r\n    isPartlyCorrect() {\r\n      return !this.get('_isAtLeastOneIncorrectSelection');\r\n    }\r\n\r\n    setupFeedback() {\r\n      \r\n      if (!this.has('_feedback')) return;\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.setupCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      if (this.isPartlyCorrect()) {\r\n        this.setupPartlyCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      this.setupIncorrectFeedback();\r\n    }\r\n  }\r\n\r\n\r\n  return FinderModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './finderView',\r\n  './finderModel'\r\n], function(Adapt, FinderView, FinderModel) {\r\n\r\n  return Adapt.register(\"finder\", {\r\n    view: FinderView,\r\n    model: FinderModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  class FlipCardView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        \"click .js-flipcard-btn\" : \"onBtnClick\"\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.model, \"change:_isFlipCardActive\", this.onFlipCardActiveChange);\r\n    }\r\n\r\n    onBtnClick() {\r\n      this.model.set(\"_isFlipCardActive\", !this.model.get(\"_isFlipCardActive\"))\r\n    }\r\n\r\n    onFlipCardActiveChange(model, isFlipCardActive) {\r\n      this.$(\".js-flipcard-card, .js-flipcard-btn\").toggleClass(\"is-active\", isFlipCardActive);\r\n\r\n      // Change the text on the button.\r\n      this.$(\".js-flipcard-btn\").html(isFlipCardActive ? this.model.get(\"_frontSide\").buttonText : this.model.get(\"_backSide\").buttonText);\r\n\r\n      // Scroll into view.\r\n      Adapt.navigateToElement(this.$(\".js-flipcard-btn, .js-flipcard-card\"), {\r\n        duration: 400,\r\n        align: \"inview\"\r\n      });\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      \r\n    }\r\n\r\n    postRender() {\r\n      this.setReadyStatus();\r\n    }\r\n  }\r\n  \r\n  FlipCardView.template = \"flipCard\";\r\n  return FlipCardView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentModel) {\r\n\r\n  class FlipCardModel extends ComponentModel {\r\n\t  \r\n  }\r\n\r\n  return FlipCardModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './flipCardView',\r\n  './flipCardModel'\r\n], function(Adapt, flipCardView, flipCardModel) {\r\n\r\n  return Adapt.register('flipcard', {\r\n    model: flipCardModel,\r\n    view: flipCardView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  // TODO: Have default button labels be defined on a source level, and not a course level? (makes updating everything a lot easier).\r\n\r\n  class FreeThinkingView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        \"click .js-freethinking-btn\" : \"onShowAnswersBtnClick\"\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.model, \"change:_isShowingAnswer\", this.onShowingAnswerChange);\r\n    }\r\n\r\n    onShowingAnswerChange(model, isShowingAnswer) {\r\n      if (isShowingAnswer) {\r\n        this.$(\".js-freethinking-header\").slideUp();\r\n        this.$(\".js-freethinking-correct\").slideDown();\r\n      }\r\n      else {\r\n        this.$(\".js-freethinking-header\").slideDown();\r\n        this.$(\".js-freethinking-correct\").slideUp();\r\n      }\r\n    }\r\n\r\n    onShowAnswersBtnClick() {\r\n      let isShowingAnswer = !this.model.get(\"_isShowingAnswer\");\r\n      this.model.set(\"_isShowingAnswer\", isShowingAnswer);\r\n\r\n      let buttons = this.model.get(\"_freeThinking\")._buttons;\r\n\r\n      this.$(\".js-freethinking-btn\")\r\n        .toggleClass(\"is-disabled\", isShowingAnswer)\r\n        .text(isShowingAnswer ? buttons._hideCorrectAnswer.buttonText : buttons._showCorrectAnswer.buttonText);\r\n      \r\n      // Fallback: scroll the freethinking widget into view just to be sure\r\n      if (isShowingAnswer) {\r\n        Adapt.navigateToElement(this.$(\".freethinking__content-inner\"), {\r\n          duration: 400,\r\n          align: \"inview\"\r\n        });\r\n      }\r\n\r\n      // Mark the component as completed.\r\n      this.setCompletionStatus();\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      \r\n    }\r\n\r\n    postRender() {\r\n      this.setReadyStatus();\r\n    }\r\n  }\r\n  \r\n  FreeThinkingView.template = \"freeThinking\";\r\n  return FreeThinkingView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentModel) {\r\n\r\n  class FreeThinkingModel extends ComponentModel {\r\n\t  \r\n    initialize() {\r\n\r\n      // Load defaults from course.json.\r\n      this.set(\"_freeThinking\", Adapt.course.get(\"_freeThinking\"));\r\n\r\n      // Start off with the answer hidden.\r\n      this.set(\"_isShowingAnswer\", false);\r\n      \r\n\r\n      // Add a FreeThinking logo using adapt-dd-componentLogo\r\n      // ----------------------------------------------------\r\n      this.set(\"_componentLogo\", {\r\n        src: \"assets/freethinking-logo.svg\"\r\n      });\r\n\r\n      // Add a class to the parent block to indicate that it contains a FreeThinking (allows for custom styling).\r\n      let parentClasses = this.getParent().get(\"_classes\");\r\n      this.getParent().set(\"_classes\", parentClasses + \" is-freethinking\");\r\n\r\n      super.initialize();\r\n    }\r\n  }\r\n\r\n  return FreeThinkingModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './freeThinkingView',\r\n  './freeThinkingModel'\r\n], function(Adapt, freeThinkingView, freeThinkingModel) {\r\n\r\n  return Adapt.register('freethinking', {\r\n    model: freeThinkingModel,\r\n    view: freeThinkingView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  const NAVIGATE_DURATION = 400;\r\n\r\n  class GLabelPopupView extends Backbone.View {\r\n\r\n    events() {\r\n      return {\r\n        //'focus .js-glabel-item-input'  : 'onItemFocus',\r\n        //'blur .js-glabel-item-input'   : 'onItemBlur',\r\n        'change .js-glabel-item-input' : 'onOptionSelect'//,\r\n        //'keyup .js-glabel-item-input'  : 'onKeyPress'\r\n      }\r\n    }\r\n\r\n    className() {\r\n      return 'glabel-popup';\r\n    }\r\n\r\n    initialize() {\r\n\r\n      this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n      this.listenTo(Adapt, \"notify:closed\", this.onClosed);\r\n      this.listenTo(Adapt, \"device:resize\", this.onDeviceResize);\r\n\r\n      // Update the tooltip in the animation.\r\n      this.listenTo(this.model, {\r\n        \"change:tooltip\":     this.onTooltipChange,\r\n        \"change:_isSelected\": this.onIsSelectedChange,\r\n        \"change:_isIncorrect\":this.onIncorrectChange\r\n      });\r\n      this.listenTo(this.model.get(\"_options\"), {\r\n        \"change:_isSelected\" : this.onOptionSelectedChange\r\n      });\r\n\r\n      this.render();\r\n    }\r\n\r\n    // Update the tooltip in the animation.\r\n    // ---------------------------------------------------------\r\n    onTooltipChange(model, tooltip) {\r\n      this.$(\".js-glabel-item-tooltip\").html(tooltip);\r\n    }\r\n    onIsSelectedChange(model, isSelected) {\r\n      this.$(\".js-glabel-popup-tooltip\").toggleClass(\"is-selected\", isSelected);\r\n    }\r\n    // ---------------------------------------------------------\r\n\r\n    onIncorrectChange(model, isIncorrect) {\r\n      this.$(\".js-glabel-item\").toggleClass(\"is-incorrect\", isIncorrect);\r\n      this.$(\".js-glabel-popup-content-anim\").toggleClass(\"is-incorrect\", isIncorrect);\r\n    }\r\n\r\n    onOptionSelect(event) {\r\n      if (!this.model.get(\"_parent\").isInteractive()) return;\r\n\r\n      let index = $(event.currentTarget).data('index'); // The real index of the option (the same regardless of randomization).\r\n      let isSelected = $(event.currentTarget).prop('checked');\r\n\r\n      this.model.get(\"_options\").find((option) => {return option.get(\"_index\") === index;}).toggle(isSelected);\r\n\r\n      // Close the popup after a slight delay.\r\n      _.delay(() => {\r\n        this.closePopup();\r\n      }, 100);\r\n    }\r\n\r\n    onOptionSelectedChange(optionModel, isSelected) {\r\n      let $label = this.$(\".js-glabel-item-label\").filter(\"[data-index=\" + optionModel.get(\"_index\") + \"]\");\r\n      $label.toggleClass(\"is-selected\", isSelected);\r\n    }\r\n\r\n    onDeviceResize() {\r\n      this.alignEverything();\r\n    }\r\n\r\n    onOpened() {\r\n\r\n      this.$el.addClass(\"u-visibility-hidden\"); // Hide this notify until the image inside has loaded; prevents a frame of flicker.\r\n\r\n      // FIXME: \\/. Could delay the reveal by a significant amount if the connection is slow!\r\n      // Adapt core notify functionality waits for the imageready event before aligning it vertically.\r\n      // We want to align the image after that, so a debounce is added to ensure our event fires just after the core event.\r\n      this.$el.imageready(_.debounce(() => {\r\n        this.alignEverything();\r\n        this.playContentAnim();\r\n        \r\n        // Setting the itemModel to focused will cause the item element in the component to hide itself.\r\n        this.$el.removeClass(\"u-visibility-hidden\");\r\n        this.$el.addClass(\"is-active\");\r\n        this.model.set(\"_isFocused\", true);\r\n      }, 0));\r\n    }\r\n\r\n    /**\r\n     * Use this function to get the offsets needed to align elements in this view with the elements in the component.\r\n     * @param {*} $el \r\n     * @param {*} $target \r\n     */\r\n    getAlignOffset($el, $target) {\r\n      let myBB      = $el[0].getBoundingClientRect();\r\n      let targetBB  = $target[0].getBoundingClientRect();\r\n\r\n      let offset = {\r\n        left: targetBB.left - myBB.left,\r\n        top: targetBB.top - myBB.top\r\n      }\r\n\r\n      return offset;\r\n    }\r\n\r\n    /**\r\n     * Align the popup's content element horizontally with the popup's item.\r\n     */\r\n    alignContentToItem() {\r\n\r\n      let $item = this.$(\".js-glabel-item\");\r\n      let $container = this.$(\".js-glabel-popup-content-helper\"); // This takes up the full width of the area the $content can be in.\r\n      let $content = this.$(\".js-glabel-popup-content\");\r\n      \r\n      // Clear any previously applied offsets.\r\n      $content.css(\"left\", \"\");\r\n      \r\n      let contentWidth =    $content.outerWidth();\r\n      let containerWidth =  $container.outerWidth();\r\n      let itemWidth =       $item.outerWidth();\r\n      let itemLeftCenter =  parseInt($item.css(\"left\"),10) + (itemWidth/2); // The left center of the item relative to its parent.\r\n      \r\n      // If the item too far to the left or right, align the content to that side (as centering it would cause it to clip).\r\n      if (itemLeftCenter < contentWidth/2) {\r\n        $container.css(\"justify-content\", \"flex-start\");\r\n      }\r\n      else if (itemLeftCenter > containerWidth - contentWidth/2) {\r\n        $container.css(\"justify-content\", \"flex-end\");\r\n      }\r\n      // Otherwise, the content can be centered above the item.\r\n      else {\r\n        $content.css(\"left\", itemLeftCenter - contentWidth/2);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Align the popup's cropped image with the one in the component.\r\n     */\r\n    alignImg() {\r\n\r\n      let $graphic = this.$(\".js-glabel-popup-img\");\r\n      let $parGraphic = this.getParentView().$(\".js-glabel-img\");\r\n      $graphic.css({\r\n        \"left\": \"\",\r\n        \"top\": \"\"\r\n      });\r\n\r\n      let offset = this.getAlignOffset($graphic, $parGraphic);;\r\n\r\n      $graphic.width($parGraphic.width());\r\n      $graphic.height($parGraphic.height());\r\n      $graphic.css(offset);\r\n    }\r\n\r\n    /**\r\n     * Align this view vertically with the popup's item\r\n     * ------------------------------------------------\r\n     * If the vertical alignment would result in this view going off the top/bottom of the viewport, scroll the main page instead.\r\n     */\r\n    alignViewport() {\r\n\r\n      let $item = this.$(\".js-glabel-item\");\r\n      let $parItem = this.getParentItemEl();\r\n\r\n      this.$el.css(\"top\", \"\");\r\n\r\n      let yDiff = this.getAlignOffset($item, $parItem).top;\r\n      let yDiffTarget = undefined;\r\n      \r\n      let yDiffMin = 0;\r\n      let yDiffMax = this.$el.closest(\".notify__popup-inner\").height() - this.$el.outerHeight();\r\n      let yOffset = 0;\r\n\r\n      // If the popup content would be too tall for the viewport, then don't scroll at all.\r\n      if (yDiffMax < 1) {\r\n        yDiff = undefined;\r\n      }\r\n      // If the popup content would move too high up, scroll the page up first to compensate.\r\n      else if (yDiff < yDiffMin) {\r\n        yOffset = yDiff - yDiffMin;\r\n        yDiffTarget = yDiffMin;\r\n      }\r\n      // If the popup content would move too low, scroll the page down first to compensate.\r\n      else if (yDiff > yDiffMax) {\r\n        yOffset = yDiff - yDiffMax;\r\n        yDiffTarget = yDiffMax;\r\n      }\r\n\r\n      if (yOffset) {\r\n        this.navigateToRelOffset(yOffset);\r\n      }\r\n\r\n      this.$el.css(\"top\", yDiff);\r\n      this.$el.animate({\"top\": yDiffTarget}, NAVIGATE_DURATION);\r\n    }\r\n\r\n    /**\r\n     * Sets up an element to create an \"expanding\" animation for the revealed content. \r\n     */\r\n    playContentAnim() {\r\n      let $anim = this.$(\".js-glabel-popup-content-anim\");\r\n      let $tooltip = this.$(\".js-glabel-popup-tooltip\");\r\n\r\n      $anim.offset($tooltip.offset());\r\n      $anim.outerWidth($tooltip.outerWidth());\r\n      $anim.outerHeight($tooltip.outerHeight());\r\n    \r\n      $anim.hide(0).show(0);\r\n\r\n      _.delay(() => {\r\n        $anim.addClass(\"is-active\");\r\n        $tooltip.addClass(\"is-active\");\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Aligns the .js-glabel-item in this popup view with the .js-glabel-item belonging to the parent component.\r\n     */\r\n    alignEverything() {\r\n\r\n      // Align the popup's item with the component's item horizontally\r\n      // -------------------------------------------------------------\r\n      let $item = this.$(\".js-glabel-item\");\r\n      let $parItem = this.getParentItemEl();\r\n\r\n      $item.css(\"left\", \"\"); // Clear first.\r\n      $item.css(\"left\", this.getAlignOffset($item, $parItem).left);\r\n      $item.width($parItem.width());\r\n      $item.height($parItem.height());\r\n      \r\n\r\n      // Align the content horizontally to the item.\r\n      // -------------------------------------------------------------\r\n      this.alignContentToItem();\r\n\r\n\r\n      // Align this view vertically with the popup's item.\r\n      // -------------------------------------------------------------\r\n      // If the vertical alignment would result in this view going off the top/bottom of the viewport, scroll the main page instead.\r\n      this.alignViewport();\r\n\r\n\r\n      // Align the graphic\r\n      // -------------------------------------------------------------\r\n      this.alignImg();\r\n    }\r\n\r\n    navigateToRelOffset(relativeTop) {\r\n      // The following needs to be done to accomplish this without causing the notify popup to close.\r\n      let notifyView = Adapt.notify.stack[Adapt.notify.stack.length-1];\r\n      notifyView.hasOpened = false;\r\n      notifyView.isOpen = false;\r\n\r\n      Adapt.navigateToRelOffset({\r\n        top: relativeTop\r\n      },\r\n      {\r\n        duration: NAVIGATE_DURATION\r\n      });\r\n\r\n      // Allow the notify to be closeable again after navigateToElement has finished.\r\n      _.delay(() => {\r\n        if (Adapt.notify.stack[Adapt.notify.stack.length-1] !== notifyView) {\r\n          Adapt.notify.stack.push(notifyView);\r\n        }\r\n        notifyView.hasOpened = true;\r\n        notifyView.isOpen = true;\r\n      }, 0);\r\n    }\r\n\r\n    // Get the view belonging to the parent component.\r\n    getParentView() {\r\n      let parent = this.model.get(\"_parent\");\r\n      return Adapt.findViewByModelId(parent.get(\"_id\"));\r\n    }\r\n\r\n    // Find the item element that was just clicked to create this popup.\r\n    getParentItemEl() {\r\n      \r\n      let parentView = this.getParentView();\r\n      return parentView.$(\".js-glabel-item\").filter(\"[data-index=\" + this.model.get(\"_index\") + \"]\");\r\n    }\r\n\r\n    onClosed(notifyView) {\r\n      \r\n      this.model.trigger(\"notify:close\");\r\n\r\n      let $anim = this.$(\".js-glabel-popup-content-anim\");\r\n      $anim.removeClass(\"is-active\");\r\n      this.$el.removeClass(\"is-active\");\r\n      this.$(\".js-glabel-popup-tooltip\").removeClass(\"is-active\");\r\n\r\n      // Check if the view being closed is this one (in case something has caused there to be multiple NotifyViews being nested).\r\n      if (!notifyView.$el.hasClass(\"glabel-popup\")) return;\r\n    }\r\n\r\n    remove() {\r\n      this.model.trigger(\"remove\");\r\n      this.model.set(\"_isFocused\", false);\r\n    }\r\n\r\n    render() {\r\n      var data = this.model.toJSON();\r\n      data.view = this;\r\n      data._parent = this.model.get(\"_parent\").toJSON();\r\n      data._options = this.model.get(\"_options\").toJSON();\r\n      /*data._options = this.model.get(\"_parent\").get(\"_options\");\r\n      data._graphic = this.model.get(\"_parent\").get(\"_graphic\");*/\r\n\r\n      var template = Handlebars.templates['glabelPopup'];\r\n      this.$el.html(template(data));\r\n    }\r\n\r\n    closePopup(event) {\r\n      Adapt.trigger('notify:close');\r\n    }\r\n  }\r\n\r\n  return GLabelPopupView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView',\r\n  './glabelPopupView'\r\n], function(Adapt, QuestionView, GLabelPopupView) {\r\n\r\n  class GLabelView extends QuestionView {\r\n\r\n    events() {\r\n      return {\r\n        \"click .js-glabel-item\"   : \"onItemClick\"\r\n        /*'focus .js-item-input'  : 'onItemFocus',\r\n        'blur .js-item-input'   : 'onItemBlur',\r\n        'change .js-item-input' : 'onItemSelect',\r\n        'keyup .js-item-input'  : 'onKeyPress'*/\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n\r\n      this.setUpModelData();\r\n\r\n      QuestionView.prototype.initialize.apply(this, arguments);\r\n      \r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n\r\n      this.update = _.debounce(this.update.bind(this), 1);\r\n\r\n      this.listenTo(this.model, {\r\n        \"change:_isEnabled change:_isComplete change:_isSubmitted\": this.update\r\n      });\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        \"change:_isActive\": this.onItemActiveChange,\r\n        \"change:_isFocused\": this.onItemFocusedChange,\r\n        \"change:_isSelected\": this.onItemSelectedChange,\r\n        \"change:_isCorrect\": this.onItemCorrectChange,\r\n        \"change:_isIncorrect\": this.onItemIncorrectChange, // FIXME: No other item in Adapt uses an \"_isIncorrect\" property.\r\n        \"change:tooltip\": this.onItemTooltipChange\r\n      });\r\n    }\r\n\r\n    setUpModelData() {\r\n\r\n      // adapt-sizing for the background-graphic.\r\n      let graphic = this.model.get(\"_graphic\");\r\n      if (graphic && graphic._sizing) {\r\n        graphic._sizing._classes = Adapt.sizing.getSizingClass(graphic._sizing);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Update the tooltip text whenever the user's selection changes.\r\n     * @param {*} itemModel \r\n     * @param {*} tooltip \r\n     */\r\n    onItemTooltipChange(itemModel, tooltip) {\r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.find(\".js-glabel-item-tooltip\").html(tooltip);\r\n    }\r\n\r\n    onItemSelectedChange(itemModel, isSelected) {\r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.find(\".js-glabel-tooltip\").toggleClass(\"is-selected\", isSelected);\r\n    }\r\n\r\n    onItemCorrectChange(itemModel, isCorrect){\r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.toggleClass(\"is-correct\", isCorrect === true);\r\n      //$item.toggleClass(\"is-incorrect\", isCorrect === false);\r\n    }\r\n\r\n    onItemIncorrectChange(itemModel, isIncorrect){\r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.toggleClass(\"is-incorrect\", isIncorrect === true);\r\n      //$item.toggleClass(\"is-incorrect\", isCorrect === false);\r\n    }\r\n    \r\n    setupQuestion() {\r\n      \r\n    }\r\n\r\n    /**\r\n     * Whenever an item outline / item btn is clicked, open the popup with the list of options.\r\n     */\r\n    onItemClick(event) {\r\n\r\n      if (this._isPopupOpen) return; // Don't allow the user to click on items while another one is set to open.\r\n\r\n      // Set the item to active.\r\n      let index = $(event.currentTarget).data(\"index\");\r\n      let itemModel = this.model.getItem(index);\r\n\r\n      itemModel.set(\"_isActive\", true); // Only one item can be active. An item is active for as long as its popup is open.\r\n      itemModel.set(\"_isVisited\", true);\r\n    }\r\n\r\n    // An item is focused until its notify is fully closed (slightly after is becomes inactive).\r\n    onItemFocusedChange(itemModel, isFocused) {\r\n\r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.toggleClass(\"is-focused\", isFocused);\r\n    }\r\n\r\n    onItemActiveChange(itemModel, isActive) {\r\n      \r\n      let $item = this.$(\".js-glabel-item\").filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\");\r\n      $item.toggleClass(\"is-active\", isActive);\r\n\r\n      this.$(\".js-glabel-item-container\").toggleClass(\"has-active-item\", isActive);\r\n\r\n      // Inactive\r\n      // ----------------------------------------------------\r\n      if (!isActive) {\r\n        return;\r\n      } \r\n\r\n      // Active\r\n      // ----------------------------------------------------\r\n      this.openItemPopup(itemModel);\r\n\r\n      // Set all other items to be inactive.\r\n      this.model.getChildren().each((e) => {\r\n\r\n        if (itemModel == e) return; // Don't deactivate self.\r\n        e.set(\"_isActive\", false);\r\n        e.set(\"_isFocused\", false);\r\n      });\r\n    }\r\n\r\n    // Called when all items have _isActive = false (after the popup is closed).\r\n    onAllItemsInactive() {\r\n      this.$(\".js-glabel-item-container\").removeClass(\"has-active-item\");\r\n    }\r\n\r\n    closeItemPopup() {\r\n\r\n    }\r\n\r\n    openItemPopup(itemModel) {\r\n\r\n      this._isPopupOpen = true;\r\n\r\n      itemModel.set(\"_isActive\", true);\r\n\r\n      //itemModel.set(\"_parent\", this.model);\r\n      this.itemPopupView = new GLabelPopupView({\r\n        model: itemModel\r\n      });\r\n\r\n      Adapt.trigger(\"notify:popup\", {\r\n        _view: this.itemPopupView,\r\n        _isCancellable: true,\r\n        _classes: 'glabel ' + this.model.get('_classes') + \" \" + this.model.get(\"_id\")\r\n      });\r\n\r\n      // When the user clicks to close the notify.\r\n      this.listenToOnce(this.itemPopupView.model, \"notify:close\", this.onItemPopupClosed);\r\n    }\r\n\r\n    onItemPopupClosed() {\r\n\r\n      let activeItem = this.model.getActiveItem();\r\n      activeItem.set(\"_isActive\", false);\r\n      this._isPopupOpen = false;\r\n      this.itemPopupView = null;\r\n    }\r\n\r\n    postRender() {\r\n      QuestionView.prototype.postRender.apply(this, arguments);\r\n      \r\n      // Allow for easy positioning of the items.\r\n      if (Adapt.debug?.setUpInteract) {\r\n        Adapt.debug.setUpInteract(this.$(\".js-glabel-item\"), this.$(\".js-glabel-item-container\"), false);\r\n      }\r\n\r\n      //this.onDeviceChange();\r\n      this.updateMarking(); // Custom: initial call to set up aria labels for the inputs.\r\n                            // FIXME: Applying the initial aria could be done better...\r\n    }\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    }\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking() {\r\n      this.update();\r\n      this.updateMarking();\r\n    }\r\n\r\n    update(model) {\r\n      this.updateSelection();\r\n      // \\/ questionPlus will call this.updateMarking() when necessary. It shouldn't be invoked here while it's in use.\r\n      //this.updateMarking();\r\n    }\r\n\r\n    updateSelection() {\r\n\r\n      //var isEnabled = this.model.get(\"_isEnabled\");\r\n\r\n      _.each(this.model.get(\"_items\"), (item) => {\r\n\r\n        let itemIdx = item._index;\r\n        let isEnabled = !Boolean(item._isCorrect); // Disable items only when the item has been completed.\r\n\r\n        _.each(item._optionsSelected, (option, optionIdx) => {\r\n\r\n          var isSelected = this.isCorrectAnswerShown ?\r\n            _.contains(item._optionsCorrect, optionIdx) :\r\n            option\r\n\r\n          let filter = '[data-adapt-index=\"' + itemIdx + '\"][data-adapt-option-index=\"' + optionIdx + '\"]';\r\n          \r\n          this.$('.js-item-label').filter(filter)\r\n            .toggleClass('is-selected', isSelected)\r\n            .toggleClass('is-disabled', !isEnabled)\r\n            // Custom \\/\r\n            .find(\".mmcq__item-answer-icon\")\r\n            .toggleClass('is-disabled', !isEnabled);\r\n\r\n          this.$('.js-item-input').filter(filter)\r\n              .prop('checked', isSelected)\r\n              .prop('disabled', !isEnabled);\r\n        });\r\n      });\r\n    }\r\n\r\n    resetQuestionOnRevisit() {\r\n      //this.resetQuestion();\r\n    }\r\n\r\n    updateMarking() {\r\n\r\n      //var isInteractive = this.model.isInteractive();\r\n      let canShowMarking = this.model.get('_canShowMarking');\r\n      let ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n      _.each(this.model.get(\"_items\"), (item) => {\r\n\r\n        let index = item._index;\r\n\r\n        let $item = this.$('.js-mmcq-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n        $item\r\n          .toggleClass('is-correct', item._isCorrect)\r\n          .toggleClass('is-incorrect', !item._isCorrect);\r\n\r\n        if (!canShowMarking) {\r\n          $item\r\n          .removeClass('is-correct')\r\n          .removeClass('is-incorrect');\r\n        }\r\n\r\n        /**\r\n         * questionPlus: only apply marking to selected items.\r\n         */\r\n        _.each(item._optionsSelected, (option, optionIdx) => {\r\n\r\n          let filter = '[data-adapt-index=\"' + index + '\"][data-adapt-option-index=\"' + optionIdx + '\"]';\r\n          let $itemInput = this.$(\".js-item-input\").filter(filter);\r\n          let $itemLabel = this.$(\".js-item-label\").filter(filter);\r\n\r\n          let shouldBeSelected = Boolean(_.contains(item._optionsCorrect, optionIdx));\r\n          let isCorrect = option == shouldBeSelected;\r\n          let isSelected = option;\r\n\r\n          // Set aria-labels\r\n          let inputText = (this.model.get(\"_options\") || item._options)[optionIdx];\r\n\r\n          // Pre-checked state (inputs which haven't been submitted while selected yet).\r\n          if (!item._optionsVisited[optionIdx]) {\r\n            $itemInput.attr('aria-label', $.a11y_normalize(inputText));\r\n          }\r\n          // Checked inputs (correct or incorrect).\r\n          // Only apply \"Incorrect\" / \"Correct\" aria labels after they've been submitted while selected.\r\n          else {\r\n            $itemInput.attr('aria-label', [\r\n              (shouldBeSelected ? ariaLabels.correct : ariaLabels.incorrect),\r\n              \", \",\r\n              (isSelected ? ariaLabels.selectedAnswer : ariaLabels.unselectedAnswer),\r\n              \". \",\r\n              $.a11y_normalize(inputText)\r\n            ].join(\"\"));\r\n          }\r\n\r\n          if (!canShowMarking) {\r\n            // Remove input marking\r\n            $itemInput.removeClass('is-correct is-incorrect');\r\n            $itemLabel.removeClass('is-correct is-incorrect');\r\n            return;\r\n          }\r\n\r\n          // Apply styles to ONLY the selected inputs.\r\n          // (DD questionPlus design choice).\r\n          if (!isSelected) return;\r\n\r\n          $itemInput.toggleClass(\"is-correct\", isCorrect)\r\n                    .toggleClass(\"is-incorrect\", !isCorrect);\r\n\r\n          $itemLabel\r\n            .toggleClass(\"is-correct\", isCorrect)\r\n            .toggleClass(\"is-incorrect\", !isCorrect);\r\n        });\r\n\r\n      });\r\n\r\n      this.updateSelection();\r\n    }\r\n  }\r\n\r\n  return GLabelView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel',\r\n  'core/js/models/itemModel'\r\n], function(Adapt, QuestionModel, ItemModel) {\r\n\r\n  class GLabelModel extends QuestionModel {\r\n\r\n    init() {\r\n      super.init.call(this);\r\n\r\n      this.setupQuestionItems();\r\n      this.setupQuestionOptions();\r\n      this.checkCanSubmit();\r\n    }\r\n\r\n    // Copied from core/js/models/itemsComponentModel.js\r\n    toJSON() {\r\n      const json = super.toJSON();\r\n      // Make sure _items is updated from child collection\r\n      json._items = this.getChildren().toJSON();\r\n      return json;\r\n    }\r\n\r\n    /**\r\n     * Create a collection of item models out of the items.\r\n     */\r\n    setupQuestionItems() {\r\n      \r\n      const items = this.get('_items') || [];\r\n      items.forEach((item, index) => {\r\n        item._index = index;\r\n        item._parent = this;\r\n        item.tooltip = \"?\"; // This value will change as the user clicks on options. // FIXME: Temp.\r\n      });\r\n      this.setChildren(new Backbone.Collection(items, { model: ItemModel }));\r\n    }\r\n\r\n    isCorrect() {\r\n\r\n      var numberOfCorrectAnswers = 0;\r\n\r\n      this.getChildren().each(function(item, index) {\r\n\r\n        /**\r\n         * An item is correct when only the options with _shouldBeSelected are selected.\r\n         */\r\n        var isCorrect = true;\r\n        item.get(\"_options\").find(option => {\r\n\r\n          // Stop searching if there's any option in the wrong state.\r\n          if (option.get(\"_shouldBeSelected\") !== option.get(\"_isSelected\")) {\r\n            isCorrect = false;\r\n            return true;\r\n          }\r\n        });\r\n\r\n        /**\r\n         * All options which have been selected should be marked as visited.\r\n         */\r\n         item.get(\"_options\").each((option) => {\r\n          if (option.get(\"_isSelected\")) {\r\n            option.set(\"_isVisited\", true);\r\n\r\n            let isCorrect = option.get(\"_shouldBeSelected\") === option.get(\"_isSelected\");\r\n            option.set(\"_isCorrect\", isCorrect);\r\n            option.set(\"_isIncorrect\", !isCorrect);\r\n\r\n            // Disable interaction once correct.\r\n            option.set(\"_isEnabled\", !isCorrect);\r\n          }\r\n        });\r\n        \r\n        if (!isCorrect) {\r\n          item.set(\"_isCorrect\", false);\r\n          item.set(\"_isIncorrect\", true);\r\n          return;\r\n        }\r\n\r\n        numberOfCorrectAnswers++;\r\n        item.set(\"_isCorrect\", true);\r\n        item.set(\"_isIncorrect\", false);\r\n\r\n        // Disable all options for this item once correct.\r\n        item.get(\"_options\").each(option => {option.set(\"_isEnabled\", false);});\r\n\r\n        this.set({\r\n          '_isAtLeastOneCorrectSelection': true\r\n        });\r\n\r\n      }, this);\r\n\r\n      this.set('_numberOfCorrectAnswers', numberOfCorrectAnswers);\r\n\r\n      if (numberOfCorrectAnswers === this.getChildren().length) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    }\r\n    \r\n    setupQuestionOptions() {\r\n      \r\n      const options = this.get('_options') || [];\r\n      let _options = []; // Convert the component's _options property from an array of strings to an array of objects.\r\n\r\n      options.forEach((option, index) => {\r\n        _options.push({\r\n          text: option,\r\n          _isEnabled: true, // Becomes disabled once the option is correct.\r\n          _index: index\r\n        });\r\n      });\r\n\r\n      this.set(\"_options\", _options);\r\n      this.setupRandomisation();\r\n\r\n      // Give each item a collection from this array.\r\n      this.getChildren().each((item) => {\r\n\r\n        let options = new Backbone.Collection(this.get(\"_options\"));\r\n        \r\n        // Check if the copy of the option belonging to this item should be selected for this item.\r\n        options.each((option) => {\r\n          option.set(\"_shouldBeSelected\", Boolean(_.includes(item.get(\"_optionsCorrect\"), option.get(\"_index\"))));\r\n          option.set(\"_parent\", item);\r\n          option.toggle = (_isSelected) => {\r\n            this._toggleOption(option, _isSelected);\r\n          }\r\n        });\r\n        item.set(\"_options\", options);\r\n\r\n        // Listen for events on the options.\r\n        // FIXME: The item model should be made into its own script instead of being defined on the fly like it is here.\r\n        item.listenTo(options, \"change:_isSelected\", (optionModel, _isSelected) => {\r\n          \r\n          // Update the tooltip whenever the options change.\r\n          let tooltip = [];\r\n          let isIncorrect = false;\r\n          item.get(\"_options\").each((option) => {\r\n            if (option.get(\"_isSelected\")) tooltip.push(option.get(\"key\"));\r\n\r\n            // If the option is incorrectly selected, and has been visited, mark the item as incorrect.\r\n            if (!isIncorrect && \r\n                option.get(\"_isSelected\") !== option.get(\"_shouldBeSelected\") && \r\n                option.get(\"_isVisited\")) {\r\n              isIncorrect = true;\r\n            }\r\n          });\r\n          item.set(\"_isIncorrect\", isIncorrect);\r\n          item.set(\"tooltip\", tooltip.length ? tooltip.join(\",\") : \"?\");\r\n\r\n          // An item is considered \"selected\" when one or more of its options have been selected.\r\n          // All items must be selected in order to submit the answer (whether it be right or wrong).\r\n          item.set(\"_isSelected\", Boolean(tooltip.length));\r\n\r\n          // Check whether the component can be submitted.\r\n          this.checkCanSubmit();\r\n        });\r\n      });\r\n    }\r\n\r\n    _toggleOption(optionModel, _isSelected) {\r\n\r\n      let isRadio = this.get(\"_isRadio\");\r\n\r\n      // Checkbox\r\n      if (!isRadio){\r\n        optionModel.set(\"_isSelected\", _isSelected === undefined ? !Boolean(optionModel.get(\"_isSelected\")) : Boolean(_isSelected));\r\n      }\r\n      // Radio (radio buttons can only be toggled on).\r\n      else {\r\n        optionModel.set(\"_isSelected\", true);\r\n        optionModel.collection.each((option) => {\r\n          if (option != optionModel) option.set(\"_isSelected\", false);\r\n        });\r\n      }\r\n    }\r\n\r\n    getItem(index) {\r\n      return this.getChildren().findWhere({ _index: index });\r\n    }\r\n\r\n    getActiveItem(index) {\r\n      return this.getChildren().findWhere({ _isActive: true });\r\n    }\r\n\r\n    /**\r\n     * This component randomizes itself by shuffling the order that the _options are displayed in.\r\n     */\r\n    setupRandomisation() {\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n      \r\n      this.set(\"_options\", _.shuffle(this.get(\"_options\")));\r\n      \r\n      // Assign an alphabet letter as the key the user will use to identify each option.\r\n      this.get(\"_options\").forEach((option, index) => {\r\n        let key = (index + 10).toString(36).toUpperCase();\r\n        option.key = key;\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Can submit if every item has at least one option selected.\r\n     * @returns \r\n     */\r\n    canSubmit() {\r\n      return this.getChildren().every((itemModel) => {return itemModel.get(\"_isSelected\");});\r\n    }\r\n\r\n    // Core\r\n    // ---------------------------------------------------------------------------------------\r\n\r\n    restoreUserAnswers() {\r\n\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      let userAnswer = this.get('_userAnswer');\r\n      let items = this.getChildren();\r\n\r\n      _.each(userAnswer, (optionIndexes, itemIndex) => {\r\n        \r\n        let item = items.find((item) => {return item.get(\"_index\") == itemIndex;});\r\n        item.get(\"_options\").each(option => {\r\n          if (_.includes(optionIndexes, option.get(\"_index\"))) {\r\n            option.set(\"_isSelected\", true);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    storeUserAnswer() {\r\n\r\n      var userAnswer = new Array(this.getChildren().length);\r\n\r\n      this.getChildren().each(function(item) {\r\n\r\n        let itemAnswer = [];\r\n        item.get(\"_options\").each(option => {\r\n          if (option.get(\"_isSelected\")) itemAnswer.push(option.get(\"_index\"));\r\n        });\r\n        userAnswer[item.get(\"_index\")] = itemAnswer;\r\n      }, this);\r\n\r\n      this.set({\r\n        '_userAnswer': userAnswer\r\n      });\r\n    }\r\n\r\n    resetUserAnswer() {\r\n\r\n      this.set('_userAnswer', []);\r\n\r\n      this.getChildren().each((item) => {\r\n        item.set(\"_isCorrect\", false);\r\n        item.set(\"_isIncorrect\", false);\r\n        item.set(\"_isSelected\", false);\r\n\r\n        item.get(\"_options\").each((option) => {\r\n          option.set(\"_isSelected\", false);\r\n          option.set(\"_isVisited\", false);\r\n        });\r\n      });\r\n    }\r\n\r\n    /**\r\n     * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n     * returns the user's answers as a string in the format 'answer1[,]answer2[,]answer3'\r\n     * the use of [,] as an answer delimiter is from the SCORM 2004 specification for the fill-in interaction type\r\n     * \r\n     * --------------------------------------------------------------\r\n     * \r\n     * Each item could have one or MORE of its buttons selected.\r\n     * SCORM (or Adapt?) doesn't have a way to store multiple multiple \"choice\" interactions that in one go,\r\n     * so I've set this up to use \"fill-in\" as the submission type for now.\r\n     * \r\n     * Example: Item0 has the first 3 options selected, Item1 has the second and third, and Item2 has only the\r\n     * last option selected:\r\n     * \r\n     * 0.1.2[,]1.2[,]4\r\n     * \r\n     * FIXME: This is most likely going to look a bit messy if the answers are viewed in the LMS UI.\r\n     * FIXME: Has not been tested yet!!!\r\n     */\r\n    getResponse() {\r\n\r\n      let resp = [];\r\n      this.getChildren().each((item) => {\r\n\r\n        let optionIndexes = [];\r\n        item.get(\"_options\").each((option) => {\r\n          if (option.get(\"_isSelected\")) optionIndexes.push(option.get(\"_index\"));\r\n        });\r\n\r\n        resp.push(optionIndexes.join('.'));\r\n      });\r\n\r\n      return resp.join('[,]');\r\n    }\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    * @return {string}\r\n    */\r\n    getResponseType() {\r\n      return \"fill-in\";\r\n    }\r\n\r\n  }\r\n\r\n  return GLabelModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './glabelView',\r\n  './glabelModel',\r\n], function(Adapt, GLabelView, GLabelModel) {\r\n\r\n  return Adapt.register('glabel', {\r\n    view: GLabelView,\r\n    model: GLabelModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  class HotgraphicFlipView extends ComponentView{\r\n    \r\n    // FIXME: Better names for the two events.\r\n    events() {\r\n      return {\r\n        'click .js-hotgraphicflip-item-click': 'onItemClick',\r\n        'click .js-hotgraphicflip-item-btn': 'onItemBtnClick'\r\n      }\r\n    }\r\n\r\n    initialize(){\r\n\r\n      this.setUpModelData();\r\n      \r\n      ComponentView.prototype.initialize.call(this);\r\n\r\n      this.setUpEventListeners();\r\n      this.checkIfResetOnRevisit();\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    setUpModelData() {\r\n      // adapt-sizing extension compatibility.\r\n      // FIXME: implements its own version of sizing.\r\n      let itemSizing = this.model.get(\"_itemSizing\");\r\n      if (itemSizing && itemSizing._width) {\r\n        //itemSizing._classes = Adapt.sizing.getSizingClass(itemSizing); \r\n        itemSizing._classes = \"col-sm-\" + itemSizing._width;\r\n\r\n        // FIXME: Non standard implementation (needs to use adapt-sizing).\r\n        if (itemSizing._maxWidthInner) {\r\n          itemSizing._itemClasses = \"--maxwidth-inner-\" + itemSizing._maxWidthInner;\r\n        }\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      //this.render();\r\n    }\r\n\r\n    postRender() {\r\n\r\n      // Only start showing the component once all images are ready.\r\n      this.$('.hotgraphicflip__widget').imageready(() => {\r\n        this.setReadyStatus();\r\n        _.debounce(this.recalcItemHeight.bind(this), 0)();\r\n      });\r\n\r\n      // Not being used.\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      \r\n      this.onDeviceResize = _.debounce(this.onDeviceResize, 0);\r\n      this.listenTo(Adapt, 'device:resize', this.onDeviceResize);\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    }\r\n\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-hotgraphicflip-item-click').filter('[data-index=\"' + index + '\"]');\r\n    }\r\n\r\n    onItemClick(event) {\r\n\r\n      // If inactive, allow clicking anywhere on the card to flip.\r\n      // If active, only flip back if the icon is clicked (different event).\r\n      var item = this.model.getItem($(event.currentTarget).data('index'));\r\n      if (item.get(\"_isActive\")) return;\r\n\r\n      // Important; prevents the click bleeding through to the flip-back button.\r\n      // iOS bugfix(?): Performed after the \"_isActive\" check (something was preventing click events from triggering on buttons\r\n      // inside the item-back element).\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      item.toggleActive();\r\n      item.toggleVisited(true);\r\n    }\r\n\r\n    // Flip back.\r\n    onItemBtnClick(event) {\r\n      event.preventDefault();\r\n      event.stopPropagation(); // Important; prevents the click bleeding through to the flip-forward button.\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('index'));\r\n      if (!item.get(\"_isActive\")) return;\r\n\r\n      item.toggleActive();\r\n    }\r\n\r\n    onItemsActiveChange(model, _isActive) {\r\n      this.getItemElement(model).toggleClass('is-active', _isActive);\r\n    }\r\n\r\n    onItemsVisitedChange(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $item = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the aria-label\r\n      var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $item.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });\r\n\r\n      $item.addClass('is-visited');\r\n    }\r\n\r\n    /**\r\n     * Ensure all the items have the same height.\r\n     * FIXME: Is there no better way of doing this?\r\n     */\r\n    onDeviceResize() {\r\n      this.recalcItemHeight();\r\n    }\r\n\r\n    /**\r\n     * Min-height is used in-case the text size changes after the resize due to external methods\r\n     * (better to have the text visible and the cards misaligned than the opposite).\r\n     */\r\n    recalcItemHeight(){\r\n      let $items = this.$(\".hotgraphicflip__item\");\r\n\r\n      // Remove previous min-height.\r\n      $items.css({\r\n        \"min-height\": \"\"\r\n      });\r\n\r\n      // Find the tallest item.\r\n      let h = 0;\r\n      $items.each((i, e) => {\r\n        let _h = $(e).height();\r\n        if (_h > h) {\r\n          h = _h;\r\n        }\r\n      });\r\n\r\n      // Enforce the _itemSizing._minHeightRatio (if present).\r\n      let minHeightRatio = this.model.get(\"_itemSizing\")?._minHeightRatio;\r\n      if (minHeightRatio && !isNaN(minHeightRatio)) {\r\n        let w = $items.first().width();      // Get the width of the first item (all items have the same width).\r\n        h = Math.max(h, w*minHeightRatio);  // Set the minimum height to ensure the ratio is met.\r\n      }\r\n\r\n      $items.css({\r\n        \"min-height\": h\r\n      });\r\n    }\r\n  }\r\n\r\n  HotgraphicFlipView.template = \"hotgraphicFlip\";\r\n  return HotgraphicFlipView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './hotgraphicFlipView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, HotgraphicFlipView, ItemsComponentModel) {\r\n\r\n  return Adapt.register('hotgraphicflip', {\r\n    model: ItemsComponentModel.extend({}),\r\n    view: HotgraphicFlipView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  class HotgraphicMiniView extends ComponentView{\r\n    \r\n    events() {\r\n      return {\r\n        'click .js-hotgraphicmini-item-click': 'onItemClick'\r\n      }\r\n    }\r\n\r\n    initialize(){\r\n\r\n      this.setUpModelData();\r\n      \r\n      ComponentView.prototype.initialize.call(this);\r\n\r\n      this.setUpEventListeners();\r\n      this.checkIfResetOnRevisit();\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    setUpModelData() {\r\n      // adapt-sizing extension compatibility.\r\n      let itemSizing = this.model.get(\"_itemSizing\");\r\n      if (itemSizing && itemSizing._width) {\r\n        itemSizing._classes = Adapt.sizing.getSizingGridClasses(itemSizing);\r\n      }\r\n    }\r\n\r\n    setUpSizingListeners() {\r\n      let itemSizing = this.model.get(\"_itemSizing\");\r\n      if (itemSizing) {\r\n        Adapt.sizing.setUpGridListeners(this.$(\".sizing-grid\"));\r\n      }\r\n    }\r\n\r\n    preRender() {\r\n      //this.render();\r\n    }\r\n\r\n    postRender() {\r\n\r\n      // Only start showing the component once all images are ready.\r\n      this.$('.hotgraphicmini__widget').imageready(() => {\r\n        this.setReadyStatus();\r\n        _.debounce(this.recalcContentMargins.bind(this), 0)();\r\n      });\r\n\r\n      // Not being used.\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n\r\n      this.setUpSizingListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      \r\n      this.onDeviceResize = _.debounce(this.onDeviceResize, 0);\r\n      this.listenTo(Adapt, 'device:resize', this.onDeviceResize);\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    }\r\n\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-hotgraphicmini-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n    }\r\n\r\n    onItemClick(event) {\r\n      if (event) event.preventDefault();\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('adapt-index'));\r\n      item.toggleActive();\r\n      item.toggleVisited(true);\r\n    }\r\n\r\n    onItemsActiveChange(model, _isActive) {\r\n      this.getItemElement(model).toggleClass('is-active', _isActive);\r\n    }\r\n\r\n    onItemsVisitedChange(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $item = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the aria-label\r\n      var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $item.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });\r\n\r\n      $item.addClass('is-visited');\r\n      $item.find(\".js-hotgraphicmini-item-click\").addClass(\"is-visited\");\r\n    }\r\n\r\n    /**\r\n     * Ensure all the items have the same height.\r\n     * FIXME: Is there no better way of doing this?\r\n     */\r\n    onDeviceResize() {\r\n      this.recalcContentMargins();\r\n    }\r\n\r\n    /**\r\n     * Hide the item contents until the item is clicked to reveal them.\r\n     */\r\n    recalcContentMargins(){\r\n\r\n      let $contents = this.$(\".js-hotgraphicmini-content\");\r\n\r\n      // Remove previous margin.\r\n      $contents.css({\r\n        \"margin-bottom\": \"\"\r\n      });\r\n\r\n      // Remove the vertical presence of the content elements by giving them a -height margin.\r\n      $contents.each((i, e) => {\r\n        let h = $(e).height();\r\n        $(e).css(\"margin-bottom\", -h).hide(0).show(0); // Skip the CSS transition.\r\n      });\r\n    }\r\n  }\r\n\r\n  HotgraphicMiniView.template = \"hotgraphicMini\";\r\n  return HotgraphicMiniView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './hotgraphicMiniView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, HotgraphicMiniView, ItemsComponentModel) {\r\n\r\n  return Adapt.register('hotgraphicmini', {\r\n    model: ItemsComponentModel.extend({}),\r\n    view: HotgraphicMiniView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n  'use strict';\r\n\r\n  /**\r\n   * Heavily modified version of the core adapt-contrib-hotgraphic hotgraphicPopupView.js script.\r\n   * Modified for our custom DD behavior + style.\r\n   */\r\n\r\n  // Ignore attempts to close the popup if the user tries to do so within X milliseconds of it opening.\r\n  // This is done to prevent graphical bugs if the user double-clicks an item.\r\n  // (Scripts can stil close the popup at any time if they need to).\r\n  const CLOSE_TIMEOUT = 500;\r\n\r\n  var HotgraphicPlusPopupView = Backbone.View.extend({\r\n\r\n    className: function(){\r\n      let classes = [\r\n        \"hotgraphicplus-popup\",\r\n        this.model.get(\"_isSingleColumn\") ? \"is-single\" : \"\"\r\n      ];\r\n\r\n      return classes.join(\" \");\r\n    },\r\n\r\n    events: {\r\n      'click .js-hotgraphicplus-popup-close': 'onClickClose',\r\n      'click .hotgraphicplus-popup__inner, .hotgraphicplus-popup__item-content, .hotgraphicplus-popup__item-graphic' : 'onClickBG',\r\n      'click .js-hotgraphic-controls-click': 'onControlClick'\r\n    },\r\n\r\n    initialize: function() {\r\n\r\n      this._canUserClose = false;\r\n      this._hasAltImg = Boolean(this.model.get(\"_graphic\")?.srcPopup);\r\n\r\n      _.delay(() => {this._canUserClose = true;}, CLOSE_TIMEOUT);\r\n\r\n      // Debounce required as a second (bad) click event is dispatched on iOS causing a jump of two items.\r\n      //this.onControlClick = _.debounce(this.onControlClick.bind(this), 100);\r\n\r\n      // adapt-sizing compatibility.\r\n      let sizing = this.model.get(\"_graphic\")?._sizing;\r\n      if (sizing) {\r\n        this.model.get(\"_graphic\")._sizing._classes = Adapt.sizing.getSizingClasses(sizing);\r\n      }\r\n\r\n      this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n      this.listenTo(Adapt, \"notify:closed\", this.onClosed);\r\n      /*this.listenTo(this.model.get('_children'), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });*/\r\n      this.render();\r\n    },\r\n\r\n    onClickClose: function(event) {\r\n\r\n      // Don't let the user close the popup too quickly.\r\n      if (!this._canUserClose) return;\r\n      this.closePopup();\r\n    },\r\n\r\n    /**\r\n     * DD specific: allow for the user to click anywhere (except the content-inner and graphic-inner elements) to close the popup.\r\n     * @param {*} event \r\n     */\r\n    onClickBG: function(event) {\r\n\r\n      event.stopPropagation();\r\n      if (event.target != event.currentTarget) return;\r\n\r\n      // Don't let the user close the popup too quickly.\r\n      if (!this._canUserClose) return;\r\n\r\n      this.closePopup();\r\n    },\r\n\r\n    onOpened: function() {\r\n\r\n      // FIXME: \\/. Could delay the reveal by a significant amount if the connection is slow!\r\n      // Adapt core notify functionality waits for the imageready event before aligning it vertically.\r\n      // We want to align the image after that, so a debounce is added to ensure our event fires just after the core event.\r\n      this.$el.imageready(_.debounce(this.setupGraphicTransition.bind(this), 0));\r\n\r\n\r\n      //this.applyNavigationClasses(this.model.getActiveItem().get('_index'));\r\n      //this.updatePageCount();\r\n      //this.handleTabs();\r\n    },\r\n\r\n    // Resize the reveal graphic to line up with the pin item graphic that was clicked to make this popup.\r\n    alignGraphicToPin: function(){\r\n\r\n      let parentView = Adapt.findViewByModelId(this.model.get(\"_parent\").get(\"_id\"));\r\n      let itemIdx = this.model.get(\"_index\");\r\n\r\n      let $pin = parentView.$(\".hotgraphicplus__item-image-transition\").filter(\".item-\" + itemIdx);\r\n      let $img = this.$(\".js-hotgraphicplus-popup-image\");\r\n\r\n      // This element will be transformed and offset to align the $img and $pin.\r\n      let $tran = this.$(\".js-hotgraphicplus-popup-image-transition\");\r\n\r\n      $tran.css({\r\n        \"transform\": \"\"\r\n      })\r\n\r\n      // FIXME: Throws errors if element missing.\r\n      let pinBB = $pin[0].getBoundingClientRect();\r\n      let imgBB = $img[0].getBoundingClientRect();\r\n\r\n      // Uniform scaling only.\r\n      let scale = pinBB.width / imgBB.width;\r\n\r\n      // Transform the popup image to place it over the pin image (and make it look like it's the same thing).\r\n      let offset = {\r\n        top: pinBB.top - imgBB.top,\r\n        left: pinBB.left - imgBB.left\r\n      }\r\n\r\n      // If using an alt image transition, the $tran element's height might not equal the $img element's height.\r\n      // Adjust top offset accordingly.\r\n      if (this._hasAltImg) {\r\n        let tranBB = $tran[0].getBoundingClientRect();\r\n        offset.top = pinBB.top - tranBB.top - (imgBB.top - tranBB.top)*scale;\r\n      }\r\n\r\n      $tran.css({\r\n        \"transform\": \"translate(\" + offset.left + \"px, \" + offset.top + \"px) scale(\" + scale + \")\"\r\n      });\r\n\r\n      return $tran;\r\n    },\r\n\r\n    /**\r\n     * To ensure a smooth transition, the notify element won't be visible until the image is ready.\r\n     * FIXME: Slow image loading could make this look bad.\r\n     */\r\n    setupGraphicTransition: function(){\r\n      \r\n      let $img = this.alignGraphicToPin();\r\n\r\n      // Now, the parent view can hide its pin image.\r\n      this.setReadyStatus();\r\n\r\n      _.debounce(() => $img.addClass(\"is-active transition-enabled\").find(\".hotgraphicplus-popup__item-image-transition-inner\").addClass(\"is-active\"), 50)();\r\n    },\r\n\r\n    setReadyStatus: function(){\r\n\r\n      //console.log(this.model.get(\"_isReady\") + \" <-----\");\r\n\r\n      //this.model.set(\"_isReady\", true);\r\n      this.model.trigger(\"hotgraphicPlusPopupView:ready\");\r\n      this.$el.addClass(\"is-ready\");\r\n    },\r\n\r\n    /** Transition the graphic back to the pin image while the popup fades out. */\r\n    onClosed: function(notifyView){\r\n      \r\n      // Check if the view being closed is this one (in case something has caused there to be multiple NotifyViews being nested).\r\n      if (!notifyView.$el.hasClass(\"hotgraphicplus\")) return;\r\n\r\n      let $img = this.alignGraphicToPin();\r\n      $img.removeClass(\"is-active\").find(\".hotgraphicplus-popup__item-image-transition-inner\").removeClass(\"is-active\");\r\n      this.$el.addClass(\"is-closed\");\r\n    },\r\n\r\n    remove: function() {\r\n      this.model.trigger(\"remove\");\r\n    },\r\n\r\n    render: function() {\r\n      var data = this.model.toJSON();\r\n      data.view = this;\r\n      var template = Handlebars.templates['hotgraphicPlusPopup'];\r\n      this.$el.html(template(data));\r\n    },\r\n\r\n    closePopup: function(event) {\r\n      Adapt.trigger('notify:close');\r\n    }\r\n\r\n    /*applyNavigationClasses: function (index) {\r\n      var itemCount = this.model.get('_items').length;\r\n      var canCycleThroughPagination = this.model.get('_canCycleThroughPagination');\r\n\r\n      var shouldEnableBack = index > 0 || canCycleThroughPagination;\r\n      var shouldEnableNext = index < itemCount - 1 || canCycleThroughPagination;\r\n      var $controls = this.$('.hotgraphic-popup__controls');\r\n\r\n      this.$('hotgraphic-popup__nav')\r\n          .toggleClass('first', !shouldEnableBack)\r\n          .toggleClass('last', !shouldEnableNext);\r\n\r\n      Adapt.a11y.toggleAccessibleEnabled($controls.filter('.back'), shouldEnableBack);\r\n      Adapt.a11y.toggleAccessibleEnabled($controls.filter('.next'), shouldEnableNext);\r\n    },\r\n\r\n    updatePageCount: function() {\r\n      var template = Adapt.course.get(\"_globals\")._components._hotgraphic.popupPagination || '{{itemNumber}} / {{totalItems}}';\r\n      var labelText = Handlebars.compile(template)({\r\n        itemNumber: this.model.getActiveItem().get('_index') + 1,\r\n        totalItems: this.model.get(\"_items\").length\r\n      });\r\n      this.$('.hotgraphic-popup__count').html(labelText);\r\n    },\r\n\r\n    handleTabs: function() {\r\n      Adapt.a11y.toggleHidden(this.$('.hotgraphic-popup__item:not(.is-active) *'), true);\r\n      Adapt.a11y.toggleHidden(this.$('.hotgraphic-popup__item.is-active *'), false);\r\n    },\r\n\r\n    onItemsActiveChange: function(item, _isActive) {\r\n      if (!_isActive) return;\r\n      var index = item.get('_index');\r\n      this.updatePageCount();\r\n      this.applyItemClasses(index);\r\n      this.handleTabs();\r\n      this.handleFocus(index);\r\n    },\r\n\r\n    applyItemClasses: function(index) {\r\n      this.$('.hotgraphic-popup__item[data-index=\"' + index + '\"]').addClass('is-active').removeAttr('aria-hidden');\r\n      this.$('.hotgraphic-popup__item[data-index=\"' + index + '\"] .hotgraphic-popup__item-title').attr(\"id\", \"notify-heading\");\r\n      this.$('.hotgraphic-popup__item:not([data-index=\"' + index + '\"])').removeClass('is-active').attr('aria-hidden', 'true');\r\n      this.$('.hotgraphic-popup__item:not([data-index=\"' + index + '\"]) .hotgraphic-popup__item-title').removeAttr(\"id\");\r\n    },\r\n\r\n    handleFocus: function(index) {\r\n      Adapt.a11y.focusFirst(this.$('.hotgraphic-popup__inner .is-active'));\r\n      this.applyNavigationClasses(index);\r\n    },\r\n\r\n    onItemsVisitedChange: function(item, _isVisited) {\r\n      if (!_isVisited) return;\r\n\r\n      this.$('.hotgraphic-popup__item')\r\n          .filter('[data-index=\"' + item.get('_index') + '\"]')\r\n          .addClass('is-visited');\r\n    },\r\n\r\n    onControlClick: function(event) {\r\n      var direction = $(event.currentTarget).hasClass('back') ? 'back' : 'next';\r\n      var index = this.getNextIndex(direction);\r\n\r\n      if (index !== -1) {\r\n        this.setItemState(index);\r\n      }\r\n    },\r\n\r\n    getNextIndex: function(direction) {\r\n      var index = this.model.getActiveItem().get('_index');\r\n      var lastIndex = this.model.get('_items').length - 1;\r\n\r\n      switch (direction) {\r\n        case 'back':\r\n          if (index > 0) return --index;\r\n          if (this.model.get('_canCycleThroughPagination')) return lastIndex;\r\n          break;\r\n        case 'next':\r\n          if (index < lastIndex) return ++index;\r\n          if (this.model.get('_canCycleThroughPagination')) return 0;\r\n      }\r\n      return -1;\r\n    },\r\n\r\n    setItemState: function(index) {\r\n      this.model.getActiveItem().toggleActive();\r\n\r\n      var nextItem = this.model.getItem(index);\r\n      nextItem.toggleActive();\r\n      nextItem.toggleVisited(true);\r\n    }*/\r\n\r\n  });\r\n\r\n  return HotgraphicPlusPopupView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  './hotgraphicPlusPopupView'\r\n], function(Adapt, ComponentView, HotgraphicPlusPopupView) {\r\n  'use strict';\r\n\r\n  var HotGraphicPlusView = ComponentView.extend({\r\n\r\n    events: {\r\n      'click .js-hotgraphicplus-item-click': 'onPinClicked',\r\n      'click .js-hotgraphicplus-counter': 'onFinderCounterClick'\r\n    },\r\n\r\n    className: function() {\r\n      var classes = ComponentView.prototype.className.call(this);\r\n      if (this.model.get(\"_isSingleColumn\")) classes += \" is-single\";\r\n      return classes;\r\n    },\r\n\r\n    initialize: function() {\r\n      this.setUpModelData(); // FIXME: Should probably move this into pre-render?\r\n      ComponentView.prototype.initialize.call(this);\r\n      this.setUpViewData();\r\n      this.setUpEventListeners();\r\n      this.checkIfResetOnRevisit();\r\n    },\r\n\r\n    setUpViewData: function() {\r\n      this.popupView = null;\r\n      this._isPopupOpen = false;\r\n    },\r\n\r\n    setUpModelData: function() {\r\n\r\n      // adapt-sizing extension compatibility\r\n      // ------------------------------------------\r\n\r\n      // adapt-sizing for optional background-graphic.\r\n      let graphic = this.model.get(\"_graphic\");\r\n      if (graphic && graphic._sizing) {\r\n        graphic._sizing._classes = Adapt.sizing.getSizingClass(graphic._sizing);\r\n      }\r\n      // If no background graphic, use the adapt-sizing for items instead.\r\n      else {\r\n        let itemSizing = this.model.get(\"_itemSizing\");\r\n        if (itemSizing) {\r\n          //itemSizing._classes = Adapt.sizing.getSizingClass(itemSizing);\r\n          // adapt-sizing grid\r\n          itemSizing._classes = Adapt.sizing.getSizingGridClasses(itemSizing);\r\n        }\r\n      }\r\n\r\n      // Allow for the sizing for all popups to be set in one property.\r\n      let itemPopupSizing = this.model.get(\"_itemPopupSizing\");\r\n      if (itemPopupSizing) {\r\n        this.model.getChildren().each((item) => {\r\n\r\n          if (!item.get(\"_graphic\")) item.set(\"_graphic\", {});\r\n\r\n          let itemSizing = item.get(\"_sizing\") /* Legacy */ || item.get(\"_graphic\")._sizing || {};\r\n\r\n          // Important to specify {} as the first parameter (making _.extend create a copy);\r\n          // otherwise the original itemPopupSizing variable gets extended (causing issues for subsequent items).\r\n          item.get(\"_graphic\")._sizing = _.extend({}, itemPopupSizing, itemSizing);\r\n        });\r\n      }\r\n\r\n      // Add sizing to the counter (if in _finder mode).\r\n      let finderData = this.model.get(\"_finder\");\r\n      if (finderData && finderData._isEnabled !== false) {\r\n        let counterSizing = finderData._counter?._sizing;\r\n        if (!counterSizing) throw \"adapt-hotgraphicplus: \\\"_finder._counter._sizing\\\" must be defined if using \\\"_finder\\\" mode.\";\r\n        \r\n        finderData._counter._sizing._classes = Adapt.sizing.getSizingClass(counterSizing);\r\n      }\r\n\r\n      /*if (this.model.get('_canCycleThroughPagination') === undefined) {\r\n        this.model.set('_canCycleThroughPagination', false);\r\n      }*/\r\n    },\r\n\r\n    setUpSizingListeners() {\r\n      \r\n      let itemSizing = this.model.get(\"_itemSizing\");\r\n      if (itemSizing) {\r\n        Adapt.sizing.setUpGridListeners(this.$(\".sizing-grid\"));\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Update the number (and suffix) in the counter based on the amount of non-visited items remaining.\r\n     * @returns \r\n     */\r\n    updateFinderCounter: function() {\r\n\r\n      let finderData = this.model.get(\"_finder\");\r\n      if (!finderData || finderData._isEnabled === false) return;\r\n\r\n      let items = this.model.getChildren();\r\n\r\n      let itemsRemaining = 0;\r\n      items.each(item => {\r\n        if (!item.get(\"_isVisited\")) itemsRemaining++;\r\n      });\r\n\r\n      this.$(\".js-hotgraphicplus-counter-num\").text(itemsRemaining);\r\n      this.$(\".js-hotgraphicplus-counter-suffix\").text(itemsRemaining == 1 ? \"Remains\" : \"Remain\");\r\n\r\n      // When complete\r\n      if (itemsRemaining === 0) {\r\n        this.$(\".js-hotgraphicplus-counter\").addClass(\"is-complete\");\r\n        this.$(\".js-hotgraphicplus-counter-hint\").text(\"Well done!\");\r\n      }\r\n    },\r\n\r\n    /**\r\n     * If the user clicks the counter, have the first non-visited item flicker.\r\n     */\r\n    onFinderCounterClick: function() {\r\n\r\n      let items = this.model.getChildren();\r\n      let nonVisitedItem = items.find(item => {if (!item.get(\"_isVisited\")) return item;});\r\n\r\n      if (!nonVisitedItem) return; // There are no non-visited items (the component is already complete).\r\n\r\n      this.clearFinderHints();\r\n\r\n      // (Delay in order to reset CSS animation).\r\n      _.delay(() => {\r\n\r\n        // Apply the hint class to this item.\r\n        var $item = this.getItemElement(nonVisitedItem);\r\n        $item.addClass(\"is-finder-hint\");\r\n\r\n        // Scroll it into view just in case.\r\n        Adapt.navigateToElement($item, {\r\n          duration: 400,\r\n          align: \"inview\"\r\n        });\r\n      });\r\n    },\r\n\r\n    clearFinderHints: function() {\r\n      // Remove the hint class from all items (done to reset animations).\r\n      this.$(\".is-finder-hint\").removeClass(\"is-finder-hint\");\r\n    },\r\n\r\n    setUpEventListeners: function() {\r\n      //this.listenTo(Adapt, 'device:changed', this.reRender);\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange,\r\n        'change:_isVisible': this.onItemsVisibleChange\r\n      });\r\n\r\n      if (this.isTabsMode()) {\r\n        this.listenTo(Adapt, 'device:resize', this.onDeviceResizeTabs);\r\n        this._isTabsOpen = false;\r\n      }\r\n    },\r\n\r\n    isTabsMode: function() {\r\n      return this.model.get(\"_tabs\")?._isEnabled;\r\n    },\r\n\r\n    reRender: function() {\r\n\r\n      \r\n\r\n      /*if (Adapt.device.screenSize !== 'large') {\r\n        this.replaceWithNarrative();\r\n      }*/\r\n    },\r\n\r\n    /*replaceWithNarrative: function() {\r\n      var NarrativeView = Adapt.getViewClass('narrative');\r\n\r\n      var model = this.prepareNarrativeModel();\r\n      var newNarrative = new NarrativeView({ model: model });\r\n      var $container = $(\".component__container\", $(\".\" + this.model.get(\"_parentId\")));\r\n\r\n      newNarrative.reRender();\r\n      newNarrative.setupNarrative();\r\n      $container.append(newNarrative.$el);\r\n      Adapt.trigger('device:resize');\r\n      _.defer(this.remove.bind(this));\r\n    },*/\r\n\r\n    /*prepareNarrativeModel: function() {\r\n      var model = this.model;\r\n      model.set({\r\n        '_component': 'narrative',\r\n        '_wasHotgraphic': true,\r\n        'originalBody': model.get('body'),\r\n        'originalInstruction': model.get('instruction')\r\n      });\r\n\r\n      // Check if active item exists, default to 0\r\n      var activeItem = model.getActiveItem();\r\n      if (!activeItem) {\r\n        model.getItem(0).toggleActive(true);\r\n      }\r\n\r\n      // Swap mobile body and instructions for desktop variants.\r\n      if (model.get('mobileBody')) {\r\n        model.set('body', model.get('mobileBody'));\r\n      }\r\n      if (model.get('mobileInstruction')) {\r\n        model.set('instruction', model.get('mobileInstruction'));\r\n      }\r\n\r\n      return model;\r\n    },*/\r\n\r\n    onItemsActiveChange: function(model, _isActive) {\r\n      this.getItemElement(model).toggleClass('is-active', _isActive);\r\n    },\r\n\r\n    // Toggle pin visibility. Done to create a smooth transition between the page and the notify popup.\r\n    onItemsVisibleChange: function(model, _isVisible) {\r\n      this.getItemElement(model).toggleClass(\"is-hidden\", !_isVisible);\r\n    },\r\n\r\n    getItemElement: function(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-hotgraphicplus-item-click').filter('[data-index=\"' + index + '\"]');\r\n    },\r\n\r\n    onItemsVisitedChange: function(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $pin = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the pin's aria-label\r\n      var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $pin.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });\r\n\r\n      $pin.addClass('is-visited');\r\n\r\n      _.delay(() => {\r\n        $pin.addClass('is-finder-visited');\r\n      }, 500);\r\n\r\n      this.updateFinderCounter();\r\n      this.clearFinderHints();\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    preRender: function() {\r\n\r\n      \r\n\r\n\r\n\r\n\r\n      //if (Adapt.device.screenSize === 'large') {\r\n      //  this.render();\r\n      //} else {\r\n      //  this.reRender();\r\n      //}\r\n    },\r\n\r\n    postRender: function() {\r\n      // Only start showing the component once all images are ready.\r\n      this.$('.hotgraphicplus__widget').imageready(this.setReadyStatus.bind(this));\r\n\r\n      // Not being used.\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n\r\n      this.setUpDebug();\r\n\r\n      this.setUpSizingListeners();\r\n    },\r\n\r\n    /**\r\n     * Allow for easy positioning of pin items using the adapt-dd-debug plugin.\r\n     */\r\n    setUpDebug: function() {\r\n\r\n      if (!Adapt.debug?._isEnabled) return;\r\n\r\n      let $pinItems = this.$(\".hotgraphicplus__pin-item\");\r\n      \r\n      if (Adapt.debug?.setUpInteract) {\r\n        Adapt.debug.setUpInteract($pinItems, this.$(\".hotgraphicplus__pin-item-container\"));\r\n      }\r\n    },\r\n\r\n    // --------------------------------------------------------------------------------------\r\n    // Customized DD behaviour begins here.\r\n    // --------------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * (For now) we do not want to allow for the user to navigate between each item from within its popup.\r\n     * @param {*} event \r\n     */\r\n    \r\n    onPinClicked: function (event) {\r\n      if (event) event.preventDefault();\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('index'));\r\n\r\n      // Set this item to be active, and all others to not be active.\r\n      this.model.getChildren().each(e => {\r\n        e.toggleActive(e == item);\r\n      });\r\n      item.toggleVisited(true);\r\n\r\n      // If in tabs mode, don't open a popup, and instead toggle the corresponding tab.\r\n      if (this.isTabsMode() && Adapt.device.screenSize !== \"small\") {\r\n        if (!this._isTabsOpen) {\r\n          this.showTab(item);\r\n          this.$(\".js-hotgraphicplus-tabs\").slideDown();\r\n          this._isTabsOpen = true;\r\n        }\r\n        else {\r\n          this.showTab(item);\r\n          this.$(\".js-hotgraphicplus-tabs\").show(0); // Fallback.\r\n        }\r\n      }\r\n      else {\r\n        this.openPopup(item);\r\n      }\r\n    },\r\n\r\n    // FIXME: This doesn't seem to be doing anything.\r\n    onDeviceResizeTabs: function() {\r\n      _.delay(this.updateTabTail.bind(this), 0);\r\n    },\r\n\r\n    // Move tail to be under the clicked item.\r\n    // TODO: Room for improvement. + the tail is a bit hard to see.\r\n    updateTabTail: function() {\r\n\r\n      let item = this.model.getActiveItem();\r\n      if (!item) return; // Don't do anything if no tab has been activated yet.\r\n\r\n      let $item = this.getItemElement(this.model.getActiveItem());\r\n\r\n      let itemBB = $item[0].getBoundingClientRect();\r\n      let widgetBB = this.$(\".hotgraphicplus__widget\")[0].getBoundingClientRect();\r\n\r\n      let left = itemBB.left - widgetBB.left;\r\n      let width = itemBB.width;\r\n      let $tail = this.$(\".js-hotgraphicplus-tabs-tail\");\r\n      \r\n      let tailLeft = left + width/2;\r\n      tailLeft = tailLeft / this.$(\".component__widget\").width();\r\n\r\n      // Set the tail's left position.\r\n      $tail.css({\r\n        \"left\": (tailLeft * 100) + \"%\"\r\n      });\r\n\r\n      // If this is the first activation, transition the tail to that position immediately, then activate it.\r\n      if (!$tail.hasClass(\"is-active\")) {\r\n        _.delay(() => {\r\n          $tail.hide(0).show(0);\r\n          $tail.addClass(\"is-active\");\r\n        }, 500); // FIXME: Delay added to counteract the slideDown animation.\r\n      }\r\n    },\r\n\r\n    showTab: function(itemModel) {\r\n\r\n      this.updateTabTail();\r\n\r\n      // Show the corresponding tab content item.\r\n      this.$(\".js-hotgraphicplus-tab-item\")\r\n        .removeClass(\"is-active\")\r\n        .filter(\"[data-index=\" + itemModel.get(\"_index\") + \"]\")\r\n        .addClass(\"is-active\");\r\n\r\n      // Ensure the user sees the reveal.\r\n      let $tabs = this.$(\".js-hotgraphicplus-tabs\");\r\n      \r\n      if (!this._isTabsOpen) $tabs.show(0);\r\n      Adapt.navigateToElement($tabs, {\r\n        duration: 400,\r\n        align: \"inview\"\r\n      });\r\n      if (!this._isTabsOpen) $tabs.hide(0);\r\n    },\r\n\r\n    /**\r\n     * For now, set up to re-render the popup each time.\r\n     * @param {*} itemModel \r\n     */\r\n    openPopup: function(itemModel) {\r\n      if (this._isPopupOpen) return;\r\n\r\n      this._isPopupOpen = true;\r\n\r\n      itemModel.set(\"_parent\", this.model);\r\n      itemModel.set(\"_isSingleColumn\", this.model.get(\"_isSingleColumn\"));\r\n      \r\n      try {\r\n        this.popupView = new HotgraphicPlusPopupView({\r\n          model: itemModel //this.model\r\n        });\r\n      }\r\n      catch (err) {\r\n        Adapt.log.error(\"hotgraphicPlusView: could not render popup (view has errors; see below):\");\r\n        this._isPopupOpen = false;\r\n        throw err;\r\n      }\r\n\r\n      this.listenToOnce(this.popupView.model, \"hotgraphicPlusPopupView:ready\", () => {\r\n        itemModel.set(\"_isVisible\", false);\r\n      });\r\n\r\n      Adapt.trigger(\"notify:popup\", {\r\n        _view: this.popupView,\r\n        _isCancellable: true,\r\n        //_showCloseButton: false,\r\n        _classes: 'hotgraphicplus ' + this.model.get('_classes') + \" \" + this.model.get(\"_id\")\r\n      });\r\n\r\n      // Wait for the popup to be fully removed before swapping the graphic visibilities.\r\n      this.listenToOnce(this.popupView.model, \"remove\", this.onPopupRemoved);\r\n    },\r\n\r\n    onPopupRemoved: function() {\r\n      this.model.getActiveItem().set(\"_isVisible\", true);\r\n      this.model.getActiveItem().toggleActive();\r\n      this._isPopupOpen = false;\r\n    }\r\n\r\n  },\r\n  {\r\n    template: \"hotgraphicPlus\"\r\n  });\r\n\r\n  return HotGraphicPlusView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './hotgraphicPlusView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, HotgraphicPlusView, ItemsComponentModel) {\r\n\r\n  /**\r\n   * This component is a modified version of adapt-contrib-hotgraphic.\r\n   * Credit for the original scripts goes to the Adapt Framework development team.\r\n   */\r\n\r\n  return Adapt.register('hotgraphicplus', {\r\n    model: ItemsComponentModel.extend({}),\r\n    view: HotgraphicPlusView\r\n  });\r\n\r\n});\r\n","const { history } = require(\"backbone\");\r\n\r\ndefine([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  class ImgFinderOutlineModel extends Backbone.Model {\r\n    \r\n    defaults() {\r\n      return {\r\n        \"_size\": \"avg\",                     // The way the size of this outline is determined (set in JSON).\r\n        \"_accuracy\": 0,                     // How accurately this outline needs to be placed over the outline (0 - 1).\r\n\r\n        \"_parent\": null,                    // Reference to the imgFinderModel which created this Model.\r\n        \"_position\": {_left: 0, _top: 0},   // Values range from 0-100 (percentages). Location of the CENTER of the outline.\r\n\r\n        \"_myItem\":  null,                   // A reference to the _item that this outline is currently _isCorrect over.\r\n        \"_myItems\": [],                     // A list of all !_isLocked items that this outline is currently covering.\r\n\r\n        // CSS properties to apply to the View.\r\n        // Will get updated as the user interacts with the widget.\r\n        _width: 0,\r\n        _height: 0,\r\n        _top: 0,\r\n        _left: 0\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n\r\n      // Determine what kind of sizing this outline should use.\r\n      this.calcSize();\r\n\r\n      this.onPositionChange(this, this.get(\"_position\")); // Initial setup.\r\n\r\n      this.setupEventListeners();\r\n    }\r\n\r\n    calcSize() {\r\n      let sizeType = this.get(\"_size\");\r\n      switch (sizeType) {\r\n\r\n        /** The outline will take on the size of the _item that's closest to it. */\r\n        case \"near\":\r\n          throw `ImgFinder: _outline._size == \"near\" is not implemented yet.`;\r\n\r\n        /** All outlines will have the exact same size; that size being the average of all _item sizes */\r\n        case \"avg\":\r\n        default:\r\n          this.set(this.getAvgOutlineSize());\r\n      }\r\n    }\r\n\r\n    setupEventListeners() {\r\n      this.listenTo(this, \"change:_position\", this.onPositionChange);\r\n    }\r\n\r\n    /**\r\n     * Whenever the \"_position\" changes, update the style properties accordingly.\r\n     * @param {*} model \r\n     * @param {*} position \r\n     */\r\n    onPositionChange(model, position) {\r\n      this.set(\"_left\", position._left - this.get(\"_width\")/2);\r\n      this.set(\"_top\", position._top - this.get(\"_height\")/2);\r\n\r\n      // Check if this outline was just placed over a previous incorrect guess.\r\n      // Mark this outline as incorrect immediately if that's the case.\r\n      this.set(\"_isIncorrect\", this.isOverGuess());\r\n    }\r\n\r\n    isOverGuess() {\r\n\r\n      // If the outline is correct, it doesn't matter if it's over an incorrect guess.\r\n      if (this.get(\"_isLocked\") || this.get(\"_isCorrect\")) return false;\r\n\r\n      // If the outline is currently over an item, don't mark it as incorrect.\r\n      if (this.calcOverlappedItems().length) return false;\r\n\r\n      // Finally, check through all guesses to see if it's over one of them.\r\n      let position = this.get(\"_position\");      \r\n      let guess = this.get(\"_parent\").getGuesses().find(guess => {\r\n        \r\n        if (position._left > guess._left + guess._width) return false;\r\n        if (position._left < guess._left)                return false;\r\n        \r\n        if (position._top > guess._top + guess._height) return false;\r\n        if (position._top < guess._top)                 return false;\r\n\r\n        return true;\r\n      });\r\n\r\n      return Boolean(guess);\r\n    }\r\n\r\n    /**\r\n     * Loops through all _items and stores a list of the ones considered \"overlapped\" by this outline.\r\n     */\r\n    calcOverlappedItems() {\r\n\r\n      // If this outline is locked, it doesn't need to be checked.\r\n      if (this.get(\"_isLocked\")) {\r\n        this.set(\"_myItems\", []);\r\n        return;\r\n      }\r\n      \r\n      let parent = this.get(\"_parent\");\r\n      const accuracy = this.get(\"_accuracy\");\r\n\r\n      let items = [];\r\n\r\n      parent.getChildren().each((itemModel) => {\r\n\r\n        let v = this.getVectorToItem(itemModel);\r\n\r\n        // If accuracy == 0, then as long as the center of the outline is within the item's bounds, it's correct.\r\n        // If accuracy == 1, then the outline's center has to be EXACTLY in the center of the item's bounds.\r\n        // (Never set accuracy to 1, as it requires the user to be pixel-perfect).\r\n        let w = itemModel.get(\"_width\")/2 * (1-accuracy);\r\n        let h = itemModel.get(\"_height\")/2 * (1-accuracy);\r\n\r\n        // If the center of this outline isn't within the item's box, then the outline isn't overlapping it.\r\n        if (Math.abs(v.x) > w) return false;\r\n        if (Math.abs(v.y) > h) return false;\r\n\r\n        items.push({\r\n          proximity: this.getVectorLengthSquared(v), // We don't need accurate proximities, so the more efficient\r\n                                                     // squared length calculation can be used.\r\n          item: itemModel\r\n        });\r\n      });\r\n\r\n      items = _.sortBy(items, \"proximity\");\r\n\r\n      this.set(\"_myItems\", items);\r\n\r\n      return items;\r\n    }\r\n\r\n    /**\r\n     * Returns a reference to a \"_myItems\" element if the itemModel provided within it.\r\n     * @param {*} itemModel \r\n     */\r\n    getOverlappingItemData(itemModel) {\r\n      return _.find(this.get(\"_myItems\"), (itemObj) => {return itemObj.item == itemModel;});\r\n    }\r\n\r\n    pairWithItem(itemModel) {\r\n      this.set(\"_item\", itemModel);\r\n      this.set(\"_isCorrect\", true);\r\n      this.set(\"_isIncorrect\", false);\r\n      this.set(\"_isLocked\", true);\r\n\r\n      // Move this outline to be perfectly centered over the item.\r\n      this.set(\"_position\", itemModel.getPosition());\r\n\r\n      itemModel.set({\r\n        _outline: this,\r\n        _isCorrect: true,\r\n        _isLocked: true,\r\n        _isActive: true\r\n      });\r\n    }\r\n    \r\n    /**\r\n     * Returns a vector from this outline's position to the center of the item.\r\n     * Vector values in percentages (0-100).\r\n     * @param {Model} item ImgFinder Item object\r\n     */\r\n    getVectorToItem(item) {\r\n\r\n      let position = this.get(\"_position\");\r\n\r\n      let x = item.get(\"_left\") + item.get(\"_width\")/2 - position._left;\r\n      let y = item.get(\"_top\") + item.get(\"_height\")/2 - position._top;\r\n\r\n      return {\r\n        x: x,\r\n        y: y\r\n      }\r\n    }\r\n\r\n    getVectorLength(vector) {\r\n      return Math.sqrt(Math.pow(vector.x,2) + Math.pow(vector.y,2));\r\n    }\r\n\r\n    // More efficient.\r\n    getVectorLengthSquared(vector) {\r\n      return Math.pow(vector.x,2) + Math.pow(vector.y,2);\r\n    }\r\n\r\n    /**\r\n     * Gets the dimensions of all item elements, then averages them.\r\n     */\r\n    getAvgOutlineSize() {\r\n\r\n      let sizeMod = this.get(\"_sizeMod\") || 1;\r\n\r\n      let width = 0;\r\n      let height = 0;\r\n\r\n      let items = this.get(\"_parent\").getChildren();\r\n      items.each((item) => {\r\n        \r\n        let w = item.get(\"_width\");\r\n        let h = item.get(\"_height\");\r\n        \r\n        // Error check (in case non-number values were entered for _width / _heights);\r\n        if (isNaN(w)) throw `imgFinderView.js: invalid value provided for item \"_width\": ${w}. Value must be a number!`;\r\n        if (isNaN(h)) throw `imgFinderView.js: invalid value provided for item \"_height\": ${h}. Value must be a number!`;\r\n        \r\n        width += w;\r\n        height += h;\r\n      });\r\n\r\n      let avg = {\r\n        _width: (width / items.length) * sizeMod,\r\n        _height: (height / items.length) * sizeMod\r\n      }\r\n\r\n      return avg;\r\n    }\r\n\r\n    /**\r\n     * Returns a model with information about where this outline was placed.\r\n     * (Guesses are used to mark a location as already being checked by the user).\r\n     */\r\n    getGuessObj() {\r\n      return {\r\n        _left: this.get(\"_left\"),\r\n        _top: this.get(\"_top\"),\r\n        _width: this.get(\"_width\"),\r\n        _height: this.get(\"_height\")\r\n      };\r\n    }\r\n\r\n    remove() {\r\n      // This will send an event to the view to tell it to play a quick removal animation.\r\n      this.set(\"_isRemoved\", true);\r\n\r\n      // Immediately remove this outline from the parent model.\r\n      this.collection?.remove(this);\r\n    }\r\n  }\r\n\r\n  return ImgFinderOutlineModel;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n\r\n  // \\/ These libraries are included with the \"adapt-jquery-ui\" extension.\r\n  'libraries/jquery-ui.interactions',\r\n  'libraries/jquery.ui.touch-punch' // MUST BE INCLUDED! Fixes several compatibility issues that jquery-ui has with touch devices.\r\n], function(Adapt) {\r\n\r\n  const DRAGGING_BUFFER = 50; // Don't allow the outline to be removed after dragging until this many ms have passed.\r\n\r\n  class ImgFinderOutlineView extends Backbone.View {\r\n    \r\n    className() {\r\n      let classes = [\r\n        \"imgfinder-outline\",\r\n        this.model.get(\"_isCorrect\") ? \"is-correct\" : \"\",\r\n        this.model.get(\"_isIncorrect\") ? \"is-incorrect\" : \"\",\r\n        this.model.get(\"_isLocked\") ? \"is-locked\" : \"\"\r\n      ];\r\n\r\n      return classes.join(\" \");\r\n    }\r\n\r\n    attributes() {\r\n      return {\r\n        \"style\": `top: ${this.model.get(\"_top\")}%; left: ${this.model.get(\"_left\")}%; width: ${this.model.get(\"_width\")}%; height: ${this.model.get(\"_height\")}%;`\r\n      }\r\n    }\r\n\r\n    events() {\r\n      return {\r\n        // FIXME: The outlines can sometimes get stuck in their mousedown state.\r\n        \"mousedown\" : \"onMouseDown\",\r\n        \"touchstart\" : \"onMouseDown\",\r\n        \"click\" : \"onClick\"\r\n      };\r\n    }\r\n\r\n    initialize() {\r\n      this.render();\r\n      this.setupEventListeners();\r\n    }\r\n\r\n    setupEventListeners() {\r\n      this.listenTo(this.model, {\r\n        \"change:_left\":             this.onPositionChange,\r\n        \"change:_top\":              this.onPositionChange,\r\n        \"change:_isDragging\":       this.onDraggingChange,\r\n        \"change:_isMouseDown\":      this.onMouseDownChange,\r\n        \"change:_isCorrect\":        this.onCorrectChange,\r\n        \"change:_isIncorrect\":       this.onIsIncorrectChange,\r\n        \"change:_isLocked\":         this.onLockedChange,\r\n        \"change:_isRemoved\":        this.onIsRemovedChange\r\n      });\r\n    }\r\n\r\n    onCorrectChange(model, isCorrect) {\r\n      this.$el\r\n        .toggleClass(\"is-correct\", isCorrect);\r\n    }\r\n\r\n    onIsIncorrectChange(model, isIncorrect) {\r\n      this.$el\r\n        .toggleClass(\"is-incorrect\", isIncorrect);\r\n    }\r\n\r\n    // TODO:? Allow for un-locking.\r\n    onLockedChange(model, isLocked) {\r\n      if (!isLocked) return;\r\n\r\n      // Once locked, disable interaction.\r\n      this.$el.draggable(\"option\", \"disabled\", true);\r\n      this.$el\r\n        .off(\"mousedown\")\r\n        .off(\"touchstart\")\r\n        .off(\"click\");\r\n    }\r\n\r\n    // Once the user clicks down on the outline, it should visually react.\r\n    onMouseDown() {\r\n      this.model.set(\"_isMouseDown\", true);\r\n    }\r\n\r\n    onMouseDownChange(model, isMouseDown) {\r\n      this.$el.toggleClass(\"is-mousedown\", isMouseDown);\r\n    }\r\n\r\n    onBlur() {\r\n      this.model.set(\"_isMouseDown\", false);\r\n    }\r\n\r\n    onDraggingChange(model, isDragging) {\r\n      this.$el.toggleClass(\"is-dragging\", isDragging);\r\n    }\r\n\r\n    onPositionChange(model) {\r\n      this.$el.css(\"left\", this.model.get(\"_left\") + \"%\");\r\n      this.$el.css(\"top\", this.model.get(\"_top\") + \"%\");\r\n    }\r\n\r\n    render() {\r\n      var data = this.model.toJSON();\r\n      data.view = this;\r\n      var template = Handlebars.templates['imgFinderOutline'];\r\n      this.$el.html(template(data));\r\n\r\n      this.setupDraggable();\r\n    }\r\n\r\n    /**\r\n     * The user can click and drags the outline to reposition it after creating it.\r\n     */\r\n    setupDraggable() {\r\n      this.$el.draggable(\r\n        {\r\n          containment: \"parent\",\r\n          scroll: false, // Prevent the page scrolling while dragging (default jQuery implementation is bugged).\r\n  \r\n          start: (event, ui) => {\r\n            this.model.set(\"_isDragging\", true);\r\n            this._isDragging = true;\r\n          },\r\n  \r\n          // TODO: define these callback functions in the View itself and reference them here?\r\n          // Called each tick the draggable is moved.\r\n          /*drag: _.throttle((event, ui) => { // Requires a lot of processing. Throttled to improve performance.\r\n            console.log(\"DRAG\");\r\n\r\n          }, 1),*/\r\n          stop: () => { \r\n\r\n            // jQuery-ui draggable sets the \"top\" and \"left\" using px.\r\n            // This will convert those values back to %.\r\n            this.recalcPosition();\r\n            this.model.set(\"_isDragging\", false);\r\n            this.model.set(\"_isMouseDown\", false);\r\n\r\n            // The user cannot remove the outline while this._isDragging == true.\r\n            _.delay(() => {\r\n              this._isDragging = false;\r\n            }, DRAGGING_BUFFER);\r\n          }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Clicking an outline (without dragging it) should remove it.\r\n     */\r\n    onClick(event) {\r\n      event.preventDefault();\r\n      event.stopPropagation(); // Prevent the $area element behind the outline detecting user clicks. \r\n      this.model.set(\"_isMouseDown\", false);\r\n\r\n      // Don't remove the outline if it was clicked too soon after being dragged.\r\n      if (this._isDragging) return;\r\n\r\n      this.model.remove();\r\n    }\r\n\r\n    $getArea() {\r\n      return this.$el.closest(\".js-imgfinder-outline-area\").first();\r\n    }\r\n\r\n    /**\r\n     * Sets the values of \"_left\" and \"_top\" based on the CSS position of this view.\r\n     * Needs to be called after draggable() completes.\r\n     */\r\n    recalcPosition() {\r\n      let pos = this.$el.position();\r\n\r\n      let $area = this.$getArea();\r\n      let bb = $area[0].getBoundingClientRect();\r\n\r\n      // Set the \"_position\" (the CENTER of the outline).\r\n      // The model will then update the style values accordingly.\r\n      this.model.set(\"_position\", {\r\n        _left: (pos.left / bb.width) * 100 + this.model.get(\"_width\")/2,\r\n        _top: (pos.top / bb.height) * 100 + this.model.get(\"_height\")/2\r\n      });\r\n    }\r\n\r\n    onIsRemovedChange(model, isRemoved) {\r\n      if (!isRemoved) return;\r\n      this.remove();\r\n    }\r\n\r\n    remove() {\r\n      this.$el.addClass(\"is-removed\");\r\n      this.model.remove();\r\n\r\n      // Once the CSS transition is complete, remove this view as well.\r\n      // FIXME: Timing hardcoded.\r\n      _.delay(() => {\r\n        super.remove();\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  return ImgFinderOutlineView;\r\n});\r\n","const G = require(\"glob\");\r\n\r\ndefine([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView',\r\n  './imgFinderOutlineModel',\r\n  './imgFinderOutlineView'\r\n], function(Adapt, QuestionView, ImgFinderOutlineModel, ImgFinderOutlineView) {\r\n\r\n  /**\r\n   * A Question component which shows the user an image, and has them outline one or more specific areas on it to complete the task.\r\n   * \r\n   * The user can click anywhere to create an outline; click on an existing outline to remove it; or click and drag an existing outline\r\n   * to move it around.\r\n   * \r\n   * How it works:\r\n   * -------------\r\n   * - An \"item\" for this template is an invisible area (hitbox) of the image that the user must place an outline over in order to\r\n   *   complete the task.\r\n   * - The user places an outline by clicking anywhere on the image.\r\n   *   The dimensions of the outline are determined by the _outline._size property.\r\n   *      - If \"auto\" || \"avg\", the outline will have the averaged dimensions of all item hotspots.\r\n   *      - If \"near\", the outline will take on the dimensions of the hotspot CLOSEST to where the user clicked.\r\n   *        This should be used SPARINGLY, as it could give away the answer.\r\n   * - An item is considered \"outlined\" if the center of the outline element is within the item hitbox.\r\n   * - If multiple outlines are covering the same item, the one closest to the item will be registered.\r\n   *   The other will be re-checked against the remaining, not-yet-checked item hitboxes.\r\n   * - Incorrectly placed outlines will leave behind a hitbox of their own. If the user tries to outline that area again, the outline will\r\n   *   automatically turn red, before they submit anything. If the outline is also over a valid item hitbox, it will NOT turn red. a.k.a, \r\n   *   an outline NEVER turns red if submitting it would result in it being labelled as \"correct\".\r\n   * \r\n   * TODO:\r\n   * -----\r\n   * - Allow for optional items (hotspots that aren't mandatory to be outlined, but also don't turn red).\r\n   * - Allow for partial completion (example: there are 10 hotspots, and only 6 need to be outlined for a \"complete\" score).\r\n   * - Prevent cheating using the browser's developer tools.\r\n   */\r\n\r\n  class ImgFinderView extends QuestionView {\r\n    \r\n    events() {\r\n      return {\r\n        \"mousedown .js-imgfinder-outline-area\" : \"onOutlineAreaDown\",\r\n        \"touchstart .js-imgfinder-outline-area\" : \"onOutlineAreaDown\"\r\n      };\r\n    }\r\n\r\n    initialize() {\r\n      this.setUpModelData();\r\n      super.initialize();\r\n      this.setupEventListeners();\r\n      \r\n      /*this.update = _.debounce(this.update.bind(this), 1);\r\n      this.setUpEventListeners();*/\r\n    }\r\n\r\n    setUpModelData() {\r\n\r\n      // Set up adapt-sizing string for the background-graphic.\r\n      let graphic = this.model.get(\"_graphic\");\r\n      if (graphic && graphic._sizing) {\r\n        graphic._sizing._classes = Adapt.sizing.getSizingClass(graphic._sizing);\r\n      }\r\n    }\r\n\r\n    setupEventListeners() {\r\n      this.listenTo(this.model, {\r\n        \"change:_isSubmitted\": this.onIsSubmittedChange,\r\n        \"change:_isCorrect\": this.onIsCorrectChange\r\n      });\r\n    }\r\n\r\n    /** \r\n     * When the user gets the component correct; disable further interaction.\r\n     */\r\n    onIsSubmittedChange(model, isSubmitted) {\r\n\r\n      if (!isSubmitted) return;\r\n            \r\n      this.$el\r\n          .toggleClass(\"is-submitted\", isSubmitted);\r\n    }\r\n    onIsCorrectChange(model, isCorrect) {\r\n            \r\n      this.$el\r\n          .toggleClass(\"is-correct\", isCorrect)\r\n          .toggleClass(\"is-incorrect\", !isCorrect);\r\n    }\r\n\r\n    /**\r\n     * Allow for easy positioning of pin items using the adapt-dd-debug plugin.\r\n     */\r\n    setUpDebug() {\r\n\r\n      if (!Adapt.debug?._isEnabled) return;\r\n\r\n      \r\n      if (Adapt.debug?.setUpInteract) {\r\n        let $items = this.$(\".js-imgfinder-item\");\r\n        let $container = this.$(\".js-imgfinder-item-container\");\r\n        Adapt.debug.setUpInteract($items, $container, false);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Whenever the user clicks on the area where outlines are created, add one.\r\n     * @param {*} event \r\n     */\r\n    onOutlineAreaDown(event) {\r\n\r\n      if (this.model.get(\"_isSubmitted\")) return; // Don't allow the creation of more outlines after submitting.\r\n\r\n      // Location (relative to the outline area) to place the CENTER of the outline.\r\n      // Needs to be in percentages.\r\n      let $area = this.$(\".js-imgfinder-outline-area\");\r\n\r\n      // Only register clicks on the area (and not on the outlines within it).\r\n      if (!$area.is($(event.target))) return;\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation(); // Probably not needed.\r\n\r\n      let x = 0;\r\n      let y = 0;\r\n      let bb = $area[0].getBoundingClientRect();\r\n\r\n      // Get the offset relative to the $area.\r\n      // A different approach needs to be used depending on if the event was touch or click.\r\n      if (event.touches) {\r\n        let touch = event.touches[0] || event.changedTouches[0];\r\n\r\n        x = touch.clientX - bb.left;\r\n        y = touch.clientY - bb.top;\r\n      }\r\n      else {\r\n        x = event.clientX - bb.left;\r\n        y = event.clientY - bb.top;\r\n      }\r\n\r\n      let pos = {\r\n        _left: (x / $area.width()) * 100,\r\n        _top: (y / $area.height()) * 100\r\n      }\r\n\r\n      this.addOutline(pos);\r\n    }\r\n\r\n    /**\r\n     * Adds an outline in the provided position.\r\n     * @param {Object} position Location that the center of the outline should be; RELATIVE to the onOutlineAreaDown.\r\n     */\r\n    addOutline(position) {\r\n\r\n      let $area = this.$(\".js-imgfinder-outline-area\");\r\n\r\n      let modelData = _.extend({}, this.model.get(\"_outline\"), {\r\n        _position: position, // In percentage values!\r\n        _parent: this.model\r\n      });\r\n\r\n      let outlineModel = new ImgFinderOutlineModel(modelData);\r\n      let outlineView = new ImgFinderOutlineView({model: outlineModel});\r\n\r\n      $area.append(outlineView.$el);\r\n\r\n      // Store it in the collection.\r\n      this.model.addOutline(outlineModel);\r\n    }\r\n\r\n    \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    setupQuestion() {\r\n      this.model.setupRandomisation();\r\n\r\n      // Modified:\r\n      // This view's model inherits itemsComponentModel, and as such will consider itself complete if all items have _isVisited: true.\r\n      // adapt-dd-questionPlus doesn't want this, so stop listening for _isVisited events on the items.\r\n      this.model.stopListening(this.model.getChildren(), \"change:_isVisited\", this.model.checkCompletionStatus);\r\n    }\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking() {\r\n      //this.update();\r\n      \r\n      // adapt-dd-questionPlus:\r\n      this.updateMarking();\r\n    }\r\n\r\n    update() {\r\n      this.updateMarking();\r\n    }\r\n\r\n    postRender() {\r\n      super.postRender();\r\n      this.setUpDebug();\r\n    }\r\n\r\n    /**\r\n     * When the user closes the feedback notify, wait X seconds, then de-activate incorrectly activated items.\r\n     * This was done to improve the UI experience, as some users didn't realize they needed to manually de-select\r\n     * the incorrectly selected items.\r\n     * \r\n     * DD: DD specific implementation.\r\n     */\r\n    onSubmitted() {\r\n      super.onSubmitted();\r\n      this.listenToOnce(Adapt, \"notify:closed\", this.onFeedbackClosed);\r\n    }\r\n\r\n    onFeedbackClosed() {\r\n      //this.deselectIncorrectAnswers();\r\n    }\r\n    \r\n    showCorrectAnswer() {\r\n      this.update();\r\n    }\r\n\r\n    hideCorrectAnswer() {\r\n      this.update();\r\n    }\r\n\r\n    setUpEventListeners(){\r\n      \r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    }\r\n\r\n    onItemClick(event) {\r\n      if (event) event.preventDefault();\r\n\r\n      var item = this.model.getItem($(event.currentTarget).data('adapt-index'));\r\n      item.toggleActive();\r\n    }\r\n\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-finder-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n    }\r\n\r\n    onItemsActiveChange(model, _isActive) {\r\n\r\n      this.getItemElement(model)\r\n        .toggleClass('is-active', _isActive)\r\n        .find(\".js-item-label\").toggleClass('is-selected', _isActive);\r\n      this.updateContainer();\r\n    }\r\n\r\n    onItemsVisitedChange(model, _isVisited) {\r\n      if (!_isVisited) return;\r\n      var $item = this.getItemElement(model);\r\n\r\n      // Append the word 'visited.' to the aria-label\r\n      /*var visitedLabel = this.model.get('_globals')._accessibility._ariaLabels.visited + \".\";\r\n      $item.find('.aria-label').each(function(index, el) {\r\n        el.innerHTML += \" \" + visitedLabel;\r\n      });*/\r\n\r\n      $item.addClass('is-visited');\r\n    }\r\n\r\n    /**\r\n     * adapt-dd-questionPlus will called this whenever the user clicks Submit.\r\n     */\r\n    updateMarking() {\r\n\r\n      let isInteractive = this.model.isInteractive();\r\n      let canShowMarking = this.model.get('_canShowMarking');\r\n      let ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n      // FIXME: Checkbox state changes are a bit messily implemented.\r\n\r\n      this.model.getChildren().each((itemModel) => {\r\n\r\n        let index = itemModel.get('_index');\r\n        let $item = this.getItemElement(itemModel);\r\n        let $itemLabel = $item.find(\".js-item-label\");\r\n\r\n        let shouldBeSelected = Boolean(itemModel.get(\"_shouldBeSelected\"));\r\n        let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n        // An item is only considered \"visited\" once it has been submitted at least once.\r\n        let isVisited = Boolean(itemModel.get(\"_isVisited\") || isActive); itemModel.set(\"_isVisited\", isVisited);\r\n        let isCorrect = shouldBeSelected && isActive; // Only mark active items as correct.\r\n\r\n        // Disable items only when the item has been completed, or when the entire component has been completed.\r\n        let isDisabled = !isInteractive || isCorrect;\r\n        $item\r\n          .prop('disabled', isDisabled)\r\n          .toggleClass('is-disabled', isDisabled)\r\n          .find(\".finder__item-answer-icon\")\r\n          .toggleClass('is-disabled', isDisabled);\r\n\r\n        // Remove marking from non-visited items.\r\n        if (/*isInteractive || */ !isVisited || !canShowMarking) {\r\n          $item.removeClass('is-correct is-incorrect');\r\n          $itemLabel.removeClass('is-correct is-incorrect');\r\n          return;\r\n        }\r\n\r\n        // Mark visited items (that are selected).\r\n        // (DD questionPlus design choice).\r\n        if (!isActive) return;\r\n\r\n        $item\r\n          .toggleClass('is-correct', isCorrect)\r\n          .toggleClass('is-incorrect', !isCorrect)\r\n          .toggleClass('is-disabled', isDisabled)\r\n          .prop('disabled', isDisabled);\r\n\r\n        $itemLabel\r\n        .toggleClass('is-correct', isCorrect)\r\n        .toggleClass('is-incorrect', !isCorrect)\r\n        .toggleClass('is-disabled', isDisabled);\r\n      });\r\n\r\n      this.updateContainer();\r\n    }\r\n\r\n    /**\r\n     * The container for the items will gain the .is-incorrect class while it contains any active incorrect items.\r\n     * The container for the items will gain the .is-correct class only when the component is completed.\r\n     */\r\n    updateContainer() {\r\n\r\n      let isAtLeastOneIncorrect = Boolean(\r\n        this.model.getChildren().find((itemModel) => {\r\n          return itemModel.get(\"_isVisited\") && itemModel.get(\"_isActive\") && !itemModel.get(\"_shouldBeSelected\");\r\n        })\r\n      );\r\n\r\n      let $container = this.$(\".finder__items-container\");\r\n      $container\r\n        .toggleClass(\"is-incorrect\", isAtLeastOneIncorrect)\r\n        .toggleClass(\"is-correct\", Boolean(this.model.get(\"_isCorrect\")));\r\n    }\r\n\r\n    /*onDeviceResize() {\r\n      this.recalcItemSize();\r\n    }*/\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  ImgFinderView.template = \"imgFinder\";\r\n  return ImgFinderView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/itemModel'\r\n], function(Adapt, ItemModel) {\r\n\r\n\r\n  class ImgFinderItemModel extends ItemModel {\r\n\r\n    initialize(...args) {\r\n      super.initialize(...args);\r\n      this.setupModelData();\r\n    }\r\n\r\n    setupModelData() {\r\n\r\n    }\r\n\r\n    getPosition() {\r\n      return {\r\n        _left: this.get(\"_left\") + this.get(\"_width\")/2,\r\n        _top: this.get(\"_top\") + this.get(\"_height\")/2\r\n      }\r\n    }\r\n  }\r\n\r\n  return ImgFinderItemModel;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/itemsQuestionModel',\r\n  './imgFinderItemModel'\r\n], function(Adapt, ItemsQuestionModel, ImgFinderItemModel) {\r\n\r\n  /**\r\n   * ImgFinder\r\n   * ----------------------------------------------------\r\n   * \r\n   * Important:\r\n   * - Avoid overlapping _items if it can be helped.\r\n   * \r\n   * Notes:\r\n   * - Uses the ItemsQuestionModel as a base.\r\n   *   Each item only has two validation states (the user has found and outlined it, or the user hasn't). Because of this,\r\n   *   the user's interactions can be recorded as if they were for an MCQ (with checkboxes) as far as SCORM is concerned.\r\n   *   (In the back-end) Outlining an item is identical to checking the checkbox on for an MCQ item.\r\n   *\r\n   * - If multiple outlines are placed over the same item, only the first will be counted.\r\n   *   All others will be auto-removed (unless they're also touching another item, in which case the process will repeat). \r\n   * \r\n   *\r\n   * TODO:\r\n   * - If an item with \"_shouldBeSelected: false\" gets outlined, it should show some kind of unique state/feedback.\r\n   * - Show the FEEDBACK_HINT.\r\n   * \r\n   * \r\n   * FIXME:\r\n   * - Not compatible with screen readers + colour blindness at the moment.\r\n   * - Dragging the outlines is a bit limited due to the containment.\r\n   * - Partly correct feedback not working.\r\n   */\r\n\r\n  // This feedback hint is shown if the user doesn't make use of the click-and-drag and/or removal functionality of the widget.\r\n  const FEEDBACK_HINT = \"<p><em>(You can click an existing outline to remove it, or you can drag it to reposition it).</em></p>\";\r\n  const MAX_GUESSES = 20; // Only store this many guess objects before removing the older ones.\r\n\r\n  class ImgFinderModel extends ItemsQuestionModel {\r\n\r\n    initialize(...args) {\r\n      super.initialize(...args);\r\n\r\n      this.setupModelData();\r\n      this.setupEventListeners();\r\n    }\r\n\r\n    /**\r\n     * Override the function from ItemsComponentModel to allow us to use our own model for the items.\r\n     */\r\n    setUpItems() {\r\n      const items = this.get('_items') || [];\r\n      items.forEach((item, index) => {\r\n        item._index = index;\r\n        item._parent = this;\r\n      });\r\n      this.setChildren(new Backbone.Collection(items, { model: ImgFinderItemModel }));\r\n    }\r\n\r\n    setupModelData() {\r\n      \r\n      // Add a collection for storing the ImgFinderOutlines.\r\n      let outlines = new Backbone.Collection();\r\n      this.set(\"_outlines\", outlines);\r\n\r\n      // The _guesses array will store all locations where an outline has been incorrectly placed (and submitted).\r\n      this.set(\"_guesses\", []);\r\n\r\n      this.set(\"_hasShownFeedbackHint\", false);\r\n    }\r\n\r\n    getGuesses() {\r\n      return this.get(\"_guesses\");\r\n    }\r\n\r\n    addGuess(guess) {\r\n      let g = this.get(\"_guesses\");\r\n      g.push(guess);\r\n\r\n      // Remove excess guesses.\r\n      if (g.length > MAX_GUESSES) g.shift();\r\n\r\n      this.set(\"_guesses\", g);\r\n    }\r\n\r\n    setupEventListeners(...args) {\r\n      if (super.setupEventListeners) super.setupEventListeners(...args);\r\n\r\n      this.listenTo(this.get(\"_outlines\"), {\r\n        \"add\": this.onOutlinesModified,\r\n        \"remove\": this.onOutlinesModified\r\n      });\r\n    }\r\n\r\n    addOutline(outlineModel) {\r\n      this.get(\"_outlines\").push(outlineModel);\r\n    }\r\n\r\n    /** \r\n     * Whenever an outline is added/removed, check whether the user can submit again.\r\n     */\r\n    onOutlinesModified() {\r\n      this.checkCanSubmit();\r\n    }\r\n\r\n    canSubmit() {\r\n\r\n      // Can submit as long as there's at least one outline present.\r\n      return this.get(\"_outlines\").length >= 1;\r\n    }\r\n\r\n    /**\r\n     * How outlines are assigned to items:\r\n     * -----------------------------------\r\n     * - All outlines are looped through, and each outline stores an array of references to all items that it successfully covers, \r\n     *   sorted by proximity.\r\n     * \r\n     * - Once that's done, all outlines are looped through. If an outline was detected by multiple items, it is given to the\r\n     *   one that it's closest to (proximity wise). All other items that have it in their arrays remove it.\r\n     * \r\n     * - Each item then pairs itself with the nearest outline thats still remaining in its array.\r\n     * \r\n     * @returns \r\n     */\r\n    validateOutlines() {\r\n\r\n      let outlines = this.get(\"_outlines\");\r\n      \r\n      // First, have each outline find and store an array of all _items it's currently covering.\r\n      outlines.each((outline) => {\r\n        outline.calcOverlappedItems();\r\n      });\r\n\r\n      // Then, for each item, check which outline determined itself to be closest to it.\r\n      this.getChildren().each(itemModel => {\r\n\r\n        if (itemModel.get(\"_isLocked\")) return; // Don't check locked items (they're already been completed).\r\n\r\n        let myOutline = null;\r\n        let myProximity = Infinity;\r\n\r\n        outlines.each((outline) => {\r\n\r\n          if (outline.get(\"_isLocked\")) return; // This outline has already been locked by another item.\r\n\r\n          let data = outline.getOverlappingItemData(itemModel);\r\n          \r\n          // This outline is not overlapping this itemModel.\r\n          if (!data) return; \r\n\r\n          // This outline is (one of the outlines) overlapping this itemModel.\r\n          // Store it if it's closer than the previous overlapping outlines checked.\r\n          if (data.proximity < myProximity) {\r\n            myProximity = data.proximity;\r\n            myOutline = outline;\r\n          }\r\n        });\r\n\r\n        // Store a reference to the outline that was closest to this itemModel.\r\n        if (!myOutline) {\r\n          itemModel.set(\"_isActive\", false);\r\n          return;\r\n        }\r\n\r\n        myOutline.pairWithItem(itemModel);\r\n        itemModel.set(\"_isActive\", true);\r\n      });\r\n\r\n      // Remove all outlines which are still un-locked, and are also covering items.\r\n      // (Aka, the user put more than one outline over an item).\r\n      outlines.each(outline => {\r\n        if (!outline) return; // Skip if already removed.\r\n\r\n        if (outline.get(\"_isLocked\")) return;\r\n        if (!outline.get(\"_myItems\").length) return;\r\n\r\n        outline.remove();\r\n      });\r\n\r\n      // For all remaining items, add their bounding-box to the \"_guesses\" collection.\r\n      outlines.each(outline => {\r\n        this.addGuess(outline.getGuessObj());\r\n        outline.set(\"_isIncorrect\", true);\r\n      });\r\n    }\r\n\r\n    \r\n    /**\r\n     * Correct:         ALL and ONLY the _shouldBeSelected items have been outlined.\r\n     * PartlyCorrect:   ONLY _shouldBeSelected items have been outlined, but not all of them.\r\n     * Incorrect:       NO _shouldBeSelected items have been outlined.\r\n     */\r\n    isCorrect() {\r\n\r\n      this.validateOutlines();\r\n      let outlines = this.get(\"_outlines\");\r\n\r\n      let correctOutlines = [];\r\n      let incorrectOutlines = [];\r\n\r\n      outlines.each(outline => {\r\n\r\n        if (outline.get(\"_isCorrect\")) {\r\n          correctOutlines.push(outline);\r\n        }\r\n        else {\r\n          incorrectOutlines.push(outline);\r\n        }\r\n      });\r\n      \r\n      const props = {\r\n        \r\n        _numberOfIncorrectAnswers: incorrectOutlines.length, \r\n        _numberOfCorrectAnswers: correctOutlines.length,\r\n        _numberOfRequiredAnswers: this.getChildren().length,\r\n\r\n        _isAtLeastOneIncorrectSelection: Boolean(incorrectOutlines.length),\r\n      };\r\n\r\n      this.set(props);\r\n\r\n      const hasRightNumberOfCorrectAnswers = (props._numberOfCorrectAnswers === props._numberOfRequiredAnswers);\r\n      const hasNoIncorrectAnswers = !props._isAtLeastOneIncorrectSelection;\r\n\r\n      return hasRightNumberOfCorrectAnswers && hasNoIncorrectAnswers;\r\n    }\r\n    \r\n    isPartlyCorrect() {\r\n      return this.get('_numberOfCorrectAnswers') > 0;\r\n    }\r\n\r\n    setupFeedback() {\r\n      \r\n      if (!this.has('_feedback')) return;\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.setupCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      // FIXME: Hardcoded.\r\n      if (!this.get(\"_hasShownFeedbackHint\")) {\r\n        this.set(\"_hasShownFeedbackHint\", true);\r\n        \r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n        console.log(\"FIXME\");\r\n\r\n        // Add the feedback hint after the incorrect feedback.\r\n        let feedback = this.get(\"_feedback\");\r\n        if (feedback._partlyCorrect.final) this.get(\"_feedback\")._partlyCorrect.body += FEEDBACK_HINT;\r\n        feedback._incorrect.final += FEEDBACK_HINT;\r\n\r\n        this.set(\"_feedback\", feedback);\r\n      }\r\n\r\n      if (this.isPartlyCorrect()) {\r\n        this.setupPartlyCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      this.setupIncorrectFeedback();\r\n    }\r\n  }\r\n\r\n\r\n  return ImgFinderModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './imgFinderView',\r\n  './imgFinderModel'\r\n], function(Adapt, ImgFinderView, ImgFinderModel) {\r\n\r\n  return Adapt.register(\"imgfinder\", {\r\n    view: ImgFinderView,\r\n    model: ImgFinderModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel'\r\n], function(Adapt, QuestionModel) {\r\n\r\n  class MatchingPlusModel extends QuestionModel {\r\n\r\n    init(...args) {\r\n      super.init();\r\n      this.setUpItems(...args);\r\n\r\n      this.checkCanSubmit();\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    toJSON() {\r\n      const json = super.toJSON();\r\n      // Make sure _items is updated from child collection\r\n      json._items = this.getChildren().toJSON();\r\n      return json;\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.getChildren(), {\r\n        \"change:_optionsSelected\" : this.onItemOptionsSelectedChange\r\n      });\r\n    }\r\n\r\n    setupRandomisation() {\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) {\r\n        Adapt.log.error(\"matchingPlusModel: '_isRandom: false' setting is not fully implemented yet. Using it is not recommended.\");\r\n        return;\r\n      }\r\n      let children = this.getChildren();\r\n      children.reset(children.shuffle(), {silent:true});\r\n    }\r\n\r\n    /**\r\n     * Enable submitting once all items have had a selection made for them.\r\n     */\r\n    onItemOptionsSelectedChange() {\r\n      this.checkCanSubmit();\r\n    }\r\n\r\n    /**\r\n     * Can submit once every item has had at least one option selected.\r\n     */\r\n    canSubmit() {\r\n      let incompleteItem = this.getChildren().find(itemModel => {\r\n        return itemModel.get(\"_optionsSelected\").length === 0;\r\n      });\r\n\r\n      return !Boolean(incompleteItem);\r\n    }\r\n\r\n    setUpItems() {\r\n\r\n      let items = this.get(\"_items\");\r\n      let globalOptions = this.get(\"_options\");\r\n\r\n      let isOptionsShared = true; // If any item has unique options, then this will be set to false.\r\n      let goOptionsCorrect = [];  // Keeps track of how many items are answered correctly by each globalOption.\r\n\r\n      _.each(items, (item, index) => {\r\n\r\n        item._index = index;\r\n        item._optionsSelected = [];\r\n\r\n        // Set up the options for each item\r\n        // -------------------------------------------------\r\n        if (item._optionsCorrect) {\r\n          \r\n          // Check that only one option is correct in the array (more than one may be supported in future).\r\n          if (item._optionsCorrect.length !== 1) {\r\n            throw `(${this.get(\"_id\")}) adapt-matchingPlus: only 1 correct option per item is supported (you had: \" + ${item._optionsCorrect.length} + \").`;\r\n          }\r\n\r\n          // Initialise the item._options property (if none already exists).\r\n          // In most cases, this is done by duplicating the global options.\r\n          if (item._options === undefined) {\r\n            \r\n            /*if (!globalOptions) {\r\n              throw `(${this.get(\"_id\")}) adapt-matchingPlus: only 1 correct option per item is supported (you had: \" + ${item._optionsCorrect.length} + \").`;\r\n            }*/\r\n\r\n            goOptionsCorrect = goOptionsCorrect.concat(item._optionsCorrect);\r\n\r\n            item._options = [];\r\n            _.each(globalOptions, (go, goIndex) => {\r\n\r\n              item._options.push({\r\n                text: go,\r\n                _index: goIndex,\r\n                //_isCorrect: _.includes(item._optionsCorrect, goIndex)\r\n              });\r\n            });\r\n          }\r\n          else {\r\n            isOptionsShared = false;\r\n          }\r\n        }\r\n\r\n        this.setChildren(new Backbone.Collection(items, { model: Backbone.Model }));\r\n      });\r\n\r\n      // Shared options\r\n      // -------------------------------------------------------\r\n      // If each item uses the same set of options, and each of those options is unique,\r\n      // AND if each global option is only correct for one item,\r\n      // set _hasSharedUniqueOptions to true.\r\n      // \r\n      // This will enable a behaviour in the View for this component which will cross\r\n      // out options from dropdowns once they are correctly assigned to an item.\r\n      if (this.get(\"_hasSharedUniqueOptions\") === undefined) {\r\n        if (\r\n            isOptionsShared && \r\n            globalOptions.length == _.uniq(globalOptions).length &&\r\n            goOptionsCorrect.length == _.uniq(goOptionsCorrect).length\r\n          ) {\r\n          this.set(\"_hasSharedUniqueOptions\", true);\r\n        }\r\n      }\r\n    }\r\n\r\n    isCorrect() {\r\n\r\n      const hasSharedUniqueOptions = this.get(\"_hasSharedUniqueOptions\");\r\n\r\n      const props = {\r\n        _numberOfIncorrectAnswers: 0, // Number of items selected that shouldn't have been.\r\n        _numberOfCorrectAnswers: 0,   // Number of items selected that should have been.\r\n        _isAtLeastOneIncorrectSelection: false, // _numberOfIncorrectAnswers != 0\r\n      };\r\n\r\n      this.getChildren().each(itemModel => {\r\n        \r\n        // Compare the item's _optionsSelected to the item's _optionsCorrect arrays.\r\n        let options = itemModel.get(\"_options\");\r\n        let optionsSelected  = itemModel.get(\"_optionsSelected\");\r\n        let optionsCorrect   = itemModel.get(\"_optionsCorrect\");\r\n        let isItemCorrect = true;\r\n        _.each(optionsSelected, (selectedIdx) => {\r\n\r\n          let isCorrect =   _.includes(optionsCorrect, selectedIdx);\r\n          let option =      _.find(options, (o) => {return o._index == selectedIdx});\r\n          option._isCorrect = isCorrect;\r\n          option._isIncorrect = !isCorrect;\r\n          option._isVisited = true;\r\n\r\n          if (!isCorrect) isItemCorrect = false;\r\n\r\n          // If the option is correct, and this component hasSharedUniqueOptions, eliminate the same options in all the other items.\r\n          if (isCorrect && hasSharedUniqueOptions) {\r\n            this.getChildren().each(otherItem => {\r\n              if (otherItem == itemModel) return;\r\n\r\n              let otherOptions = otherItem.get(\"_options\");\r\n              let otherOption = _.find(otherOptions, (o) => {return o._index == selectedIdx});\r\n              otherOption._isEliminated = true;\r\n              otherOption._isIncorrect = true;\r\n            });\r\n          }\r\n        });\r\n        \r\n        // The item is incorrect if any of its selected options are incorrect.\r\n        itemModel.set('_isCorrect', isItemCorrect);\r\n        itemModel.set('_isIncorrect', !isItemCorrect);\r\n        itemModel.set('_isDisabled', isItemCorrect);\r\n\r\n        // This item was incorrect.\r\n        if (!isItemCorrect) {\r\n          props._numberOfIncorrectAnswers++;\r\n          props._isAtLeastOneIncorrectSelection = true;\r\n          return;\r\n        }\r\n\r\n        // This item was correct.\r\n        props._numberOfCorrectAnswers++;\r\n      });\r\n\r\n      this.set(props);\r\n\r\n      const hasRightNumberOfCorrectAnswers = (props._numberOfCorrectAnswers === this.getChildren().length);\r\n      const hasNoIncorrectAnswers = !props._isAtLeastOneIncorrectSelection;\r\n\r\n      return hasRightNumberOfCorrectAnswers && hasNoIncorrectAnswers;\r\n    }\r\n\r\n    /**\r\n     * DD: This function is used by core Adapt, but is not used by our DD content (due to the adapt-questionPlus extension skipping its call).\r\n     */\r\n    storeUserAnswer() {\r\n\r\n      let items = this.getChildren();\r\n\r\n      var userAnswer = new Array(items.length);\r\n      var tempUserAnswer = new Array(items.length);\r\n\r\n      // TODO:? Only supports one selected option at this time. \r\n      items.forEach(function(itemModel) {\r\n        var optionIndex = itemModel.get(\"_optionsSelected\")[0];\r\n\r\n        tempUserAnswer[itemModel.get(\"_index\")] = optionIndex;\r\n        userAnswer[itemModel.get(\"_index\")] = optionIndex;\r\n      }, this);\r\n\r\n      this.set({\r\n        _userAnswer: userAnswer,\r\n        _tempUserAnswer: tempUserAnswer\r\n      });\r\n    }\r\n\r\n    setScore() {\r\n      var questionWeight = this.get('_questionWeight');\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.set('_score', questionWeight);\r\n        return;\r\n      }\r\n\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var itemLength = this.getChildren().length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    }\r\n\r\n    isPartlyCorrect() {\r\n      return this.get('_numberOfCorrectAnswers') > 0;\r\n    }\r\n\r\n    resetUserAnswer() {\r\n      this.set('_userAnswer', []);\r\n    }\r\n\r\n    /**\r\n    * Used by tracking extensions to return an object containing the component's specific interactions.\r\n    */\r\n    /*getInteractionObject() {\r\n      var interactions = {\r\n        correctResponsesPattern: null,\r\n        source: null,\r\n        target: null\r\n      };\r\n      var items = this.getChildren();\r\n      // This contains an array with a single string value, matching the source 'id' with the correct\r\n      // matching target 'id' value. An example is as follows:\r\n      // [ \"1[.]1_2[,]2[.]2_3\" ]\r\n      interactions.correctResponsesPattern = [\r\n        items.map(function(item, questionIndex) {\r\n          // Offset the item index and use it as a group identifier.\r\n          questionIndex = questionIndex + 1;\r\n          return [\r\n            questionIndex,\r\n            item._options.filter(function(item) {\r\n              // Get the correct item(s).\r\n              return item._isCorrect;\r\n            }).map(function(item) {\r\n              // Prefix the option's index and offset by 1.\r\n              return questionIndex + '_' + (item._index + 1).toString();\r\n            })\r\n          ].join('[.]');\r\n        }).join('[,]')\r\n      ];\r\n      // The 'source' property contains an array of all the stems/questions, e.g.\r\n      // [{id: \"1\", description: \"First question\"}, {id: \"2\", description: \"Second question\"}]\r\n      interactions.source = _.flatten(items.map(function(item) {\r\n        return {\r\n          // Offset by 1.\r\n          id: (item._index + 1).toString(),\r\n          description: item.text\r\n        };\r\n      }));\r\n      // The 'target' property contains an array of all the option responses, with the 'id'\r\n      // prefixed to indicate the grouping, e.g.\r\n      // [  {id: \"1_1\": description: \"First option, group 1\"},\r\n      //    {id: \"1_2\": description: \"Second option, group 1\"}\r\n      //    {id: \"2_1\": description: \"First option, group 2\"}  ]\r\n      interactions.target = _.flatten(items.map(function(item, index) {\r\n        // Offset by 1, as these values are not zero-indexed.\r\n        index = index + 1;\r\n        return item._options.map(function(option) {\r\n          return {\r\n            id: index + '_' + (option._index + 1),\r\n            description: option.text\r\n          };\r\n        });\r\n      }));\r\n      return interactions;\r\n    }*/\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * @return {string} the user's answers as a string in the format \"1.1#2.3#3.2\" assuming user selected option 1 in drop-down 1,\r\n    * option 3 in drop-down 2 and option 2 in drop-down 3. The '#' character will be changed to either ',' or '[,]' by adapt-contrib-spoor,\r\n    * depending on which SCORM version is being used.\r\n    */\r\n    getResponse() {\r\n      var responses = [];\r\n\r\n      this.get('_userAnswer').forEach(function(userAnswer, index) {\r\n        responses.push((index + 1) + '.' + (userAnswer + 1));// convert from 0-based to 1-based counting\r\n      });\r\n\r\n      return responses.join('#');\r\n    }\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    * @return {string}\r\n    */\r\n    getResponseType() {\r\n      return 'matching';\r\n    }\r\n\r\n  }\r\n\r\n  return MatchingPlusModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  const CLICK_ANYWHERE_EVENTS = \"click touch mouseup touchend\";\r\n\r\n  class MatchingPlusDropdownView extends Backbone.View {\r\n\r\n    events() {\r\n      return {\r\n        \"click .js-matchingplus-dropdown-trigger\" : \"onTriggerClick\",\r\n        \"click .js-matchingplus-dropdown-option\" : \"onOptionClick\"\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.model, \"change:_isActive\", this.onActiveChange); // The item is \"active\" while its dropdown is opened.\r\n      this.listenTo(this.model, \"change:_optionsSelected\", this.onOptionsSelectedChange);\r\n      this.listenTo(this.model, \"change:_isDisabled\", this.onDisabledChange);\r\n    }\r\n\r\n    toggleDropdown(isActive) {\r\n\r\n      if (isActive === undefined) isActive = !this.model.get(\"_isActive\");\r\n      this.model.set(\"_isActive\", isActive); // Fallback.\r\n\r\n      let $item = this.$el.closest(\".js-matchingplus-item\");\r\n\r\n      // While the dropdown is active, add a class to the root item too (used by custom theme styles).\r\n      $item.toggleClass(\"is-active\", isActive);\r\n      this.$el.toggleClass(\"is-active\", isActive);\r\n\r\n      if (isActive) {\r\n        // Listen for a click anywhere except the dropdown to close it.\r\n        this.onClickAnywhereEvent = this.onClickAnywhere.bind(this);\r\n        $(document).on(CLICK_ANYWHERE_EVENTS, this.onClickAnywhereEvent);\r\n      }\r\n      else {\r\n        // Remove the global event this made.\r\n        $(document).off(CLICK_ANYWHERE_EVENTS, this.onClickAnywhereEvent);\r\n      }\r\n    }\r\n\r\n    onDisabledChange(model, isDisabled) {\r\n      this.$el.toggleClass(\"is-disabled\", isDisabled);\r\n    }\r\n\r\n    onActiveChange(model, isActive) {\r\n      this.toggleDropdown(isActive);\r\n    }\r\n\r\n    onTriggerClick(event) {\r\n\r\n      // Don't allow interaction after the model is disabled.\r\n      if (this.model.get(\"_isDisabled\")) return;\r\n\r\n      this.model.set(\"_isActive\", !this.model.get(\"_isActive\"));\r\n    }\r\n\r\n    onOptionClick(event) {\r\n\r\n      // Don't allow interaction after the model is disabled.\r\n      if (this.model.get(\"_isDisabled\")) return;\r\n\r\n      let $option = $(event.currentTarget);\r\n\r\n      let val = $option.data(\"value\"); // This is the dropdown's version of the <select value=\"X\"> attribute.\r\n    \r\n      // TODO:? Support more than one option being selectable? Probably not necessary.\r\n      // Array used regardless in case this functionality is needed at a later date. \r\n      this.model.set(\"_optionsSelected\", [parseInt(val, 10)]);\r\n\r\n      // Close the dropdown after the user makes a selection.\r\n      this.model.set(\"_isActive\", false); \r\n    }\r\n\r\n    /**\r\n     * Mark the selected options as visited and correct/incorrect based on the itemModel values. \r\n     */\r\n    updateMarking() {\r\n\r\n      let optionsSelected = this.model.get(\"_optionsSelected\");\r\n      let anyIncorrect = false;\r\n\r\n      _.each(optionsSelected, (optionIdx) => {\r\n\r\n        let $option = this.$(\".js-matchingplus-dropdown-option\").filter(\"[data-value='\" + optionIdx + \"']\");\r\n        let option = this.model.get(\"_options\").find((o) => {return o._index == optionIdx});\r\n\r\n        $option\r\n          .addClass(\"is-visited\")\r\n          .toggleClass(\"is-correct\", option._isCorrect)\r\n          .toggleClass(\"is-incorrect\", option._isIncorrect);\r\n\r\n        if (option._isIncorrect) anyIncorrect = true;\r\n      });\r\n\r\n      // Add a class to any eliminated options (\"_hasSharedUniqueOptions\" mode).\r\n      _.each(this.model.get(\"_options\"), (option) => {\r\n        if (!option._isEliminated) return;\r\n\r\n        let $option = this.$(\".js-matchingplus-dropdown-option\").filter(\"[data-value='\" + option._index + \"']\");\r\n        $option\r\n          .addClass(\"is-eliminated\");\r\n      });\r\n\r\n\r\n      // Add a validation state to the $trigger too.\r\n      /*let $trigger = this.$(\".js-matchingplus-dropdown-trigger\");\r\n      $trigger\r\n        .toggleClass(\"is-incorrect\", anyIncorrect)\r\n        .toggleClass(\"is-correct\", !anyIncorrect);*/\r\n      this.$el\r\n        .toggleClass(\"is-incorrect\", anyIncorrect)\r\n        .toggleClass(\"is-correct\", !anyIncorrect);\r\n\r\n      this.$el.toggleClass(\"is-disabled\", !anyIncorrect);\r\n    }\r\n\r\n    onOptionsSelectedChange(model, optionsSelected) {\r\n\r\n      let $options = this.$(\".js-matchingplus-dropdown-option\");\r\n      $options.removeClass(\"is-selected\");\r\n      \r\n      let triggerText = [];\r\n      let triggerIncorrect = false;\r\n\r\n      // Highlight the selected option using a CSS class.\r\n      _.each(optionsSelected, (optionIdx) => {\r\n        let $option = this.$(\".js-matchingplus-dropdown-option\").filter(\"[data-value='\" + optionIdx + \"']\");\r\n        $option\r\n          .addClass(\"is-selected\");\r\n\r\n        // Get the option that was selected and change the trigger element's text to match it.\r\n        let option = this.model.get(\"_options\").find((o) => {return o._index == optionIdx});\r\n        triggerText.push(option.text);\r\n\r\n        // If the user selects the same incorrect option a second (or more) time, mark the trigger element as incorrect too.\r\n        if (option._isIncorrect || option._isEliminated) {\r\n          triggerIncorrect = true;\r\n        }\r\n      });\r\n\r\n      // Update the trigger text.\r\n      let $trigger = this.$(\".js-matchingplus-dropdown-trigger\");\r\n      $trigger\r\n        .addClass(\"is-visited\");\r\n\r\n      let $triggerText = this.$(\".js-matchingplus-dropdown-trigger-text\");\r\n        $triggerText.html(triggerText.join(', '));\r\n\r\n      this.$el\r\n        .toggleClass(\"is-incorrect\", triggerIncorrect);\r\n        //.toggleClass(\"is-correct\", !triggerIncorrect);\r\n\r\n      // Close the dropdown after the user makes a selection.\r\n      this.model.set(\"_isActive\", false); \r\n    }\r\n\r\n    onClickAnywhere(event) {\r\n      if (event.target == this.el || $.contains(this.el, event.target)) return; // Clicks on or inside this view won't close it.\r\n      this.model.set(\"_isActive\", false);\r\n    }\r\n\r\n  }\r\n\r\n  return MatchingPlusDropdownView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView',\r\n  './matchingPlusDropdownView'\r\n], function(Adapt, QuestionView, MatchingPlusDropdownView) {\r\n\r\n  // https://www.24a11y.com/2019/select-your-poison/\r\n  // https://css-tricks.com/striking-a-balance-between-native-and-custom-select-elements/\r\n\r\n  const MIN_OPTION_LENGTH = 12;\r\n\r\n  class MatchingPlusView extends QuestionView {\r\n\r\n    events() {\r\n      return {\r\n        \"change .js-matchingplus-select\" : \"onSelectChange\"\r\n      }\r\n    }\r\n\r\n    postRender() {\r\n      super.postRender();\r\n      this.$el.closest(\".block\").addClass(\"has-matchingplus\");\r\n\r\n      // Have a seperate view control each dropdown element.\r\n      this.dropdownViews = [];\r\n      this.model.getChildren().each((itemModel) => {\r\n        this.dropdownViews.push(new MatchingPlusDropdownView({\r\n          model: itemModel,\r\n          el: this.getItemEl(itemModel).find(\".js-matchingplus-dropdown\")[0]\r\n        }));\r\n      });\r\n\r\n      this.setUpEventListeners();\r\n\r\n      // Set a consistent width for all the 'select' elements.\r\n      let optionLength = 0;\r\n      _.each(this.model.get(\"_options\"), (option) => {\r\n        optionLength = Math.max(option.length, optionLength);\r\n      });\r\n      optionLength = Math.max(Math.round(optionLength * 0.7), MIN_OPTION_LENGTH);\r\n      this.$(\".matchingplus__item-select\").css(\"width\", optionLength + \"em\");\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      this.listenTo(this.model.getChildren(), {\r\n        \"change:_optionsSelected\": this.onItemOptionsSelectedChange,\r\n        \"change:_isDisabled\": this.onItemDisabledChange\r\n      });\r\n    }\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    }\r\n\r\n    getItemByIndex(index) {\r\n      return this.model.getChildren().find((item) => {\r\n        return item.get(\"_index\") === index;\r\n      });\r\n    }\r\n\r\n    getItemEl(itemModel) {\r\n      return this.$(\".js-matchingplus-item\").filter(\"[data-adapt-index=\" + itemModel.get(\"_index\") + \"]\");\r\n    }\r\n\r\n    update() {\r\n      this.updateMarking();\r\n    }\r\n\r\n    showMarking() {\r\n      this.updateMarking();\r\n    }\r\n\r\n    /**\r\n     * Mark the visited options in the dropdown as incorrect/correct.\r\n     */\r\n    updateMarking() {\r\n\r\n      _.each(this.dropdownViews, (dropdownView) => {\r\n        dropdownView.updateMarking();\r\n      });\r\n\r\n      this.model.getChildren().each(itemModel => {\r\n        this.updateItemState(itemModel);\r\n      });\r\n    }\r\n\r\n    updateItemState(itemModel) {\r\n      let $item = this.getItemEl(itemModel);\r\n      let options = itemModel.get(\"_options\");\r\n      let optionsSelected = itemModel.get(\"_optionsSelected\");\r\n\r\n      let anyIncorrect = false;\r\n      let anyCorrect = false;\r\n\r\n      _.each(optionsSelected, (optionIdx) => {\r\n        let option = _.find(options, (o) => {return o._index == optionIdx;});\r\n        if (option._isIncorrect) anyIncorrect = true;\r\n        if (option._isCorrect) anyCorrect = true;\r\n\r\n        if (option._isVisited) {\r\n          let $option = $item.find(\".js-matchingplus-option[data-value='\" + optionIdx + \"']\");\r\n          $option\r\n            .toggleClass(\"is-visited\", option._isVisited)\r\n            .toggleClass(\"is-correct\", option._isCorrect)\r\n            .toggleClass(\"is-incorrect\", option._isIncorrect);\r\n        }\r\n      });\r\n\r\n      // Mark eliminated options\r\n      _.each(options, (option) => {\r\n\r\n        if (!option._isEliminated) return;\r\n\r\n        let $option = $item.find(\".js-matchingplus-option[data-value='\" + option._index + \"']\");\r\n        $option.toggleClass(\"is-eliminated\", option._isEliminated);\r\n      });\r\n\r\n      $item\r\n        .toggleClass(\"is-incorrect\", anyIncorrect)\r\n        .toggleClass(\"is-correct\", !anyIncorrect && anyCorrect);\r\n    }\r\n\r\n    setupQuestion() {\r\n\t\t\tthis.model.setupRandomisation();\r\n\t\t}\r\n\r\n    resetQuestion() {\r\n\r\n\t\t\t// Not implemented (DD doesn't use this at this time).\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n    //#region Synchronise the states of the <select>s, the dropdowns, and the itemModels.\r\n\r\n    /**\r\n     * Whenever an itemModel's _optionsSelected values change, set the value for the <select> element, and update the item highlighting.\r\n     */\r\n    onItemOptionsSelectedChange(itemModel, optionsSelected) {\r\n      \r\n      // FIXME: Won't work if there's more than one element in optionsSelected.\r\n      if (!optionsSelected.length) return;\r\n      if (optionsSelected.length > 1) throw \"matchingPlusView: multiple _optionsSelected values not supported at this time.\";\r\n      \r\n      let optionIdx = optionsSelected[0];\r\n\r\n      let $select = this.getItemEl(itemModel).find(\".js-matchingplus-select\");\r\n      $select.addClass(\"is-visited\");\r\n      $select[0].value = optionIdx;\r\n\r\n      this.updateItemState(itemModel);\r\n    }\r\n\r\n    /**\r\n     * When the item model is disabled, ensure that there can be no more inputs to the <select> element.\r\n     * @param {*} itemModel \r\n     * @param {*} isDisabled \r\n     */\r\n    onItemDisabledChange(itemModel, isDisabled) {\r\n      let $select = this.getItemEl(itemModel).find(\".js-matchingplus-select\");\r\n      $select.toggleClass(\"is-disabled\", isDisabled);\r\n\r\n      if (isDisabled)\r\n        $select.attr(\"disabled\", \"\");\r\n      else\r\n        $select.removeAttr(\"disabled\");\r\n    }\r\n\r\n    /**\r\n     * Whenever the value in the <select> elements changes update item values.\r\n     */\r\n    onSelectChange(event) {\r\n      let itemIdx = $(event.currentTarget).data(\"adapt-index\");\r\n      let itemModel = this.getItemByIndex(itemIdx);\r\n\r\n      let val = $(event.currentTarget).val();\r\n      \r\n      // Niche bugfix:\r\n      // On some devices, the user can select the placeholder option. Ignore those cases, and auto-set the select to the last valid value.\r\n      if (!val && val !== 0) {\r\n        let lastVal = itemModel.get(\"_optionsSelected\");\r\n        if (lastVal) {\r\n          $(event.currentTarget).val(lastVal);\r\n        }\r\n        return; \r\n      }\r\n\r\n      itemModel.set(\"_optionsSelected\", [parseInt($(event.currentTarget).val(),10)]);\r\n    }\r\n\r\n    //#endregion\r\n  }\r\n\r\n  MatchingPlusView.template = \"matchingPlus\";\r\n  return MatchingPlusView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './matchingPlusModel',\r\n  './matchingPlusView'\r\n], function(Adapt, MatchingPlusModel, MatchingPlusView) {\r\n\r\n  return Adapt.register('matchingplus', {\r\n    view: MatchingPlusView,\r\n    model: MatchingPlusModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'components/adapt-contrib-mcq/js/adapt-contrib-mcq'\r\n], function(Adapt, MCQ) {\r\n\r\n  /**\r\n   * Extends the Finder.view.\r\n   */\r\n\r\n  class MCQCodeView extends MCQ.view {\r\n    \r\n    events() {\r\n      return {\r\n        'focus .js-item-input': 'onItemFocus',\r\n        'blur .js-item-input': 'onItemBlur',\r\n        'change .js-item-input': 'onItemSelect',\r\n        'keyup .js-item-input': 'onKeyPress'\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      super.initialize();\r\n\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    render() {\r\n      super.render();\r\n\r\n      // Hide the .mcqcode__codebox-correct elements until the correct answer is shown.\r\n      //this.$(\".mcqcode__codebox-correct\").hide();\r\n\r\n      //console.log(this.$(\".mcqcode__codebox-correct\"));\r\n    }\r\n\r\n    setUpEventListeners() {\r\n      if (super.setUpEventListeners){\r\n        super.setUpEventListeners();\r\n      }\r\n\r\n      this.listenTo(this.model.getChildren(), \"change:_isCorrect\", this.onItemCorrectChange);\r\n    }\r\n\r\n    // FIXME: Very hardcoded.\r\n    onItemCorrectChange(itemModel, isCorrect) {\r\n      if (!isCorrect) return;\r\n\r\n      let $item = this.getItemElement(itemModel);\r\n\r\n      // Wait for the feedback to be closed.\r\n      this.listenToOnce(Adapt, \"notify:closed\", () => {\r\n\r\n        _.debounce(() => {\r\n          // Render the inline feedback after the item.\r\n          var data = itemModel.toJSON();\r\n          data.view = this;\r\n          var template = Handlebars.templates['mcqCodeFeedback'];\r\n\r\n          let feedbackHTML = Handlebars.compile(template(data));\r\n\r\n          // Mark that codebox as incorrect.\r\n          $item.find(\".js-item-codebox\").addClass(\"mcqcode__codebox-incorrect\");\r\n\r\n          // Append the annotation\r\n          // (very important to pass the data object so that Handlebars.getComponentModelFromContext can get the context from it).\r\n          let annotationHTML = Handlebars.compile('{{#annotation tooltip=\"' + data._feedback.body + '\" hasIcon=\"true\"}}{{/annotation}}')(data);\r\n\r\n          $item.find(\".js-item-content-inner\")\r\n            .append(annotationHTML);\r\n\r\n          // Append the correct answer.\r\n          $item.find(\".js-item-content-feedback\")\r\n            .html(feedbackHTML)\r\n            .hide(0)\r\n            .slideDown();\r\n        }, 500)();\r\n      });\r\n    }\r\n\r\n    getItemElement(model) {\r\n      var index = model.get('_index');\r\n      return this.$('.js-mcqcode-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n    }\r\n\r\n    onItemsActiveChange(model, _isActive) {\r\n\r\n      this.getItemElement(model).toggleClass('is-active', _isActive).find(\".js-item-label\").toggleClass(\"is-selected\", _isActive);\r\n      this.updateContainer();\r\n    }\r\n  }\r\n\r\n  MCQCodeView.template = \"mcqCode\";\r\n  return MCQCodeView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/itemsQuestionModel'\r\n], function(Adapt, ItemsQuestionModel) {\r\n\r\n  /**\r\n   * FIXME: Not compatible with screen readers + colour blindness at the moment.\r\n   * FIXME: Somewhat rushed.\r\n   */\r\n\r\n  class MCQCodeModel extends ItemsQuestionModel{\r\n\r\n    initialize() {\r\n      this.preSetUpItems();\r\n      super.initialize();\r\n    }\r\n\r\n    /**\r\n     * Get each line of code from the \"_code\" property and assign it to \"_items\".\r\n     */\r\n    preSetUpItems() {\r\n      let code = this.get(\"_code\");\r\n\r\n      let lines = Adapt.codeBox.getLines(code);\r\n      let items = this.get(\"_items\");\r\n\r\n      let _items = new Array(lines.length);\r\n\r\n      _.each(lines, (line, i) => {\r\n        \r\n        // If an item has been defined for this line, find it.\r\n        let item = _.find(items, (item) => {return item._lineNum == i+1;});\r\n        if (!item) item = {_shouldBeSelected: false};\r\n        else       item._shouldBeSelected = true;\r\n\r\n        item.text = line; // Assign the text from that line in _code.\r\n        _items[i] = item;\r\n      });\r\n\r\n      this.set(\"_items\", _items);\r\n    }\r\n\r\n    /**\r\n     * This component has unique correct/partial/incorrect conditions. \r\n     */\r\n    isCorrect() {\r\n\r\n      const props = {\r\n        _numberOfIncorrectAnswers: 0, // Number of items selected that shouldn't have been.\r\n        _numberOfCorrectAnswers: 0,   // Number of items selected that should have been.\r\n        _numberOfRequiredAnswers: 0,  // Number of items which need to have been selected.\r\n        _isAtLeastOneIncorrectSelection: false // _numberOfIncorrectAnswers != 0\r\n      };\r\n\r\n      this.getChildren().each(itemModel => {\r\n        \r\n        let shouldBeSelected = Boolean(itemModel.get('_shouldBeSelected'));\r\n        let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n        \r\n        if (isActive) {\r\n          itemModel.set('_isCorrect', shouldBeSelected == isActive);\r\n        }\r\n\r\n        if (shouldBeSelected) {\r\n          props._numberOfRequiredAnswers++;\r\n        }\r\n\r\n        if (!isActive) return; // Only mark selected anwswers.\r\n\r\n        // This item was selected and it shouldn't have been.\r\n        if (!shouldBeSelected) {\r\n          props._numberOfIncorrectAnswers++;\r\n          props._isAtLeastOneIncorrectSelection = true;\r\n          return;\r\n        }\r\n\r\n        // This item was selected and it should have been.\r\n        props._numberOfCorrectAnswers++;\r\n      });\r\n\r\n      this.set(props);\r\n\r\n      const hasRightNumberOfCorrectAnswers = (props._numberOfCorrectAnswers === props._numberOfRequiredAnswers);\r\n      const hasNoIncorrectAnswers = !props._isAtLeastOneIncorrectSelection;\r\n\r\n      return hasRightNumberOfCorrectAnswers && hasNoIncorrectAnswers;\r\n    }\r\n    \r\n    isPartlyCorrect() {\r\n      return !this.get('_isAtLeastOneIncorrectSelection');\r\n    }\r\n\r\n    /*setupFeedback() {\r\n      \r\n      if (!this.has('_feedback')) return;\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.setupCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      if (this.isPartlyCorrect()) {\r\n        this.setupPartlyCorrectFeedback();\r\n        return;\r\n      }\r\n\r\n      this.setupIncorrectFeedback();\r\n    }*/\r\n  }\r\n\r\n\r\n  return MCQCodeModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './mcqCodeView',\r\n  './mcqCodeModel'\r\n], function(Adapt, MCQCodeView, MCQCodeModel) {\r\n\r\n  return Adapt.register(\"mcqcode\", {\r\n    view: MCQCodeView,\r\n    model: MCQCodeModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'components/adapt-contrib-media/js/adapt-contrib-media'\r\n], function(Adapt, Media) {\r\n\r\n  /**\r\n   * This extension was made to keep core Adapt's default media player while adding new features.\r\n   * \r\n   * WARNING: Extends adapt-contrib-media.\r\n   * Any changes to the original will affect this.\r\n   */\r\n\r\n  function _stringToSeconds(str) {\r\n    let a = str.split(\":\");\r\n    let l = a.length;\r\n\r\n    if (l == 0 || a > 3) throw \"adapt-mediaPlus: Invalid time string value: \" + str;\r\n\r\n    let seconds = parseInt(a[l-1], 10);\r\n    if (l > 1) seconds += parseInt(a[l-2], 10) * 60;\r\n    if (l > 2) seconds += parseInt(a[l-3], 10) * 60 * 60;\r\n\r\n    return seconds;\r\n  }\r\n\r\n  class MediaPlusModel extends Media.model {  \r\n\r\n    initialize(...args) {\r\n      this.setUpModelData();\r\n      super.initialize(...args);\r\n    }\r\n\r\n    setUpModelData() {\r\n      this.setUpDefaultData();\r\n\r\n      // Determine the seconds value of each _chapters._items[*].time\r\n      // Note: will not check if the time is outside of the bounds of the video.\r\n      let chapters = this.get(\"_chapters\");\r\n      if (chapters?._isEnabled) {\r\n        _.each(chapters._items, (_items) => {\r\n          _items._time = _stringToSeconds(_items.time);\r\n        });\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Set specific values automatically (hardcoded to DD specifications).\r\n     */\r\n    setUpDefaultData() {\r\n      let defaults = {};\r\n\r\n      // Extend root properties.\r\n      defaults = {\r\n        _allowFullScreen: \t  true,\r\n        _setCompletionOn: \t  \"play\",\r\n        _showVolumeControl:   true,\r\n        _pauseWhenOffScreen:  false, // Changed.\r\n      };\r\n\r\n      // Extend transcript properties.\r\n      defaults._transcript = _.extend({\r\n        _inlineTranscript: \t\t\t      true,\r\n        _externalTranscript: \t\t      false,\r\n        inlineTranscriptButton:       \"Transcript\",\r\n        inlineTranscriptCloseButton:  \"Close Transcript\",\r\n        transcriptLinkButton: \t\t    \"Transcript\",\r\n        transcriptLink: \t\t\t\t      \"\"\r\n      }, this.get(\"_transcript\"));\r\n\r\n      // Extend player options.\r\n      defaults._playerOptions = _.extend({\r\n        alwaysShowControls:               true,\r\n        toggleCaptionsButtonWhenOnlyOne:  true,\r\n        iPadUseNativeControls:            true,\r\n        iPhoneUseNativeControls:          true,\r\n        AndroidUseNativeControls:         true,\r\n        enableProgressTooltip:            false // Not implemented in the version of MediaElement being used.\r\n      }, this.get(\"_playerOptions\"));\r\n\r\n      this.set(defaults);\r\n    }\r\n  };\r\n\r\n  class MediaPlusView extends Media.view {\r\n\r\n    events() {\r\n      return _.extend({}, super.events, {\r\n        \"click .js-mediaplus-chapter-item-time\" : \"onChapterItemClick\"\r\n      });\r\n    }\r\n\r\n    initialize(...args) {\r\n      super.initialize(...args);\r\n    }\r\n\r\n    onPlayerReady(...args) {\r\n      super.onPlayerReady(...args);\r\n\r\n      // Hide the time float tooltip\r\n      // (MediaElement has a bug where it appears with 0:00 on the left side if the user mouses over before video metadata has been loaded).\r\n      this.$(\".mejs-time-float\").addClass(\"u-display-none\");\r\n      this.renderChaptersTimeFloat();\r\n      this.renderChaptersMenu();\r\n      // Un-hide the time float element once the video's duration is known.\r\n      this.mediaElement.addEventListener('loadedmetadata', () => {\r\n        this.$(\".mejs-time-float\").removeClass(\"u-display-none\");\r\n        this.renderChaptersDividers();\r\n      });\r\n    }\r\n\r\n    setupEventListeners(...args){\r\n      super.setupEventListeners(...args);\r\n\r\n      // If no player (adapt-contrib-media doesn't initialize the player on mobile devices), then don't track the time float element.\r\n      if (!this.mediaElement.player) return;\r\n      \r\n      // If no chapters, then no need to monitor the time float element.\r\n      if (!this.model.get(\"_chapters\")?._isEnabled) return;\r\n\r\n      this.listenTo(this.model, \"change:_timeFloatTime\", this.onTimeFloatTimeChange);\r\n      this.setUpTimeFloat();\r\n    }\r\n\r\n    onTimeFloatTimeChange(model, time) {\r\n      \r\n      // Determine the chapter title.\r\n      let title = \"\";\r\n      _.find(this.model.get(\"_chapters\")._items, (item) => {\r\n        if (item._time <= time) {\r\n          title = item.title;\r\n        }\r\n        else return true;\r\n      });\r\n\r\n      this.$(\".mejs-time-float-title\").text(title);\r\n    }\r\n\r\n    // Fallback: In case a new update changes the capitalization of the base function.\r\n    setUpEventListeners(...args) {\r\n      throw \"adapt-mediaPlus: Recent Adapt update has changed \\\"setupEventListeners\\\" to \\\"setUpEventListeners\\\". Please update the script to use the right capitalization.\";\r\n    }\r\n\r\n    /**\r\n     * Show the title of the current chapter in the time float element that appears when the user scrubs the video.\r\n     */\r\n    setUpTimeFloat() {\r\n\r\n      let $timeFloat = this.$(\".mejs-time-float\");\r\n      let $timeFloatCur = $timeFloat.find(\".mejs-time-float-current\");\r\n\r\n      let observer = new MutationObserver((event) => {\r\n        this.model.set(\"_timeFloatTime\", _stringToSeconds($timeFloatCur.text()));\r\n      });\r\n\r\n      // Whenever the time in the floating tooltip changes, update the chapter title.\r\n      observer.observe($timeFloatCur[0], {\r\n        childList: true\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Renders some lines over the timeline to make it appear like it was split into multiple segments.\r\n     */\r\n    renderChaptersDividers() {\r\n\r\n      let chapters = this.model.get(\"_chapters\");\r\n      if (!chapters) return;\r\n\r\n      let $rail = this.$(\".mejs-time-rail\");\r\n      let duration = this.mediaElement.duration;\r\n\r\n      _.each(chapters._items, (item, i) => {\r\n        if (i == 0) return;\r\n\r\n        let $divider = $(\"<div>\", {class: \"mejs-time-rail-divider\"});\r\n\r\n        $divider.css(\"left\", ((item._time / duration) * 100) + \"%\");\r\n        $rail.append($divider);\r\n      });\r\n    }\r\n\r\n    renderChaptersTimeFloat() {\r\n      this.$(\".mejs-time-float\").prepend($(\"<span>\", {class: \"mejs-time-float-title\"}));\r\n    }\r\n\r\n    renderChaptersMenu() {\r\n      if (!this.model.get(\"_chapters\")?._isEnabled) return;\r\n\r\n      var data = this.model.toJSON();\r\n      var template = Handlebars.templates['mediaPlusChapters'];\r\n      this.$(\".component__widget\").append(template(data));\r\n    }\r\n\r\n    onChapterItemClick(event) {\r\n      let time = $(event.target).data(\"time\");\r\n\r\n      this.mediaElement.play();\r\n      this.mediaElement.setCurrentTime(time);\r\n    }\r\n  };\r\n\r\n  return Adapt.register('mediaplus', {\r\n    model: MediaPlusModel,\r\n    view: MediaPlusView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  /**\r\n   * Notes:\r\n   * - Each item has 2+ buttons.\r\n   * - Items become activated as long as one or more of their buttons is clicked.\r\n   * - Each item stores an array of buttons that have been clicked in it.\r\n   * - Each item will need one or more of its buttons selected to be correct.\r\n   *   SCORM (or Adapt?) doesn't have a way to store multiple multiple \"choice\" interactions that in one go,\r\n   *   so I've set this up to use \"fill-in\" as the submission type for now.\r\n   */\r\n\r\n  var MmcqView = QuestionView.extend({\r\n\r\n    events: {\r\n      'focus .js-item-input'  : 'onItemFocus',\r\n      'blur .js-item-input'   : 'onItemBlur',\r\n      'change .js-item-input' : 'onItemSelect',\r\n      'keyup .js-item-input'  : 'onKeyPress'\r\n    },\r\n\r\n    isCorrectAnswerShown: false,\r\n\r\n    initialize: function() {\r\n      QuestionView.prototype.initialize.apply(this, arguments);\r\n      this.update = _.debounce(this.update.bind(this), 1);\r\n      \r\n      this.listenTo(this.model, {\r\n        \"change:_isEnabled change:_isComplete change:_isSubmitted\": this.update\r\n      });\r\n\r\n      // FIXME: Custom trigger comes from mmcqModel.\r\n      this.listenTo(this.model, {\r\n        \"_change:_optionsSelected\": this.update\r\n      });\r\n\r\n      this.listenTo(Adapt, \"device:changed\", this.onDeviceChange);\r\n    },\r\n\r\n    resetQuestionOnRevisit: function() {\r\n      this.resetQuestion();\r\n    },\r\n\r\n    setupQuestion: function() {\r\n\r\n      this.model.setupRandomisation();\r\n    },\r\n\r\n    postRender: function() {\r\n      QuestionView.prototype.postRender.apply(this, arguments);\r\n      this.onDeviceChange();\r\n      this.updateMarking(); // Custom: initial call to set up aria labels for the inputs.\r\n                            // FIXME: Applying the initial aria could be done better...\r\n    },\r\n\r\n    onDeviceChange: function() {\r\n      this.resizeHeaderLabels();\r\n    },\r\n\r\n    /**\r\n     * Have all the .mmcq__items-header-label elements have the same widths.\r\n     * (Only if \"_combineOptions\": true).\r\n     */\r\n    resizeHeaderLabels: function() {\r\n\r\n      if (!this.model.get(\"_combineOptions\")) return;\r\n\r\n      let $labelsInner = this.$(\".mmcq__items-header-label-inner\");\r\n      let minWidth = this.$(\".mmcq__item-icon\").first().outerWidth() + 1; // Don't let the width go below the width of the clickable icons.\r\n      let maxWidth = 0;\r\n\r\n      $labelsInner.each((i, e) => {\r\n        maxWidth = Math.max($(e).width(), maxWidth);\r\n      });\r\n      if (maxWidth < minWidth) maxWidth = minWidth;\r\n      this.$(\".mmcq__items-header-label\").width(maxWidth);\r\n    },\r\n\r\n    onQuestionRendered: function() {\r\n      this.setReadyStatus();\r\n      this.update();\r\n    },\r\n\r\n    onKeyPress: function(event) {\r\n      if (event.which !== 13) return;\r\n      //<ENTER> keypress\r\n      this.onItemSelect(event);\r\n    },\r\n\r\n    onItemFocus: function(event) {\r\n      if (!this.model.isInteractive()) return;\r\n\r\n      $('.js-item-label[for='+$(event.currentTarget).attr('id')+']').addClass('is-highlighted');\r\n    },\r\n\r\n    onItemBlur: function(event) {\r\n      $('.js-item-label[for='+$(event.currentTarget).attr('id')+']').removeClass('is-highlighted');\r\n    },\r\n\r\n    onItemSelect: function(event) {\r\n      if (!this.model.isInteractive()) return;\r\n\r\n      var index = $(event.currentTarget).data('adapt-index');             // Adapt item index\r\n      var inputIndex = $(event.currentTarget).data('adapt-option-index');\r\n      \r\n      this.model.toggleOptionsSelected(index, inputIndex);\r\n\r\n      return;\r\n    },\r\n\r\n    // Blank method to add functionality for when the user cannot submit\r\n    // Could be used for a popup or explanation dialog/hint\r\n    onCannotSubmit: function() {},\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking: function() {\r\n      this.update();\r\n      this.updateMarking();\r\n    },\r\n\r\n    resetQuestion: function() {\r\n\r\n      return;\r\n      this.$('.matching__item').removeClass('is-correct is-incorrect');\r\n      this.model.set('_isAtLeastOneCorrectSelection', false);\r\n      var resetAll = this.model.get('_shouldResetAllAnswers');\r\n\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        if (item._isCorrect && resetAll === false) return;\r\n        this.selectValue(index, null);\r\n        item._options.forEach(function(option, index) {\r\n          option._isSelected = false;\r\n        });\r\n        item._selected = null;\r\n      }, this);\r\n    },\r\n    \r\n    showCorrectAnswer: function() {\r\n      this.isCorrectAnswerShown = true;\r\n      this.update();\r\n    },\r\n\r\n    hideCorrectAnswer: function() {\r\n      this.isCorrectAnswerShown = false;\r\n      this.update();\r\n    },\r\n\r\n    update: function(model) {\r\n      this.updateSelection();\r\n      // \\/ questionPlus will call this.updateMarking() when necessary. It shouldn't be invoked here while it's in use.\r\n      //this.updateMarking();\r\n    },\r\n\r\n    updateSelection: function() {\r\n\r\n      //var isEnabled = this.model.get(\"_isEnabled\");\r\n\r\n      _.each(this.model.get(\"_items\"), (item) => {\r\n\r\n        let itemIdx = item._index;\r\n        let isEnabled = !Boolean(item._isCorrect); // Disable items only when the item has been completed.\r\n\r\n        _.each(item._optionsSelected, (option, optionIdx) => {\r\n\r\n          var isSelected = this.isCorrectAnswerShown ?\r\n            _.contains(item._optionsCorrect, optionIdx) :\r\n            option\r\n\r\n          let filter = '[data-adapt-index=\"' + itemIdx + '\"][data-adapt-option-index=\"' + optionIdx + '\"]';\r\n          \r\n          this.$('.js-item-label').filter(filter)\r\n            .toggleClass('is-selected', isSelected)\r\n            .toggleClass('is-disabled', !isEnabled)\r\n            // Custom \\/\r\n            .find(\".mmcq__item-answer-icon\")\r\n            .toggleClass('is-disabled', !isEnabled);\r\n\r\n          this.$('.js-item-input').filter(filter)\r\n              .prop('checked', isSelected)\r\n              .prop('disabled', !isEnabled);\r\n        });\r\n      });\r\n    },\r\n\r\n    updateMarking: function() {\r\n\r\n      //var isInteractive = this.model.isInteractive();\r\n      let canShowMarking = this.model.get('_canShowMarking');\r\n      let ariaLabels = Adapt.course.get('_globals')._accessibility._ariaLabels;\r\n\r\n      _.each(this.model.get(\"_items\"), (item) => {\r\n\r\n        let index = item._index;\r\n\r\n        let $item = this.$('.js-mmcq-item').filter('[data-adapt-index=\"' + index + '\"]');\r\n        $item\r\n          .toggleClass('is-correct', item._isCorrect)\r\n          .toggleClass('is-incorrect', !item._isCorrect);\r\n\r\n        if (!canShowMarking) {\r\n          $item\r\n          .removeClass('is-correct')\r\n          .removeClass('is-incorrect');\r\n        }\r\n\r\n        /**\r\n         * questionPlus: only apply marking to selected items.\r\n         */\r\n        _.each(item._optionsSelected, (option, optionIdx) => {\r\n\r\n          let filter = '[data-adapt-index=\"' + index + '\"][data-adapt-option-index=\"' + optionIdx + '\"]';\r\n          let $itemInput = this.$(\".js-item-input\").filter(filter);\r\n          let $itemLabel = this.$(\".js-item-label\").filter(filter);\r\n\r\n          let shouldBeSelected = Boolean(_.contains(item._optionsCorrect, optionIdx));\r\n          let isCorrect = option == shouldBeSelected;\r\n          let isSelected = option;\r\n\r\n          // Set aria-labels\r\n          let inputText = (this.model.get(\"_options\") || item._options)[optionIdx];\r\n\r\n          // Pre-checked state (inputs which haven't been submitted while selected yet).\r\n          if (!item._optionsVisited[optionIdx]) {\r\n            $itemInput.attr('aria-label', $.a11y_normalize(inputText));\r\n          }\r\n          // Checked inputs (correct or incorrect).\r\n          // Only apply \"Incorrect\" / \"Correct\" aria labels after they've been submitted while selected.\r\n          else {\r\n            $itemInput.attr('aria-label', [\r\n              (shouldBeSelected ? ariaLabels.correct : ariaLabels.incorrect),\r\n              \", \",\r\n              (isSelected ? ariaLabels.selectedAnswer : ariaLabels.unselectedAnswer),\r\n              \". \",\r\n              $.a11y_normalize(inputText)\r\n            ].join(\"\"));\r\n          }\r\n\r\n          if (!canShowMarking) {\r\n            // Remove input marking\r\n            $itemInput.removeClass('is-correct is-incorrect');\r\n            $itemLabel.removeClass('is-correct is-incorrect');\r\n            return;\r\n          }\r\n\r\n          // Apply styles to ONLY the selected inputs.\r\n          // (DD questionPlus design choice).\r\n          if (!isSelected) return;\r\n\r\n          $itemInput.toggleClass(\"is-correct\", isCorrect)\r\n                    .toggleClass(\"is-incorrect\", !isCorrect);\r\n\r\n          $itemLabel\r\n            .toggleClass(\"is-correct\", isCorrect)\r\n            .toggleClass(\"is-incorrect\", !isCorrect);\r\n        });\r\n\r\n      });\r\n\r\n      this.updateSelection();\r\n    }\r\n\r\n  });\r\n\r\n  return MmcqView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel'\r\n], function(Adapt, QuestionModel) {\r\n\r\n  /**\r\n   * Notes:\r\n   * - Each item has 2+ buttons.\r\n   * - Items become activated as long as one or more of their buttons is clicked.\r\n   * - Each item stores an array of options that have been selected for it.\r\n   * - Each item will need one or more of its buttons selected to be correct.\r\n   *   SCORM (or Adapt?) doesn't have a way to store multiple multiple \"choice\" interactions that in one go,\r\n   *   so I've set this up to use \"fill-in\" as the submission type for now.\r\n   */\r\n\r\n  var MmcqModel = QuestionModel.extend({\r\n\r\n    init: function() {\r\n      QuestionModel.prototype.init.call(this);\r\n\r\n      this.setupQuestionItemIndexes();\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    getHasUniqueOptions: function() {\r\n      return this.get(\"_combineOptions\") === false || this.get(\"_hasInlineButtons\"); // _hasInlineButtons = legacy.\r\n    },\r\n\r\n    // Set up indexes + collections for user answers.\r\n    setupQuestionItemIndexes: function() {\r\n\r\n      // Force inline buttons if display mode is set to \"rows\".\r\n      let hasUniqueOptions = this.getHasUniqueOptions();\r\n      this.set(\"_combineOptions\", !hasUniqueOptions);\r\n\r\n      let _options = this.get(\"_options\");\r\n\r\n      this.get('_items').forEach((item, index) => {\r\n        if (item._index === undefined) {\r\n\r\n          // If !hasUniqueOptions, then give each item the same options from the root of the component.\r\n          let itemOptions = [];\r\n          try {\r\n            // If hasUniqueOptions, first try to use each individual item's _options, then fallback to global _options if need be.\r\n            _.each(hasUniqueOptions ? (item._options || _options) : _options, (optionText, optionIndex) => {\r\n              itemOptions.push({\r\n                text: optionText,\r\n                _index: optionIndex\r\n              });\r\n            });\r\n          }\r\n          catch (err) {\r\n            if (hasUniqueOptions) {\r\n              throw `\"mmcq\" component: if \"_combineOptions\": false, then each \"_items\" element must define its own \"_options\" array.`;\r\n            }\r\n            else {\r\n              throw `\"mmcq\" component: if \"_combineOptions\": true, then the root of the component\\'s JSON must define an \"_options\" array.`;\r\n            }\r\n          }\r\n          let optionsCount = itemOptions.length;\r\n\r\n          item._index = index;\r\n          //item._options = (hasUniqueOptions && this.get(\"_isRandom\")) ? _.shuffle(itemOptions) : itemOptions; // Randomize if inline.\r\n          item._options = itemOptions;\r\n          item._optionsSelected = new Array(optionsCount);\r\n          item._optionsVisited = new Array(optionsCount);\r\n          try {\r\n            item._optionsSelected.fill(false);\r\n            item._optionsVisited.fill(false);\r\n          } catch (err) {}\r\n        }\r\n      });\r\n    },\r\n\r\n    setupRandomisation: function() {\r\n\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n\r\n      // If the component has unique options for each item, then the options should be shuffled instead of the items.\r\n      if (this.getHasUniqueOptions()) {\r\n        this.get('_items').forEach((item, index) => {\r\n          item._options = _.shuffle(item._options);\r\n        });\r\n        return;\r\n      }\r\n\r\n      this.set('_items', _.shuffle(this.get('_items')));\r\n    },\r\n\r\n    canSubmit: function() {\r\n      // Can submit if every item has at least one input selected.\r\n      // (At least one element in item._optionsSelected is == true).\r\n      var canSubmit = _.every(this.get('_items'), function(item) {\r\n        return _.find(item._optionsSelected, (e) => {return Boolean(e);}) !== undefined;\r\n      });\r\n\r\n      return canSubmit;\r\n    },\r\n\r\n    toggleOptionsSelected: function(itemIndex, optionIndex, _isSelected){\r\n\r\n      if (optionIndex === undefined) throw \"\\\"optionIndex\\\" cannot be undefined.\";\r\n      let isRadio = this.get(\"_isRadio\");\r\n\r\n      // Get the original index of the item (before the item order was shuffled).\r\n      let item = _.find(this.get('_items'), (item) => {\r\n        return item._index === itemIndex;\r\n      });\r\n\r\n      if (!isRadio){\r\n        item._optionsSelected[optionIndex] = \r\n          (_isSelected === undefined) ? !Boolean(item._optionsSelected[optionIndex]) : Boolean(_isSelected);\r\n      }\r\n      else {\r\n        item._optionsSelected = _.map(item._optionsSelected, (option, _optionIndex) => {\r\n          if (optionIndex != _optionIndex) return false;\r\n          else return (_isSelected === undefined) ? !Boolean(option) : Boolean(_isSelected);\r\n        });\r\n      }\r\n      \r\n      // Fixme: custom trigger used.\r\n      this.trigger(\"_change:_optionsSelected\");\r\n\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    isCorrect: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n\r\n        /**\r\n         * An item is correct when only the _optionsSelected at indexes in the _optionsCorrect are true.\r\n         * isCorrect will == true only if the _.find returns undefined (it couldn't find an incorrect match).\r\n         */\r\n        var isCorrect = true;\r\n        _.find(item._optionsSelected, (option, optionIdx) => {\r\n          let shouldBeSelected = Boolean(_.contains(item._optionsCorrect, optionIdx));\r\n          if (option != shouldBeSelected) {\r\n            isCorrect = false;\r\n            return true; // Stop searching if there's any option in the wrong state.\r\n          }\r\n        });\r\n\r\n        /**\r\n         * All options which have been selected and checked should be marked as visited.\r\n         */\r\n        _.each(item._optionsSelected, (optionSelected, optionIdx) => {\r\n          if (optionSelected) {\r\n            item._optionsVisited[optionIdx] = true;\r\n          }\r\n        });\r\n        \r\n        if (!isCorrect) {\r\n          item._isCorrect = false;\r\n          return;\r\n        }\r\n\r\n        numberOfCorrectAnswers++;\r\n        item._isCorrect = true;\r\n        this.set({\r\n          '_numberOfCorrectAnswers': numberOfCorrectAnswers,\r\n          '_isAtLeastOneCorrectSelection': true\r\n        });\r\n\r\n      }, this);\r\n\r\n      this.set('_numberOfCorrectAnswers', numberOfCorrectAnswers);\r\n\r\n      if (numberOfCorrectAnswers === this.get('_items').length) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Score currently calculated per-item\r\n     * (meaning that if an item required 2 of its options to be selected, the same score will be given\r\n     * if 0 or 1 of those 2 options was selected upon submission).\r\n     */\r\n    setScore: function() {\r\n      var questionWeight = this.get('_questionWeight');\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.set('_score', questionWeight);\r\n        return;\r\n      }\r\n\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var itemLength = this.get('_items').length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      var userAnswer = this.get('_userAnswer');\r\n      var items = this.get(\"_items\");\r\n\r\n      _.each(userAnswer, (e, itemIdx) => {\r\n        items[itemIdx]._optionsSelected = _.toArray(e)\r\n      });\r\n\r\n      // Fixme: custom trigger used.\r\n      this.trigger(\"_change:_optionsSelected\");\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    storeUserAnswer: function() {\r\n\r\n      var userAnswer = new Array(this.get('_items').length);\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n        userAnswer[item._index] = _.toArray(item._optionsSelected);\r\n      }, this);\r\n\r\n      this.set({\r\n        '_userAnswer': userAnswer\r\n      });\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n\r\n      this.set('_userAnswer', []);\r\n\r\n      _.each(this.get(\"_items\"), (item) => {\r\n        item._isCorrect = false;\r\n        item._optionsSelected.fill(false);\r\n      });\r\n    },\r\n\r\n    /**\r\n    * Used by tracking extensions to return an object containing the component's specific interactions.\r\n    */\r\n    /*getInteractionObject: function() {\r\n      \r\n      // textInputModel didn't implement this function either.\r\n      \r\n      return;\r\n    },*/\r\n\r\n    /**\r\n     * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n     * returns the user's answers as a string in the format 'answer1[,]answer2[,]answer3'\r\n     * the use of [,] as an answer delimiter is from the SCORM 2004 specification for the fill-in interaction type\r\n     * \r\n     * --------------------------------------------------------------\r\n     * \r\n     * Each item could have one or MORE of its buttons selected.\r\n     * SCORM (or Adapt?) doesn't have a way to store multiple multiple \"choice\" interactions that in one go,\r\n     * so I've set this up to use \"fill-in\" as the submission type for now.\r\n     * \r\n     * FIXME: This is most likely going to look a bit messy if the answers are viewed in the LMS UI.\r\n     * FIXME: Has not been tested yet!!!\r\n     */\r\n    getResponse: function() {\r\n\r\n      let resp = [];\r\n      _.each(this.get(\"_items\"), (item) => {\r\n        resp.push(item._optionsSelected.join('.'));\r\n      });\r\n\r\n      return resp.join('[,]');\r\n    },\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    * @return {string}\r\n    */\r\n    getResponseType: function() {\r\n      return \"fill-in\";\r\n    }\r\n  });\r\n\r\n  return MmcqModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './mmcqView',\r\n  './mmcqModel'\r\n], function(Adapt, MmcqView, MmcqModel) {\r\n\r\n  return Adapt.register(\"mmcq\", {\r\n    view: MmcqView,\r\n    // Extend ItemsQuestionModel to distinguish McqModel in\r\n    // the inheritance chain and allow targeted model extensions.\r\n    model: MmcqModel\r\n  });\r\n\r\n});\r\n","define(function() {\r\n\r\n  return new ENUM([\r\n    'SMALL',\r\n    'LARGE'\r\n  ]);\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  './modeEnum'\r\n], function(Adapt, ComponentView, MODE) {\r\n\r\n  class NarrativePlusView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        'click .js-narrativeplus-controls-click': 'onNavigationClicked',\r\n        'click .js-narrativeplus-progress-click': 'onProgressClicked',\r\n        'swiperight .narrativeplus__widget':  \"onSwipeRight\",\r\n        'swipeleft .narrativeplus__widget':  \"onSwipeLeft\"\r\n      }\r\n    }\r\n\r\n    setupEventListeners() {\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion('.component__widget');\r\n      }\r\n\r\n      // Listen for swipe events.\r\n      // TODO: Implement this.\r\n      this.$(\".component__widget\")\r\n      \r\n    }\r\n\r\n    preRender() {\r\n\r\n      //this.moveSliderToIndex = _.debounce(this.moveSliderToIndex.bind(this),0);\r\n\r\n      this._isUninteracted = true; // Set to false only once the user interacts with the buttons.\r\n      this.setUpModelData();\r\n      \r\n      this.listenTo(Adapt, {\r\n        'device:changed device:resize': this.reRender,\r\n        'notify:closed': this.closeNotify\r\n      });\r\n      this.renderMode();\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n\r\n      this.checkIfResetOnRevisit();\r\n      this.calculateWidths();\r\n    }\r\n\r\n    setUpModelData() {\r\n\r\n      if (!Adapt.sizing) return;\r\n\r\n      // adapt-sizing extension compatibility. Allow for individual item sizing.\r\n      let globalSizing = this.model.get(\"_itemSizing\");\r\n      _.each(this.model.get(\"_items\"), item => {\r\n\r\n        let graphic = item._graphic;\r\n        if (!graphic) return; // If no graphic, no need for sizing.\r\n\r\n        // Override the global sizing with the individual item sizing (if any).\r\n        let itemSizing = graphic._sizing || {};\r\n        itemSizing = _.extend(\r\n          {},\r\n          globalSizing,\r\n          itemSizing\r\n        );\r\n\r\n        // Set the item's sizing classes.\r\n        item._graphic._sizing = itemSizing;\r\n        item._graphic._sizing._classes = Adapt.sizing.getSizingClass(item._graphic._sizing);\r\n        item._graphic._sizing._parClasses = Adapt.sizing.getParentClasses(item._graphic._sizing);\r\n      });\r\n    }\r\n\r\n    renderMode() {\r\n      this.calculateMode();\r\n      if (this.isLargeMode()) {\r\n        this.$el.addClass('mode-large').removeClass('mode-small');\r\n      } else {\r\n        this.$el.addClass('mode-small').removeClass('mode-large');\r\n      }\r\n    }\r\n\r\n    calculateMode() {\r\n      var mode = Adapt.device.screenSize === 'large' ?\r\n          MODE.LARGE :\r\n          MODE.LARGE; //MODE.SMALL;\r\n      this.model.set('_mode', mode);\r\n    }\r\n\r\n    isLargeMode() {\r\n      return this.model.get('_mode') === MODE.LARGE;\r\n    }\r\n\r\n    onItemsActiveChange(item, _isActive) {\r\n      if (_isActive === true) {\r\n        this.setStage(item);\r\n      }\r\n    }\r\n\r\n    onItemsVisitedChange(item, isVisited) {\r\n      if (!isVisited) return;\r\n      this.$('[data-index=\"' + item.get('_index') + '\"]').addClass('is-visited');\r\n    }\r\n\r\n    setupNarrative() {\r\n\r\n      this.renderMode();\r\n      var items = this.model.getChildren();\r\n      if (!items || !items.length) return;\r\n\r\n      // Ensure there's always an active item.\r\n      var activeItem = this.model.getActiveItem();\r\n      if (!activeItem) {\r\n        activeItem = this.model.getItem(0);\r\n        activeItem.toggleActive(true);\r\n      } else {\r\n        // Manually trigger change as it is not fired on reentry\r\n        items.trigger('change:_isActive', activeItem, true);\r\n      }\r\n\r\n      this.calculateWidths();\r\n\r\n      /*if (!this.isLargeMode() && !this.model.get('_wasHotgraphic')) {\r\n        this.replaceInstructions();\r\n      }*/\r\n      this.setupEventListeners();\r\n    }\r\n\r\n    setStage(item) {\r\n      var index = item.get('_index');\r\n      if (this.isLargeMode()) {\r\n        // Set the visited attribute for large screen devices\r\n        item.toggleVisited(true);\r\n      }\r\n\r\n      // Set the selected classes for the progress dots\r\n      this.$('.narrativeplus__progress:visible')\r\n        .removeClass('is-selected')\r\n        .filter('[data-index=\"'+index+'\"]')\r\n        .addClass('is-selected');\r\n\r\n      /*var $slideGraphics = this.$('.narrativeplus__slider-image-container');\r\n      $slideGraphics.children('.controls').a11y_cntrl_enabled(false);\r\n      $slideGraphics.filter('[data-index=\"'+index+'\"]').children('.controls').a11y_cntrl_enabled(true);*/\r\n\r\n      // Toggle aria visibility on the items (only the currently active one should be visible).\r\n      let $items = this.$('.narrativeplus__slider-item');\r\n      Adapt.a11y.toggleAccessible($items/*.addClass('u-visibility-hidden u-display-none')*/, false);\r\n      Adapt.a11y.toggleAccessible($items.filter('[data-index=\"'+index+'\"]')/*.removeClass('u-visibility-hidden u-display-none')*/, true);\r\n\r\n      this.evaluateNavigation();\r\n      this.evaluateCompletion();\r\n      this.moveSliderToIndex(index);\r\n    }\r\n\r\n    /**\r\n     * Change the state of the left and right buttons based on the active item index.\r\n     */\r\n    evaluateNavigation() {\r\n      var active = this.model.getActiveItem();\r\n      if (!active) return;\r\n\r\n      var currentStage = active.get('_index');\r\n      var itemCount = this.model.getChildren().length;\r\n\r\n      var isAtStart = currentStage === 0;\r\n      var isAtEnd = currentStage === itemCount - 1;\r\n\r\n      this.$('.narrativeplus__controls-left').toggleClass('u-visibility-hidden', isAtStart);\r\n      this.$('.narrativeplus__controls-right').toggleClass('u-visibility-hidden', isAtEnd);\r\n    }\r\n\r\n    evaluateCompletion() {\r\n      if (this.model.areAllItemsCompleted()) {\r\n        this.trigger('allItems');\r\n      }\r\n    }\r\n\r\n    moveSliderToIndex(itemIndex) {\r\n\r\n      var $slider = this.$('.narrativeplus__slider');\r\n\r\n      // Finish any prior transitions (only really noticeable if the user mashes the < or > buttons.\r\n      // looks a bit jarring, but prevents stickyElement bugs).\r\n      $slider.hide(0).show(0);\r\n\r\n      var offset = this.model.get('_itemWidth') * itemIndex;\r\n      if (Adapt.config.get('_defaultDirection') === 'ltr') {\r\n        offset *= -1;\r\n      }\r\n      var cssValue = 'translateX('+offset+'%)';\r\n\r\n      // Debounce used to improve visual movement of stickyElementItems.\r\n      if (this._debounceTransitionEnd) {\r\n        this._debounceTransitionEnd.cancel(); // End the previous debounce callback if it hasn't triggered yet.\r\n        this.onTransitionEnd();\r\n      }\r\n\r\n      this._debounceTransitionEnd = _.debounce(() => {\r\n        $slider.css('transform', cssValue);\r\n\r\n        if (Adapt.config.get('_disableAnimation') || this._isUninteracted) {\r\n          this.onTransitionEnd();\r\n        } else {\r\n          $slider.one('transitionend', this.onTransitionEnd.bind(this));\r\n        }\r\n\r\n        this._debounceTransitionEnd = null;\r\n      }, 0);\r\n      this._debounceTransitionEnd();\r\n    }\r\n\r\n    onTransitionEnd() {\r\n      if (this._isUninteracted) return;\r\n\r\n      var index = this.model.getActiveItem().get('_index');\r\n      if (this.isLargeMode()) {\r\n\r\n        // THIS IS WHAT WAS CAUSING THE CONTENT TO JUMP TO A \"RANDOM\" LOCATION ONLOAD.\r\n        Adapt.a11y.focusFirst(this.$('.narrativeplus__slider-item[data-index=\"'+index+'\"]'), {defer: true});\r\n      }\r\n    }\r\n\r\n    calculateWidths() {\r\n      var itemCount = this.model.getChildren().length;\r\n      this.model.set({\r\n        '_totalWidth': 100 * itemCount,\r\n        '_itemWidth': 100 / itemCount\r\n      });\r\n    }\r\n\r\n    postRender() {\r\n      \r\n      this.renderMode();\r\n      this.setupNarrative();\r\n      \r\n      this.$('.narrativeplus__slider').imageready(this.setReadyStatus.bind(this));\r\n\r\n      // FIXME: Not implemented.\r\n      if (Adapt.config.get('_disableAnimation')) {\r\n        this.$el.addClass('disable-animation');\r\n      }\r\n    }\r\n\r\n    checkIfResetOnRevisit() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Custom:\r\n     * Whenever the user clicks on a navigation button, ensure that the top of the content is inview.\r\n     */\r\n    scrollIntoView(){\r\n\r\n      _.debounce(() => {\r\n        Adapt.navigateToElement(this.$(\".narrativeplus__widget\"), {\r\n          duration: 400,\r\n          align: \"inview\"\r\n        });\r\n      }, 0)();\r\n    }\r\n\r\n    onNavigationClicked(event) {\r\n\r\n      this._isUninteracted = false;\r\n      \r\n      var stage = this.model.getActiveItem().get('_index');\r\n\r\n      if ($(event.currentTarget).hasClass('narrativeplus__controls-right')) {\r\n        this.model.setActiveItem(++stage);\r\n      } else if ($(event.currentTarget).hasClass('narrativeplus__controls-left')) {\r\n        this.model.setActiveItem(--stage);\r\n      }\r\n\r\n      this.scrollIntoView();\r\n    }\r\n\r\n    onProgressClicked(event) {\r\n\r\n      this._isUninteracted = false;\r\n\r\n      event && event.preventDefault();\r\n      var clickedIndex = $(event.target).data('index');\r\n\r\n      if (clickedIndex == this.model.getActiveItem().get(\"_index\")) return; // Do nothing if this item is already active.\r\n\r\n      this.model.setActiveItem(clickedIndex);\r\n\r\n      this.scrollIntoView();\r\n    }\r\n\r\n    onSwipeRight(event) {\r\n      console.log(\"right\");\r\n    }\r\n\r\n    onSwipeLeft(event) {\r\n      console.log(\"left\");\r\n    }\r\n  }\r\n  \r\n  NarrativePlusView.template = \"narrativePlus\";\r\n  return NarrativePlusView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './narrativePlusView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, NarrativePlusView, ItemsComponentModel) {\r\n\r\n  /**\r\n   * NarrativePlus\r\n   * ---------\r\n   * This component is a heavily modified version of the adapt-contrib-narrative component.\r\n   * The most major change was the removal of the strapline + the component changes to a different component in small mode.\r\n   */\r\n\r\n  return Adapt.register('narrativeplus', {\r\n    model: ItemsComponentModel,\r\n    view: NarrativePlusView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView',\r\n\r\n  // \\/ These libraries are included with the \"adapt-jquery-ui\" extension.\r\n  'libraries/jquery-ui.interactions',\r\n  'libraries/jquery.ui.touch-punch' // MUST BE INCLUDED! Fixes several compatibility issues that jquery-ui has with touch devices.\r\n], function(Adapt, QuestionView) {\r\n\r\n\t/**\r\n\t * FIXME:\r\n\t * - data-adapt-index gives away the correct order the draggables are meant to go in.\r\n\t * \r\n\t * TODO:\r\n\t * - Add keyboard support (maybe, user selects items with arrow keys, then presses Enter to move them down, and Shift+Enter to move them up?).\r\n\t */\r\n\r\n\t// Makes jquery-ui.draggable() work with touch devices.\r\n\t// Depends on jquery-ui, and must be loaded AFTER it.\r\n\t/*require.config({\r\n        shim: {\r\n            \"libraries/jquery-ui.touch-punch\": {\r\n                deps: [\"libraries/jquery-ui.reorder\"] // Standalone jquery-ui library which only includes the functionality this component needs.\r\n            }\r\n        }\r\n    });*/\r\n\r\n\tconst JITTER_THRESHOLD = 1;\r\n\tconst VIEWPORT_SCROLL_THRESHOLD = 0.175; // If the event.pageY is within this ratio of the edges of the viewport, then have the page scroll.\r\n\tconst VIEWPORT_SCROLL_SPEED = 10;\r\n\r\n\tclass ReorderView extends QuestionView {\r\n\r\n\t\tevents() {\r\n\t\t\treturn {\r\n\t\t\t\t\"mousedown .js-reorder-item\" : \"onItemMousedown\",\r\n\t\t\t\t\"touchstart .js-reorder-item\" : \"onItemMousedown\",\r\n\t\t\t\t\"mouseup .js-reorder-item\" : \"onItemMouseup\",\r\n\t\t\t\t\"touchend .js-reorder-item\" : \"onItemMouseup\"\r\n\r\n\t\t\t\t/*'focus .js-item-input'  : 'onItemFocus',\r\n\t\t\t\t'blur .js-item-input'   : 'onItemBlur',\r\n\t\t\t\t'change .js-item-input' : 'onItemSelect',\r\n\t\t\t\t'keyup .js-item-input'  : 'onKeyPress'*/\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//isCorrectAnswerShown: false,\r\n\r\n\t\tinitialize() {\r\n\r\n\t\t\tthis.itemCount = this.model.getChildren().length;\r\n\t\t\tthis.itemElementTopCache = new Array(this.itemCount);\r\n\r\n\t\t\tQuestionView.prototype.initialize.apply(this, arguments);\r\n\t\t\tthis.update = _.debounce(this.update.bind(this), 1);\r\n\t\t\t\r\n\t\t\tthis.listenTo(this.model, {\r\n\t\t\t\t\"change:_isEnabled change:_isComplete change:_isSubmitted\": this.update\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tresetQuestionOnRevisit() {\r\n\t\t\tthis.resetQuestion();\r\n\t\t}\r\n\r\n\t\tsetupQuestion() {\r\n\r\n\t\t\tthis.model.setupRandomisation();\r\n\t\t}\r\n\r\n\t\tpostRender() {\r\n\t\t\tQuestionView.prototype.postRender.apply(this, arguments);\r\n\r\n\t\t\t// Makes jquery-ui.draggable() work with touch devices.\r\n\t\t\t// Must be loaded AFTER jQuery-ui.\r\n\t\t\t// FIXME: When the content is uploaded to VitalSource Bookshelf and viewed online, this can sometimes TIME OUT!\r\n\t\t\t//require(['libraries/jquery-ui.touch-punch.min'], () => {\r\n\r\n\t\t\t\tthis.renderItems();\r\n\t\t\t\tthis.updateMarking(); // Custom: initial call to set up aria labels for the inputs.\r\n\t\t\t\t\t\t\t\t\t// FIXME: Applying the initial aria could be done better...\r\n\r\n\t\t\t\tthis.setUpEventListeners();\r\n\r\n\t\t\t\tthis.setReadyStatus();\r\n\t\t\t//});\r\n\t\t}\r\n\r\n\t\tsetUpEventListeners() {\r\n\t\t\tthis.listenTo(this.model.getChildren(), {\r\n\t\t\t\t\"change:_isGrabbed\": this.onItemGrabbedChange,\r\n\t\t\t\t\"change:_userIndex\": this.onItemUserIndexChange,\r\n\t\t\t\t\"change:_isVisited\": this.onItemVisitedChange,\r\n\t\t\t\t\"change:_isCorrect\": this.onItemCorrectChange,\r\n\t\t\t\t\"change:_isLocked\": this.onItemLockedChange,\r\n\t\t\t\t\"change:_positionTop\": \tthis.onItemPositionTopChange,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * The item should apply its grabbed class as soon as it's clicked.\r\n\t\t * @param {*} event \r\n\t\t */\r\n\t\tonItemMousedown(event) {\r\n\r\n\t\t\tlet itemModel = this.getItemModel($(event.currentTarget));\r\n\t\t\tif (itemModel.get(\"_isLocked\")) return;\r\n\t\t\t$(event.currentTarget).addClass(\"is-grabbed\");\r\n\t\t\t//itemModel.set(\"_isGrabbed\", true);\r\n\t\t}\r\n\r\n\t\tonItemMouseup(event) {\r\n\t\t\tlet itemModel = this.getItemModel($(event.currentTarget));\r\n\t\t\tif (itemModel.get(\"_isLocked\") || itemModel.get(\"_isGrabbed\")) return;\r\n\t\t\t$(event.currentTarget).removeClass(\"is-grabbed\");\r\n\t\t\t//itemModel.set(\"_isGrabbed\", false);\r\n\t\t}\r\n\r\n\t\tgetItemModel($itemElement) {\r\n\t\t\tlet index = $itemElement.attr(\"data-adapt-index\");\r\n\t\t\treturn this.model.getChildren().find((itemModel) => {\r\n\t\t\t\treturn itemModel.get(\"_index\") == index;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tgetItemElement(itemModel) {\r\n\t\t\treturn this.$(\".js-reorder-item\").filter('[data-adapt-index=' + itemModel.get(\"_index\") + ']');\r\n\t\t}\r\n\r\n\t\tonItemGrabbedChange(itemModel, isGrabbed) {\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t$item.toggleClass(\"is-grabbed\", isGrabbed);\r\n\t\t}\r\n\r\n\t\tonItemVisitedChange(itemModel, isVisited) {\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t$item.toggleClass(\"is-visited\", isVisited);\r\n\t\t}\r\n\r\n\t\tonItemLockedChange(itemModel, isLocked) {\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t$item.toggleClass(\"is-disabled\", isLocked);\r\n\r\n\t\t\t// Locked items can no longer be dragged.\r\n\t\t\tthis.getItemElement(itemModel).draggable(\"option\", \"disabled\", isLocked);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Note: isCorrect can === undefined, in which case the state is neither correct nor incorrect.\r\n\t\t * @param {*} itemModel \r\n\t\t * @param {*} isCorrect \r\n\t\t */\r\n\t\tonItemCorrectChange(itemModel, isCorrect) {\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t$item\r\n\t\t\t\t.toggleClass(\"is-correct\", isCorrect === true)\r\n\t\t\t\t.toggleClass(\"is-incorrect\", isCorrect === false);\r\n\t\t}\r\n\r\n\t\tonItemUserIndexChange(itemModel, userIndex) {\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t$item.attr(\"data-adapt-user-index\", userIndex);\r\n\t\t}\r\n\r\n\t\tonItemPositionTopChange(itemModel, positionTop) {\r\n\t\t\t\r\n\t\t\tif (itemModel.get(\"_isGrabbed\")) return;\r\n\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\t\r\n\t\t\t_.debounce(() => {\r\n\t\t\t\tlet translate = positionTop - $item.position().top;\r\n\t\t\t\t// Prevent slight jitters from small values.\r\n\t\t\t\ttranslate = Math.abs(translate) < JITTER_THRESHOLD ? 0 : translate;\r\n\t\t\t\t\r\n\t\t\t\tif (translate) {\r\n\t\t\t\t\t$item.find(\".js-reorder-item-transform\")\r\n\t\t\t\t\t.css(\"transform\", \"translateY(\" + translate + \"px)\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$item.find(\".js-reorder-item-transform\")\r\n\t\t\t\t\t.css(\"transform\", \"\");\r\n\t\t\t\t}\r\n\t\t\t},0)();\r\n\t\t}\r\n\r\n\t\t// Too costly. Do not use.\r\n\t\t/*getElementBB($el) {\r\n\t\t\tlet bb = $el[0].getBoundingClientRect();\r\n\t\t\treturn bb;\r\n\t\t}*/\r\n\r\n\t\trenderItems() {\r\n\t\t\t\r\n\t\t\tthis.model.getChildren().each((itemModel) => {\r\n\t\t\t\tthis.setUpItem(itemModel);\r\n\t\t\t\tthis.getItemElement(itemModel).draggable(\"option\", \"disabled\", itemModel.get(\"_isLocked\"));\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\trefreshItemElementTopCache() {\r\n\t\t\t\r\n\t\t\tlet top = 0;\r\n\t\t\tthis.model.getChildren().each((itemModel, index) => {\r\n\t\t\t\tthis.itemElementTopCache[index] = top;\r\n\t\t\t\ttop += this.getItemElement(itemModel).outerHeight();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Calculates the top offset of the specified item's element based on _userIndex.\r\n\t\tgetItemElementTop(itemModel) {\r\n\t\t\treturn this.itemElementTopCache[itemModel.get(\"_userIndex\")];\r\n\t\t}\r\n\r\n\t\t_getFirstEmptyIdx(arr) {\r\n\r\n\t\t\tlet idx = 0;\r\n\t\t\twhile(arr[idx]) {\r\n\t\t\t\tidx++;\r\n\t\t\t\tif (idx >= arr.length) throw \"Unexpected error has occured: idx out of range of arr (there are no falsy elements)\";\r\n\t\t\t}\r\n\r\n\t\t\treturn idx;\r\n\t\t}\r\n\r\n\t\tsetUpItem(itemModel) {\r\n\r\n\t\t\tlet $item = this.getItemElement(itemModel);\r\n\t\t\tlet $items;\r\n\r\n\t\t\tlet curTop;  // The top value of the dragged item (current frame).\r\n\t\t\tlet lastTop; // The top value of the dragged item (last frame).\r\n\r\n\t\t\tlet children;\r\n\t\t\tlet offsetY = 0;\r\n\r\n\t\t\t$item.draggable(\r\n\t\t\t{\r\n\t\t\t\tcontainment: this.$(\".js-reorder-containment\"),\r\n\t\t\t\tscroll: false, // Prevent the page scrolling while dragging (default jQuery implementation is bugged).\r\n\t\t\t\t//scrollSpeed: 5,\r\n\r\n\t\t\t\tstart: (event, ui) => {\r\n\t\t\t\t\titemModel.set(\"_isGrabbed\", true);\r\n\t\t\t\t\t$items = this.$(\".js-reorder-item\");\r\n\r\n\t\t\t\t\toffsetY = 0;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Used to detect the direction along the Y axis the draggable is moving.\r\n\t\t\t\t\tlet top = $item.position().top;\r\n\t\t\t\t\tcurTop = top;\r\n\t\t\t\t\tlastTop = top;\r\n\r\n\t\t\t\t\t// Sort the items by their _userIndex.\r\n\t\t\t\t\tchildren = this.model.getChildren();\r\n\t\t\t\t\tchildren.sort();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// TODO: define these callback functions in the View itself and reference them here?\r\n\t\t\t\t// Called each tick the draggable is moved.\r\n\t\t\t\tdrag: _.throttle((event, ui) => { // Requires a lot of processing. Throttled to improve performance.\r\n\r\n\t\t\t\t\tthis.refreshItemElementTopCache();\r\n\t\t\t\t\titemModel.set(\"_isGrabbed\", true);\r\n\r\n\t\t\t\t\tlet bb = $item[0].getBoundingClientRect();\r\n\t\t\t\t\toffsetY += this.scrollPage($item, dir, bb.top, bb.bottom);\r\n\t\t\t\t\tui.position.top += offsetY;\r\n\t\t\t\t\t$item.css(\"top\", ui.position.top);\r\n\r\n\t\t\t\t\tcurTop = $item.position().top;\r\n\t\t\t\t\tlet movement = curTop - lastTop;\r\n\t\t\t\t\tlet dir = movement == 0 ? 0 : (movement < 0 ? -1 : 1); // The direction the draggable is travelling.\r\n\t\t\t\t\tlastTop = curTop;\r\n\r\n\t\t\t\t\tif (dir == 0) return;\r\n\r\n\t\t\t\t\t//let data = $item.data('ui-draggable');\r\n\t\t\t\t\t//console.log(data);\r\n\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\t//console.log(ui.position.top);\r\n\t\t\t\t\t//$item.css(\"top\", ui.position.top);\r\n\r\n\t\t\t\t\t// Temporary array made which will contain the new order of the items.\r\n\t\t\t\t\tlet newItemOrder = new Array(this.itemCount);\r\n\t\t\t\t\tlet itemsAbove = [];\r\n\t\t\t\t\tlet itemsBelow = [];\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Fill areas of the newItemOrder that will always be consistent.\r\n\t\t\t\t\t// [ ][L][g][ ][L]\r\n\t\t\t\t\tchildren.each((item) => {\r\n\t\t\t\t\t\tif (!item.get(\"_isLocked\")) return;\r\n\r\n\t\t\t\t\t\t// _index used instead of _userIndex as a fallback\r\n\t\t\t\t\t\t// (_isLocked items should ALWAYS have _index == _userIndex.).\r\n\t\t\t\t\t\tnewItemOrder[item.get(\"_index\")] = item; \r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tlet curMiddle = curTop + $item.outerHeight()/2;\r\n\r\n\t\t\t\t\t// Travelling down.\r\n\t\t\t\t\tif (dir > 0) {\r\n\r\n\t\t\t\t\t\t// Find all items with a greater _userIndex that are above this item.\r\n\t\t\t\t\t\tchildren.each((eModel) => {\r\n\r\n\t\t\t\t\t\t\t// Ignore this $item when calculating.\r\n\t\t\t\t\t\t\tif (eModel == itemModel) return;\r\n\t\t\t\t\t\t\tif (eModel.get(\"_isLocked\")) return; // Locked items can never move.\r\n\r\n\t\t\t\t\t\t\t// FIXME: This is likely what's causing the stutter.\r\n\t\t\t\t\t\t\t// Need to make item tops cache themselves until window resize / _userIndex change.\r\n\t\t\t\t\t\t\tlet eTop = this.getItemElementTop(eModel);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Determine which items are above this one's middle point, and add them.\r\n\t\t\t\t\t\t\tif (eTop < curMiddle) itemsAbove.push(eModel);\r\n\t\t\t\t\t\t\telse itemsBelow.push(eModel);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Travelling up.\r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t// Find all items with a greater _userIndex that are above this item.\r\n\t\t\t\t\t\tchildren.each((eModel) => {\r\n\r\n\t\t\t\t\t\t\t// Ignore this $item when calculating.\r\n\t\t\t\t\t\t\tif (eModel == itemModel) return;\r\n\t\t\t\t\t\t\tif (eModel.get(\"_isLocked\")) return; // Locked items can never move.\r\n\r\n\t\t\t\t\t\t\tlet eBottom = this.getItemElementTop(eModel) + this.getItemElement(eModel).outerHeight();\r\n\r\n\t\t\t\t\t\t\t// Determine which items are below this one's middle point, and add them.\r\n\t\t\t\t\t\t\tif (eBottom > curMiddle) itemsBelow.push(eModel);\r\n\t\t\t\t\t\t\telse itemsAbove.push(eModel);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create the final item array.\r\n\t\t\t\t\t_.each(itemsAbove, (item) => {\r\n\t\t\t\t\t\t// Find the first empty element in the newItemOrder and add this itemAbove to it.\r\n\t\t\t\t\t\tnewItemOrder[this._getFirstEmptyIdx(newItemOrder)] = item;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// Find the first empty element and add the currently dragging item to it.\r\n\t\t\t\t\tnewItemOrder[this._getFirstEmptyIdx(newItemOrder)] = itemModel;\r\n\t\t\t\t\t_.each(itemsBelow, (item) => {\r\n\t\t\t\t\t\t// Find the first empty element in the newItemOrder and add this itemBelow to it.\r\n\t\t\t\t\t\tnewItemOrder[this._getFirstEmptyIdx(newItemOrder)] = item;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Change the _userIndex values for all items based on the newItemOrder.\r\n\t\t\t\t\t_.each(newItemOrder, (item, index) => {\r\n\t\t\t\t\t\titem.set(\"_userIndex\", index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.model.getChildren().sort();\r\n\r\n\t\t\t\t\t// Update the items _positionTop.\r\n\t\t\t\t\t_.each(newItemOrder, (item, index) => {\r\n\t\t\t\t\t\titem.set(\"_positionTop\", this.getItemElementTop(item));\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 1),\r\n\t\t\t\tstop: () => { \r\n\r\n\t\t\t\t\tlet $container = this.$(\".reorder__items-container\");\r\n\r\n\t\t\t\t\tlet itemGrabbedTop = $item.offset().top;\r\n\r\n\t\t\t\t\t// Sort all items in order and remove their temporary offsets.\r\n\t\t\t\t\tthis.model.getChildren().each((item) => {\r\n\t\t\t\t\t\tlet $item = this.getItemElement(item);\r\n\t\t\t\t\t\t$item.find(\".js-reorder-item-transform\").css(\"transform\", \"\");\r\n\t\t\t\t\t\t$item.css(\"top\", \"\");\r\n\t\t\t\t\t\t$container.append($item);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Smoothly transition the item that was just grabbed.\r\n\t\t\t\t\tlet itemGrabbedOffset = itemGrabbedTop - $item.offset().top;\r\n\t\t\t\t\t$item\r\n\t\t\t\t\t\t.addClass(\"is-grabbed\")\r\n\t\t\t\t\t\t.find(\".js-reorder-item-transform\")\r\n\t\t\t\t\t\t.css(\"top\", itemGrabbedOffset + \"px\")\r\n\t\t\t\t\t\t.hide(0).show(0);\r\n\t\t\t\t\t_.debounce(() => {\r\n\t\t\t\t\t\t$item.find(\".js-reorder-item-transform\")\r\n\t\t\t\t\t\t\t.css(\"top\", \"0\");\r\n\t\t\t\t\t\t\titemModel.set(\"_isGrabbed\", false);\r\n\t\t\t\t\t}, 0)();\r\n\t\t\t\t},\r\n\t\t\t\taxis: 'y'//,\r\n\t\t\t\t//\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tscrollPage($item, dragDir, draggableTop, draggableBottom) {\r\n\r\n\t\t\tlet bb = this.$(\".js-reorder-containment\")[0].getBoundingClientRect();\r\n\r\n\t\t\tif (draggableTop < bb.top) {\r\n\t\t\t\t//console.log(bb.top - draggableTop);\r\n\t\t\t\treturn bb.top - draggableTop;\r\n\t\t\t\t//$item.css(\"top\", \"+=\" + (bb.top - draggableTop) + \"px\");\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\tif (draggableBottom > bb.bottom) {\r\n\t\t\t\t//console.log(bb.bottom - draggableBottom);\r\n\t\t\t\treturn bb.bottom - draggableBottom;\r\n\t\t\t\t$item.css(\"top\", \"-=\" + (draggableBottom - bb.bottom) + \"px\");\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet pageY = draggableTop + (draggableBottom - draggableTop)/2;\r\n\t\t\tlet screenHeight = Adapt.device.screenHeight;\r\n\t\t\tlet dir = 0;\r\n\t\t\tif (pageY < screenHeight * VIEWPORT_SCROLL_THRESHOLD) dir = -1;\r\n\t\t\telse if (pageY > screenHeight - screenHeight * VIEWPORT_SCROLL_THRESHOLD) dir = 1;\r\n\t\t\t\r\n\t\t\t//console.log(\"MIDDLE\");\r\n\r\n\t\t\t// If the pageY is within the center of the viewport, no need to scroll.\r\n\t\t\tif (dir == 0 /*|| dir != dragDir*/) return 0;\r\n\t\t\t\r\n\t\t\t$.scrollTo(dir > 0 ? \"+=\" + VIEWPORT_SCROLL_SPEED + \"px\" : \"-=\" + VIEWPORT_SCROLL_SPEED + \"px\", {});\r\n\r\n\t\t\t//console.log(\"GO\");\r\n\t\t\treturn dir * VIEWPORT_SCROLL_SPEED;\r\n\t\t}\r\n\r\n\t\tonQuestionRendered() {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\t// Blank method to add functionality for when the user cannot submit\r\n\t\t// Could be used for a popup or explanation dialog/hint\r\n\t\tonCannotSubmit() {}\r\n\r\n\t\t// This is important and should give the user feedback on how they answered the question\r\n\t\t// Normally done through ticks and crosses by adding classes\r\n\t\tshowMarking() {\r\n\t\t\tthis.update();\r\n\t\t\tthis.updateMarking();\r\n\t\t}\r\n\r\n\t\tresetQuestion() {\r\n\r\n\t\t\t// Not implemented (DD doesn't use this at this time).\r\n\t\t\treturn;\r\n\r\n\t\t\tthis.model.set('_isAtLeastOneCorrectSelection', false);\r\n\t\t\tvar resetAll = this.model.get('_shouldResetAllAnswers');\r\n\r\n\t\t\tthis.model.getChildren().each((item, index) => {\r\n\r\n\t\t\t\tif (item.get(\"_isCorrect\") && resetAll === false) return;\r\n\t\t\t\t\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tshowCorrectAnswer() {\r\n\t\t\tthis.isCorrectAnswerShown = true;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\thideCorrectAnswer() {\r\n\t\t\tthis.isCorrectAnswerShown = false;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate(model) {\r\n\t\t\t//this.updateSelection();\r\n\t\t\t// \\/ questionPlus will call this.updateMarking() when necessary. It shouldn't be invoked here while it's in use.\r\n\t\t\t//this.updateMarking();\r\n\t\t}\r\n\r\n\t\tupdateSelection() {\r\n\r\n\t\t}\r\n\r\n\t\tupdateMarking() {\r\n\r\n\t\t\t// No need to implement. All marking happens when the itemModel properties change.\r\n\r\n\t\t\t//this.updateSelection();\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn ReorderView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  class ReorderItemModel extends Backbone.Model {\r\n\r\n    defaults() {\r\n      return {\r\n        _index: -1,              // The correct + JSON index (this item will be correct if submitted when at this index).\r\n        _userIndex: -1,          // The current index of the item as it appears onscreen (the index the user has dragged it to).\r\n        _isCorrect: false,\r\n        _isLocked: false,        // If true, the draggable will be immoveable.\r\n        _isVisited: false,       // == _.includes(_visitedIndexes, _userIndex).\r\n        _visitedIndexes: [],     // Array of all _userIndexes that have been submitted up until this point.\r\n\r\n        _isGrabbed: false,\r\n        _positionTop: 0,         // Value used while an item is being dragged.\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpEventListeners(){\r\n      this.listenTo(this, \"change:_userIndex\", this.onUserIndexChange);\r\n    }\r\n\r\n    /**\r\n     * Whenever the userIndex changes, check if the item has already been visited, and toggle _isVisited.\r\n     * @param {*} model \r\n     * @param {*} userIndex \r\n     */\r\n    onUserIndexChange(model, userIndex) {\r\n      let isVisited = _.includes(this.get(\"_visitedIndexes\"), userIndex);\r\n      this.set(\"_isVisited\", isVisited);\r\n\r\n      // DD specific: Update the value of isCorrect accordingly.\r\n      if (!isVisited) {\r\n        // Not yet visited; value of _isCorrect is unknown.\r\n        this.set(\"_isCorrect\", undefined);\r\n        return;\r\n      }\r\n      this.set(\"_isCorrect\", this.get(\"_index\") == this.get(\"_userIndex\"));\r\n    }\r\n\r\n    /**\r\n     * Sets the current _userIndex to visited.\r\n     */\r\n    setVisited() {\r\n\r\n      let visitedIndexes = this.get(\"_visitedIndexes\");\r\n      let userIndex = this.get(\"_userIndex\");\r\n      if (_.includes(visitedIndexes, userIndex)) return;\r\n      visitedIndexes.push(userIndex);\r\n    }\r\n\r\n  }\r\n\r\n  return ReorderItemModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './reorderItemModel'\r\n], function(Adapt, ReorderItemModel) {\r\n\r\n  class ReorderItemCollection extends Backbone.Collection {\r\n\r\n    // Always sort by user index.\r\n    comparator(item) {\r\n      return item.get(\"_userIndex\");\r\n    }\r\n  }\r\n\r\n  return ReorderItemCollection;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/questionModel',\r\n  './reorderItemModel',\r\n  './reorderItemCollection'\r\n], function(Adapt, QuestionModel, ReorderItemModel, ReorderItemCollection) {\r\n\r\n  class ReorderModel extends QuestionModel {\r\n\r\n    toJSON() {\r\n      const json = super.toJSON();\r\n      // Make sure _items is updated from child collection\r\n      json._items = this.getChildren().toJSON();\r\n      return json;\r\n    }\r\n\r\n    init() {\r\n\r\n      QuestionModel.prototype.init.call(this);\r\n\r\n      this.setUpItems();\r\n      this.setUpLabels();\r\n\r\n      //this.setupQuestionItemIndexes();\r\n      this.checkCanSubmit();\r\n    }\r\n\r\n    /**\r\n     * Legacy:\r\n     * -------\r\n     * Previous versions of this component had the \"header\" and \"footer\" labels defined in the root.\r\n     * This is no longer the case, so adjust the model values to fix this.\r\n     */\r\n    setUpLabels() {\r\n      \r\n      let legacyHeader = this.get(\"header\");\r\n      let legacyFooter = this.get(\"footer\");\r\n\r\n      // Show a warning if the legacy implementation is being used.\r\n      if (legacyHeader || legacyFooter) {\r\n        Adapt.log.deprecated(\"reorderModel.js: \\\"header\\\" and \\\"footer\\\" properties are now defined in the \\\"_labels\\\" object.\");\r\n      }\r\n\r\n      // Override legacy label definitions with the proper definitions if both are present.\r\n      let labels = this.get(\"_labels\") || {};\r\n      labels = _.extend(\r\n        {},\r\n        {\r\n          header: legacyHeader,\r\n          footer: legacyFooter\r\n        },\r\n        labels\r\n      );\r\n\r\n      this.set(\"_labels\", labels);\r\n    }\r\n\r\n    setUpItems() {\r\n      const items = this.get('_items') || [];\r\n      items.forEach((item, index) => {\r\n        item._index = index;\r\n      });\r\n      this.setChildren(new ReorderItemCollection(items, { model: ReorderItemModel }));\r\n    }\r\n\r\n    /**\r\n     * Note: Odd way of shuffling used to ensure that _isLocked items DONT have their _userIndex randomized,\r\n     * while the other items around them do.\r\n     */\r\n    setupRandomisation() {\r\n\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n      let children = this.getChildren();\r\n      children.reset(children.shuffle(), {silent:true});\r\n\r\n      // Set up initial _userIndex values for the items.\r\n      // _isLocked items should ALWAYS have their _index == _userIndex, hence the weird implementation.\r\n      let temp = new Array(children.length);\r\n      \r\n      // Fill in the locked items first.\r\n      children.each((item, index) => {\r\n        if (!item.get(\"_isLocked\")) return;\r\n        temp[item.get(\"_index\")] = item;\r\n      });\r\n\r\n      // Fill in the other unlocked items in the empty spaces.\r\n      children.each((item, index) => {\r\n        if (item.get(\"_isLocked\")) return;\r\n        temp[_.indexOf(temp, undefined)] = item;\r\n      });\r\n\r\n      // Finally, set _userIndex.\r\n      _.each(temp, (item, index) => {\r\n        item.set(\"_userIndex\", index);\r\n      });\r\n      children.sort();\r\n    }\r\n\r\n    canSubmit() {\r\n      // Can submit at any time.\r\n      return true;\r\n    }\r\n\r\n    isCorrect() {\r\n\r\n      const props = {\r\n        _numberOfIncorrectAnswers: 0, // Number of items in the wrong location.\r\n        _numberOfCorrectAnswers: 0,   // Number of items in the correct location.\r\n        _isAtLeastOneCorrectAnswer: false, // _numberOfCorrectAnswers > 0\r\n      };\r\n\r\n      /**\r\n       * An item is correct only when its _index == _userIndex;\r\n       */\r\n      this.getChildren().each(item => {\r\n        \r\n        let isCorrect = Boolean(item.get(\"_index\") == item.get(\"_userIndex\"));\r\n        item.set(\"_isCorrect\", isCorrect);\r\n        item.set(\"_isLocked\", isCorrect);\r\n        item.setVisited();\r\n\r\n        if (isCorrect) {\r\n          props._numberOfCorrectAnswers++;\r\n          props._isAtLeastOneCorrectAnswer = true;\r\n        }\r\n        else {\r\n          props._numberOfIncorrectAnswers++;\r\n        }\r\n      });\r\n\r\n      this.set(props);\r\n\r\n      return props._numberOfIncorrectAnswers === 0;\r\n    }\r\n\r\n    setScore() {\r\n      let questionWeight = this.get('_questionWeight');\r\n\r\n      if (this.get('_isCorrect')) {\r\n        this.set('_score', questionWeight);\r\n        return;\r\n      }\r\n\r\n      let numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      let itemLength = this.getChildren().length;\r\n\r\n      let score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    }\r\n\r\n    isPartlyCorrect() {\r\n      return this.get('_isAtLeastOneCorrectAnswer');\r\n    }\r\n\r\n    resetUserAnswer() {\r\n      this.set('_userAnswer', []);\r\n    }\r\n\r\n    restoreUserAnswers() {\r\n\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      let userAnswer = this.get('_userAnswer');\r\n      this.set(\"_items\", _.sortBy(this.get(\"_items\"), (item, index) => {\r\n        item.set(\"_userAnswer\", userAnswer[index]);\r\n        return userAnswer[index];\r\n      }));\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    }\r\n\r\n    storeUserAnswer() {\r\n\r\n      let userAnswer = new Array(this.getChildren().length);\r\n      let tempUserAnswer = new Array(this.getChildren().length);\r\n\r\n      // Create an array where each element stores the index it was placed in by the user.\r\n      // Example:\r\n      // userAnswer[0] = 2  ---> The user dragged _items[0] into index 2 (when it should have been at 0 to be correct).\r\n      this.getChildren().each((item, index) => {\r\n\r\n        tempUserAnswer[item._index] = item.get(\"_userAnswer\");\r\n        userAnswer[item._index] = item.get(\"_userAnswer\");\r\n\r\n      }, this);\r\n\r\n      this.set({\r\n        '_userAnswer': userAnswer,\r\n        '_tempUserAnswer': tempUserAnswer\r\n      });\r\n    }\r\n\r\n\r\n    /**\r\n    * Used by tracking extensions to return an object containing the component's specific interactions.\r\n    */\r\n    /*getInteractionObject() {\r\n\r\n      let interactions = {\r\n        correctResponsesPattern: null,\r\n        source: null,\r\n        target: null\r\n      };\r\n      let items = this.get('_items');\r\n      // This contains an array with a single string value, matching the source 'id' with the correct\r\n      // matching target 'id' value. An example is as follows:\r\n      // [ \"1[.]1_2[,]2[.]2_3\" ]\r\n      interactions.correctResponsesPattern = [\r\n        items.map(function(item, questionIndex) {\r\n          // Offset the item index and use it as a group identifier.\r\n          questionIndex = questionIndex + 1;\r\n          return [\r\n            questionIndex,\r\n            item._options.filter(function(item) {\r\n              // Get the correct item(s).\r\n              return item._isCorrect;\r\n            }).map(function(item) {\r\n              // Prefix the option's index and offset by 1.\r\n              return questionIndex + '_' + (item._index + 1).toString();\r\n            })\r\n          ].join('[.]');\r\n        }).join('[,]')\r\n      ];\r\n      // The 'source' property contains an array of all the stems/questions, e.g.\r\n      // [{id: \"1\", description: \"First question\"}, {id: \"2\", description: \"Second question\"}]\r\n      interactions.source = _.flatten(items.map(function(item) {\r\n        return {\r\n          // Offset by 1.\r\n          id: (item._index + 1).toString(),\r\n          description: item.text\r\n        };\r\n      }));\r\n      // The 'target' property contains an array of all the option responses, with the 'id'\r\n      // prefixed to indicate the grouping, e.g.\r\n      // [  {id: \"1_1\": description: \"First option, group 1\"},\r\n      //    {id: \"1_2\": description: \"Second option, group 1\"}\r\n      //    {id: \"2_1\": description: \"First option, group 2\"}  ]\r\n      interactions.target = _.flatten(items.map(function(item, index) {\r\n        // Offset by 1, as these values are not zero-indexed.\r\n        index = index + 1;\r\n        return item._options.map(function(option) {\r\n          return {\r\n            id: index + '_' + (option._index + 1),\r\n            description: option.text\r\n          };\r\n        });\r\n      }));\r\n      return interactions;\r\n    }*/\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * @return {string} the user's answers as a string in the format \"1#3#2\" assuming user ordered the items with the item0 in position0,\r\n    * item2 in position1, and item1 in position2.\r\n    * The '#' character will be changed to either ',' or '[,]' by adapt-contrib-spoor, depending on which SCORM version is being used.\r\n    */\r\n    getResponse() {\r\n      let responses = [];\r\n\r\n      _.each(this.get('_userAnswer'), (userAnswer, index) => {\r\n        responses.push((userAnswer + 1));// convert from 0-based to 1-based counting\r\n      });\r\n\r\n      return responses.join('#');\r\n    }\r\n\r\n    /**\r\n    * Used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    * @return {string}\r\n    */\r\n    getResponseType() {\r\n      return \"sequencing\";\r\n    }\r\n  }\r\n\r\n  return ReorderModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './reorderView',\r\n  './reorderModel'\r\n], function(Adapt, ReorderView, ReorderModel) {\r\n\r\n  return Adapt.register(\"reorder\", {\r\n    view: ReorderView,\r\n    model: ReorderModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'core/js/models/itemsComponentModel'\r\n], function(Adapt, ComponentView, ItemsComponentModel) {\r\n\r\n  var Tabs = ComponentView.extend({\r\n\r\n    events: {\r\n      'click .js-tabs-nav-item-btn-click': 'onTabItemClicked'\r\n    },\r\n\r\n    preRender: function() {\r\n      this.checkIfResetOnRevisit();\r\n      this.setUpModelData();\r\n\r\n      this.model.resetActiveItems();\r\n\r\n      this.listenTo(this.model.getChildren(), {\r\n        'change:_isActive': this.onItemsActiveChange,\r\n        'change:_isVisited': this.onItemsVisitedChange\r\n      });\r\n    },\r\n\r\n    // DD: Modified to add support for sizing.\r\n    setUpModelData: function() {\r\n\r\n      if (!Adapt.sizing) return;\r\n\r\n      // adapt-sizing extension compatibility.\r\n      let globalSizing = this.model.get(\"_itemSizing\");\r\n      if (globalSizing) {\r\n        \r\n        // Global item sizing.\r\n        globalSizing = Adapt.sizing.getSizingClass(globalSizing);\r\n        \r\n        // Apply to each item (or use the items own override if it exists).\r\n        this.model.getChildren().each((item) => {\r\n          \r\n          let itemGraphic = item.get(\"_graphic\");\r\n          if (!itemGraphic) return; // No need to apply sizing if there's no graphic to create a second column.\r\n          \r\n          let itemSizing = itemGraphic._sizing;\r\n          itemGraphic._sizing = _.extend(\r\n            {},\r\n            itemSizing,\r\n            {\r\n              _classes: itemSizing ? Adapt.sizing.getSizingClass(itemSizing) : globalSizing\r\n            });\r\n        });\r\n\r\n        this.model.set(\"_parSizingClasses\", Adapt.sizing.getParentClasses(globalSizing));\r\n      }\r\n    },\r\n\r\n    postRender: function() {\r\n      this.setReadyStatus();\r\n      this.setLayout();\r\n      this.listenTo(Adapt, 'device:resize', this.setLayout);\r\n\r\n      this.model.setActiveItem(0);\r\n\r\n      if (this.model.get('_setCompletionOn') === 'inview') {\r\n        this.setupInviewCompletion();\r\n      }\r\n\r\n      // DD: Re-render as accordion if in PDF mode.\r\n      if (Adapt.isPDFMode()) {\r\n        this.replaceWithAccordion();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * DD: Used for PDF mode. \r\n     */\r\n    replaceWithAccordion: function() {\r\n\r\n      if (!Adapt.componentStore.accordion) throw \"Accordion not included in build\";\r\n      let AccordionView = Adapt.componentStore.accordion.view;\r\n\r\n      let model = this.prepareAccordionModel();\r\n      let newAccordion = new AccordionView({ model: model });\r\n      let $container = $(\".component__container\", $(\".\" + this.model.get(\"_parentId\")));\r\n\r\n      $container.append(newAccordion.$el);\r\n      this.remove();\r\n      $.a11y_update();\r\n      _.defer(function() {\r\n        Adapt.trigger('device:resize');\r\n      });\r\n    },\r\n\r\n    /**\r\n     * DD: Used for PDF mode. \r\n     */\r\n    prepareAccordionModel: function() {\r\n      var model = this.model;\r\n      /*model.resetActiveItems();\r\n      model.set({\r\n        '_isPopupOpen': false,\r\n        '_component': 'hotgraphic',\r\n        'body': model.get('originalBody'),\r\n        'instruction': model.get('originalInstruction')\r\n      });*/\r\n\r\n      return model;\r\n    },\r\n\r\n    checkIfResetOnRevisit: function() {\r\n      var isResetOnRevisit = this.model.get('_isResetOnRevisit');\r\n\r\n      // If reset is enabled set defaults\r\n      if (isResetOnRevisit) {\r\n        this.model.reset(isResetOnRevisit);\r\n      }\r\n    },\r\n\r\n    setLayout: function () {\r\n      this.$el.removeClass('is-horizontal-layout is-vertical-layout');\r\n      if (Adapt.device.screenSize === 'large') {\r\n        var tabLayout = this.model.get('_tabLayout');\r\n        this.$el.addClass('is-' + tabLayout + '-layout');\r\n        if (tabLayout === 'vertical') {\r\n          this.setTabLayoutVertical();\r\n          return;\r\n        }\r\n        this.setTabLayoutHorizontal();\r\n        return;\r\n      }\r\n\r\n      this.$el.addClass('is-horizontal-layout');\r\n      this.setTabLayoutVertical();\r\n    },\r\n\r\n    // DD modified: CSS used to set tab width now.\r\n    setTabLayoutHorizontal: function () {\r\n      return;\r\n      \r\n      var itemsLength = this.model.get('_items').length;\r\n      var itemWidth = 100 / itemsLength;\r\n\r\n      this.$('.tabs__nav-item-btn').css({\r\n        width: itemWidth + '%'\r\n      });\r\n    },\r\n\r\n    setTabLayoutVertical: function () {\r\n      this.$('.tabs__nav-item-btn').css({\r\n        width: 100 + '%'\r\n      });\r\n    },\r\n\r\n    onTabItemClicked: function(e) {\r\n      if (e && e.preventDefault) e.preventDefault();\r\n\r\n      let index = $(e.currentTarget).data('index');\r\n      this.model.setActiveItem(index);\r\n\r\n      // DD: Modified:\r\n      // Smoothly scroll the tab that was just pressed into view (along with the content that it activated).\r\n      // This is done to improve the phone experience.\r\n      var dataFilter = '[data-index=\"' + index +'\"]';\r\n      var $tabButton = this.$('.js-tabs-nav-item-btn-click').filter(dataFilter);\r\n      var $tabPanel = this.$('.tabs__content-item').filter(dataFilter);\r\n\r\n      Adapt.navigateToElement($tabPanel.add($tabButton), {\r\n        duration: 400,\r\n        align: \"inview\",\r\n        offset: {\r\n          top: -15,\r\n          left: 0\r\n        }\r\n      });\r\n    },\r\n\r\n    onItemsActiveChange: function(item, isActive) {\r\n      var dataFilter = '[data-index=\"' + item.get('_index') +'\"]';\r\n\r\n      var $tabButton = this.$('.js-tabs-nav-item-btn-click').filter(dataFilter);\r\n      var $tabPanel = this.$('.tabs__content-item').filter(dataFilter);\r\n\r\n      $tabButton.toggleClass('is-selected', isActive).attr('aria-selected', isActive);\r\n      $tabPanel.toggleClass('is-active', isActive);\r\n\r\n      if (isActive) {\r\n        $tabPanel.a11y_focus();\r\n        item.toggleVisited(true);\r\n      }\r\n    },\r\n\r\n    onItemsVisitedChange: function(item, isVisited) {\r\n      if (!isVisited) return;\r\n\r\n      var ariaLabel = item.get('title') + '. ' + this.model.get('_globals')._accessibility._ariaLabels.visited;\r\n      var $tabButton = this.$('.js-tabs-nav-item-btn-click').filter('[data-index=\"' + item.get('_index') +'\"]');\r\n      $tabButton.addClass('is-visited').attr('aria-label', ariaLabel);\r\n    },\r\n\r\n  }, {\r\n    template: 'tabs'\r\n  });\r\n\r\n  return Adapt.register('tabs', {\r\n    model: ItemsComponentModel,\r\n    view: Tabs\r\n  });\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/questionView'\r\n], function(Adapt, QuestionView) {\r\n\r\n  /**\r\n   * Modified version of adapt-contrib-textInput/js/textInputView\r\n   * \r\n   * DD SPECIFIC! WILL NOT WORK WITH VANILLA ADAPT!\r\n   * \r\n   * FIXME:\r\n   * ------\r\n   * Due to being a copy paste; this script needs a good cleanup.\r\n   */\r\n\r\n  class TextInputPlusView extends QuestionView {\r\n\r\n    events() {\r\n      return {\r\n        'focus .js-textinputplus-textbox': 'clearValidationError',\r\n        'change .js-textinputplus-textbox': 'onInputChanged',\r\n        'keyup .js-textinputplus-textbox': 'onInputChanged',\r\n        'click .js-textinputplus-incorrect-icon': 'onIncorrectIconClick'\r\n      }\r\n    }\r\n\r\n    postRender() {\r\n      super.postRender();\r\n      \r\n      // The input field Models and Views are set up by the external {{#inputField}} helper plugin.\r\n      this.setUpInputFields();\r\n\r\n      // Once the user submits the component this many times, the adapt-dd-inputFields will enable their hint buttons.\r\n      // FIXME: Rough implementation.\r\n      this.attemptsBeforeHint = 3; \r\n    }\r\n\r\n    /**\r\n     * InputFields\r\n     * -----------\r\n     * For consistency, this component uses the {{#inputField}} helper to make its input fields have the same behaviour\r\n     * and appearance.\r\n     * \r\n     * WARNING:\r\n     * --------\r\n     * Changes the Model's \"_item\" property to accomplish this.\r\n     */\r\n    setUpInputFields() {\r\n\r\n      //if (!this.model.get(\"custom\")) return false;\r\n\r\n      let items = [];\r\n      let $inputFields = this.$(\".inputfield\");\r\n\r\n      $inputFields.each((i, e) => {\r\n        \r\n        // Find the InputFieldView that created this element.\r\n        let view = Adapt.inputField.findViewByEl($(e));\r\n        let model = view.model;\r\n        \r\n        // Add the classes to the fields that would be on this (textInputPlus) view's native <input> elements.\r\n        // (Do not remove this, as {{#inputField}} helpers defined in the \"custom\" property HTML need it).\r\n        view\r\n          .$(\".js-inputfield-input\")\r\n          .addClass(\"js-textinputplus-textbox\")\r\n          .attr(\"data-adapt-index\", i);\r\n\r\n        // Add an item to the model for it.\r\n        items.push({\r\n          _answers: model.getAnswers(),\r\n          _inputFieldModel: model\r\n        });\r\n\r\n        // Hide the hint buttons from the inputFields (they'll be re-enabled if the user submits the wrong answer 3 times).\r\n        model.disableHint();\r\n        model.enableRequireSubmit();\r\n      });\r\n\r\n      this.model.set(\"_items\", items);\r\n      this.model.setupQuestionItemIndexes();\r\n      this.model.checkCanSubmit();\r\n\r\n      return true;\r\n    }\r\n\r\n    resetQuestionOnRevisit() {\r\n      this.setAllItemsEnabled(false);\r\n      this.resetQuestion();\r\n    }\r\n\r\n    setupQuestion() {\r\n      this.model.setupRandomisation();\r\n    }\r\n\r\n    disableQuestion() {\r\n      this.setAllItemsEnabled(false);\r\n    }\r\n\r\n    enableQuestion() {\r\n      this.setAllItemsEnabled(true);\r\n    }\r\n\r\n    setAllItemsEnabled(isEnabled) {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        var $itemInput = this.$('.js-textinputplus-textbox').eq(index);\r\n\r\n        $itemInput.prop('disabled', !isEnabled);\r\n      }, this);\r\n    }\r\n\r\n    onQuestionRendered() {\r\n      this.setReadyStatus();\r\n    }\r\n\r\n    clearValidationError() {\r\n      //this.$('.js-textinputplus-textbox-container').removeClass('is-incorrect');\r\n    }\r\n\r\n    // Blank method for question to fill out when the question cannot be submitted\r\n    onCannotSubmit() {\r\n      this.showValidationError();\r\n    }\r\n\r\n    showValidationError() {\r\n      //this.$('.js-textinputplus-textbox-container').addClass('is-incorrect');\r\n    }\r\n\r\n    // This is important and should give the user feedback on how they answered the question\r\n    // Normally done through ticks and crosses by adding classes\r\n    showMarking() {\r\n      \r\n      /*if (!this.model.get('_canShowMarking')) return;\r\n\r\n      console.log(\"SHOWING MARKING\");\r\n\r\n      this.model.get('_items').forEach(function(item, i) {\r\n        \r\n        var $item = this.$('.js-textinputplus-item').eq(i);\r\n        \r\n        //$item.removeClass('is-correct is-incorrect').addClass(item._isCorrect ? 'is-correct' : 'is-incorrect');\r\n\r\n        $item.toggleClass('is-correct', item._isCorrect);\r\n        $item.toggleClass('is-incorrect', !item._isCorrect);\r\n\r\n      }, this);*/\r\n\r\n      // Moved to updateMarking();\r\n    }\r\n\r\n    updateMarking() {\r\n\r\n      if (!this.model.get('_canShowMarking')) return;\r\n\r\n      this.model.get('_items').forEach(function(item, i) {\r\n        \r\n        var $item = this.$('.js-textinputplus-item').eq(i);\r\n        \r\n        //$item.removeClass('is-correct is-incorrect').addClass(item._isCorrect ? 'is-correct' : 'is-incorrect');\r\n\r\n        $item.toggleClass('is-correct', item._isCorrect);\r\n        $item.toggleClass('is-incorrect', !item._isCorrect);\r\n\r\n        /*$item.find(\".js-textinputplus-textbox\")\r\n        .prop('disabled', item._isCorrect) // Prevent correct answers from being modified after submission.\r\n        .inputField(\"submit\");*/\r\n\r\n        // CUSTOM MODE\r\n        // -----------\r\n        // Lock correct inputFields.\r\n        if (item._inputFieldModel?.isCorrect()) {\r\n          item._inputFieldModel.lock();\r\n        }\r\n\r\n        // Add a class to allow custom styles for the input box if it contains an incorrect input (that has been checked).\r\n        /*$item.find('.js-textinputplus-textbox-container')\r\n          .toggleClass('is-correct', item._isCorrect)\r\n          .toggleClass('is-incorrect', !item._isCorrect);*/\r\n\r\n      }, this);\r\n\r\n      \r\n      // Show hint icons after the feedback is closed if the user hasn't reached the correct answer after X submissions.\r\n      this.attemptsBeforeHint--;\r\n      if (this.attemptsBeforeHint == 0) {\r\n        this.listenToOnce(Adapt, \"notify:closed\", () => {\r\n            _.debounce(() => {\r\n\r\n              _.each(this.model.get(\"_items\"), (item) => {\r\n\r\n                // Custom mode (using current inputField implementation).\r\n                if (item._inputFieldModel) {\r\n                  item._inputFieldModel.enableHint();\r\n                }\r\n                /*else {\r\n                  // FIXME: Legacy support (using legacy inputField implementation).\r\n                  //this.$(\".js-textinputplus-textbox\").filter(`[data-adapt-index=\"${item._index}\"]`).inputField(\"enableHint\");\r\n                }*/\r\n              });\r\n            }, 600)();\r\n        });\r\n      }\r\n    }\r\n\r\n    // Used by the question view to reset the look and feel of the component.\r\n    resetQuestion() {\r\n      this.$('.js-textinputplus-textbox')\r\n        .prop('disabled', !this.model.get('_isEnabled'))\r\n        .val('');\r\n\r\n      /*this.$(\".js-textinputplus-textbox-container\")\r\n        .removeClass('is-incorrect is-correct');*/\r\n\r\n      this.attemptsBeforeHint = 3;\r\n\r\n      this.model.set({\r\n        _isAtLeastOneCorrectSelection: false,\r\n        _isCorrect: undefined\r\n      });\r\n    }\r\n\r\n    showCorrectAnswer() {\r\n\r\n      if (this.model.get('_answers'))  {\r\n\r\n        var correctAnswers = this.model.get('_answers');\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinputplus-textbox').eq(index).val(correctAnswers[index][0]);\r\n        }, this);\r\n\r\n      } else {\r\n        this.model.get('_items').forEach(function(item, index) {\r\n          this.$('.js-textinputplus-textbox').eq(index).val(item._answers[0]);\r\n        }, this);\r\n      }\r\n\r\n    }\r\n\r\n    hideCorrectAnswer() {\r\n      this.model.get('_items').forEach(function(item, index) {\r\n        this.$('.js-textinputplus-textbox').eq(index).val(item.userAnswer);\r\n      }, this);\r\n    }\r\n\r\n    onInputChanged(e) {\r\n      var $input = $(e.target);\r\n      this.model.setItemUserAnswer($input.attr('data-adapt-index'), $input.val());\r\n    }\r\n\r\n    // Completely reset an item its initial state (visibly; its record of incorrect answers will remain).\r\n    clearItemState(index) {\r\n      \r\n      let $input = this.$('.js-textinputplus-textbox');\r\n      let $item = this.$('.js-textinputplus-item');\r\n\r\n      // Allow for a specific index to be used if the parameter is provided.\r\n      if (index !== undefined) {\r\n        $item = $item.filter(\"[data-adapt-index=\" + index + \"]\");\r\n        $input = $input.filter(\"[data-adapt-index=\" + index + \"]\");\r\n      }\r\n\r\n      $input\r\n        .prop('disabled', !this.model.get('_isEnabled'))\r\n        .val('') // Clear value\r\n        .parent().removeClass('is-incorrect is-correct') // Remove error class.\r\n\r\n      this.model.setItemUserAnswer(index, '');\r\n\r\n      $item.removeClass('is-correct is-incorrect');\r\n    }\r\n\r\n    /**\r\n     * Note: hidden feature.\r\n     * If the user thinks the 'X' over the input is a button, they may try to click it.\r\n     * Have the action simply clear the input field if they do (since the X is there, it means it's wrong anyway). \r\n     */\r\n    onIncorrectIconClick(event) {\r\n      let index = $(event.currentTarget).attr(\"data-adapt-index\");\r\n      this.clearItemState(index);\r\n    }\r\n\r\n  }\r\n\r\n  return TextInputPlusView;\r\n\r\n});\r\n","define([\r\n  'core/js/models/questionModel'\r\n], function(QuestionModel) {\r\n\r\n  var TextInputPlusModel = QuestionModel.extend({\r\n\r\n    init: function() {\r\n      QuestionModel.prototype.init.call(this);\r\n\r\n      this.set( '_genericAnswerIndexOffset', TextInputPlusModel.genericAnswerIndexOffset );\r\n\r\n      this.setupQuestionItemIndexes();\r\n      this.setUpQuestionItemInputWidths();\r\n\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    /**\r\n     * New feature:\r\n     * Make the widths of the all the inputs the same; and have that width be = to the largest _answer they accept.\r\n     */\r\n    setUpQuestionItemInputWidths: function() {\r\n\r\n      let maxAnswerLength = 0;\r\n      let inputWidthExtra = this.get(\"_inputWidthExtra\") || 2; // Add some extra space for characters if specified.\r\n\r\n      _.each(this.get('_items'), (item) => {\r\n        _.each(item._answers, (answer) => {\r\n\r\n          let answerLength = String(answer).length;\r\n          if (answerLength > maxAnswerLength) {\r\n            maxAnswerLength = answerLength;\r\n          }\r\n        });\r\n      });\r\n\r\n      maxAnswerLength += inputWidthExtra;\r\n\r\n      // Set the width on the items (it will be passed to the {{#inputFields}} in the .hbs).\r\n      _.each(this.get(\"_items\"), (item) => {\r\n        item._inputWidth = maxAnswerLength;\r\n      });\r\n\r\n      /*this.$(\".textinputplus__item-textbox-container\").css({\r\n        \"flex-basis\": (maxAnswerLength) + \"em\"\r\n      });\r\n      // Cap the amount of characters the user can enter into the input.\r\n      // FIXME: Temp?\r\n      this.$(\".textinputplus__item-textbox\").attr(\"maxlength\", Math.ceil(maxAnswerLength * 1.5));*/\r\n    },\r\n\r\n    setupQuestionItemIndexes: function() {\r\n\r\n      this.get('_items').forEach(function(item, index) {\r\n\r\n        if (item._index === undefined) item._index = index;\r\n        if (item._answerIndex === undefined) item._answerIndex = -1;\r\n      });\r\n    },\r\n\r\n    restoreUserAnswers: function() {\r\n      if (!this.get('_isSubmitted')) return;\r\n\r\n      var userAnswer = this.get('_userAnswer');\r\n      var genericAnswers = this.get('_answers');\r\n      this.get('_items').forEach(function(item) {\r\n        var answerIndex = userAnswer[item._index];\r\n        if (answerIndex >= TextInputPlusModel.genericAnswerIndexOffset) {\r\n          item.userAnswer = genericAnswers[answerIndex - TextInputPlusModel.genericAnswerIndexOffset];\r\n          item._answerIndex = answerIndex;\r\n        } else if (answerIndex > -1) {\r\n          item.userAnswer = item._answers[answerIndex];\r\n          item._answerIndex = answerIndex;\r\n        } else {\r\n          if (item.userAnswer === undefined) item.userAnswer = '******';\r\n          item._answerIndex = -1;\r\n        }\r\n        if (item.userAnswer instanceof Array) item.userAnswer = item.userAnswer[0];\r\n      });\r\n\r\n      this.setQuestionAsSubmitted();\r\n      this.markQuestion();\r\n      this.setScore();\r\n      this.setupFeedback();\r\n    },\r\n\r\n    setupRandomisation: function() {\r\n      if (!this.get('_isRandom') || !this.get('_isEnabled')) return;\r\n\r\n      this.set('_items', _.shuffle(this.get('_items')));\r\n    },\r\n\r\n    // Use to check if the user is allowed to submit the question\r\n    canSubmit: function() {\r\n      // can submit if every item has user input\r\n      return this.get('_items').every(({ userAnswer }) => userAnswer);\r\n    },\r\n\r\n    setItemUserAnswer:function(itemIndex, userAnswer) {\r\n      var item = this.get('_items')[itemIndex];\r\n      item.userAnswer = userAnswer;\r\n      this.checkCanSubmit();\r\n    },\r\n\r\n    //This preserve the state of the users answers for returning or showing the users answer\r\n    storeUserAnswer: function() {\r\n      var items = this.get('_items');\r\n\r\n      this.isCorrect();\r\n\r\n      var userAnswer = new Array( items.length );\r\n      items.forEach(function(item, index) {\r\n        userAnswer[ item._index ] = item._answerIndex;\r\n      });\r\n      this.set('_userAnswer', userAnswer);\r\n    },\r\n\r\n    isCorrect: function() {\r\n\r\n      // InputFields\r\n      // ----------------------------------------\r\n      // New: trigger a submit on all inputFields (if they're being used).\r\n      this.get('_items').forEach((item) => {\r\n        if (item._inputFieldModel) {\r\n          item._inputFieldModel.submit();\r\n        }\r\n      });\r\n\r\n      if (this.get('_answers')) {\r\n        this.markGenericAnswers();\r\n      } else {\r\n        this.markSpecificAnswers();\r\n      }\r\n      // do we have any _isCorrect == false?\r\n      return !_.contains(_.pluck(this.get('_items'), '_isCorrect'), false);\r\n    },\r\n\r\n    isPartlyCorrect: function() {\r\n      return this.get('_isAtLeastOneCorrectSelection');\r\n    },\r\n\r\n    // Allows the learner to give answers into any input, ignoring the order.\r\n    // (this excludes any inputs which have their own specific answers).\r\n    markGenericAnswers: function() {\r\n      var numberOfCorrectAnswers = 0;\r\n      var correctAnswers = this.get('_answers').slice();\r\n      var usedAnswerIndexes = [];\r\n\r\n      this.get('_items').forEach(function(item) {\r\n        correctAnswers.forEach(function(answerGroup, answerIndex) {\r\n          if (_.indexOf(usedAnswerIndexes, answerIndex) > -1) return;\r\n\r\n          if (this.checkAnswerIsCorrect(answerGroup, item.userAnswer) == false) return;\r\n\r\n          usedAnswerIndexes.push(answerIndex);\r\n          item._isCorrect = true;\r\n          item._answerIndex = answerIndex + TextInputPlusModel.genericAnswerIndexOffset;\r\n\r\n          this.set({\r\n            _numberOfCorrectAnswers: ++numberOfCorrectAnswers,\r\n            _isAtLeastOneCorrectSelection: true\r\n          });\r\n\r\n        }, this);\r\n        if(!item._isCorrect) item._isCorrect = false;\r\n      }, this);\r\n    },\r\n\r\n    // Marks any items which have answers specific to it\r\n    // (i.e. item has a _answers array)\r\n    markSpecificAnswers: function() {\r\n\r\n      var numberOfCorrectAnswers = 0;\r\n      this.get('_items').forEach(function(item) {\r\n\r\n        // InputField (new)\r\n        // --------------------------------------\r\n        // If using the inputField helper, check whether it considers itself correct instead.\r\n        if (item._inputFieldModel) {\r\n          let isCorrect = item._inputFieldModel.isCorrect();\r\n\r\n          if (isCorrect) {\r\n            item._isCorrect = true;\r\n            item._answerIndex = item._inputFieldModel.getAnswerIndex();\r\n\r\n            this.set({\r\n              _numberOfCorrectAnswers: ++numberOfCorrectAnswers,\r\n              _isAtLeastOneCorrectSelection: true\r\n            });\r\n          }\r\n          else {\r\n            item._isCorrect = false;\r\n            item._answerIndex = -1;\r\n          }\r\n\r\n          return;\r\n        }\r\n\r\n        // Legacy\r\n        // --------------------------------------\r\n        if (!item._answers) return;\r\n        var userAnswer = item.userAnswer || '';\r\n        if (this.checkAnswerIsCorrect(item._answers, userAnswer)) {\r\n          item._isCorrect = true;\r\n          item._answerIndex = _.indexOf(item._answers, this.cleanupUserAnswer(userAnswer));\r\n          this.set({\r\n            _numberOfCorrectAnswers: ++numberOfCorrectAnswers,\r\n            _isAtLeastOneCorrectSelection: true\r\n          });\r\n        } else {\r\n          item._isCorrect = false;\r\n          item._answerIndex = -1;\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    checkAnswerIsCorrect: function(possibleAnswers, userAnswer) {\r\n      var uAnswer = this.cleanupUserAnswer(userAnswer);\r\n      var matched = possibleAnswers.filter(function(cAnswer) {\r\n        return this.cleanupUserAnswer(cAnswer) == uAnswer;\r\n      }, this);\r\n\r\n      var answerIsCorrect = matched && matched.length > 0;\r\n      if (answerIsCorrect) this.set('_hasAtLeastOneCorrectSelection', true);\r\n      return answerIsCorrect;\r\n    },\r\n\r\n    cleanupUserAnswer: function(userAnswer) {\r\n      if (this.get('_allowsAnyCase')) {\r\n        userAnswer = userAnswer.toLowerCase();\r\n      }\r\n      if (this.get('_allowsPunctuation')) {\r\n        userAnswer = userAnswer.replace(/[\\.,-\\/#!$%\\^&\\*;:{}=\\-_`~()]/g, '');\r\n        //remove any orphan double spaces and replace with single space (B & Q)->(B  Q)->(B Q)\r\n        userAnswer = userAnswer.replace(/(  +)+/g, ' ');\r\n      }\r\n      // removes whitespace from beginning/end (leave any in the middle)\r\n      return $.trim(userAnswer);\r\n    },\r\n\r\n    // Used to set the score based upon the _questionWeight\r\n    setScore: function() {\r\n      var numberOfCorrectAnswers = this.get('_numberOfCorrectAnswers');\r\n      var questionWeight = this.get('_questionWeight');\r\n      var itemLength = this.get('_items').length;\r\n\r\n      var score = questionWeight * numberOfCorrectAnswers / itemLength;\r\n\r\n      this.set('_score', score);\r\n    },\r\n\r\n    resetUserAnswer: function() {\r\n      this.get('_items').forEach(function(item) {\r\n        item._isCorrect = false;\r\n        item.userAnswer = '';\r\n      });\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the user's answers in the format required by the cmi.interactions.n.student_response data field\r\n    * returns the user's answers as a string in the format 'answer1[,]answer2[,]answer3'\r\n    * the use of [,] as an answer delimiter is from the SCORM 2004 specification for the fill-in interaction type\r\n    */\r\n    getResponse: function() {\r\n      return _.pluck(this.get('_items'), 'userAnswer').join('[,]');\r\n    },\r\n\r\n    /**\r\n    * used by adapt-contrib-spoor to get the type of this question in the format required by the cmi.interactions.n.type data field\r\n    */\r\n    getResponseType: function() {\r\n      return 'fill-in';\r\n    }\r\n  }, {\r\n    genericAnswerIndexOffset: 65536\r\n  });\r\n\r\n  return TextInputPlusModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './textInputPlusView',\r\n  './textInputPlusModel',\r\n], function(Adapt, TextInputPlusView, TextInputPlusModel) {\r\n\r\n  return Adapt.register('textinputplus', {\r\n    view: TextInputPlusView,\r\n    model: TextInputPlusModel\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView',\r\n  'libraries/codemirror/lib/codemirror',\r\n  'libraries/codemirror/mode/htmlmixed/htmlmixed'\r\n], function(Adapt, ComponentView, CodeMirror) {\r\n\r\n  class TryHtmlView extends ComponentView {\r\n\r\n    events() {\r\n      return {\r\n        \"click .js-tryhtml-ui-update\" :     \"onUpdateClick\",\r\n        \"click .js-tryhtml-ui-toggleanswer\" : \"onToggleAnswerClick\",\r\n        \"mouseup .js-tryhtml-content-user\": \"onCodeMirrorUp\"\r\n      }\r\n    }\r\n\r\n    initialize() {\r\n      this.setUpModelData();\r\n      ComponentView.prototype.initialize.call(this);\r\n    }\r\n\r\n    setUpModelData() {\r\n      this.model.set(\"_tryHtml\", Adapt.course.get(\"_tryHtml\"));\r\n      this.model.set(\"_isShowingAnswer\", false);\r\n    }\r\n\r\n    setUpEventListeners() {\r\n\r\n      this.listenTo(this.model, \"change:_isShowingAnswer\", this.onShowingAnswerChange);\r\n\r\n      this.$(\".js-tryhtml-iframe-user\").on(\"load\", this.onIframeUserLoad.bind(this));\r\n      this.$(\".js-tryhtml-iframe-correct\").on(\"load\", this.onIframeCorrectLoad.bind(this));\r\n    }\r\n\r\n    preRender() {\r\n      \r\n    }\r\n\r\n    postRender() {\r\n\r\n      let lang = this.model.get(\"_lang\"); // Allow for specific languages to be specified in the JSONSynt.\r\n      let mode = \"htmlmixed\";\r\n      \r\n      switch (lang) {\r\n\r\n        case \"html\":\r\n          mode = \"htmlmixed\";\r\n          break;\r\n\r\n        case \"css\":\r\n        case \"xml\":\r\n        case \"php\":\r\n          mode = lang;\r\n          break;\r\n        \r\n        case \"js\":\r\n          mode = \"javascript\";\r\n          break;\r\n\r\n        default:\r\n          Adapt.log.error(\"tryHtmlView.js: \\\"_lang\\\" cannot be \\\"\" + lang + \"\\\" (this language is not implemented).\");\r\n      }\r\n\r\n      this.codeMirror = CodeMirror.fromTextArea(this.$(\".js-tryhtml-content-textarea\")[0], {\r\n        theme:      \"prettify\", // Custom theme override to match CodeBox syntax highlighting.\r\n        tabSize: 2,\r\n        tabUnit: 2,\r\n        lineWrapping: true,\r\n        resetSelectionOnContextMenu: false,\r\n        //viewportMargin: Infinity,\r\n        mode: mode\r\n      });\r\n\r\n      /**\r\n       * BUGFIX:\r\n       * ---------------\r\n       * In codemirror.js, on line 9616, there is a window.scrollTo() call. Adapt has overridden this function, and codemirror calling\r\n       * it unintentionally causes the entire page to scroll to the top (due to window.scrollY being equal to 0) when the user \r\n       * opens the context menu.\r\n       * \r\n       * Unfortunately, this call to windows.scrollTo() can't be prevented, but it can be tricked to instead scroll nowhere.\r\n       * To resolve this, window.scrollY is explicitly set (giving codemirror.js the correct value to scroll to).\r\n       */\r\n      this.codeMirror.on(\"contextmenu\", (codeMirror, event) => {\r\n        let scrollY = Adapt.scrolling.$app.scrollTop() || Adapt.scrolling.$html.scrollTop();\r\n        window.scrollY = scrollY;\r\n      });\r\n\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    /**\r\n     * Performs any \"_onSubmit\" modifiers on the provided HTML and returns it.\r\n     * @param {*} html \r\n     */\r\n    setUpIframeHTML(_html) {\r\n      \r\n      let html = _html;\r\n      let onSubmit = this.model.get(\"_onSubmit\");\r\n\r\n      html = (onSubmit?.prepend || \"\") + html + (onSubmit?.append || \"\");\r\n\r\n      // EPUB functionality. Prepend a comment that will tell the html2xhtml.js script to ignore this html when validating it for XHTML.\r\n      if (Adapt.isEpubMode()) { \r\n        html = \"<!--!IGNORE-XHTML!-->\" + html;\r\n      }\r\n\r\n      return html;\r\n    }\r\n\r\n    /**\r\n     * Whenever the user clicks the update button, update the iframe with their current code.\r\n     */\r\n    onUpdateClick(event) {\r\n\r\n      // Don't allow updating the user code while the update button is disabled.\r\n      if (this.model.get(\"_isShowingAnswer\")) return;\r\n\r\n      // Scroll the output box into view.\r\n      Adapt.navigateToElement(this.$(\".js-tryhtml-iframe-container\"), {\r\n        duration: 400,\r\n        align: \"inview\"\r\n      });\r\n\r\n      let $iframe = this.$(\".js-tryhtml-iframe-user\");\r\n      $iframe.fadeOut(() => {\r\n\r\n        // Prepend and append the \"_after\" values.\r\n        let html = this.setUpIframeHTML(this.codeMirror.getValue());\r\n        $iframe.contents().find(\"body\").html(html);\r\n      });\r\n      $iframe.fadeIn();\r\n    }\r\n\r\n    onShowingAnswerChange(model, isShowingAnswer) {\r\n\r\n      // Scroll the answer/input element into view.\r\n      Adapt.navigateToElement(this.$(\".js-tryhtml-content-correct\"), {\r\n        duration: 400,\r\n        align: \"inview\"\r\n      });\r\n\r\n      this.$(\".js-tryhtml-widget\").toggleClass(\"show-correct-answer\");\r\n\r\n      let tryHtml = this.model.get(\"_tryHtml\");\r\n\r\n      this.$(\".js-tryhtml-ui-title\")\r\n        .text(!isShowingAnswer ? tryHtml._user.title : tryHtml._correct.title);\r\n      \r\n      this.$(\".js-tryhtml-ui-toggleanswer\")\r\n        .text(isShowingAnswer ? tryHtml._user.buttonText : tryHtml._correct.buttonText);\r\n\r\n      this.$(\".js-tryhtml-ui-update\")\r\n        .text(isShowingAnswer ? tryHtml._update.disabledText : tryHtml._update.buttonText)\r\n        .toggleClass(\"is-disabled\", isShowingAnswer);\r\n    }\r\n\r\n    /**\r\n     * Fade in/out the correct code when the user clicks the button.\r\n     */\r\n    onToggleAnswerClick() {\r\n      this.model.set(\"_isShowingAnswer\", !this.model.get(\"_isShowingAnswer\"));\r\n    }\r\n\r\n    /**\r\n     * Set up initial view for the user-input iframe\r\n     * (the one which will be updated repeatedly with the user's input).\r\n     */\r\n    onIframeUserLoad() {\r\n      // The content can start once the iframe has loaded.\r\n      this.setReadyStatus();\r\n\r\n      let $iframe = this.$(\".js-tryhtml-iframe-user\");\r\n      $iframe.contents().find(\"body\").html(this.setUpIframeHTML(this.model.get(\"_user\").output));\r\n    }\r\n\r\n    onIframeCorrectLoad() {\r\n      let $iframe = this.$(\".js-tryhtml-iframe-correct\");\r\n      let height = $iframe.contents()\r\n                    .find(\"body\")\r\n                    .html(this.setUpIframeHTML(this.model.get(\"_correct\").output))\r\n                    .parent().height();\r\n\r\n      // Set the height of both iframe elements based on the height of the correct output.\r\n      this.$(\".js-tryhtml-iframe-container\").height(height + 40);\r\n    }\r\n\r\n    //#region Bugfix: CodeMirror often loses focus when initially clicked if this isn't added.\r\n    onCodeMirrorUp(event) {\r\n\r\n      // FIXME: This needs to be done.\r\n      // Bugfix: right clicking on the TextArea (for some reason) scrolls the page to the very top (in Chrome). This prevents that.\r\n      \r\n      _.delay(() => {\r\n        this.codeMirror.focus();\r\n      }, 1);\r\n    }\r\n    //#endregion\r\n  }\r\n  \r\n  TryHtmlView.template = \"tryHtml\";\r\n  return TryHtmlView;\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/models/componentModel'\r\n], function(Adapt, ComponentModel) {\r\n\r\n  class TryHtmlModel extends ComponentModel {\r\n\r\n    // Used to set model defaults\r\n    defaults() {\r\n\r\n      // Extend from the ComponentModel defaults\r\n      return ComponentModel.resultExtend('defaults', {\r\n        \r\n      });\r\n    }\r\n\r\n    initialize() {\r\n\r\n      // Allow for custom languages to be used; but set to default \"html\" if none provided.\r\n      if (this.get(\"_lang\") === undefined) {\r\n        this.set(\"_lang\", \"html\");\r\n      }\r\n\r\n      // If in EPUB mode, need to throw an error (the CodeMirror plugin uses uppercase classnames, which Bookshelf may reject).\r\n      if (Adapt.config.get(\"_isEpub\")){\r\n        Adapt.log.error(\"tryHtml: CodeMirror plugin uses capitals in its classnames. Check that they still work with the EPUB reader.\");\r\n      }\r\n\r\n      this.setUpModelData();\r\n\r\n      ComponentModel.prototype.initialize.call(this);\r\n      this.setUpEventListeners();\r\n    }\r\n\r\n    setUpModelData() {\r\n\r\n      // Add the tryThis logo to this component (using the adapt-dd-componentLogo extension).\r\n      this.set(\"_componentLogo\", {\r\n          src: \"assets/trythis-logo.svg\"\r\n      });\r\n\r\n      // Process the provided HTML code.\r\n      let s = Adapt.codeBox.toString(this.get(\"_user\").code);\r\n      this.get(\"_user\").code = s;\r\n\r\n      s = s.replace(/&lt;/g, \"<\");\r\n      s = s.replace(/&gt;/g, \">\");\r\n      this.get(\"_user\").output = s;\r\n\r\n      s = Adapt.codeBox.toString(this.get(\"_correct\").code);\r\n      s = s.replace(/&lt;/g, \"<\");\r\n      s = s.replace(/&gt;/g, \">\");\r\n      this.get(\"_correct\").output = s;\r\n    }\r\n\r\n    setUpEventListeners() {\r\n\r\n    }\r\n  }\r\n\r\n  return TryHtmlModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './tryHtmlView',\r\n  './tryHtmlModel'\r\n], function(Adapt, TryHtmlView, TryHtmlModel) {\r\n\r\n  return Adapt.register('tryhtml', {\r\n    model: TryHtmlModel,\r\n    view: TryHtmlView\r\n  });\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'components/adapt-contrib-accordion/js/adapt-contrib-accordion'\r\n], function(Adapt, Accordion) {\r\n\r\n  // FIXME: View needs improvements (just a crude modification of Accordion View for now).\r\n\r\n  let TryThisView = Accordion.view.extend({\r\n\r\n    postRender: function() {\r\n      Accordion.view.prototype.postRender.call(this);\r\n    }\r\n\r\n  }, {\r\n    template: 'tryThis'\r\n  });\r\n\r\n  let TryThisModel = Accordion.model.extend({\r\n    \r\n    initialize: function() {\r\n\r\n      // Add the tryThis logo to this component (using the adapt-dd-componentLogo extension).\r\n      this.set(\"_componentLogo\", {\r\n          src: \"assets/trythis-logo.svg\"\r\n      });\r\n\r\n      // Apply the values in \"_reflect\" as the only \"_item\" for the Accordion component that TryThis inherited.\r\n      let reflect = this.get(\"_reflect\");\r\n\r\n      if (reflect) {\r\n        this.set(\"_items\", [\r\n          {\r\n            title: \"Reflect\",\r\n            body: reflect?.body || \"\"\r\n          }\r\n        ]);\r\n      }\r\n      else {\r\n        this.set(\"_items\", []);\r\n      }\r\n\r\n      Accordion.model.prototype.initialize.call(this);\r\n    }\r\n  });\r\n\r\n  return Adapt.register('trythis', {\r\n    model: TryThisModel,\r\n    view: TryThisView\r\n  });\r\n\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * FIXME:\r\n     * Possible bug: it's possible that if an annotationView has targets in a component that's very slow to render,\r\n     * that the initTargets function will trigger before all targets are ready.\r\n     */\r\n\r\n    class AnnotationView extends Backbone.View {\r\n\r\n        className() {\r\n            let classNames = [\r\n                \"annotation\",\r\n                \"js-annotation-click\",\r\n                this.model.get(\"_hasIcon\") ? \"has-icon\" : \"\",\r\n                this.model.get(\"_tooltip\") ? \"has-tooltip\" : \"\"\r\n            ]\r\n            return classNames.join(\" \");\r\n        }\r\n\r\n        tagName() {\r\n            return \"span\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click\" : \"onClick\"\r\n            }\r\n        }\r\n        \r\n        attributes() {\r\n\r\n            let attributes = {\r\n                \"data-annotation-num\": this.model.get(\"_number\")\r\n            };\r\n\r\n            return attributes;\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setupEventListeners();\r\n            _.debounce(this.initTargets.bind(this))(); // Debounce to allow for all mark elements to be rendered first.\r\n            this.render();\r\n        }\r\n\r\n        setupEventListeners(){\r\n\r\n            this.listenTo(this.model, \"change:_isActive\", this.onActiveChange);\r\n            this.listenTo(this.model, \"change:_isVisited\", this.onVisitedChange);\r\n\r\n            Adapt.on(\"annotation:toggle\", this.onAdaptAnnotationToggle.bind(this));\r\n        }\r\n\r\n        initTargets(){\r\n            let $targets = this.$getForTargets();\r\n            \r\n            $targets\r\n            .addClass(\"is-annotation-target\")\r\n            .attr(\"data-annotation-num\", this.model.get(\"_number\"));\r\n\r\n            // PDF mode\r\n            if (Adapt.isPDFMode()) {\r\n                $targets.addClass(\"is-active\");\r\n            }\r\n        }\r\n\r\n        render(){\r\n            let template = Handlebars.templates['annotation'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            if (Adapt.isPDFMode()) this.renderTooltipFallback();\r\n        }\r\n\r\n        /**\r\n         * Render the tooltip for this annotation in the nearest .tooltip-fallback element after this one.\r\n         * FIXME: Will only work inside of a component.\r\n         */\r\n        async renderTooltipFallback() {\r\n            let tooltip = this.model.get(\"_tooltip\");\r\n            if (!tooltip) return;\r\n\r\n            // FIXME: Need a proper way to await for HelperEl's to render.\r\n            // FIXME: The way that the tooltipFallback is being found is quite arbitrary at the moment.\r\n            _.debounce(() => {\r\n                let componentView = Adapt.findViewByModelId(this.model.get(\"_parent\").get(\"_id\"));\r\n                let $tooltipFallback = componentView.$(\".tooltip-fallback\");\r\n                if (!$tooltipFallback.length) { \r\n                    throw \"AnnotationView: Could not find a {{{tooltipFallback}}} element in component \\\"\" + this.model.get(\"_parent\").get(\"_id\") + \"\\\" (required for PDF mode).\";\r\n                }\r\n                \r\n                $tooltipFallback.append(\"<div class='tooltip-fallback__item' data-annotation-num='\" + this.model.get(\"_number\") + \"'>\" + tooltip + \"</div>\");\r\n            }, 0)();\r\n        }\r\n\r\n        onClick(){\r\n            this.toggle();\r\n\r\n            // FIXME: Tooltip activation should be the in the active event, not on the click event.\r\n            if (!this.model.get(\"_isActive\")) return;\r\n            \r\n            // Allow the annotation to also create adapt-tooltip extension popups over itself when clicked.\r\n            let tooltip = this.model.get(\"_tooltip\");\r\n            if (tooltip) {\r\n                let tooltipPopupView = Adapt.createTooltip(this.$el, {\r\n                    content: tooltip,\r\n                    _type: \"annotation\"\r\n                });\r\n                this.tooltipPopupView = tooltipPopupView;\r\n\r\n                this.listenToOnce(tooltipPopupView.model, \"change:_isActive\", () => {this.model.set(\"_isActive\", false);});\r\n            }\r\n        }\r\n\r\n        toggle(){\r\n\r\n            // Change the model value and...\r\n            this.model.set(\"_isActive\", !this.model.get(\"_isActive\"));\r\n\r\n            // ...deactivate ALL the other annotations with _toggleEnabled == true.\r\n            Adapt.trigger(\"annotation:toggle\", this.model);\r\n\r\n            /*_.each(models, function(annotationModel){\r\n                \r\n                if (annotationModel == this.model) return; // Don't toggle yourself though.\r\n                if (!annotationModel.get(\"_toggleEnabled\")) return;\r\n                annotationModel.deactivate();\r\n            }.bind(this));*/\r\n        }\r\n\r\n        /**\r\n         * Whenever another AnnotationModel becomes active, deactivate this one.\r\n         * @param {*} model \r\n         */\r\n        onAdaptAnnotationToggle(model) {\r\n            \r\n            if (model == this.model) return; // Ignore self triggers.\r\n            this.model.set(\"_isActive\", false);\r\n        }\r\n\r\n        onVisitedChange(model, isVisited){\r\n            if (!isVisited) return;\r\n            this.$el.addClass(\"is-visited\");\r\n        }\r\n\r\n        /**\r\n         * Find and return a jQuery object selecting all _for elements.\r\n         * Will search for all elements in the entire parent .block / .notify of the annotation.\r\n         */\r\n        $getForTargets() {\r\n            var _for = this.model.get(\"_for\");\r\n            var $for = $();\r\n\r\n            if (_for) {\r\n                let $container = this.$el.closest(\".block, .notify\");\r\n                if (!$container.length) {\r\n                    Adapt.log.error(\"adapt-annotation: could not find closest .block / .notify element.\", \"Content: \" + this.model.get(\"content\"));\r\n                    return $for;\r\n                }\r\n                \r\n                _.each(_for, (forName) => {\r\n\r\n                    let $f = $for.add($container.find(\"[name='\" + forName + \"']\"));\r\n\r\n                    // Check if the element being toggled exists.\r\n                    if (!$f.length) {\r\n                        Adapt.log.error(\"adapt-annotation: Could not find element with name=\\\"\" + forName + \"\\\" inside its componentView (\" + this.model.get(\"_parent\").get(\"_id\") + \").\");\r\n                    }\r\n\r\n                    $for = $for.add($f);\r\n                });\r\n            }\r\n\r\n            return $for;\r\n        }\r\n\r\n        onActiveChange(model, isActive){\r\n\r\n            // Toggle the active + visited classes on the button.\r\n            this.$el.toggleClass(\"is-active\", isActive);\r\n            if (isActive) {this.model.set(\"_isVisited\", true);}\r\n\r\n            // Toggle all _for elements.\r\n            let $forTargets = this.$getForTargets();\r\n            if (!$forTargets.length) return;\r\n\r\n            Adapt.annotation.toggleEl($forTargets, isActive);\r\n        \r\n            /**\r\n             * Ensure the user sees the annotations by scrolling them into view.\r\n             */\r\n            if (!isActive) {\r\n                if (this.tooltipPopupView) this.tooltipPopupView.remove(); // Remove the tooltip (if it exists).\r\n                $(document).off(\"click touch\", this.onClickAnywhereEvent); // Remove the global event this made.\r\n                return;\r\n            }\r\n\r\n            // Listen for a click anywhere to close it.\r\n            _.debounce(() => {\r\n                // The user clicking anywhere is enough to close the tooltip popup.\r\n                this.onClickAnywhereEvent = this.onClickAnywhere.bind(this);\r\n                $(document).one(\"click touch\", this.onClickAnywhereEvent);\r\n            })();\r\n        }\r\n\r\n        onClickAnywhere(event) {\r\n\r\n            //let innerEl = this.$(\".annotation__inner\")[0];\r\n            //if (event.target == innerEl || $.contains(innerEl, event.target)) return; // Clicks on or inside annotation.\r\n            \r\n            // Check if the click was on one of the targets that this annotation activates.\r\n            let $target = $(event.target);\r\n            if ($target.closest(\".is-annotation-target.is-active\").length) return;\r\n\r\n            this.model.set(\"_isActive\", false);\r\n        }\r\n    };\r\n\r\n    return AnnotationView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './annotationView'\r\n], function(Handlebars, Adapt, AnnotationView) {\r\n\r\n    /**\r\n     * adapt-annotation\r\n     * --------------------------------------\r\n     * This extension sets up resource buttons in the content to show fullscreen popup resources.\r\n     * \r\n     * TODO:\r\n     *  - May be changed to being a normal Component; depends on how frequently it's seen inside of other Components.\r\n     * \r\n     * FIXME:\r\n     * - Won't work if the resource is inside of another fullscreen reveal (like a HotgraphicPlus).\r\n     * - A bit tedious to use (needs a partial to work).\r\n     */\r\n\r\n    // Helpers\r\n    // ---------------------\r\n    \r\n    /**\r\n     * Use these to create the inline tags for the resource button.\r\n     * \r\n     * Note:\r\n     * -----\r\n     * Using Handlebars fixes the issue previous extensions developed for DD had, that being that\r\n     * they couldn't be used inside of dynamically generated HTML (like inside of a popup for example).\r\n     * Now, whenever the Handlebars is compiled, it knows to create the appropriate View for the thing.\r\n     * Plus, it keeps the components.json tidy and consistant to use Handlebars expressions for such things.\r\n     * (And no need for custom HTML tags).\r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * Had to use a weird workaround to get this one working. Monitor for possible bugs.\r\n     */\r\n\r\n    class Annotation extends Backbone.Controller {\r\n\r\n        initialize() {\r\n            Adapt.on('router:page', this.onRouterPage);\r\n            this.initHelpers();\r\n        }\r\n\r\n        onRouterPage() {\r\n\r\n            let annotationNum = 1; // Give each annotation in the unit a unique number (used by PDF mode).\r\n\r\n            // Annotation\r\n            // --------------------------------------------------\r\n            Handlebars.registerHelperEl(\"annotation\", function() {\r\n\r\n                let context = arguments[arguments.length-1];\r\n                let hash = context.hash;\r\n\r\n                // Find the componentModel that this Helper was placed in.\r\n                /*let componentModel = Handlebars.getComponentModelFromContext(context);\r\n                console.log(componentModel);*/\r\n\r\n                // The \"for\" parameter tells the annotation which elements it will activate.\r\n                if (!hash.for) {\r\n                    // If no \"for\" value set, check if a tooltip being used.\r\n                    if (!hash.tooltip) {\r\n                        throw \"Annotation must have the \\\"for\\\" and/or \\\"tooltip\\\" parameter defined.\";\r\n                    }\r\n\r\n                    // Annotations shouldn't have icons if they're only for tooltips.\r\n                    if (hash.hasIcon === undefined){\r\n                        hash.hasIcon = false;\r\n                    }\r\n                }\r\n                else {\r\n                    // Annotations should always have icons if they have \"for\" targets.\r\n                    if (hash.hasIcon === undefined){\r\n                        hash.hasIcon = true;\r\n                    }\r\n                }\r\n\r\n                let modelJSON = {\r\n                    content: context?.fn ? context.fn(this) : \"\", //context?.fn ? context.fn(this) : \"\",\r\n                    _for: hash.for ? hash.for.split(\",\") : undefined,\r\n                    _tooltip: hash.tooltip,\r\n                    _hasIcon: hash.hasIcon !== false,\r\n                    _number: annotationNum,\r\n                    _parent: Handlebars.getComponentModelFromContext(context)\r\n                };\r\n\r\n                annotationNum++;\r\n\r\n                return new AnnotationView({\r\n                    model: new Backbone.Model(modelJSON)\r\n                }).$el;\r\n            });\r\n        }\r\n\r\n        initHelpers() {\r\n            /**\r\n             * Normal helpers\r\n             */\r\n            var helpers = {\r\n\r\n                // \r\n                // \r\n                /**\r\n                 * Mark <mark>\r\n                 * --------------------------------------------------\r\n                 * @param {string} absolute String defining 4 values for absolutely positioning the mark (in percent; \"LEFT,TOP,WIDTH,HEIGHT\").\r\n                 * @returns HTML string\r\n                 */\r\n                mark: function() {\r\n                    let context = arguments[arguments.length-1];\r\n\r\n                    let data = context.hash || {};\r\n\r\n                    // Allow for absolute positioning of the marks (used to make them overlay images).\r\n                    // FIXME: May be renamed/reworked in future.\r\n                    // FIXME: If an absolute mark is used inside of an img which is inside of a scrollable container, the width will be inaccurate.\r\n                    if (data.absolute) {\r\n                        let vals = data.absolute.split(\",\");\r\n                        if (vals.length < 2) {\r\n                            throw \"{{#mark}} helper: the \\\"absolute\\\" property must have a string value formatted as follows: \\\"LEFT,TOP,WIDTH,HEIGHT\\\".\\n\\nFor example: absolute=\\\"10,10,20,20\\\".\\n\\nYou entered: absolute=\\\"\" + absolute + \"\\\"\";\r\n                        }\r\n                        data.absolute = {\r\n                            left: vals[0].trim() + \"%\",\r\n                            top: vals[1].trim() + \"%\"\r\n                        }\r\n                        if (vals.length >= 3) data.absolute.width = vals[2].trim() + \"%\";\r\n                        if (vals.length >= 4) data.absolute.height = vals[3].trim() + \"%\";\r\n                    }\r\n\r\n                    data._tag = \"mark\";\r\n\r\n                    data = _.extend(\r\n                        {},\r\n                        {content: context.fn?.apply(this)},\r\n                        data\r\n                    );\r\n                    let template = Handlebars.templates['mark'];\r\n\r\n                    return new Handlebars.SafeString(template(data)).string;\r\n                },\r\n\r\n                // MarkBlock <div>\r\n                // --------------------------------------------------\r\n                markBlock: function() {\r\n                    let context = arguments[arguments.length-1];\r\n\r\n                    let data = _.extend({content: context.fn(this)}, context.hash || {}, {_tag: \"div\"});\r\n                    let template = Handlebars.templates['mark'];\r\n\r\n                    return new Handlebars.SafeString(template(data)).string;\r\n                },\r\n\r\n                // Fade <span>\r\n                // --------------------------------------------------\r\n                fade: function() {\r\n                    let context = arguments[arguments.length-1];\r\n\r\n                    let data = _.extend({content: context.fn(this)}, context.hash || {}, {_tag: \"span\"});\r\n                    let template = Handlebars.templates['fade'];\r\n\r\n                    return new Handlebars.SafeString(template(data)).string;\r\n                },\r\n                \r\n                // FadeBlock <div>\r\n                // --------------------------------------------------\r\n                // Block level fading (should NOT be used inline).\r\n                fadeBlock: function() {\r\n                    let context = arguments[arguments.length-1];\r\n\r\n                    let data = _.extend({content: context.fn(this)}, context.hash || {}, {_tag: \"div\"});\r\n                    let template = Handlebars.templates['fade'];\r\n\r\n                    return new Handlebars.SafeString(template(data)).string;\r\n                },\r\n\r\n                // Annotation tooltip fallback\r\n                // --------------------------------------------------\r\n                // If PDF mode is used, tooltips will be rendered into the nearest fallback element.\r\n                // Should always be placed AFTER the annotation it refers to.\r\n                // Note: likely to be renamed in future.\r\n                // FIXME: Only one per component allowed.\r\n                // FIXME: Will not work inside of popups.\r\n                tooltipFallback: function() {\r\n                    let template = Handlebars.templates['tooltipFallback'];\r\n                    return new Handlebars.SafeString(template({})).string;\r\n                }\r\n            }\r\n\r\n            for (var name in helpers) {\r\n                if (helpers.hasOwnProperty(name)) {\r\n                    Handlebars.registerHelper(name, helpers[name]);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Manually \"activates\"/\"deactivates\" the provided $el(s) in exactly the same way that clicking an annotation button would. \r\n         */\r\n        toggleEl($el, isActive) {\r\n\r\n            $el.addClass(\"is-annotation-target\").each((i, e) => {\r\n\r\n                // Toggle it.\r\n                if (!isActive){\r\n                    $(e)\r\n                        .toggleClass(\"is-active\", false)\r\n                        .trigger(\"annotation:inactive\");\r\n                }\r\n                // Ensure de-activations happen before activations.\r\n                // FIXME: Can be done with less _.debounce calls.\r\n                else {\r\n                    _.debounce(() => {\r\n                        $(e)\r\n                            .toggleClass(\"is-active\", true)\r\n                            .trigger(\"annotation:active\");\r\n                    })();\r\n                }\r\n            });\r\n        \r\n            if (!isActive) return;\r\n\r\n            // Scroll the recently toggled element into view.\r\n            Adapt.navigateToElement($el, {\r\n                align: \"inview\",\r\n                scrollNested: true\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    Adapt.annotation = new Annotation();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // FIXME:\r\n    // \"_prevBlockBackground\" implementation works; but has several visual bugs + is crudely implemented.\r\n    // It should do for now, but could really use a rework if time permits.\r\n\r\n    const VIEWPORT_MARGIN = \"15%\"; // Once a group crosses this point in the viewport, its background will appear.\r\n\r\n    class BlockBackgroundView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"blockbg\";\r\n        }\r\n\r\n        initialize() {\r\n\r\n            this.onDeviceResize = _.debounce(this.onDeviceResize.bind(this), 100);\r\n\r\n            this.blockView = Adapt.findViewByModelId(this.model.get(\"_parent\").get(\"_id\"));\r\n            this.blockView.$el.addClass(\"has-blockbg\").toggleClass(\"has-prevblockbg\", Boolean(this.model.get(\"_prevBlockBackground\")));\r\n\r\n            this.setUpItemGraphics();\r\n            this.render();\r\n            this.onDeviceChange();\r\n            this.updateClipMask();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        /**\r\n         * Determing the item graphic to use on the initial load. \r\n         */\r\n        setUpItemGraphics() {\r\n            _.each(this.model.get(\"_items\"), (item, i) => {\r\n                if (!item._graphic) return;\r\n\r\n                item._graphic.src = item._graphic[\"_\" + (Adapt.device.screenSize == \"large\" ? \"large\" : \"small\")];\r\n            });\r\n        }\r\n\r\n        onDeviceChange() {\r\n            this.updateItemGraphics();\r\n        }\r\n\r\n        onDeviceResize() {\r\n            this.updateClipMask();\r\n        }\r\n\r\n        /**\r\n         * Whenever the device is resized, update the CSS clip style on this element.\r\n         * \r\n         * Explanation:\r\n         * ------------\r\n         * Without the clipping mask, the 'position: fixed' .js-blockbg-item elements within it will \r\n         * overflow its borders (this happens regardless of whether overflow: hidden is applied or not).\r\n         * \r\n         * Using a clipping mask seems to fix this.\r\n         */\r\n        updateClipMask() {\r\n\r\n            if (!this.model.get(\"_isInview\")) return; // Don't do anything if not inview (the user won't see it anyway).\r\n\r\n            let coords = [\r\n                \"0\",                        // Top\r\n                \"100vw\",                    // Right\r\n                this.$el.height() + \"px\",   // Bottom\r\n                \"0\"                         // Left\r\n            ]\r\n\r\n            this.$el.css(\"clip\", `rect(${coords.join(\",\")})`);\r\n        }\r\n\r\n        updateItemGraphics() {\r\n\r\n            _.each(this.model.get(\"_items\"), (item, i) => {\r\n\r\n                let $item = this.$(\".js-blockbg-item\").filter(\"[data-adapt-index=\" + i + \"]\");\r\n                let $group = this.blockView.$(\".js-blockbg-group-img\").filter(\"[data-adapt-index=\" + i + \"]\");\r\n                let url = \"url(\" + item._graphic[\"_\" + (Adapt.device.screenSize == \"large\" ? \"large\" : \"small\")] + \")\";\r\n\r\n                $item.css(\"background-image\", url);\r\n                $group.css(\"background-image\", url);\r\n            });\r\n        }\r\n\r\n        render() {\r\n\r\n            let modelJSON = this.model.toJSON();\r\n\r\n            // Render background elements.\r\n            let template = Handlebars.templates['blockBackground'];\r\n            this.$el.html(new Handlebars.SafeString(template(modelJSON)).string);\r\n            this.blockView.$el.prepend(this.$el);\r\n\r\n            // Render groups.\r\n            template = Handlebars.templates['blockBackgroundGroups'];\r\n            this.blockView.$(\".component__container\").prepend(new Handlebars.SafeString(template(modelJSON)).string);\r\n        }\r\n\r\n        setUpEventListeners() {\r\n\r\n            this.listenTo(this.model, \"change:_activeItemIdx\", this.onActiveItemIdxChange.bind(this));\r\n            this.listenTo(this.model, \"change:_isInview\", this.onIsInviewChange.bind(this));\r\n            \r\n            let prevBlockBackground = this.model.get(\"_prevBlockBackground\");\r\n            if (prevBlockBackground) {\r\n                this.listenTo(prevBlockBackground, \"change:_isInview\", this.onPrevBlockBackgroundIsInviewChange.bind(this));\r\n            }\r\n            \r\n            this.listenTo(Adapt, \"device:changed\", this.onDeviceChange);\r\n            this.listenTo(Adapt, \"device:resize\", this.onDeviceResize);\r\n\r\n            this.setUpObservers();\r\n        }\r\n\r\n        /**\r\n         * Whenever this blockBackground is inview in any way, isInview == true.\r\n         */\r\n        onIsInviewChange(model, isInview) {\r\n            \r\n            // Perform an update to the clipmask as soon as this element becomes visible again.\r\n            if (isInview) this.updateClipMask();\r\n\r\n            let $items = this.$(\".js-blockbg-item\");\r\n            \r\n            let prevBlockBackground = this.model.get(\"_prevBlockBackground\");\r\n\r\n            // If the previous block has a blockBackground, then show this blockBackground in a different way.\r\n            if (prevBlockBackground) {\r\n                \r\n                // When coming into view, hide all background items.\r\n                // The onGroupInview callback will unhide the appropriate item once the user scrolls down a bit further.\r\n                if (isInview) {\r\n                    if (prevBlockBackground.get(\"_isInview\")) {\r\n                        $items.removeClass(\"is-active\").addClass(\"is-hidden\");\r\n                    }\r\n                    else {\r\n                        $items.removeClass(\"is-hidden\");\r\n                    }\r\n                    $items.toggle(isInview);\r\n                }\r\n                // When going out of view, fade out smoothly if the prevBlockBackground is inview.\r\n                // Otherwise, hide instantly as normal.\r\n                else {\r\n                    if (!prevBlockBackground.get(\"_isInview\")) {\r\n                        // If this blockBackground has a prevBlockBackground, only hide its items once both it and the pbb have !_isInview\r\n                        $items.toggle(false);\r\n                    }\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            $items.toggle(isInview);\r\n        }\r\n\r\n        /**\r\n         * If this blockBackground has a prevBlockBackground, only hide its items once both it and the pbb have !_isInview\r\n         */\r\n        onPrevBlockBackgroundIsInviewChange(pbb, isInview) {\r\n\r\n            if (!isInview && !this.model.get(\"_isInview\")) {\r\n                let $items = this.$(\".js-blockbg-item\");\r\n                $items.toggle(false);\r\n            }\r\n        }\r\n\r\n        setUpObservers() {\r\n\r\n            // Observe whenever this view is out of view (and hide ALL items when it is).\r\n            // DISABLE IF CAUSING TOO MANY PERFORMANCE ISSUES.\r\n            const mainObserver = new IntersectionObserver((entries) => {\r\n                entries.forEach((entry) => {\r\n                    this.model.set(\"_isInview\", entry.isIntersecting);\r\n                });\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                threshold: [0]\r\n            });\r\n            mainObserver.observe(this.$el[0]);\r\n\r\n            // Observe whenever a .blockbg__group goes into view.\r\n            const observer = new IntersectionObserver((entries) => {\r\n                entries.forEach(this.onGroupInview.bind(this));\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                rootMargin: \"-\" + VIEWPORT_MARGIN + \" 0%\", // Wait for the group to cross the middle of the viewport.\r\n                threshold: [0]\r\n            });\r\n\r\n            let $groups = this.blockView.$(\".js-blockbg-group\");\r\n            $groups.each((i, e) => {\r\n                observer.observe(e);\r\n            });\r\n        }\r\n\r\n        onGroupInview(entry) {\r\n\r\n            let prevBlockBackground = this.model.get(\"_prevBlockBackground\");\r\n            \r\n            let $group = $(entry.target);\r\n            let index = $group.data(\"adapt-index\");\r\n\r\n            // Only react to elements entering the viewport (unless there's a prevBlockBackground).\r\n            if (!entry.isIntersecting) {\r\n\r\n                // Hide items on the way out.\r\n                if (prevBlockBackground && prevBlockBackground.get(\"_isInview\")) {\r\n                    this.$(\".js-blockbg-item\")\r\n                        .filter(\"[data-adapt-index=\" + index + \"]\")\r\n                        .addClass(\"is-hidden\");\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            this.model.set(\"_activeItemIdx\", index);\r\n\r\n            // prevBlockBackground support.\r\n            if (prevBlockBackground) {\r\n                this.$(\".js-blockbg-item\")\r\n                    .filter(\"[data-adapt-index=\" + index + \"]\")\r\n                    .removeClass(\"is-hidden\");\r\n            }\r\n        }\r\n\r\n        // Fade in the appropriate background for the item.\r\n        onActiveItemIdxChange(model, idx) {\r\n\r\n            this.$(\".js-blockbg-item\")\r\n                .removeClass(\"is-active\")\r\n                .filter(\"[data-adapt-index=\" + idx + \"]\")\r\n                .addClass(\"is-active\");\r\n        }\r\n    }\r\n\r\n    return BlockBackgroundView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class BlockBackgroundModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                _activeItemIdx: null\r\n            };\r\n        }\r\n\r\n        initialize() {\r\n\r\n            if (!this.get(\"_items\")) {throw \"BlockBackground: Must have an '_items' array property defined.\";}\r\n            \r\n            this.setUpId();\r\n        }\r\n\r\n        // FIXME: Groups need to be set up on postRender.\r\n        // FIXME: Bad encapsulation; this needs to be called by adapt-blockBackground.\r\n        onParentPostRender() {\r\n            this.setUpGroups();\r\n        }\r\n\r\n        // Give the blockBackground the same ID as its parent, only b-X -> b-X-bbg.\r\n        setUpId() {\r\n            this.set(\"_id\", this.get(\"_parent\").get(\"_id\") + \"-bbg\");\r\n        }\r\n\r\n        setUpGroups() {\r\n            // Get all componentRow children that will be rendered inside of this block.\r\n            let componentRows = this.get(\"_parent\").get(\"_componentRow\").get(\"_children\");\r\n            let items = this.get(\"_items\");\r\n\r\n            const childIds = items.map(e => {return e._child;});\r\n\r\n            // Group the componentRows.\r\n            // -----------------------------------------------\r\n            // If groups are automatic, they will be created by grouping:\r\n            // ComponentRowWithTitle + AllComponentRowsWithoutTitlesImmediatelyAfterIt\r\n            let groups = [];\r\n            let curGroup = [];\r\n            componentRows.each((componentRow) => {\r\n                \r\n                const title = componentRow.get(\"title\");\r\n\r\n                // If the ComponentRow has a title, or one of its children's _ids appear in the items, Start a new group.\r\n                if (\r\n                    title ||\r\n                    componentRow.getChildren().find(e => {return childIds.includes(e.get(\"_id\"));})\r\n                ) {\r\n                    if (curGroup.length) {groups.push(new Backbone.Collection(curGroup));}\r\n                    curGroup = [];\r\n                }\r\n                curGroup.push(componentRow);\r\n            });\r\n            groups.push(new Backbone.Collection(curGroup));\r\n\r\n            // Assign the groups to the items.\r\n            _.each(items, (item, i) => {\r\n                item._componentRows = i < groups.length ? groups[i] : null;\r\n            });\r\n\r\n            // If there are more groups than items, clone additional items from the last real item added.\r\n            if (items.length < groups.length) {\r\n                Adapt.log.warn(\"BlockBackground: More component groups found than _items in \" + this.get(\"_parent\").get(\"_id\") + \" (groups: \" + groups.length + \", _items: \" + items.length + \") \\n\\n(There aren't enough _blockBackground._items elements).\");\r\n                for (let i = items.length; i < groups.length; i++) {\r\n                    \r\n                    let cloneItem = _.extend({}, items[items.length-1]);\r\n                    cloneItem._componentRows = groups[i];\r\n                    items.push(cloneItem);\r\n                }\r\n            }\r\n            // If there are more items than groups, remove all items that didn't get a group.\r\n            else if (items.length > groups.length) {\r\n                items = _.filter(items, (item, i) => {\r\n                    return Boolean(item._componentRows);\r\n                });\r\n\r\n                Adapt.log.error(\"BlockBackground: Could not find componentRows for all _items in \" + this.get(\"_parent\").get(\"_id\") + \" (groups: \" + groups.length + \", _items: \" + items.length + \") \\n\\n(There are too many _blockBackground._items for the amount of components in the block).\");\r\n            }\r\n\r\n            // Set up IDs.\r\n            _.each(items, (item, i) => {\r\n                item._id = this.get(\"_id\") + \"-\" + i;\r\n                \r\n                // Set the values on the components.\r\n                item._componentRows.each((cr) => {\r\n                    cr.set(\"_blockBackgroundItemId\", item._id);\r\n                });\r\n            });\r\n\r\n            this.set(\"_items\", items);\r\n        }\r\n    }\r\n\r\n    return BlockBackgroundModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './blockBackgroundView',\r\n    './blockBackgroundModel'\r\n], function(Adapt, BlockBackgroundView, BlockBackgroundModel) {\r\n\r\n    class BlockBackground extends Backbone.Controller {\r\n\r\n        initialize() {\r\n\r\n            // Store a collection of ALL blockBackgrounds in the page.\r\n            this._blockBackgrounds = new Backbone.Collection({model: BlockBackgroundModel});\r\n\r\n            Adapt.on(\"app:dataReady\", this.onDataReady.bind(this));\r\n            Adapt.on(\"blockView:postRender\", this.onBlockViewPostRender.bind(this));\r\n            Adapt.on(\"componentRowView:postRender\", this.onComponentRowViewPostRender.bind(this));\r\n        }\r\n\r\n        /**\r\n         * LEGACY SUPPORT:\r\n         * ---------------\r\n         * (DD specific).\r\n         * \r\n         * In the past, we would define block backgrounds by doing:\r\n         * \r\n         * \"_didasko\": {\r\n         *    \"_backgroundImage\": {\r\n         *      \"_large\": \t\"course/en/images/b-3/bg.jpg\",\r\n         *      \"_medium\": \t\"course/en/images/b-3/bg.jpg\",\r\n         *      \"_small\": \t\"course/en/images/b-3/bg.jpg\"\r\n         *    }\r\n         * },\r\n         * \r\n         * This script will automatically convert and remove this property from all blocks, and change it so a property that will\r\n         * invoke the adapt-blockBackground extension.\r\n         */\r\n        _legacyBlockBGFix(blockModel) {\r\n\r\n            let legacyBG = blockModel.get(\"_didasko\")?._backgroundImage;\r\n            \r\n            // This block doesn't have a legacy background. Ignore it.\r\n            if (!legacyBG) return;\r\n        \r\n            // Remove the legacy background settings from the block.\r\n            blockModel.get(\"_didasko\")._backgroundImage = undefined;\r\n        \r\n            // Check if this block already has the adapt-blockBackground property.\r\n            if (blockModel.get(\"_blockBackground\")) {\r\n                throw \"adapt-blockBackground: block \" + blockModel.get(\"_id\") + \" has both \\\"_didasko\\\".\\\"_backgroundImage\\\" and \\\"_blockBackground\\\" properties.\\n\\nPlease use only \\\"_blockBackground\\\".\";\r\n            }\r\n        \r\n            // Add in the equivalent settings to add an adapt-blockBackground to this block.\r\n            blockModel.set(\"_blockBackground\", {\r\n                _isEnabled: true,\r\n                _items: [\r\n                    {\r\n                        _graphic: {\r\n                            _large: legacyBG._large,\r\n                            _small: legacyBG._small\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Initialize a blockBackgroundModel for all blocks which use it.\r\n         */\r\n        onDataReady() {\r\n            \r\n            let prevBlockBB = undefined;\r\n\r\n            Adapt.blocks.each(block => {\r\n\r\n                this._legacyBlockBGFix(block);\r\n\r\n                let data = block.get(\"_blockBackground\");\r\n                if (!data || !data._isEnabled) {\r\n                    prevBlockBB = undefined;\r\n                    return;\r\n                }\r\n\r\n                // If the _blockBackground is just a solid colour (doesn't have any items), set up a generic model for it instead.\r\n                if (!data._items || !data._items.length) {\r\n                    block.set(\"_blockBackground\", new Backbone.Model(data));\r\n                    prevBlockBB = undefined;\r\n                    return;\r\n                };\r\n                \r\n                data._parent = block;\r\n                \r\n                /**\r\n                 * If the blockBackgroundModel before this one (in the collection) belongs to the blockModel before this one,\r\n                 * then this blockBackgroundModel will need to use a slightly different script to determine if it's inview.\r\n                 * (This allows for sequential blocks to each have blockBackgrounds without there being a jarring transition).\r\n                 */\r\n                if (prevBlockBB) data._prevBlockBackground = prevBlockBB;\r\n\r\n                let model = new BlockBackgroundModel(data);\r\n                block.set(\"_blockBackground\", model);\r\n\r\n                this._blockBackgrounds.push(model);\r\n                prevBlockBB = model;\r\n            });\r\n        }\r\n\r\n        onBlockViewPostRender(blockView) {\r\n\r\n            let blockBackground = blockView.model.get(\"_blockBackground\");\r\n            if (!blockBackground || !blockBackground.get(\"_isEnabled\")) return;\r\n\r\n            // If the _blockBackground is just a solid colour (doesn't have any items), don't set up models and views\r\n            // -------------------------------------------------------------------------------------------------------\r\n            let items = blockBackground.get(\"_items\");\r\n            if (!items || !items.length) {\r\n                let color = blockBackground.get(\"_color\");\r\n                if (color) {\r\n                    blockView.$el.css(\"background-color\", color);\r\n                }\r\n                return;\r\n            }\r\n\r\n            blockBackground.onParentPostRender(); // MUST be called here to ensure it's invoked before the view is initialized.\r\n            let view = new BlockBackgroundView({model: blockBackground});\r\n        }\r\n\r\n        // Once the componentRowViews render, append them into their blockBackground groups (if they belong to them).\r\n        onComponentRowViewPostRender(componentRowView) {\r\n            \r\n            let bbgItemId = componentRowView.model.get(\"_blockBackgroundItemId\");\r\n            if (bbgItemId === undefined) return;\r\n            \r\n            // Append the componentRowView to the group element with the matching ID.\r\n            componentRowView.$el.appendTo($(\".js-blockbg-group[data-adapt-id=\" + bbgItemId + \"]\"));\r\n        }\r\n    }\r\n\r\n    new BlockBackground();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * FIXME: Hardcoded + rushed a bit.\r\n     */\r\n\r\n    class CodeBoxFadeBlockView extends Backbone.View {\r\n\r\n        events() {\r\n            return {\r\n                \"click .fadeblock__header\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.$(\".fadeblock__content\").toggle(this.model.get(\"_isActive\"));\r\n            this.update();\r\n\r\n            this.setupEventListeners();\r\n        }\r\n\r\n        setupEventListeners(){\r\n\r\n            this.listenTo(this.model, \"change:_isActive\", this.onActiveChange);\r\n        }\r\n\r\n        onClick() {\r\n            this.model.set(\"_isActive\", !Boolean(this.model.get(\"_isActive\")));\r\n        }\r\n\r\n        onActiveChange(model, isActive) {\r\n\r\n            this.update();\r\n\r\n            if (isActive) {\r\n                this.$(\".fadeblock__content\").slideDown();\r\n            }\r\n            else {\r\n                this.$(\".fadeblock__content\").slideUp();\r\n            }\r\n        }\r\n\r\n        update() {\r\n            let isActive = this.model.get(\"_isActive\");\r\n            this.$el.toggleClass(\"is-active\", isActive);\r\n            this.$(\".fadeblock__header\").toggleClass(\"is-active\", isActive);\r\n        }\r\n    };\r\n\r\n    return CodeBoxFadeBlockView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './codeBoxFadeBlockView'\r\n], function(Adapt, CodeBoxFadeBlockView) {\r\n\r\n    /**\r\n     * Add google-code-prettify to the requirejs shim.\r\n     * FIXME:\r\n     * I'm not sure this is the correct way to add shim elements to Adapt,\r\n     * but I couldn't find much other documentation about it online.\r\n     */\r\n    require.config({\r\n        shim: {\r\n            \"libraries/google-code-prettify/prettify\": {\r\n                exports: \"PR\"\r\n            }\r\n        }\r\n    });\r\n\r\n    const RENDER_LINE_CONTAINERS = true; \r\n    const DESKTOP_BOOKSHELF_TAB_STRING = \"&nbsp;&nbsp;\"; // Fallback for adapt-epub compatibility.\r\n\r\n    // The following languages need additional scripts loaded from libraries/google-code-prettify/*\r\n    // FIXME: Hardcoded.\r\n    const LANG_SCRIPTS = [\r\n        \"css\",\r\n        \"lua\",\r\n        \"basic\",\r\n        \"apollo\"\r\n    ];\r\n\r\n    class CodeBoxView extends Backbone.View {\r\n\r\n        className() {\r\n\r\n            let sizingClasses = this.model.get(\"_sizing\");\r\n\r\n            let classes = [\r\n                \"codebox\",\r\n                this.model.get(\"_classes\") || \"\",\r\n                sizingClasses || \"\",\r\n                sizingClasses ? \"has-sizing\" : \"\",\r\n                \"is-\" + this.model.get(\"_type\"),\r\n                \"lang-\" + this.model.get(\"_lang\"),\r\n                this.model.get(\"_wrappingEnabled\") ? \"wrapping-enabled\" : \"\"\r\n            ];\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                \"data-codebox-lang\": this.model.get(\"_lang\") || \"auto\",\r\n                \"style\": this.model.get(\"_style\") || \"\"\r\n            }\r\n        }\r\n\r\n        tagName() {\r\n            return \"div\"; // <pre> not being used as the grunt task already uniquely formats the code.\r\n        }\r\n\r\n        events() {\r\n\r\n        }\r\n\r\n        initialize(){\r\n\r\n            // Escape HTML content (if applicable).\r\n            this.escapeHTMLContent();\r\n\r\n            this.setupEventListeners();\r\n            //this.initTargets();\r\n            this.render();\r\n        }\r\n\r\n        setupEventListeners(){\r\n\r\n        }\r\n\r\n        renderContent(){\r\n            let template = Handlebars.templates['codeBox'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n        }\r\n\r\n        render(){\r\n\r\n            this.renderContent();\r\n\r\n            // adapt-dd-figure compatibility\r\n            // ------------------------------------------\r\n            // Add a class to the closest .figure element (if applicable).\r\n            _.debounce(()=>{\r\n                this.$el.closest(\".figure\").addClass(\"is-figure-codebox\");\r\n            }, 0)();\r\n\r\n            // adapt-epub compatibility\r\n            // ------------------------------------------\r\n            // Desktop Bookshelf renders tab characters too large. If it's detected, have the\r\n            // tab characters be made of &nbsp; instead.\r\n            if (Adapt.config.get('_isDesktopBookshelf')) {\r\n                this.$(\".tab\").html(DESKTOP_BOOKSHELF_TAB_STRING);\r\n            }\r\n\r\n            //this.setUpFigure();\r\n            this.renderPrettify();\r\n        }\r\n\r\n        /**\r\n         * If the language is \"html\" (or \"xml\" or \"xhtml\"), the code content needs to have all of its < and > escaped.\r\n         */\r\n        escapeHTMLContent() {\r\n\r\n            // Ensure that this the right language is used.\r\n            let lang = this.model.get(\"_lang\");\r\n            if (\r\n                lang != \"html\" &&\r\n                lang != \"xml\" &&\r\n                lang != \"xhtml\"\r\n            ) return;\r\n\r\n            let _type = this.model.get(\"_type\");\r\n            let content = this.model.get(\"content\");\r\n\r\n            // If this is the console, remove all generated <br> tags and leave the rest as is.\r\n            if (_type == \"console\") {\r\n                this.model.set(\"content\", content.replace(Adapt.codeBox.BR_REGEX, \"\"));\r\n                return;\r\n            }\r\n\r\n            // If this is the codebox, do nothing (jsonsynt-build.js has already escaped the < and >).\r\n        }\r\n\r\n        /**\r\n         * Apply syntax highlighting to codeBox views with type \"code\".\r\n         */\r\n        renderPrettify() {\r\n            if (this.model.get(\"_type\") !== \"code\") return;\r\n\r\n            let lang = this.model.get(\"_lang\");\r\n\r\n            // Don't pretty print if language is set to \"none\".\r\n            if (lang == \"none\") return;\r\n            \r\n            // Also don't pretty print if set to pseudo / pseudocode.\r\n            if (lang == \"pseudo\" || lang == \"pseudocode\") return;\r\n\r\n            // Load the required lang script from the library too (if the language uses one).\r\n            let langRequired = [];\r\n            if (LANG_SCRIPTS.includes(lang)) langRequired.push(\"libraries/google-code-prettify/lang-\" + lang);\r\n\r\n            require([\"libraries/google-code-prettify/prettify\"], (Prettify) => {\r\n\r\n                // lang-* script must be loaded after prettify.\r\n                require(langRequired, () => {\r\n\r\n                    let $content = this.$(\".js-codebox-content\");\r\n\r\n                    // Wrap the elements in syntax highlighting tags.\r\n                    $content.html(PR.prettyPrintOne($content.html(), lang || undefined)); //.addClass(\"prettyprint\");\r\n\r\n                    // After syntax highlighting, wrap each line in its own element.\r\n                    // This is done to allow for optional line-colouration / numbers.\r\n                    if (!RENDER_LINE_CONTAINERS) return;\r\n                    this.renderLineContainers();\r\n                });\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Returns and array of HTML strings which will need to be appended to the element.\r\n         * @param {*} blockHTML\r\n         */\r\n        _getLinesHTMLArray(blockHTML) {\r\n\r\n            let html = blockHTML;\r\n            let htmlLines;\r\n            \r\n            htmlLines = html.split(Adapt.codeBox.BR_REGEX);\r\n            let arr = [];\r\n\r\n            // Trim leading and trailing <br/>s\r\n            // Done to make the following two formatting styles have the same outcome:\r\n            /*\r\n            <div>\r\n            *CODE*\r\n            </div>\r\n\r\n            <div>*CODE*</div>\r\n            */\r\n            if (htmlLines.length && !htmlLines[0].trim()) htmlLines.shift();\r\n            if (htmlLines.length >= 1 && !htmlLines[htmlLines.length-1].trim()) htmlLines.pop();\r\n\r\n            _.each(htmlLines, (htmlLine, idx) => {\r\n\r\n                // If there's nothing in the line, add a newline symbol instead.\r\n                // This will show up in the codebox due to its white-space: pre-line; CSS property.\r\n                let h = htmlLine;\r\n                let isEmpty = false;\r\n                if ($(h).text().trim().length == 0) {\r\n                    // If the htmlLine is completely blank, just add a newline.\r\n                    if (h.trim().length == 0) {\r\n                        h = \"\\n\";\r\n                        isEmpty = true;\r\n                    }\r\n                    // If something has already filled the htmlLine with tags, instead add the newline at the end of the last one.\r\n                    else {\r\n                        h.replace(/(<\\/)(?!.*<\\/)/g, \"\\n</\"); // Insert a newline at the end of the last element.\r\n                        isEmpty = true;\r\n                    }\r\n                }\r\n\r\n                arr.push('<div class=\"codebox__line' + (isEmpty ? ' is-empty' : '') + '\">' + h + '</div>');\r\n            });\r\n\r\n            return arr;\r\n        }\r\n\r\n        /**\r\n         * FIXME:(?)\r\n         * This sort of processing of how the lines are rendered and the special treatment for <div>s could be deferred to Grunt,\r\n         * but would be quite complex to implement. \r\n         */\r\n        renderLineContainers() {\r\n\r\n            // Each line of code is determined based on the <br> tags that grunt added when compiling.\r\n            let $codeBoxInner = this.$(\".js-codebox-content\");\r\n            let htmlLines = [];\r\n\r\n            // Unique clause: keep any outer <div> wrappers (wrap code lines in them).\r\n            // (Gives compatibility with {{#fadeBlock}} and {{#markBlock}} helpers).\r\n            let $divs = $codeBoxInner.children(\"div\");\r\n\r\n            // Contains no nested DIVs (common).\r\n            if (!$divs.length) {\r\n                htmlLines = this._getLinesHTMLArray($codeBoxInner.html());\r\n            }\r\n            // Contains nested DIVs. Insert lines sequentially, but keep outer div wrappers.\r\n            else {\r\n                \r\n                // Insert all elements prior to the first div\r\n                // ------------------------------------------\r\n                // prevUntil gives the children in the reverse order, so reverse it again.\r\n                let $first = $($divs.first().prevUntil(\"div\").get().reverse());\r\n                // The HTML is derrived this way to ensure <br/> tags are included too.\r\n                if ($first.length) {\r\n                    htmlLines = htmlLines.concat(this._getLinesHTMLArray($first.wrapAll(\"<div>\").parent().html()));\r\n                }\r\n\r\n                // Insert all div elements, and all elements between divs\r\n                // ------------------------------------------------------\r\n                $divs.each((i, e) => {\r\n                    \r\n                    // Add the DIV header.\r\n                    let openingTagHtml = e.outerHTML.match(/^<div(>|.*?[^?]>)/);\r\n                    if (!openingTagHtml) {\r\n                        Adapt.log.error(\"codeBoxView.js: could not determine opening <div> tag HTML for the following element:\", $(e));\r\n                    }\r\n                    openingTagHtml = openingTagHtml[0];\r\n                    htmlLines.push(openingTagHtml);\r\n\r\n                    // Add the lines in the DIV.\r\n                    htmlLines = htmlLines.concat(this._getLinesHTMLArray($(e).html()));\r\n\r\n                    // Add a closing tag.\r\n                    htmlLines.push(\"</div>\");\r\n\r\n                    // Add the lines for elements that come after this DIV but aren't inside one.\r\n                    let $next = $(e).nextUntil(\"div\");\r\n                    if ($next.length) {\r\n                        htmlLines = htmlLines.concat(this._getLinesHTMLArray($next.wrapAll(\"<div>\").parent().html()));\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Finally, modify the HTML to the new processed htmlLines.\r\n\r\n            let $codeBoxLines = $('<div class=\"codebox__lines\">');\r\n            $codeBoxLines.html(htmlLines.join(\"\"));\r\n            // Set the data-line-num attributes for the codebox__lines, but not the wrapper <div>s.\r\n            $codeBoxLines.find(\".codebox__line\").each((i, e) => {\r\n                $(e).attr(\"data-line-num\", i+1);\r\n            });\r\n            this.$(\".js-codebox-content\").empty().append($codeBoxLines);\r\n\r\n            this.renderFadeBlocks();\r\n        }\r\n\r\n        /**\r\n         * Custom functionality:\r\n         * If a .fade.is-accordion element is detected inside the code, modify the elements to allow it to collapse it.\r\n         * \r\n         * FIXME: Fairly hardcoded at this time. Needs to be made more flexible if used often.\r\n         */\r\n        renderFadeBlocks() {\r\n\r\n            let $fadeBlocks = this.$(\".fade.is-accordion\");\r\n            if (!$fadeBlocks.length) return;\r\n\r\n            $fadeBlocks.each((i, e) => {\r\n\r\n                $(e).addClass(\"fadeblock\");\r\n                let $headerLine = $(e).find(\".codebox__line:first-child\");\r\n                let $contentLines = $(e).find(\".codebox__line:not(:first-child)\");\r\n                \r\n                // Wrap the first codebox line in the \"header\" div.\r\n                $headerLine.wrapAll(\"<div class='fadeblock__header' title='View omitted code'>\")\r\n\r\n                // Wrap all but the first codebox line in a div.\r\n                $contentLines.wrapAll(\"<div class='fadeblock__content'>\");\r\n\r\n                new CodeBoxFadeBlockView({\r\n                    el: $(e),\r\n                    model: new Backbone.Model({\r\n                        _isActive: false\r\n                    })\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    return CodeBoxView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './codeBoxView',\r\n    'libraries/jquery.actual.min'\r\n], function(Adapt, CodeBoxView) {\r\n\r\n    /**\r\n     * Same as the regular CodeBoxView, only the content is rendered inside of an iframe instead of a normal element.\r\n     * This is used mainly for HTML consoleboxes; as it prevents the contents from being affected (and affecting) any of\r\n     * Adapt's CSS.\r\n     */\r\n    class CodeBoxIframeView extends CodeBoxView {\r\n\r\n        events() {\r\n            return _.extend({}, super.events, {\r\n                \r\n            });\r\n        }\r\n\r\n        setupEventListeners(){\r\n            super.setupEventListeners.apply(this, arguments);\r\n\r\n            // To ensure the iframe is always the correct height, set up an event listener for device resizing.\r\n            Adapt.on(\"device:resize\", this.updateIframeSize.bind(this));\r\n        }\r\n\r\n        /**\r\n         * Override the original function.\r\n         */\r\n         renderContent(){\r\n            let template = Handlebars.templates['codeBoxIframe'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            this.$(\".js-codebox-iframe\").on(\"load\", this.onIframeLoad.bind(this));\r\n        }\r\n\r\n        waitUpdateIframeContent($iframe) {\r\n\r\n            return new Promise(resolve => {\r\n\r\n                let doc = $iframe[0].contentWindow.document;\r\n                let content = this.model.get(\"content\");\r\n\r\n                // Extract all external script tags (tags with src) from the content.\r\n                // They need to be added in a different way.\r\n                // ------------------------------------------------------------------\r\n                let scripts = [];\r\n                content = content.replace(/<script.*?src=(['\"]).*?\\1.*?(<\\/script>|\\/>)/g, function(match) {\r\n                    let src = match.match(/src=(['\"])(.*?)\\1/)[2];\r\n                    scripts.push(src);\r\n                    return \"\";\r\n                });\r\n                // ------------------------------------------------------------------\r\n\r\n                // Extract all inline script tags.\r\n                // They need to be added in a different way.\r\n                // ------------------------------------------------------------------\r\n                let inlineScripts = [];\r\n                content = content.replace(/<script.*?>*.?>((.|\\n)*)<\\/\\s*?script>/gm, function(match, $1) {\r\n                    inlineScripts.push($1);\r\n                    return \"\";\r\n                });\r\n                // ------------------------------------------------------------------\r\n\r\n                // EPUB functionality. Prepend a comment that will tell the html2xhtml.js script to ignore this html when\r\n                // validating it for XHTML.\r\n                if (Adapt.isEpubMode()) {\r\n                    content = \"<!--!IGNORE-XHTML!-->\" + content;\r\n                }\r\n\r\n                doc.body.innerHTML = content;\r\n\r\n                // Give the HTML element in the iframe ALL classes of the main Adapt <html>.\r\n                // This will allow for mode-specific styles to be used.\r\n                doc.documentElement.className = $(\"html\")[0].className;\r\n\r\n                _.each(scripts, (src) => {\r\n                    let s = doc.createElement(\"script\");\r\n                    s.src = src;\r\n                    doc.body.appendChild(s);\r\n                });\r\n\r\n                _.each(inlineScripts, (code) => {\r\n                    let s = doc.createElement(\"script\");\r\n                    s.type = 'text/javascript';\r\n                    try {\r\n                        s.appendChild(doc.createTextNode(code));\r\n                        doc.body.appendChild(s);\r\n                    }\r\n                    // Fallback for older browsers.\r\n                    catch (e) {\r\n                        s.text = code;\r\n                        doc.body.appendChild(s);\r\n                    }\r\n                });\r\n\r\n                // Resolve once the HTML changes have been applied.\r\n                // FIXME: Triggers multiple times in succession for every iframe on initial load.\r\n\r\n                $iframe.contents().ready(() => {\r\n                    $iframe.contents().off(\"ready\");\r\n\r\n                    // If DOMContentLoaded is already ready, resolve immediately.\r\n                    if (doc.readyState === \"complete\" || doc.readyState === \"loaded\") {\r\n                        resolve();\r\n                        return;\r\n                    }\r\n                    // Otherwise wait for it.\r\n                    doc.addEventListener(\"DOMContentLoaded\", () => {\r\n                        resolve();\r\n                    }, {once: true});\r\n                });\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Once the iframe is ready for it, populate it with the provided HTML content, and calculate its height.\r\n         * \r\n         * FIXME: This gets triggered multiple times per iframe.\r\n         */  \r\n        async onIframeLoad() {\r\n            \r\n            let $iframe = this.$(\".js-codebox-iframe\");\r\n            await this.waitUpdateIframeContent($iframe);\r\n\r\n            // CUSTOM: If there's a <form> in the iframe, overload it's \"submit\" event.\r\n            let codeBox = Adapt.course.get(\"_codeBox\");\r\n            if (codeBox._formSubmitMessageEnabled === true) {\r\n                $iframe.contents().find(\"form\").off(\"submit\").on(\"submit\", (event) => {\r\n                    event.preventDefault();\r\n                    alert(\"Form submitted!\");\r\n                });\r\n            }\r\n\r\n            this.updateIframeSize();\r\n        }\r\n\r\n        // Waits for all images to have loaded in the provided iframe before resolving.\r\n        waitIframeImgLoad($iframe) {\r\n            return new Promise(resolve => {\r\n                let $imgs = $iframe.contents().find(\"img\");\r\n\r\n                let remainingImages = $imgs.length;\r\n                if (remainingImages == 0) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                let decrementCounter = function() {\r\n                    remainingImages--;\r\n                    if (remainingImages == 0) resolve();\r\n                }\r\n\r\n                $imgs.each((i, e) => {\r\n                    if (e.complete) decrementCounter();\r\n                    else $(e).one(\"load\", () => {decrementCounter();});\r\n                });\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Updates the height CSS of the iframe to match its contents.\r\n         */\r\n        async updateIframeSize() {\r\n\r\n            let $iframe = this.$(\".js-codebox-iframe\");\r\n            $iframe.css(\"height\", \"\");\r\n\r\n            // If the real $iframe is display:none after the resize, clone it and check the clone's height.\r\n            if ($iframe.is(\":hidden\")) {\r\n\r\n                let $clone = $iframe.clone();\r\n                $clone.off(\"load\"); // Just in case it copied the original iframe's events.\r\n\r\n                $clone.css({\r\n                    \"height\": \"0px\",\r\n                    \"max-height\": \"0px\"\r\n                });\r\n                $clone.on(\"load\", async () => {\r\n\r\n                    //$clone.one(\"load\", this.onIframeLoad.bind(this));\r\n\r\n                    // Set the clone's width to be identical to the originals (for accurate calculation).\r\n                    let width = $iframe.actual(\"outerWidth\");\r\n                    $clone.width(width);\r\n\r\n                    await this.waitUpdateIframeContent($clone);\r\n                    await this.waitIframeImgLoad($clone);\r\n\r\n                    let height = $clone[0].contentWindow.document.body.scrollHeight;\r\n                    $iframe.height(height);\r\n\r\n                    // Remove clone (we only needed it for calculating its height).\r\n                    $clone.remove();\r\n                });\r\n                $(\"body\").append($clone);\r\n            }\r\n            // Otherwise, just set its height based on its content.\r\n            else {\r\n\r\n                await this.waitIframeImgLoad($iframe);\r\n\r\n                $iframe.css({\"height\": \"0px\"}); // Reset height before re-calculating.\r\n                try {\r\n                    let height = $iframe[0].contentWindow.document.body.scrollHeight;\r\n                    $iframe.height(height);\r\n                }\r\n                catch (err) {\r\n                    Adapt.log.error(err, $iframe);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return CodeBoxIframeView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    'handlebars',\r\n    './codeBoxView',\r\n    './codeBoxIframeView'\r\n], function(Adapt, Handlebars, CodeBoxView, CodeBoxIframeView) {\r\n\r\n    /**\r\n     * WARNING:\r\n     * --------\r\n     * This extention requires the JSONSYNT {{#code}} grunt build task to be executed for the best results.\r\n     * See grunt/config/jsonsynt-build.js for more information.\r\n     */\r\n\r\n    Adapt.on('router:page', () => {\r\n\r\n        // Code\r\n        Handlebars.registerHelperEl(\"code\", function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n            let hash = Handlebars.getContextHash.apply(this, arguments);\r\n\r\n            // Set the code language.\r\n            let _default = Adapt.course.get(\"_codeBox\");\r\n            let _lang = hash.lang ? hash.lang : (_default ? _default._lang : \"\");\r\n\r\n            let modelJSON = {\r\n                content: context.fn(this),\r\n                _classes: hash.class,\r\n                _style: hash.style,\r\n                _filename: hash.filename,\r\n                // adapt-sizing compatibility removed after rework of design.\r\n                //_sizing: hash.sizing ? Adapt.sizing.getSizingClass(hash.sizing) : \"\",\r\n                _type: \"code\",\r\n                _lang: _lang,\r\n                _wrappingEnabled: Boolean(hash.wrapping)\r\n            };\r\n\r\n            return new CodeBoxView({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el;\r\n        });\r\n\r\n        // Console\r\n        Handlebars.registerHelperEl(\"console\", function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n            let hash = context.hash;\r\n\r\n            // Set the console language (only matters if the language is \"html\"; changes its appearance).\r\n            // TODO: Have it inherit its language from the paired codebox if possible.\r\n            let _default = Adapt.course.get(\"_codeBox\");\r\n            let _lang = hash.lang ? hash.lang : (_default ? _default._lang : \"\");\r\n\r\n            let modelJSON = {\r\n                content: context.fn(this),\r\n                _classes: hash.class,\r\n                _style: hash.style,\r\n                _type: \"console\",\r\n                _lang: _lang,\r\n                _wrappingEnabled: Boolean(hash.wrapping)\r\n            };\r\n\r\n            // Use a different view for HTML consoleboxes.\r\n            let view = _lang == \"html\" ? CodeBoxIframeView : CodeBoxView;\r\n\r\n            return new view({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el;\r\n        });\r\n    });\r\n\r\n    // Other helpers\r\n    // ---------------------------------------------------------\r\n    var helpers = {\r\n\r\n        pseudocode: function() {\r\n            let context = arguments[arguments.length-1];\r\n            return \"<span class='codebox__pseudocode'>\" + context.fn(this) + \"</span>\";\r\n        }\r\n    }\r\n\r\n    for (var name in helpers) {\r\n        if (!helpers.hasOwnProperty(name)) continue;\r\n        Handlebars.registerHelper(name, helpers[name]);\r\n    }\r\n\r\n    Adapt.codeBox = {\r\n        /**\r\n         * This regex will be used to find the \"<br class=\"br\" />\" tags generated by the jsonsynt-build Grunt task.\r\n         * \r\n         * adapt-epub compatibility\r\n         * --------------------------------------------------\r\n         * Sometimes the XHTML renders the <br /> as <br xmlns=\"http://www.w3.org/1999/xhtml\" />\r\n         */\r\n        BR_REGEX:   new RegExp(/<br\\s+[^>]*?class=\"br\"\\s*.*?\\/?>/, \"g\"),\r\n        TAB_REGEX:  new RegExp(/<span[^>]*?class=\"tab\"\\s*.*?>.*?<\\/span>/, \"g\"),\r\n        \r\n        /**\r\n         * Converts a code string to a regular string (replaces BR_REGEX and TAB_REGEX).\r\n         * Used mainly by tryHtml (for now).\r\n         * \r\n         * @param {string} codeString \r\n         */\r\n        toString: function(codeString) {\r\n\r\n            if (typeof(codeString) !== \"string\") throw \"adapt-codeBox: codeString must be a valid string.\";\r\n\r\n            let s = codeString;\r\n            s = s.replace(this.BR_REGEX, \"\\n\");\r\n            s = s.replace(this.TAB_REGEX, \"\\t\");\r\n\r\n            return s;\r\n        },\r\n\r\n        getLines: function(codeString) {\r\n            if (typeof(codeString) !== \"string\") throw \"adapt-codeBox: codeString must be a valid string.\";\r\n\r\n            let lines = codeString.split(this.BR_REGEX);\r\n            return lines;\r\n        }\r\n    }\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class ComponentRowModel extends Backbone.Model{\r\n\r\n        defaults() {\r\n            return {\r\n                _index: 0,              // Index of this componentRow in the block.\r\n                _children: undefined,   // Collection of 1 or 2 componentModel children stored in this component row.\r\n                _parent: undefined,     // BlockModel that this componentRow is inside of.\r\n                _prevSibling: undefined,// Reference to the previous component row in the block (if there is one).\r\n\r\n                _isEnabled: true,       // If set to false, will move the components outside the componentRow, then delete its view.\r\n                _isVisible: true,       // If set to false, the view will slideUp the componentRow (and vice-versa).\r\n                _isComplete: false,     // Will become true once all _children._isComplete is true.\r\n\r\n                _isQuestionType: false, // If any of the children in this component are Question components, set this to true.\r\n                _isReverse: false,      // Whether the componentRow should display its components in reverse order on large view.\r\n                _isSingle: false,       // True if _children.length == 1.\r\n                title: \"\",              // If any of the _children have a title, it will be assigned to this property.\r\n                _hasDivider: false      // Whether this componentRow should render a divider line above it (determined automatically).\r\n            }\r\n        }\r\n        \r\n        initialize() {\r\n\r\n            this.setUpTitle();\r\n            this.setUpReverse();\r\n            this.setUpDivider();\r\n            this.setUpQuestionType();\r\n            this.setUpIsComplete();\r\n            this.set(\"_isSingle\", this.get(\"_children\").length <= 1);\r\n            //this.setUpHasFloat();\r\n            this.setUpSizing();\r\n\r\n            this.listenTo(this.get(\"_parent\").get(\"_componentRow\"), \"change:_isEnabled\", this.onParentEnabledChange);\r\n            \r\n            // Let the child components know of the componentRow they belong to.\r\n            this.get(\"_children\").each((model) => {\r\n                model.set(\"_componentRow\", this);\r\n            });\r\n        }\r\n\r\n        getChildren() {\r\n            return this.get(\"_children\");\r\n        }\r\n\r\n        /**\r\n         * FIXME: QUICK-FIX\r\n         * Returns true if the children in this componentRow are all !_isAvailable.\r\n         */\r\n        isAvailable() {\r\n\r\n            let available = this.getChildren().find((model) => {return model.get(\"_isAvailable\") !== false;});\r\n            return Boolean(available);\r\n        }\r\n\r\n        /**\r\n         * adapt-sizing compatibility\r\n         * --------------------------\r\n         * Set up adapt-sizing classes for the componentrow__inner element.\r\n         */\r\n        setUpSizing() {\r\n            if (!Adapt.sizing) return;\r\n\r\n            this.get(\"_children\").each((childModel) => {\r\n                let sizing = childModel.get(\"_sizing\");\r\n                if (sizing) {\r\n                    this.set(\"_parSizingClasses\", Adapt.sizing.getParentClasses(sizing));\r\n                }\r\n            });\r\n            \r\n        }\r\n\r\n        onParentEnabledChange(ComponentRow, _isEnabled) {\r\n            this.set(\"_isEnabled\", _isEnabled);\r\n        }\r\n\r\n        // Fixme: these two functions could be \r\n        setUpIsComplete() {\r\n\r\n            let children = this.get(\"_children\");\r\n            \r\n            // Check if it's already complete.\r\n            this.updateIsComplete();\r\n\r\n            // Listen for changes.\r\n            this.listenTo(children, \"change:_isComplete\", this.updateIsComplete.bind(this));\r\n        }\r\n\r\n        // Check each child and set _isComplete to true only if every one of them has _isComplete: true.\r\n        updateIsComplete() {\r\n\r\n            let isComplete = true;\r\n            let children = this.get(\"_children\");\r\n            children.find((child) => {\r\n                if (!child.get(\"_isComplete\")) {\r\n                    isComplete = false;\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            this.set(\"_isComplete\", isComplete);\r\n            return isComplete;\r\n        }\r\n\r\n        setUpTitle() {\r\n\r\n            let componentWithTitle = _.find(this.get(\"_children\").models, (c) => {\r\n                return c.get(\"title\") || c.get(\"displayTitle\");\r\n            });\r\n            if (!componentWithTitle) return;\r\n\r\n            let title = componentWithTitle.get(\"title\") || componentWithTitle.get(\"displayTitle\");\r\n            this.set(\"title\", title);\r\n\r\n            this.get(\"_parent\").set(\"_blockTitle\", title);\r\n        }\r\n\r\n        // If the components are in reverse order ([\"right\", \"left\"]), then set it.\r\n        setUpReverse() {\r\n\r\n            let children = this.get(\"_children\");\r\n            if (children.length != 2) return;\r\n\r\n            if (children.models[0].get(\"_layout\") == \"right\") {\r\n                this.set(\"_isReverse\", true);\r\n            }\r\n        }\r\n\r\n        // If the previous componentRow had 2 components, or if its component count != the cur component count,\r\n        // then it needs a divider.\r\n        // Or if one of the children has \"_hasDivider\": true.\r\n        // FIXME: Currently hardcoded to DD's preferred pattern.\r\n        setUpDivider(){\r\n            \r\n            let prevCR = this.get(\"_prevSibling\");\r\n            if (!prevCR) return;\r\n\r\n            if (this.get(\"_children\").find(m => {return m.get(\"_hasDivider\");})) {\r\n                this.set(\"_hasDivider\", true);\r\n                return;\r\n            }\r\n\r\n            // If one of the children has hardcoded \"_hasDivider\" === false, then disable it.\r\n            if (this.get(\"_children\").find(m => {return m.get(\"_hasDivider\") === false;})) {\r\n                this.set(\"_hasDivider\", false);\r\n                return;\r\n            }\r\n\r\n            if (prevCR.get(\"_children\").length == 2 || \r\n                prevCR.get(\"_children\").length != this.get(\"_children\").length ||\r\n                this.get(\"title\")) {\r\n\r\n                    // Don't give dividers to full component rows with no titles.\r\n                    if (!this.get(\"title\") && this.get(\"_children\").length < 2) return;\r\n                    \r\n                    this.set(\"_hasDivider\", true);\r\n            }\r\n        }\r\n\r\n        setUpQuestionType(){\r\n            this.set(\"_isQuestionType\", Boolean(this.get(\"_children\").find((child) => {\r\n                return child.get(\"_isQuestionType\");\r\n            })));\r\n        }\r\n    }\r\n\r\n    return ComponentRowModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    \"./componentRowModel\"\r\n], function(Adapt, ComponentRowModel) {\r\n\r\n    class ComponentRowCollection extends Backbone.Collection{\r\n\r\n        initialize(models, options) {\r\n            this.listenTo(Adapt, 'remove', this.reset);\r\n            if (!options || !options.blockModel) return;\r\n            this._blockModel = options.blockModel;\r\n            this.repopulate();\r\n        }\r\n\r\n        repopulate() {\r\n            this.reset();\r\n            if (!this._blockModel) return;\r\n\r\n            let blockModel = this._blockModel;\r\n            let componentModels = blockModel.getChildren().models;\r\n        \r\n            // Automatically determine which components to pair up.\r\n            var curPair = [];\r\n            \r\n            // For each componentModel...\r\n            _.each(componentModels, (componentModel) => {\r\n                \r\n                var _layout = componentModel.get(\"_layout\");\r\n            \r\n                // Wrap isolated \"full\" and \"_isSingle\" layouts (they're the only components on their \"row\").\r\n                if (this.isComponentSingleton(componentModel))\r\n                {\r\n                    // Fallback:\r\n                    // If the previous component wasn't detected as singleton, make it singleton too.\r\n                    if (curPair.length) {\r\n                        this.pairComponents([curPair[0]], blockModel);\r\n                    }\r\n\r\n                    // Wrap the singleton component.\r\n                    this.pairComponents([componentModel], blockModel);\r\n                    \r\n                    // Clear the pair for the next row.\r\n                    curPair = [];\r\n\r\n                    return true;\r\n                }\r\n\r\n                // First child of the pair.\r\n                if (curPair.length == 0)\r\n                {\r\n                    curPair.push(componentModel);\r\n                    return true;\r\n                }\r\n\r\n                // Second child of the pair. Wrap both elements if the _layouts are different, and neither is a singleton.\r\n                if (_layout != curPair[0].get(\"_layout\"))\r\n                {\r\n                    curPair.push(componentModel);\r\n\r\n                    this.pairComponents(curPair, blockModel);\r\n\r\n                    // Clear the pair for the next row.\r\n                    curPair = [];\r\n                    return true;\r\n                }\r\n\r\n                // If the next component has the exact same layout as the previous one, then treat the first one as a singleton\r\n                // (mainly done for stickyBlock and other niche customs compatibility).\r\n                // Example:\r\n                /*\r\n                    full\r\n                    left <--\r\n                    left <--\r\n                    left - right\r\n                    left <--\r\n                    left <--\r\n                    left - right\r\n\r\n                */\r\n                this.pairComponents([curPair[0]], blockModel); // Pair the previous one.\r\n\r\n                // Clear the pair for the next row.\r\n                curPair = [];\r\n                curPair.push(componentModel);\r\n            });\r\n\r\n            // Fallback: If there's any stragglers at the end, pair them too.\r\n            if (curPair.length) {\r\n                this.pairComponents(curPair, blockModel);\r\n            }\r\n        }\r\n\r\n        // Returns true if the component is \"full\", or has been marked as a \"singleton\".\r\n        isComponentSingleton(componentModel){\r\n\r\n            // All \"full\" components are singletons.\r\n            if (componentModel.get(\"_layout\") == \"full\") return true;\r\n\r\n            // Non-\"full\" components can be manually set to be isolated. \r\n            var cr = componentModel.get(\"_componentRow\");\r\n            if (!cr) return false;\r\n            \r\n            return Boolean(cr._isSingle);\r\n        }\r\n\r\n        pairComponents(componentArray, blockModel) {\r\n            \r\n            let crModel = new ComponentRowModel({\r\n                _index: this.length,\r\n                _children: new Backbone.Collection(componentArray),\r\n                _parent: blockModel,\r\n                _prevSibling: this.last() || undefined,\r\n                _isEnabled: blockModel.get(\"_componentRow\").get(\"_isEnabled\") !== false\r\n            });\r\n\r\n            this.add(crModel);\r\n\r\n            return crModel;\r\n        }\r\n    }\r\n\r\n    return ComponentRowCollection;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class ComponentRowView extends Backbone.View {\r\n\r\n        className() {\r\n            let classNames = [\r\n                \"componentrow\",\r\n                (this.model.get(\"title\") ? \"componentrow-has-title\" : \"\"),\r\n                (this.model.get(\"_hasDivider\") ? \"componentrow-has-divider\" : \"\"),\r\n                (this.model.get(\"_isReverse\") ? \"componentrow-is-reverse\" : \"componentrow-is-not-reverse\"),\r\n                (this.model.get(\"_isSingle\") ? \"componentrow-is-single\" : \"componentrow-is-double\")\r\n            ];\r\n\r\n            // Add a class specifying the types of the child components inside this component row.\r\n            this.model.get(\"_children\").each((childModel) => {\r\n                classNames.push(\"componentrow-contains-\" + childModel.get(\"_component\"));\r\n            });\r\n\r\n            return classNames.join(' ');\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                \"data-componentrow-index\" : this.model.get(\"_index\")\r\n            };\r\n        }\r\n\r\n        initialize() {\r\n\r\n            \r\n            this.validateChildren();\r\n\r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        /**\r\n         * Error check. If _isSingle, then the child must have _layout: full.\r\n         * This check was moved to the View in case external scripts modify the model's values after they have been set.\r\n         */\r\n        validateChildren(){\r\n            if (this.model.get(\"_isSingle\") && this.model.get(\"_children\").first().get(\"_layout\") !== \"full\") {\r\n                Adapt.log.error(\"componentRow:\\nComponent with block parent \\\"\" + this.model.get(\"_parent\").get(\"_id\") + \"\\\" must have its \\\"layout\\\" property be \\\"full\\\" (it is the only component in its row).\");\r\n            }\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(this.model, \"change:_isEnabled\", this.onEnabledChange.bind(this));\r\n            this.listenTo(this.model, \"change:_isVisible\", this.onVisibleChange.bind(this));\r\n\r\n            // FIXME: Temp. This shouldn't be being toggled after the componentRowView has rendered.\r\n            this.listenTo(this.model, \"change:_hasDivider\", this.onDividerChange.bind(this));\r\n        }\r\n\r\n        onDividerChange(model, hasDivider) {\r\n            this.$el.toggleClass(\"componentrow-has-divider\", hasDivider);\r\n        }\r\n\r\n        onVisibleChange(model, isVisible) {\r\n            if (isVisible) {\r\n                this.$el.slideDown();\r\n            }\r\n            else {\r\n                this.$el.slideUp();\r\n            }\r\n        }\r\n\r\n        onEnabledChange(model, isEnabled) {\r\n            if (isEnabled) return;\r\n\r\n            // Move the child components out of this view.\r\n            let $container = this.$el.closest(\".component__container\");\r\n\r\n            this.model.get(\"_children\").each((child) => {\r\n                Adapt.findViewByModelId(child.get(\"_id\")).$el.appendTo($container);\r\n            });\r\n\r\n            // Remove this view entirely.\r\n            this.remove();\r\n        }\r\n\r\n        render() {\r\n            \r\n            this.$el.html(Handlebars.templates[\"componentRow\"](this.model.toJSON()));\r\n\r\n            if (!this.model.get(\"_isVisible\")) this.$el.hide();\r\n\r\n            // Trigger an event (for use by extensions).\r\n            // FIXME: Not sure why a delay is needed, but it adapt-blockBackground doesn't work without it.\r\n            _.delay(() => {\r\n                // Due to the way componentRow is set up, a block with multiple componentRows will have these events all trigger in the same order the componentRows are in every time.\r\n                Adapt.trigger(\"componentRowView:postRender\", this);\r\n            });\r\n        }\r\n    }\r\n\r\n    return ComponentRowView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    \"./componentRowCollection\",\r\n    \"./componentRowView\"\r\n], function(Adapt, ComponentRowCollection, ComponentRowView) {\r\n\r\n    /**\r\n     * adapt-componentRow\r\n     * ==================\r\n     * \r\n     * Description:\r\n     * ------------\r\n     * Automatically creates container elements around each row of components (like an inner container between block & container).\r\n     * \r\n     * Components can have \"left\", \"right\", and \"full\" layouts.\r\n     * Each \"row\" of component that are side-by-side on large views should be wrapped together for layout purposes.\r\n     * \r\n     * The component row wrapper will also allow a \"right\" component to be added before a \"left\" one.\r\n     * On large screens, they will still show up side-by-side as \"left\" \"right\", but when they're placed above each other,\r\n     * the order will become \"right\" \"left\" (the same as in the JSON).\r\n     * \r\n     * Also offers the option to interlace components on small devices by always placing the componentRow title at the top\r\n     * of both stacked components; like so (or vice-versa):\r\n     * [left component's title]\r\n     * [right component]\r\n     * [left component's body + widget]\r\n     * \r\n     * Any component with _componentRow._single == true will be given its own wrapper.\r\n     * \r\n     * TODO:\r\n     * ----- \r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * - (Maybe?) If the component is re-rendered, check if it leaves the componentRow element (as well as losing the correct order).\r\n     * \r\n     * Notes:\r\n     * ------\r\n     * \r\n     */\r\n\r\n    class ComponentRow extends Backbone.Controller{\r\n\r\n        initialize() {\r\n\r\n            Adapt.on(\"blockView:preRender\", this.setupComponentRowData.bind(this));\r\n            Adapt.on(\"blockView:postRender\", this.renderComponentRowViews.bind(this));\r\n            Adapt.on(\"componentView:postRender\", this.onComponentPostRender.bind(this));\r\n        }\r\n\r\n        // Set up data only. Actual modification of the DOM takes place postRender.\r\n        setupComponentRowData(blockView) {\r\n            \r\n            let blockModel = blockView.model;\r\n\r\n            // Advanced: allow blocks to not use component rows.\r\n            //let blockComponentRow = blockModel.get(\"_componentRow\");\r\n            //if (blockComponentRow && blockComponentRow._isEnabled === false) return;\r\n\r\n            // Overload the block child sorting functionality (Adapt sorts block children by _layout. We don't want that).\r\n            let _getChildren = blockModel.getChildren;\r\n            if (!_getChildren.prototype._componentRowOverride) {\r\n                blockModel.getChildren = () => {\r\n                    \r\n                    // Call the original (which sorts the children by _layout)\r\n                    _getChildren.apply(blockModel, arguments);\r\n                    \r\n                    // Re-sort the children by cid (to undo the sorting that was done in adaptModel).\r\n                    if (blockModel._childrenCollection.length === 2) {\r\n\r\n                        blockModel._childrenCollection.comparator = (model) => {\r\n                            // Parsed \"c99\" into int to prevent rare bug where \"c99\" and \"c100\" are sorted in the wrong order.\r\n                            return parseInt(model.cid.substring(1));\r\n                        };\r\n                        blockModel._childrenCollection.sort();\r\n                        blockModel.setChildren(blockModel._childrenCollection);\r\n                    }\r\n                    return blockModel._childrenCollection;\r\n                }\r\n                blockModel.getChildren.prototype._componentRowOverride = true; // Override only once.\r\n            }\r\n\r\n            blockModel.set(\"_componentRow\", new Backbone.Model(_.extend(\r\n                {_isEnabled: true},\r\n                blockModel.get(\"_componentRow\") || {}\r\n            )));\r\n            let componentRowCollection = new ComponentRowCollection(null, {\r\n                blockModel: blockModel\r\n            });\r\n            blockModel.get(\"_componentRow\").set(\"_children\", componentRowCollection);\r\n\r\n            // Advanced\r\n            // --------\r\n            // Allow componentRow to be toggled on and off.\r\n            // FIXME: Weird to have the enabling functionality here, and the disabling functionality in the views.\r\n            // FIXME: Enabling is listened to on a block level, while disabling is listened to on a componentRow level.\r\n            this.listenTo(blockModel.get(\"_componentRow\"), \"change:_isEnabled\", (componentRow, isEnabled) => {\r\n                \r\n                if (!isEnabled) return; // The individual componentRowViews handle disabling (and removing) themselves.\r\n\r\n                // Re-create the componentRowViews.\r\n                if (isEnabled) {\r\n                    this.appendComponentRowViews(blockView);\r\n\r\n                    // FIXME: Could this break if the component isn't currently rendered when this is called?\r\n                    componentRow.get(\"_children\").each((componentRowModel) => {\r\n                        componentRowModel.get(\"_children\").each(model => {\r\n                            this.appendComponentView(Adapt.findViewByModelId(model.get(\"_id\")));\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        renderComponentRowViews(blockView) {\r\n\r\n            // Don't do anything if manually disabled.\r\n            let blockModel = blockView.model;\r\n            let blockComponentRow = blockModel.get(\"_componentRow\");\r\n            if (blockComponentRow && blockComponentRow.get(\"_isEnabled\") === false) return;\r\n\r\n            this.appendComponentRowViews(blockView);\r\n        }\r\n\r\n        /**\r\n         * Whenever a component inside of a componentRow is rendered, move it to be inside of its assigned row.\r\n         * @param {*} componentView \r\n         */\r\n        onComponentPostRender(componentView){\r\n\r\n            this.appendComponentView(componentView);\r\n        }\r\n\r\n        appendComponentRowViews(blockView){\r\n            \r\n            // Render the views.\r\n            let $container = blockView.$(\".component__container\");\r\n            _.each(blockView.model.get(\"_componentRow\").get(\"_children\").models, (model) => {\r\n\r\n                if (!model.isAvailable()) return; // Don't render the componentRow if there's no available components in it.\r\n\r\n                $container.append(new ComponentRowView({\r\n                    model: model\r\n                }).$el);\r\n            });\r\n        }\r\n\r\n        appendComponentView(componentView) {\r\n\r\n            // Ignore componentViews which are clones (temporary copies of components made by stickyBlock).\r\n            if (componentView.isClone) return;\r\n\r\n            let _componentRow = componentView.model.get(\"_componentRow\");            \r\n            if (!_componentRow) return;\r\n\r\n            // Determine whether to prepend or append the componentView.\r\n            let isFirst = _componentRow.get(\"_children\").first().get(\"_id\") == componentView.model.get(\"_id\");\r\n\r\n            // Append the components.\r\n            let $container = componentView.$el.closest(\".component__container\");\r\n            $container = $container.find(\"[data-componentrow-index='\" + _componentRow.get(\"_index\") + \"'] .js-componentrow-items\");\r\n\r\n            if (isFirst)    $container.prepend(componentView.$el);\r\n            else            $container.append(componentView.$el);\r\n        }\r\n    }\r\n\r\n    new ComponentRow();\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/articleView'\r\n], function(Adapt, AdaptArticleView) {\r\n\r\n  var AssessmentView = {\r\n\r\n    postRender: function() {\r\n      AdaptArticleView.prototype.postRender.call(this);\r\n      if (this.model.isAssessmentEnabled()) {\r\n        this._setupEventListeners();\r\n\r\n        var config = this.model.getConfig();\r\n        if (config && config._questions && config._questions._canShowMarking === false) {\r\n          this.$el.addClass('has-no-marking');\r\n        }\r\n      }\r\n      this.$el.addClass('is-assessment');\r\n    },\r\n\r\n    _setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        'assessments:complete': this._onAssessmentComplete,\r\n        'assessments:reset': this._onAssessmentReset,\r\n        remove: this._onRemove\r\n      });\r\n    },\r\n\r\n    _removeEventListeners: function() {\r\n      this.stopListening(Adapt, {\r\n        'assessments:complete': this._onAssessmentComplete,\r\n        'assessments:reset': this._onAssessmentReset\r\n      });\r\n    },\r\n\r\n    _onAssessmentComplete: function(state, model) {\r\n      if (state.id != this.model.get('_assessment')._id) return;\r\n\r\n      console.log('assessment complete', state, model);\r\n    },\r\n\r\n    _onAssessmentReset: function(state, model) {\r\n      if (state.id != this.model.get('_assessment')._id) return;\r\n\r\n      console.log('assessment reset', state, model);\r\n\r\n    },\r\n\r\n    _onRemove: function() {\r\n      this._removeEventListeners();\r\n    }\r\n\r\n  };\r\n\r\n  return AssessmentView;\r\n\r\n});\r\n","define(function(require) {\r\n\r\n  var QuestionBank = function(quizBankid, articleId, numQuestionBlocks, uniqueQuestions) {\r\n\r\n    this._id = quizBankid;\r\n    this._articleId = articleId;\r\n    this._numQuestionBlocks = numQuestionBlocks;\r\n    this._uniqueQuestions = uniqueQuestions;\r\n    this.questionBlocks = [];\r\n    this.unUsedQuestionBlocks = undefined;\r\n    this.usedQuestionBlocks = [];\r\n\r\n  };\r\n\r\n  QuestionBank.prototype = {\r\n\r\n      getID: function() {\r\n        return this._id;\r\n      },\r\n\r\n      addBlock: function(block) {\r\n        this.questionBlocks.push(block);\r\n      },\r\n\r\n      getRandomQuestionBlocks: function() {\r\n        this.checkResetUnunsedBlocks();\r\n\r\n        var questionBlocks = [];\r\n        var usedQuestionBlocks = this.usedQuestionBlocks.slice(0);\r\n\r\n        for (var i = 0; i < this._numQuestionBlocks; i++) {\r\n          var question = this.getRandomQuestion();\r\n          if (question !== undefined) {\r\n            questionBlocks.push(question);\r\n          } else {\r\n            if (usedQuestionBlocks.length === 0) break;\r\n            var index = Math.floor(Math.random() * (usedQuestionBlocks.length-1));\r\n            question = usedQuestionBlocks.splice(index, 1)[0];\r\n            questionBlocks.push(question);\r\n          }\r\n        }\r\n\r\n        return questionBlocks;\r\n      },\r\n\r\n      checkResetUnunsedBlocks: function() {\r\n        if (this.unUsedQuestionBlocks !== undefined && this._uniqueQuestions) return;\r\n\r\n        this.unUsedQuestionBlocks = this.questionBlocks.slice(0);\r\n      },\r\n\r\n      getRandomQuestion: function() {\r\n        if (this.unUsedQuestionBlocks !== undefined && this.unUsedQuestionBlocks.length < 1) {\r\n          console.warn('assessment:'+ this._articleId +' No more unique questions for _assessment._quizBankID ' + this._id);\r\n          return undefined;\r\n        }\r\n\r\n        var index = Math.round(Math.random() * (this.unUsedQuestionBlocks.length-1));\r\n        var questionBlock = this.unUsedQuestionBlocks[index];\r\n        this.usedQuestionBlocks.push(questionBlock);\r\n\r\n        this.unUsedQuestionBlocks.splice(index, 1);\r\n\r\n        return questionBlock;\r\n      }\r\n\r\n  };\r\n\r\n  return QuestionBank;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './adapt-assessmentQuestionBank'\r\n], function(Adapt, QuestionBank) {\r\n\r\n\r\n  var givenIdCount = 0;\r\n  var assessmentConfigDefaults = {\r\n    _isEnabled: true,\r\n    _questions: {\r\n      _resetType: 'soft',\r\n      _canShowFeedback: false,\r\n      _canShowMarking: false,\r\n      _canShowModelAnswer: false\r\n    },\r\n    _suppressMarking: false,\r\n    _isPercentageBased : true,\r\n    _scoreToPass : 100,\r\n    _includeInTotalScore: true,\r\n    _assessmentWeight: 1,\r\n    _isResetOnRevisit: true,\r\n    _reloadPageOnReset: true,\r\n    _attempts: 'infinite',\r\n    _allowResetIfPassed: false\r\n  };\r\n\r\n  var AssessmentModel = {\r\n\r\n  // Private functions\r\n\r\n    _postInitialize: function() {\r\n      if (!this.isAssessmentEnabled()) return;\r\n\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      _.extend(this, {\r\n        _currentQuestionComponents: null,\r\n        _originalChildModels: null,\r\n        _questionBanks: null,\r\n        _forceResetOnRevisit: false\r\n      });\r\n\r\n      var attemptsLeft;\r\n      switch (assessmentConfig._attempts) {\r\n        case 'infinite': case 0: case undefined: case -1: case null:\r\n          attemptsLeft = 'infinite';\r\n          break;\r\n        default:\r\n          attemptsLeft = assessmentConfig._attempts;\r\n          break;\r\n      }\r\n\r\n      this.set({\r\n        _currentQuestionComponentIds: [],\r\n        _assessmentCompleteInSession: false,\r\n        _attemptInProgress: false,\r\n        _isAssessmentComplete: false,\r\n        _numberOfQuestionsAnswered: 0,\r\n        _lastAttemptScoreAsPercent: 0,\r\n        _attempts: attemptsLeft,\r\n        _attemptsLeft: attemptsLeft,\r\n        _attemptsSpent: 0\r\n      });\r\n\r\n      this.listenToOnce(Adapt, 'app:dataReady', this._onDataReady);\r\n      this.listenTo(Adapt, 'remove', this._onRemove);\r\n\r\n    },\r\n\r\n    init: function() {\r\n      // save original children\r\n      this._originalChildModels = this.getChildren().models;\r\n      // collect all question components\r\n      this._currentQuestionComponents = this.findDescendantModels('components', {where: { _isQuestionType: true }});\r\n      this.set('_currentQuestionComponentIds', this._currentQuestionComponents.map(function(comp) {\r\n        return comp.get('_id');\r\n      }));\r\n\r\n      this._setAssessmentOwnershipOnChildrenModels();\r\n\r\n    },\r\n\r\n    _setAssessmentOwnershipOnChildrenModels: function() {\r\n      // mark all children components as belonging to an assessment\r\n      var assessmentConfig = this.get('_assessment');\r\n      var childConfig = {\r\n        _isPartOfAssessment: true,\r\n        _assessmentId: assessmentConfig._id\r\n      };\r\n      for (var i = 0, l = this._originalChildModels.length; i < l; i++) {\r\n        var blockModel = this._originalChildModels[i];\r\n        blockModel.set(childConfig);\r\n        //make sure components are set to _isPartOfAssessment for plp checking\r\n        blockModel.setOnChildren(childConfig);\r\n      }\r\n    },\r\n\r\n\r\n    _onDataReady: function() {\r\n      //register assessment\r\n      Adapt.assessment.register(this);\r\n    },\r\n\r\n    _setupAssessmentData: function(force, callback) {\r\n      var assessmentConfig = this.getConfig();\r\n      var state = this.getState();\r\n      var shouldResetAssessment = (!this.get('_attemptInProgress') && !state.isPass) || force === true;\r\n      var shouldResetQuestions = (assessmentConfig._isResetOnRevisit && (state.allowResetIfPassed || !state.isPass)) || force === true;\r\n\r\n      if (shouldResetAssessment || shouldResetQuestions) {\r\n        Adapt.trigger('assessments:preReset', this.getState(), this);\r\n      }\r\n\r\n      var quizModels;\r\n      if (shouldResetAssessment) {\r\n        this.set({\r\n          _numberOfQuestionsAnswered: 0,\r\n          _isAssessmentComplete: false,\r\n          _assessmentCompleteInSession: false,\r\n          _score: 0\r\n        });\r\n        this.getChildren().models = this._originalChildModels;\r\n        if (assessmentConfig._banks &&\r\n            assessmentConfig._banks._isEnabled &&\r\n            assessmentConfig._banks._split.length > 1) {\r\n\r\n          quizModels = this._setupBankedAssessment();\r\n        } else if(assessmentConfig._randomisation &&\r\n                  assessmentConfig._randomisation._isEnabled) {\r\n\r\n          quizModels = this._setupRandomisedAssessment();\r\n        }\r\n      }\r\n\r\n      if (!quizModels) {\r\n        // leave the order as before, completed or not\r\n        quizModels = this.getChildren().models;\r\n      } else if ( quizModels.length === 0 ) {\r\n        quizModels = this.getChildren().models;\r\n        console.warn('assessment: Not enough unique questions to create a fresh assessment, using last selection');\r\n      }\r\n\r\n      this.getChildren().models = quizModels;\r\n\r\n      this._currentQuestionComponents = this.findDescendantModels('components', {where: { _isQuestionType: true }});\r\n      this.set('_currentQuestionComponentIds', this._currentQuestionComponents.map(function(comp) {\r\n        return comp.get('_id');\r\n      }));\r\n\r\n      if (shouldResetAssessment || shouldResetQuestions) {\r\n        this._resetQuestions(function() {\r\n          this.set('_attemptInProgress', true);\r\n          Adapt.trigger('assessments:reset', this.getState(), this);\r\n\r\n          finalise.apply(this);\r\n        }.bind(this));\r\n      } else {\r\n        finalise.apply(this);\r\n      }\r\n\r\n      function finalise() {\r\n        if (!state.isComplete) {\r\n          this.set('_attemptInProgress', true);\r\n        }\r\n\r\n        this._overrideQuestionComponentSettings();\r\n        this._setupQuestionListeners();\r\n        this._checkNumberOfQuestionsAnswered();\r\n        this._updateQuestionsState();\r\n\r\n        Adapt.assessment.saveState();\r\n\r\n        if (typeof callback == 'function') callback.apply(this);\r\n\r\n        if (shouldResetAssessment || shouldResetQuestions) {\r\n          Adapt.trigger('assessments:postReset', this.getState(), this);\r\n        }\r\n      }\r\n    },\r\n\r\n    _setupBankedAssessment: function() {\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      this._setupBanks();\r\n\r\n      // get random questions from banks\r\n      var questionModels = [];\r\n      for (var bankId in this._questionBanks) {\r\n        if(this._questionBanks.hasOwnProperty(bankId)) { // skip over properties that were added to Array.prototype by the ES5-shim for IE8\r\n          var questionBank = this._questionBanks[bankId];\r\n          var questions = questionBank.getRandomQuestionBlocks();\r\n          questionModels = questionModels.concat(questions);\r\n        }\r\n      }\r\n\r\n      // if overall question order should be randomized\r\n      if (assessmentConfig._banks._randomisation) {\r\n        questionModels = _.shuffle(questionModels);\r\n      }\r\n\r\n      return questionModels;\r\n    },\r\n\r\n    _setupBanks: function() {\r\n      var assessmentConfig = this.getConfig();\r\n      var banks = assessmentConfig._banks._split.split(',');\r\n      var bankId;\r\n\r\n      this._questionBanks = [];\r\n\r\n      // build fresh banks\r\n      for (var i = 0, l = banks.length; i < l; i++) {\r\n        var bank = banks[i];\r\n        bankId = (i + 1);\r\n        var questionBank = new QuestionBank(bankId, this.get('_id'), bank, true);\r\n\r\n        this._questionBanks[bankId] = questionBank;\r\n      }\r\n\r\n      //add blocks to banks\r\n      var children = this.getChildren().models;\r\n      for (var j = 0, count = children.length; j < count; j++) {\r\n        var blockModel = children[j];\r\n        var blockAssessmentConfig = blockModel.get('_assessment');\r\n        if (!blockAssessmentConfig) continue;\r\n        bankId = blockAssessmentConfig._quizBankID;\r\n        this._questionBanks[bankId].addBlock(blockModel);\r\n      }\r\n\r\n    },\r\n\r\n    _setupRandomisedAssessment: function() {\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      var randomisationModel = assessmentConfig._randomisation;\r\n      var blockModels = this.getChildren().models;\r\n\r\n      var questionModels = _.shuffle(blockModels);\r\n\r\n      if (randomisationModel._blockCount > 0) {\r\n        questionModels = questionModels.slice(0, randomisationModel._blockCount);\r\n      }\r\n\r\n      return questionModels;\r\n    },\r\n\r\n    _overrideQuestionComponentSettings: function() {\r\n      var newSettings = this._getMarkingSettings();\r\n\r\n      // Add any additional setting overrides here\r\n      var questionConfig = this.getConfig()._questions;\r\n      if (questionConfig.hasOwnProperty('_canShowFeedback')) {\r\n        newSettings._canShowFeedback = questionConfig._canShowFeedback;\r\n      }\r\n\r\n      if (!_.isEmpty(newSettings)) {\r\n        for (var i = 0, l = this._currentQuestionComponents.length; i < l; i++) {\r\n          this._currentQuestionComponents[i].set(newSettings, { pluginName: '_assessment' });\r\n        }\r\n      }\r\n    },\r\n\r\n    _setupQuestionListeners: function() {\r\n      var questionComponents = this._currentQuestionComponents;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var question = questionComponents[i];\r\n        if (question.get('_isInteractionComplete')) continue;\r\n        this.listenTo(question, 'change:_isInteractionComplete', this._onQuestionCompleted);\r\n      }\r\n    },\r\n\r\n    _checkNumberOfQuestionsAnswered: function() {\r\n      var questionComponents = this._currentQuestionComponents;\r\n      var numberOfQuestionsAnswered = 0;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var question = questionComponents[i];\r\n        if (question.get('_isInteractionComplete')) {\r\n          numberOfQuestionsAnswered++;\r\n        }\r\n      }\r\n      this.set('_numberOfQuestionsAnswered', numberOfQuestionsAnswered);\r\n    },\r\n\r\n    _removeQuestionListeners: function() {\r\n      var questionComponents = this._currentQuestionComponents;\r\n      if (!questionComponents) return;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var question = questionComponents[i];\r\n        this.stopListening(question, 'change:_isInteractionComplete', this._onQuestionCompleted);\r\n      }\r\n    },\r\n\r\n    _onQuestionCompleted: function(questionModel, value) {\r\n      if (value === false) return;\r\n      if(!questionModel.get('_isInteractionComplete')) return;\r\n\r\n      var numberOfQuestionsAnswered = this.get('_numberOfQuestionsAnswered');\r\n      numberOfQuestionsAnswered++;\r\n      this.set('_numberOfQuestionsAnswered', numberOfQuestionsAnswered);\r\n\r\n      this._updateQuestionsState();\r\n      Adapt.assessment.saveState();\r\n\r\n      this._checkAssessmentComplete();\r\n    },\r\n\r\n    _checkAssessmentComplete: function() {\r\n      var numberOfQuestionsAnswered = this.get('_numberOfQuestionsAnswered');\r\n\r\n      var allQuestionsAnswered = numberOfQuestionsAnswered >= this._currentQuestionComponents.length;\r\n      if (!allQuestionsAnswered) return;\r\n\r\n      this._onAssessmentComplete();\r\n    },\r\n\r\n    _onAssessmentComplete: function() {\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      this.set('_attemptInProgress', false);\r\n      this._spendAttempt();\r\n\r\n      var scoreAsPercent = this._getScoreAsPercent();\r\n      var score = this._getScore();\r\n      var maxScore = this._getMaxScore();\r\n\r\n      this.set({\r\n        _scoreAsPercent: scoreAsPercent,\r\n        _score: score,\r\n        _maxScore: maxScore,\r\n        _lastAttemptScoreAsPercent: scoreAsPercent,\r\n        _assessmentCompleteInSession: true,\r\n        _isAssessmentComplete: true\r\n      });\r\n\r\n      this._updateQuestionsState();\r\n\r\n      this._checkIsPass();\r\n\r\n      this._removeQuestionListeners();\r\n\r\n      if (this._isMarkingSuppressionEnabled() && !this._isAttemptsLeft()) {\r\n        _.defer(function() {\r\n          this._overrideMarkingSettings();\r\n          this._refreshQuestions();\r\n        }.bind(this));\r\n      }\r\n\r\n      Adapt.trigger('assessments:complete', this.getState(), this);\r\n    },\r\n\r\n    _updateQuestionsState: function() {\r\n      var questions = [];\r\n\r\n      var questionComponents = this._currentQuestionComponents;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var questionComponent = questionComponents[i];\r\n\r\n        var questionModel = {\r\n          _id: questionComponent.get('_id'),\r\n          _isCorrect: questionComponent.get('_isCorrect') === undefined ? null : questionComponent.get('_isCorrect')\r\n        };\r\n\r\n        //build array of questions\r\n        questions.push(questionModel);\r\n\r\n      }\r\n\r\n      this.set('_questions', questions);\r\n    },\r\n\r\n    _checkIsPass: function() {\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      var isPercentageBased = assessmentConfig._isPercentageBased;\r\n      var scoreToPass = assessmentConfig._scoreToPass;\r\n\r\n      var scoreAsPercent = this.get('_scoreAsPercent');\r\n      var score = this.get('_score');\r\n\r\n      var isPass = isPercentageBased ? (scoreAsPercent >= scoreToPass) : (score >= scoreToPass);\r\n\r\n      this.set('_isPass', isPass);\r\n    },\r\n\r\n    _getMarkingSettings: function() {\r\n      var markingSettings = {};\r\n\r\n      if (this._shouldSuppressMarking()) {\r\n        markingSettings = {\r\n          _canShowMarking: false,\r\n          _canShowModelAnswer: false\r\n        };\r\n      } else {\r\n        var questionConfig = this.getConfig()._questions;\r\n\r\n        if (questionConfig.hasOwnProperty('_canShowModelAnswer')) {\r\n          markingSettings._canShowModelAnswer = questionConfig._canShowModelAnswer;\r\n        }\r\n\r\n        if (questionConfig.hasOwnProperty('_canShowMarking')) {\r\n          markingSettings._canShowMarking = questionConfig._canShowMarking;\r\n        }\r\n      }\r\n\r\n      return markingSettings;\r\n    },\r\n\r\n    _overrideMarkingSettings: function() {\r\n      var newMarkingSettings = this._getMarkingSettings();\r\n      for (var i = 0, l = this._currentQuestionComponents.length; i < l; i++) {\r\n        this._currentQuestionComponents[i].set(newMarkingSettings, {\r\n          pluginName: '_assessment'\r\n        });\r\n      }\r\n    },\r\n\r\n    _refreshQuestions: function() {\r\n      for (var a = 0, b = this._currentQuestionComponents.length; a < b; a++) {\r\n        var question = this._currentQuestionComponents[a];\r\n        question.refresh();\r\n      }\r\n    },\r\n\r\n    _shouldSuppressMarking: function() {\r\n      return this._isMarkingSuppressionEnabled() && this._isAttemptsLeft();\r\n    },\r\n\r\n    _isMarkingSuppressionEnabled: function() {\r\n      var assessmentConfig = this.getConfig();\r\n      return assessmentConfig._suppressMarking;\r\n    },\r\n\r\n    _isAttemptsLeft: function() {\r\n      if (this.get('_isAssessmentComplete') && this.get('_isPass')) return false;\r\n\r\n      if (this.get('_attemptsLeft') === 0) return false;\r\n\r\n      return true;\r\n    },\r\n\r\n    _spendAttempt: function() {\r\n      if (!this._isAttemptsLeft()) return false;\r\n\r\n      var attemptsSpent = this.get('_attemptsSpent');\r\n      this.set('_attemptsSpent', ++attemptsSpent);\r\n\r\n      if (this.get('_attempts') == 'infinite') return true;\r\n\r\n      var attemptsLeft = this.get('_attemptsLeft');\r\n      this.set('_attemptsLeft', --attemptsLeft);\r\n\r\n      return true;\r\n    },\r\n\r\n    _getScore: function() {\r\n      var score = 0;\r\n      var questionComponents = this._currentQuestionComponents;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var question = questionComponents[i];\r\n        if (question.get('_isCorrect') &&\r\n          question.get('_questionWeight')) {\r\n          score += question.get('_questionWeight');\r\n        }\r\n      }\r\n      return score;\r\n    },\r\n\r\n    _getMaxScore: function() {\r\n      var maxScore = 0;\r\n      var questionComponents = this._currentQuestionComponents;\r\n      for (var i = 0, l = questionComponents.length; i < l; i++) {\r\n        var question = questionComponents[i];\r\n        if (question.get('_questionWeight')) {\r\n          maxScore += question.get('_questionWeight');\r\n        }\r\n      }\r\n      return maxScore;\r\n    },\r\n\r\n    _getScoreAsPercent: function() {\r\n      if (this._getMaxScore() === 0) return 0;\r\n      return Math.round((this._getScore() / this._getMaxScore()) * 100);\r\n    },\r\n\r\n    _getLastAttemptScoreAsPercent: function() {\r\n      return this.get('_lastAttemptScoreAsPercent');\r\n    },\r\n\r\n    _checkReloadPage: function() {\r\n      if (!this.canResetInPage()) return false;\r\n\r\n      var parentId = this.getParent().get('_id');\r\n      var currentLocation = Adapt.location._currentId;\r\n\r\n      //check if on assessment page and should rerender page\r\n      if (currentLocation != parentId) return false;\r\n      if (!this.get('_isReady')) return false;\r\n\r\n      return true;\r\n    },\r\n\r\n    _reloadPage: function(callback) {\r\n      this._forceResetOnRevisit = true;\r\n\r\n      this.listenToOnce(Adapt, 'pageView:ready', callback);\r\n\r\n      _.delay(function() {\r\n        Backbone.history.navigate('#/id/' + Adapt.location._currentId, { replace:true, trigger: true });\r\n      }, 250);\r\n    },\r\n\r\n    _resetQuestions: function(callback) {\r\n      var assessmentConfig = this.getConfig();\r\n      var syncIterations = 1; // number of synchronous iterations to perform\r\n      var i = 0, qs = this._currentQuestionComponents, len = qs.length;\r\n\r\n      function step() {\r\n        for (var j = 0, count=Math.min(syncIterations, len-i); j < count; i++, j++) {\r\n          var question = qs[i];\r\n          question.reset(assessmentConfig._questions._resetType, true);\r\n        }\r\n\r\n        i == len ? callback() : setTimeout(step);\r\n      }\r\n\r\n      step();\r\n    },\r\n\r\n    _onRemove: function() {\r\n      this._removeQuestionListeners();\r\n    },\r\n\r\n    _setCompletionStatus: function() {\r\n      this.set({\r\n        _isComplete: true,\r\n        _isInteractionComplete: true\r\n      });\r\n    },\r\n\r\n    _checkIfQuestionsWereRestored: function() {\r\n      if (this.get('_assessmentCompleteInSession')) return;\r\n      if (!this.get('_isAssessmentComplete')) return;\r\n\r\n      //fix for courses that do not remember the user selections\r\n      //force assessment to reset if user revisits an assessment page in a new session which is completed\r\n      var wereQuestionsRestored = true;\r\n\r\n      var questions = this.get('_questions');\r\n      for (var i = 0, l = questions.length; i < l; i++) {\r\n        var question = questions[i];\r\n        var questionModel = Adapt.findById(question._id);\r\n        if (!questionModel.get('_isSubmitted')) {\r\n          wereQuestionsRestored = false;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (!wereQuestionsRestored) {\r\n        this.set('_assessmentCompleteInSession', true);\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    },\r\n\r\n\r\n  // Public Functions\r\n\r\n    isAssessmentEnabled: function() {\r\n      if (this.get('_assessment') &&\r\n        this.get('_assessment')._isEnabled) return true;\r\n      return false;\r\n    },\r\n\r\n    canResetInPage: function() {\r\n      var assessmentConfig = this.getConfig();\r\n      if (assessmentConfig._reloadPageOnReset === false) return false;\r\n      return true;\r\n    },\r\n\r\n    reset: function(force, callback) {\r\n\r\n      if (this._isResetInProgress) {\r\n        // prevent multiple resets from executing.\r\n        // keep callbacks in queue for when current reset is finished\r\n        this.once('reset', function() {\r\n          this._isResetInProgress = false;\r\n          if (typeof callback == 'function') {\r\n            callback(true);\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      //check if forcing reset via page revisit or force parameter\r\n      force = this._forceResetOnRevisit || force === true;\r\n      this._forceResetOnRevisit = false;\r\n\r\n      var isPageReload = this._checkReloadPage();\r\n\r\n      //stop resetting if not complete or not allowed\r\n      if (this.get('_assessmentCompleteInSession') &&\r\n          !assessmentConfig._isResetOnRevisit &&\r\n          !isPageReload &&\r\n          !force) {\r\n        if (typeof callback == 'function') {\r\n          callback(false);\r\n        }\r\n        return false;\r\n      }\r\n\r\n      //check if new session and questions not restored\r\n      var wereQuestionsRestored = this._checkIfQuestionsWereRestored();\r\n      force = force || wereQuestionsRestored;\r\n      // the assessment is going to be reset so we must reset attempts\r\n      // otherwise assessment may not be set up properly in next session\r\n      if (force && !this._isAttemptsLeft()) {\r\n        this.set({\r\n          _attemptsLeft: this.get('_attempts'),\r\n          _attemptsSpent: 0\r\n        });\r\n      }\r\n\r\n      var allowResetIfPassed = this.get('_assessment')._allowResetIfPassed;\r\n      //stop resetting if no attempts left and allowResetIfPassed is false\r\n      if (!this._isAttemptsLeft() && !force && !allowResetIfPassed) {\r\n        if (typeof callback == 'function') callback(false);\r\n        return false;\r\n      }\r\n\r\n      if (!isPageReload) {\r\n        // only perform this section when not attempting to reload the page\r\n        // wait for reset to trigger\r\n        this.once('reset', function() {\r\n          this._isResetInProgress = false;\r\n          if (typeof callback == 'function') {\r\n            callback(true);\r\n          }\r\n        });\r\n        this._isResetInProgress = true;\r\n        // perform asynchronous reset\r\n        this._setupAssessmentData(force, function() {\r\n          this.trigger('reset');\r\n        });\r\n      } else {\r\n        this._reloadPage(function() {\r\n          if (typeof callback == 'function') {\r\n            callback(true);\r\n          }\r\n        });\r\n      }\r\n\r\n      return true;\r\n    },\r\n\r\n    getSaveState: function() {\r\n      var state = this.getState();\r\n      let blocks;\r\n      var cfg = this.getConfig();\r\n      var banksActive = cfg._banks && cfg._banks._isEnabled && cfg._banks._split.length > 1;\r\n      var randomisationActive = cfg._randomisation && cfg._randomisation._isEnabled;\r\n\r\n      if (!banksActive && !randomisationActive) {\r\n        // include presentation blocks in save state so that blocks without questions aren't removed\r\n        blocks = this.findDescendantModels('block');\r\n      } else {\r\n        blocks = state.questions.map(question => Adapt.findById(question._id).getParent());\r\n      }\r\n      blocks = blocks.filter(block => {\r\n        const trackingId = block.get('_trackingId');\r\n        return Number.isInteger(trackingId) && trackingId >= 0;\r\n      });\r\n      const blockTrackingIds = blocks.map(block => block.get('_trackingId'));\r\n      const blockCompletion = blocks.map(block => {\r\n        let questions = block.findDescendantModels('question');\r\n        return questions.map(question => question.get('_isCorrect') || false);\r\n      });\r\n      const blockData = [blockTrackingIds, blockCompletion];\r\n\r\n      const saveState = [\r\n        state.isComplete ? 1:0,\r\n        state.attemptsSpent,\r\n        state.maxScore || 0,\r\n        state.score,\r\n        state.attemptInProgress ? 1:0,\r\n      ];\r\n\r\n      const dataPackage = [saveState, blockData]\r\n\r\n      return dataPackage;\r\n    },\r\n\r\n    setRestoreState: function(dataPackage) {\r\n      const restoreState = dataPackage[0];\r\n      const blockData = dataPackage[1];\r\n      var id;\r\n      var isComplete = restoreState[0] == 1 ? true : false;\r\n      var attempts = this.get('_attempts');\r\n      var attemptsSpent = restoreState[1];\r\n      var maxScore = restoreState[2];\r\n      var score = restoreState[3];\r\n      var attemptInProgress = restoreState[4] == 1 ? true : false;\r\n      var scoreAsPercent;\r\n\r\n      let blocks = blockData[0].map(trackingId => Adapt.data.findWhere({ _trackingId: trackingId }));\r\n\r\n      if (blocks.length) {\r\n        this.getChildren().models = blocks;\r\n      }\r\n\r\n      this.set({\r\n        _isAssessmentComplete: isComplete,\r\n        _assessmentCompleteInSession: false,\r\n        _attemptsSpent: attemptsSpent,\r\n        _attemptInProgress: attemptInProgress,\r\n        _attemptsLeft: (attempts === 'infinite' ? attempts : attempts - attemptsSpent),\r\n        _maxScore: maxScore || this._getMaxScore(),\r\n        _score: score || 0\r\n      });\r\n\r\n      if (score) {\r\n        scoreAsPercent = Math.round( score / maxScore  * 100);\r\n      } else {\r\n        scoreAsPercent = 0;\r\n      }\r\n\r\n      this.set({\r\n        _scoreAsPercent: scoreAsPercent,\r\n        _lastAttemptScoreAsPercent: scoreAsPercent\r\n      });\r\n\r\n      var questions = [];\r\n      blocks.forEach((block, blockIndex) => {\r\n        const blockQuestions = block.findDescendantModels('question');\r\n        blockQuestions.forEach((question, questionIndex) => {\r\n          questions.push({\r\n            _id: question.get('_id'),\r\n            _isCorrect: blockData[1][blockIndex][questionIndex]\r\n          });\r\n        });\r\n      });\r\n      this.set('_questions', questions);\r\n\r\n      if (isComplete) this._checkIsPass();\r\n\r\n      Adapt.trigger('assessments:restored', this.getState(), this);\r\n\r\n    },\r\n\r\n    getState: function() {\r\n      //return the current state of the assessment\r\n      //create snapshot of values so as not to create memory leaks\r\n      var assessmentConfig = this.getConfig();\r\n\r\n      var state = {\r\n        id: assessmentConfig._id,\r\n        type: 'article-assessment',\r\n        pageId: this.getParent().get('_id'),\r\n        articleId: this.get('_id'),\r\n        isEnabled: assessmentConfig._isEnabled,\r\n        isComplete: this.get('_isAssessmentComplete'),\r\n        isPercentageBased: assessmentConfig._isPercentageBased,\r\n        scoreToPass: assessmentConfig._scoreToPass,\r\n        score: this.get('_score'),\r\n        scoreAsPercent: this.get('_scoreAsPercent'),\r\n        maxScore: this.get('_maxScore'),\r\n        isPass: this.get('_isPass'),\r\n        includeInTotalScore: assessmentConfig._includeInTotalScore,\r\n        assessmentWeight: assessmentConfig._assessmentWeight,\r\n        attempts: this.get('_attempts'),\r\n        attemptsSpent: this.get('_attemptsSpent'),\r\n        attemptsLeft: this.get('_attemptsLeft'),\r\n        attemptInProgress: this.get('_attemptInProgress'),\r\n        lastAttemptScoreAsPercent: this.get('_lastAttemptScoreAsPercent'),\r\n        questions: this.get('_questions'),\r\n        resetType: assessmentConfig._questions._resetType,\r\n        allowResetIfPassed: assessmentConfig._allowResetIfPassed,\r\n        questionModels: new Backbone.Collection(this._currentQuestionComponents)\r\n      };\r\n\r\n      return state;\r\n    },\r\n\r\n    getConfig: function() {\r\n      var assessmentConfig = this.get('_assessment');\r\n\r\n      if (!assessmentConfig) {\r\n        assessmentConfig = $.extend(true, {}, assessmentConfigDefaults);\r\n      } else {\r\n        assessmentConfig = $.extend(true, {}, assessmentConfigDefaults, assessmentConfig);\r\n      }\r\n\r\n      if (assessmentConfig._id === undefined) {\r\n        assessmentConfig._id = 'givenId'+(givenIdCount++);\r\n      }\r\n\r\n      this.set('_assessment', assessmentConfig);\r\n\r\n      return assessmentConfig;\r\n    }\r\n\r\n  };\r\n\r\n  return AssessmentModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  /*\r\n   * Here we setup a registry for all assessments\r\n   */\r\n  var assessmentsConfigDefaults = {\r\n    _isPercentageBased: true,\r\n    _scoreToPass: 100,\r\n    _isDefaultsLoaded: true\r\n  };\r\n\r\n  Adapt.assessment = _.extend({\r\n\r\n  // Private functions\r\n\r\n    _assessments: _.extend([], {\r\n      _byPageId: {},\r\n      _byAssessmentId: {}\r\n    }),\r\n\r\n    initialize: function() {\r\n      this.listenTo(Adapt, {\r\n        'assessments:complete': this._onAssessmentsComplete,\r\n        'router:location': this._checkResetAssessmentsOnRevisit,\r\n        'router:plugin': this._handleRoute,\r\n        'app:dataReady': this._onDataReady\r\n      });\r\n    },\r\n\r\n    _onAssessmentsComplete: function(state) {\r\n      var assessmentId = state.id;\r\n\r\n      state.isComplete = true;\r\n\r\n      if (assessmentId === undefined) return;\r\n\r\n      if (!this._getStateByAssessmentId(assessmentId)) {\r\n        Adapt.log.warn('assessments: state was not registered when assessment was created');\r\n      }\r\n\r\n      this.saveState();\r\n\r\n      this._setPageProgress();\r\n\r\n      this._checkAssessmentsComplete();\r\n\r\n    },\r\n\r\n    _restoreModelState: function(assessmentModel) {\r\n\r\n      if (!this._saveStateModel) {\r\n        this._saveStateModel = Adapt.offlineStorage.get('a');\r\n      }\r\n      if (this._saveStateModel) {\r\n        var state = assessmentModel.getState();\r\n        if (this._saveStateModel[state.id]) {\r\n          assessmentModel.setRestoreState(Adapt.offlineStorage.deserialize(this._saveStateModel[state.id]));\r\n        }\r\n      }\r\n\r\n    },\r\n\r\n    /*\r\n     * Allow navigating to an assessment via the URL.\r\n     */\r\n    _handleRoute: function(plugin, id) {\r\n      if (plugin !== 'assessment' && plugin !== 'article-assessment' || id === undefined) {\r\n        return;\r\n      }\r\n\r\n      // Check the 'id' passed is that of an article.\r\n      if (!Adapt.findById(id)) {\r\n        // The 'id' passed may have been the assessment _id/name, not the article _id.\r\n        var assessment = Adapt.assessment._assessments._byAssessmentId[id];\r\n        if (assessment) {\r\n          // Set 'id' to the article _id.\r\n          id = assessment.get('_id');\r\n        } else {\r\n          Adapt.log.warn('Assessment not found with _id: ' + id);\r\n          return;\r\n        }\r\n      }\r\n\r\n      _.defer(function() {\r\n        // Defer this call so that the router's _canNavigate flag is true.\r\n        Backbone.history.navigate('#/id/' + id, { trigger: true, replace: true });\r\n      });\r\n    },\r\n\r\n    _checkResetAssessmentsOnRevisit: function(toObject) {\r\n      /*\r\n       * Here we hijack router:location to reorganise the assessment blocks\r\n       * this must happen before trickle listens to block completion\r\n       */\r\n      if (toObject._contentType !== 'page') return;\r\n\r\n      // initialize assessment on page visit before pageView:preRender (and trickle)\r\n      var pageAssessmentModels = this._getAssessmentByPageId(toObject._currentId);\r\n      if (pageAssessmentModels === undefined) return;\r\n\r\n      /*\r\n       * Here we further hijack the router to ensure the asynchronous assessment\r\n       * reset completes before routing completes\r\n       */\r\n      Adapt.wait.for(function resetAllAssessments(allAssessmentHaveReset) {\r\n\r\n        var numberOfAssessments = pageAssessmentModels.length;\r\n        var numberOfResetAssessments = 0;\r\n        var forceAssessmentReset = false;\r\n\r\n        pageAssessmentModels.forEach(function(model) {\r\n\r\n          model.reset(forceAssessmentReset, function() {\r\n\r\n            numberOfResetAssessments++;\r\n            var haveAllModelsReset = (numberOfResetAssessments === numberOfAssessments);\r\n            if (!haveAllModelsReset) {\r\n              return;\r\n            }\r\n\r\n            allAssessmentHaveReset();\r\n\r\n          });\r\n\r\n        });\r\n\r\n      });\r\n\r\n      this._setPageProgress();\r\n    },\r\n\r\n    _onDataReady: function() {\r\n      this._assessments = _.extend([], {\r\n        _byPageId: {},\r\n        _byAssessmentId: {}\r\n      });\r\n\r\n      this._restoredCount = 0;\r\n    },\r\n\r\n\r\n    _checkAssessmentsComplete: function() {\r\n      var allAssessmentsComplete = true;\r\n      var assessmentToPostBack = 0;\r\n      var states = this._getStatesByAssessmentId();\r\n\r\n      var assessmentStates = [];\r\n\r\n      for (var id in states) {\r\n        var state = states[id];\r\n        if (!state.includeInTotalScore) continue;\r\n        if (!state.isComplete) {\r\n          allAssessmentsComplete = false;\r\n          break;\r\n        }\r\n        assessmentToPostBack++;\r\n        assessmentStates.push(state);\r\n      }\r\n\r\n      if (!allAssessmentsComplete || assessmentToPostBack === 0) return false;\r\n\r\n      if (assessmentToPostBack === 1) {\r\n        this._setupSingleAssessmentConfiguration(assessmentStates[0]);\r\n      }\r\n\r\n      _.defer(function() {\r\n        Adapt.trigger('assessment:complete', this.getState());\r\n      }.bind(this));\r\n\r\n      return true;\r\n    },\r\n\r\n    _setupSingleAssessmentConfiguration: function(assessmentState) {\r\n      var assessmentsConfig = Adapt.course.get('_assessment');\r\n      $.extend(true, assessmentsConfig, {\r\n        _isPercentageBased: assessmentState.isPercentageBased,\r\n        _scoreToPass: assessmentState.scoreToPass\r\n      });\r\n      Adapt.course.set('_assessment', assessmentsConfig);\r\n    },\r\n\r\n    _getAssessmentByPageId: function(pageId) {\r\n      return this._assessments._byPageId[pageId];\r\n    },\r\n\r\n    _getStateByAssessmentId: function(assessmentId) {\r\n      if (assessmentId === undefined) {\r\n        return null;\r\n      }\r\n\r\n      return this._assessments._byAssessmentId[assessmentId].getState();\r\n    },\r\n\r\n    _getStatesByAssessmentId: function() {\r\n      var states = {};\r\n      for (var i = 0, l = this._assessments.length; i < l; i++) {\r\n        var assessmentModel = this._assessments[i];\r\n        if (!assessmentModel.get('_isAvailable')) continue;\r\n        var state = assessmentModel.getState();\r\n        states[state.id] = state;\r\n      }\r\n      return states;\r\n    },\r\n\r\n    _setPageProgress: function() {\r\n      // set _subProgressTotal and _subProgressComplete on pages that have assessment progress indicator requirements\r\n\r\n      for (var k in this._assessments._byPageId) {\r\n\r\n        var assessments = this._assessments._byPageId[k];\r\n\r\n        var assessmentsTotal = assessments.length;\r\n        var assessmentsPassed = 0;\r\n\r\n        for (var i = 0, l = assessments.length; i < l; i++) {\r\n          var assessmentState = assessments[i].getState();\r\n\r\n          if (assessmentState.includeInTotalScore && !assessmentState.isPass) continue;\r\n\r\n          if (assessmentState.isComplete) {\r\n            assessmentsPassed++;\r\n          }\r\n        }\r\n\r\n        try {\r\n          var pageModel = Adapt.findById(k);\r\n          pageModel.set({\r\n            _subProgressTotal: assessmentsTotal,\r\n            _subProgressComplete: assessmentsPassed\r\n          });\r\n        } catch(e) {\r\n\r\n        }\r\n\r\n      }\r\n    },\r\n\r\n    _addToAssessmentIdMap: function(id, model) {\r\n      if (id === undefined) {\r\n        Adapt.log.warn('An assessment has been registered with an undefined value for \"_id\"');\r\n        return;\r\n      }\r\n\r\n      if (id === '') {\r\n        Adapt.log.warn('An assessment has been registered with an empty value for \"_id\"');\r\n      }\r\n\r\n      if (!this._assessments._byAssessmentId[id]) {\r\n        this._assessments._byAssessmentId[id] = model;\r\n      } else {\r\n        Adapt.log.warn('An assessment with an _id of \"' + id + '\" already exists!');\r\n      }\r\n    },\r\n\r\n    _setupQuestionNumbering: function() {\r\n      var getRelatedQuestions = function(data) {\r\n        var currentAssessmentId = data._assessmentId;\r\n        var currentAssessment =  Adapt.assessment.get(currentAssessmentId);\r\n        return currentAssessment.getState().questions;\r\n      };\r\n\r\n      Handlebars.registerHelper('questionNumber', function getQuestionNumber() {\r\n        var data = this.view ? this.view.model.toJSON() : this;\r\n        if (!data._isPartOfAssessment) return;\r\n\r\n        var related = _.pluck(getRelatedQuestions(data), '_id');\r\n\r\n        return related.indexOf(data._id) + 1;\r\n      });\r\n\r\n      Handlebars.registerHelper('questionCount', function getTotalQuestions() {\r\n        var data = this.view ? this.view.model.toJSON() : this;\r\n        if (!data._isPartOfAssessment) return;\r\n        return getRelatedQuestions(data).length;\r\n      });\r\n    },\r\n\r\n  // Public functions\r\n\r\n    register: function(assessmentModel) {\r\n      var state = assessmentModel.getState();\r\n      var assessmentId = state.id;\r\n      var pageId = state.pageId;\r\n\r\n      if (this._assessments._byPageId[pageId] === undefined) {\r\n        this._assessments._byPageId[pageId] = [];\r\n      }\r\n\r\n      this._assessments._byPageId[pageId].push(assessmentModel);\r\n\r\n      this._addToAssessmentIdMap(assessmentId, assessmentModel);\r\n\r\n      this._assessments.push(assessmentModel);\r\n\r\n      this._restoreModelState(assessmentModel);\r\n      this._restoredCount++;\r\n\r\n      Adapt.trigger('assessments:register', state, assessmentModel);\r\n\r\n      this._setPageProgress();\r\n\r\n      this._setupQuestionNumbering();\r\n\r\n      if (this._restoredCount === this._assessments.length) {\r\n        // Since all assessments have been stored, broadcast an\r\n        // event which has the collated state.\r\n        Adapt.trigger('assessment:restored', this.getState());\r\n      }\r\n    },\r\n\r\n    get: function(id) {\r\n      if (id === undefined) {\r\n        return this._assessments.slice(0);\r\n      } else {\r\n        return this._assessments._byAssessmentId[id];\r\n      }\r\n    },\r\n\r\n    saveState: function() {\r\n\r\n      this._saveStateModel = {};\r\n      for (var i = 0, assessmentModel; assessmentModel = this._assessments[i++];) {\r\n        var state = assessmentModel.getState();\r\n        this._saveStateModel[state.id] = Adapt.offlineStorage.serialize(assessmentModel.getSaveState())\r\n      }\r\n\r\n      Adapt.offlineStorage.set('a', this._saveStateModel);\r\n    },\r\n\r\n    getConfig: function () {\r\n      var assessmentsConfig = Adapt.course.get('_assessment');\r\n\r\n      if (assessmentsConfig && assessmentsConfig._isDefaultsLoaded) {\r\n        return assessmentsConfig;\r\n      }\r\n\r\n      if (assessmentsConfig === undefined) {\r\n        assessmentsConfig = $.extend(true, {}, assessmentsConfigDefaults);\r\n      } else {\r\n        assessmentsConfig = $.extend(true, {}, assessmentsConfigDefaults, assessmentsConfig);\r\n      }\r\n\r\n      Adapt.course.set('_assessment', assessmentsConfig);\r\n\r\n      return assessmentsConfig;\r\n    },\r\n\r\n    getState: function() {\r\n      var assessmentsConfig = this.getConfig();\r\n\r\n      var score = 0;\r\n      var maxScore = 0;\r\n      var isPass = false;\r\n      var totalAssessments = 0;\r\n\r\n      var states = this._getStatesByAssessmentId();\r\n\r\n      var assessmentsComplete = 0;\r\n\r\n      for (var id in states) {\r\n        var state = states[id];\r\n        if (!state.includeInTotalScore) continue;\r\n        if (state.isComplete) assessmentsComplete++;\r\n        totalAssessments++;\r\n        maxScore += state.maxScore / state.assessmentWeight;\r\n        score += state.score / state.assessmentWeight;\r\n      }\r\n\r\n      var isComplete = assessmentsComplete == totalAssessments;\r\n\r\n      var scoreAsPercent = Math.round((score / maxScore) * 100);\r\n\r\n      if ((assessmentsConfig._scoreToPass || 100) && isComplete) {\r\n        if (assessmentsConfig._isPercentageBased !== false) {\r\n          if (scoreAsPercent >= assessmentsConfig._scoreToPass) isPass = true;\r\n        } else {\r\n          if (score >= assessmentsConfig._scoreToPass) isPass = true;\r\n        }\r\n      }\r\n\r\n      return {\r\n        isComplete: isComplete,\r\n        isPercentageBased: assessmentsConfig._isPercentageBased,\r\n        isPass: isPass,\r\n        scoreAsPercent: scoreAsPercent,\r\n        maxScore: maxScore,\r\n        score: score,\r\n        scoreToPass: assessmentsConfig._scoreToPass,\r\n        assessmentsComplete: assessmentsComplete,\r\n        assessments: totalAssessments\r\n      };\r\n    }\r\n\r\n  }, Backbone.Events);\r\n\r\n  Adapt.assessment.initialize();\r\n\r\n});\r\n","define([\r\n  'core/js/views/articleView',\r\n  'core/js/models/articleModel',\r\n  './adapt-assessmentArticleView',\r\n  './adapt-assessmentArticleModel',\r\n  './assessment'\r\n], function(ArticleView, ArticleModel, AdaptAssessmentArticleView, AdaptAssessmentArticleModel) {\r\n\r\n  /*\r\n   * Here we are extending the articleView and articleModel in Adapt.\r\n   * This is to accomodate the assessment functionality on the article.\r\n   * The advantage of this method is that the assessment behaviour can utilize all of the predefined article behaviour in both the view and the model.\r\n   */\r\n\r\n  //Extends core/js/views/articleView.js\r\n  var ArticleViewInitialize = ArticleView.prototype.initialize;\r\n  ArticleView.prototype.initialize = function(options) {\r\n    if (this.model.get('_assessment') && this.model.get('_assessment')._isEnabled === true) {\r\n      //extend the articleView with new functionality\r\n      _.extend(this, AdaptAssessmentArticleView);\r\n    }\r\n    //initialize the article in the normal manner\r\n    return ArticleViewInitialize.apply(this, arguments);\r\n  };\r\n\r\n  //Extends core/js/models/articleModel.js\r\n  var ArticleModelInitialize = ArticleModel.prototype.initialize;\r\n  ArticleModel.prototype.initialize = function(options) {\r\n    if (this.get('_assessment') && this.get('_assessment')._isEnabled === true) {\r\n      //extend the articleModel with new functionality\r\n      _.extend(this, AdaptAssessmentArticleModel);\r\n\r\n      //initialize the article in the normal manner\r\n      var returnValue = ArticleModelInitialize.apply(this, arguments);\r\n\r\n      //initialize assessment article\r\n      this._postInitialize();\r\n\r\n      return returnValue;\r\n    }\r\n\r\n    //initialize the article in the normal manner if no assessment\r\n    return ArticleModelInitialize.apply(this, arguments);\r\n  };\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var Bookmarking = Backbone.Controller.extend({\r\n\r\n    bookmarkLevel: null,\r\n    watchViewIds: null,\r\n    watchViews: [],\r\n    restoredLocationID: null,\r\n    currentLocationID: null,\r\n\r\n    initialize: function () {\r\n      this.listenToOnce(Adapt, 'router:location', this.onAdaptInitialize);\r\n    },\r\n\r\n    onAdaptInitialize: function() {\r\n      if (!this.checkIsEnabled()) return;\r\n      this.setupEventListeners();\r\n      this.checkRestoreLocation();\r\n    },\r\n\r\n    checkIsEnabled: function() {\r\n      var courseBookmarkModel = Adapt.course.get('_bookmarking');\r\n      if (!courseBookmarkModel || !courseBookmarkModel._isEnabled) return false;\r\n      if (!Adapt.offlineStorage) return false;\r\n      return true;\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this._onScroll = _.debounce(this.checkLocation.bind(this), 1000);\r\n      this.listenTo(Adapt, {\r\n        'menuView:ready': this.setupMenu,\r\n        'pageView:preRender': this.setupPage\r\n      });\r\n    },\r\n\r\n    checkRestoreLocation: function() {\r\n      this.restoredLocationID = Adapt.offlineStorage.get('location');\r\n\r\n      if (!this.restoredLocationID || this.restoredLocationID === 'undefined') return;\r\n\r\n      this.listenToOnce(Adapt, 'pageView:ready menuView:ready', this.restoreLocation);\r\n    },\r\n\r\n    restoreLocation: function() {\r\n      _.defer(function() {\r\n        this.stopListening(Adapt, 'pageView:ready menuView:ready', this.restoreLocation);\r\n\r\n        if ((this.restoredLocationID === Adapt.location._currentId) || !Adapt.findById(this.restoredLocationID)) {\r\n          return;\r\n        }\r\n        var locationOnscreen = $('.' + this.restoredLocationID).onscreen();\r\n        var isLocationOnscreen = locationOnscreen && (locationOnscreen.percentInview > 0);\r\n        var isLocationFullyInview = locationOnscreen && (locationOnscreen.percentInview === 100);\r\n        if (isLocationOnscreen && isLocationFullyInview) {\r\n          return;\r\n        }\r\n\r\n        if (Adapt.course.get('_bookmarking')._showPrompt === false) {\r\n          this.navigateToPrevious();\r\n          return;\r\n        }\r\n        this.showPrompt();\r\n\r\n      }.bind(this));\r\n    },\r\n\r\n    showPrompt: function() {\r\n      var courseBookmarkModel = Adapt.course.get('_bookmarking');\r\n      var buttons = courseBookmarkModel._buttons || { yes: 'Yes', no: 'No' };\r\n\r\n      this.listenToOnce(Adapt, {\r\n        'bookmarking:continue': this.navigateToPrevious,\r\n        'bookmarking:cancel': this.navigateCancel\r\n      });\r\n\r\n      var promptObject = {\r\n        title: courseBookmarkModel.title,\r\n        body: courseBookmarkModel.body,\r\n        _prompts:[\r\n          {\r\n            promptText: buttons.yes || 'Yes',\r\n            _callbackEvent: 'bookmarking:continue'\r\n          },\r\n          {\r\n            promptText: buttons.no || 'No',\r\n            _callbackEvent: 'bookmarking:cancel'\r\n          }\r\n        ],\r\n        _showIcon: true\r\n      };\r\n\r\n      var accessibility = Adapt.config.get('_accessibility');\r\n      if (!accessibility || !accessibility._isActive) {\r\n        Adapt.notify.prompt(promptObject);\r\n        return;\r\n      }\r\n\r\n      $('.js-loading').show();\r\n      $('#a11y-focuser').focus();\r\n      $('body').attr('aria-hidden', true);\r\n      _.delay(function() {\r\n        $('.js-loading').hide();\r\n        $('body').removeAttr('aria-hidden');\r\n        Adapt.notify.prompt(promptObject);\r\n      }, 3000);\r\n    },\r\n\r\n    navigateToPrevious: function() {\r\n      _.defer(function() {\r\n        var isSinglePage = Adapt.contentObjects.models.length == 1;\r\n        Backbone.history.navigate('#/id/' + this.restoredLocationID, {trigger: true, replace: isSinglePage});\r\n      }.bind(this));\r\n\r\n      this.stopListening(Adapt, 'bookmarking:cancel');\r\n    },\r\n\r\n    navigateCancel: function() {\r\n      this.stopListening(Adapt, 'bookmarking:continue');\r\n    },\r\n\r\n    resetLocationID: function () {\r\n      this.setLocationID('');\r\n    },\r\n\r\n    /**\r\n     * if the learner navigates to the top-level menu, clear the stored bookmark\r\n     * if it's a sub-menu, store the menu's id as the bookmark\r\n     */\r\n    setupMenu: function(menuView) {\r\n      var menuModel = menuView.model;\r\n\r\n      if (!menuModel.get('_parentId')) {\r\n        this.resetLocationID();\r\n        return;\r\n      }\r\n\r\n      this.setLocationID(menuModel.get('_id'));\r\n    },\r\n\r\n    /**\r\n     * Calculates what the bookmarking 'level' will be for any given page.\r\n     * First sets a default using the course-level setting (or 'component' if that's not been set)\r\n     * then checks to see if that's being overridden at page level or not\r\n     * @param {Backbone.Model} pageModel The model for the current page view\r\n     * @return {String} Either 'page', 'block', or 'component' - with 'component' being the default\r\n     */\r\n    getBookmarkLevel: function(pageModel) {\r\n      var defaultLevel = Adapt.course.get('_bookmarking')._level || 'component';\r\n      var bookmarkModel = pageModel.get('_bookmarking');\r\n      var isInherit = !bookmarkModel || !bookmarkModel._level || bookmarkModel._level === 'inherit';\r\n      return isInherit ? defaultLevel : bookmarkModel._level;\r\n    },\r\n\r\n    /**\r\n     * Sets up bookmarking for the page the learner just navigated to\r\n     * If bookmarking is disabled for the current page, clear the stored bookmark and return.\r\n     * Otherwise, bookmark the page then - if necessary - set up to calculate which block or component\r\n     * should be bookmarked as the learner scrolls up/down the page\r\n     * @param {Backbone.View} pageView The current page view\r\n     */\r\n    setupPage: function (pageView) {\r\n      var pageBookmarkModel = pageView.model.get('_bookmarking');\r\n      if (pageBookmarkModel && pageBookmarkModel._isEnabled === false) {\r\n        this.resetLocationID();\r\n        return;\r\n      }\r\n\r\n      this.setLocationID(pageView.model.get('_id'));\r\n\r\n      this.bookmarkLevel = this.getBookmarkLevel(pageView.model);\r\n      if (this.bookmarkLevel === 'page') {\r\n        return;\r\n      }\r\n\r\n      this.watchViewIds = pageView.model.findDescendantModels(this.bookmarkLevel).map(function(desc) {\r\n        return desc.get('_id');\r\n      });\r\n\r\n      this.listenTo(Adapt, this.bookmarkLevel + 'View:postRender', this.captureViews);\r\n      this.listenToOnce(Adapt, 'remove', this.releaseViews);\r\n\r\n      $(window).on('scroll', this._onScroll);\r\n    },\r\n\r\n    captureViews: function (view) {\r\n      this.watchViews.push(view);\r\n    },\r\n\r\n    setLocationID: function (id) {\r\n      if (!Adapt.offlineStorage) return;\r\n      if (this.currentLocationID == id) return;\r\n      Adapt.offlineStorage.set('location', id);\r\n      this.currentLocationID = id;\r\n    },\r\n\r\n    releaseViews: function () {\r\n      this.watchViews.length = 0;\r\n      this.watchViewIds.length = 0;\r\n      this.stopListening(Adapt, 'remove', this.releaseViews);\r\n      this.stopListening(Adapt, this.bookmarkLevel + 'View:postRender', this.captureViews);\r\n      $(window).off('scroll', this._onScroll);\r\n    },\r\n\r\n    checkLocation: function() {\r\n      var highestOnscreen = 0;\r\n      var highestOnscreenLocation = '';\r\n\r\n      for (var i = 0, l = this.watchViews.length; i < l; i++) {\r\n        var view = this.watchViews[i];\r\n\r\n        var isViewAPageChild = (this.watchViewIds.indexOf(view.model.get('_id')) > -1 );\r\n\r\n        if (!isViewAPageChild ) continue;\r\n\r\n        var element = $('.' + view.model.get('_id'));\r\n        var measurements = element.onscreen();\r\n\r\n        if (!measurements.onscreen) continue;\r\n        if (measurements.percentInview > highestOnscreen) {\r\n          highestOnscreen = measurements.percentInview;\r\n          highestOnscreenLocation = view.model.get('_id');\r\n        }\r\n      }\r\n\r\n      // set location as most inview component\r\n      if (highestOnscreenLocation) this.setLocationID(highestOnscreenLocation);\r\n    }\r\n\r\n  });\r\n\r\n  return new Bookmarking();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var NavigationView = Backbone.View.extend({\r\n\r\n    className: 'nav',\r\n\r\n    attributes: {\r\n      role: 'navigation'\r\n    },\r\n\r\n    initialize: function() {\r\n      this.template = 'languagePickerNavigation';\r\n      this.setupHelpers();\r\n      this.preRender();\r\n    },\r\n\r\n    preRender: function() {\r\n      Adapt.trigger('navigationView:preRender', this);\r\n      this.render();\r\n    },\r\n\r\n    render: function() {\r\n      var template = Handlebars.templates[this.template];\r\n      this.$el.html(template({\r\n        _config: this.model.get('_accessibility'),\r\n        _accessibility: Adapt.config.get('_accessibility')\r\n      })).insertBefore('#app');\r\n\r\n      _.defer(function() {\r\n        Adapt.trigger('navigationView:postRender', this);\r\n      }.bind(this));\r\n\r\n      return this;\r\n    },\r\n\r\n    setupHelpers: function() {\r\n      Handlebars.registerHelper('a11y_aria_label', function(text) {\r\n        return '<div class=\"aria-label\">'+text+'</div>';\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n  return NavigationView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './languagePickerNavigationView'\r\n], function(Adapt, NavigationView) {\r\n\r\n  var LanguagePickerView = Backbone.View.extend({\r\n\r\n    events: {\r\n      'click .js-languagepicker-btn-click': 'onLanguageClick'\r\n    },\r\n\r\n    className: 'languagepicker',\r\n\r\n    initialize: function () {\r\n      this.initializeNavigation();\r\n      $('html').addClass('in-languagepicker');\r\n      this.listenTo(Adapt, 'remove', this.remove);\r\n      this.render();\r\n    },\r\n\r\n    render: function () {\r\n      var data = this.model.toJSON();\r\n      var template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n      this.$el.addClass(data._classes);\r\n\r\n      document.title = this.model.get('title') || \"\";\r\n\r\n      _.defer(this.postRender.bind(this));\r\n    },\r\n\r\n    postRender: function () {\r\n      $('.js-loading').hide();\r\n    },\r\n\r\n    onLanguageClick: function (event) {\r\n      this.destroyNavigation();\r\n      this.model.setLanguage($(event.target).val());\r\n    },\r\n\r\n    initializeNavigation: function() {\r\n      this.navigationView = new NavigationView({model:this.model});\r\n    },\r\n\r\n    destroyNavigation: function() {\r\n      this.navigationView.remove();\r\n    },\r\n\r\n    remove: function() {\r\n      $('html').removeClass('in-languagepicker');\r\n\r\n      Backbone.View.prototype.remove.apply(this, arguments);\r\n    }\r\n\r\n  }, {\r\n    template: 'languagePickerView'\r\n  });\r\n\r\n  return LanguagePickerView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var LanguagePickerDrawerView = Backbone.View.extend({\r\n\r\n    events: {\r\n      'click .js-languagepicker-item-btn': 'onButtonClick'\r\n    },\r\n\r\n    initialize: function () {\r\n      this.listenTo(Adapt, {\r\n        remove: this.remove,\r\n        'languagepicker:changelanguage:yes': this.onDoChangeLanguage,\r\n        'languagepicker:changelanguage:no': this.onDontChangeLanguage\r\n      });\r\n      this.render();\r\n    },\r\n\r\n    render: function () {\r\n      var data = this.model.toJSON();\r\n      var template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n    },\r\n\r\n    onButtonClick: function (event) {\r\n      var newLanguage = $(event.currentTarget).attr('data-language');\r\n      this.model.set('newLanguage', newLanguage);\r\n      var data = this.model.getLanguageDetails(newLanguage);\r\n\r\n      var promptObject = {\r\n        _attributes: { lang: newLanguage },\r\n        _classes: `is-lang-${newLanguage} ${data._direction === 'rtl' ? 'is-rtl' : 'is-ltr'}`,\r\n        title: data.warningTitle,\r\n        body: data.warningMessage,\r\n        _prompts:[\r\n          {\r\n            promptText: data._buttons.yes,\r\n            _callbackEvent: 'languagepicker:changelanguage:yes'\r\n          },\r\n          {\r\n            promptText: data._buttons.no,\r\n            _callbackEvent: 'languagepicker:changelanguage:no'\r\n          }\r\n        ],\r\n        _showIcon: true\r\n      };\r\n\r\n      //keep active element incase the user cancels - usually navigation bar icon\r\n      //move drawer close focus to #focuser\r\n      if ($.a11y) {\r\n        // old a11y API (Framework v4.3.0 and earlier)\r\n        this.$finishFocus = $.a11y.state.focusStack.pop();\r\n        $.a11y.state.focusStack.push($('#focuser'));\r\n      } else {\r\n        this.$finishFocus = Adapt.a11y._popup._focusStack.pop();\r\n        Adapt.a11y._popup._focusStack.push($('#a11y-focuser'));\r\n      }\r\n\r\n      Adapt.once('drawer:closed', function() {\r\n        //wait for drawer to fully close\r\n        _.delay(function(){\r\n          //show yes/no popup\r\n          Adapt.once('popup:opened', function() {\r\n            //move popup close focus to #focuser\r\n            if ($.a11y) {\r\n              // old a11y API (Framework v4.3.0 and earlier)\r\n              $.a11y.state.focusStack.pop();\r\n              $.a11y.state.focusStack.push($('#focuser'));\r\n              return;\r\n            }\r\n            Adapt.a11y._popup._focusStack.pop();\r\n            Adapt.a11y._popup._focusStack.push($('#a11y-focuser'));\r\n          });\r\n\r\n          Adapt.notify.prompt(promptObject);\r\n        }, 250);\r\n      });\r\n\r\n      Adapt.trigger('drawer:closeDrawer');\r\n    },\r\n\r\n    onDoChangeLanguage: function () {\r\n      // set default language\r\n      var newLanguage = this.model.get('newLanguage');\r\n      this.model.setTrackedData();\r\n      this.model.setLanguage(newLanguage);\r\n      this.remove();\r\n    },\r\n\r\n    onDontChangeLanguage: function () {\r\n      this.remove();\r\n\r\n      // wait for notify to close fully\r\n      _.delay(function(){\r\n        // focus on navigation bar icon\r\n        this.$finishFocus.a11y_focus();\r\n      }.bind(this), 500);\r\n\r\n    }\r\n\r\n  }, {\r\n    template: 'languagePickerDrawerView'\r\n  });\r\n\r\n  return LanguagePickerDrawerView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './languagePickerDrawerView'\r\n], function(Adapt, LanguagePickerDrawerView) {\r\n\r\n  var LanguagePickerNavView = Backbone.View.extend({\r\n\r\n    tagName: 'button',\r\n\r\n    className: function () {\r\n      var classNames = 'btn-icon nav__btn nav__languagepicker-btn js-languagepicker-nav-btn icon';\r\n      var customClass = this.model.get('_languagePickerIconClass') || 'icon-language-2';\r\n\r\n      return classNames + ' ' + customClass;\r\n    },\r\n\r\n    events: {\r\n      'click': 'onClick'\r\n    },\r\n\r\n    initialize: function () {\r\n      this.listenTo(Adapt, 'remove', this.remove);\r\n    },\r\n\r\n    onClick: function (event) {\r\n      Adapt.drawer.triggerCustomView(new LanguagePickerDrawerView({model: this.model}).$el, false);\r\n    }\r\n\r\n  });\r\n\r\n  return LanguagePickerNavView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function (Adapt) {\r\n\r\n  var LanguagePickerModel = Backbone.Model.extend({\r\n\r\n    defaults: {\r\n      _isEnabled: false,\r\n      displayTitle: '',\r\n      body: '',\r\n      _languages: []\r\n    },\r\n\r\n    trackedData: {\r\n      components: [],\r\n      blocks: []\r\n    },\r\n\r\n    locationId: null,\r\n\r\n    initialize: function () {\r\n      this.listenTo(Adapt.config, 'change:_activeLanguage', this.markLanguageAsSelected);\r\n      this.listenTo(Adapt, 'app:dataLoaded', this.onDataLoaded);\r\n    },\r\n\r\n    getLanguageDetails: function (language) {\r\n      var _languages = this.get('_languages');\r\n      return _.find(_languages, function (item) {\r\n        return (item._language === language);\r\n      });\r\n    },\r\n\r\n    setLanguage: function (language) {\r\n      Adapt.config.set({\r\n        '_activeLanguage': language,\r\n        '_defaultDirection': this.getLanguageDetails(language)._direction\r\n      });\r\n    },\r\n\r\n    markLanguageAsSelected: function(model, language) {\r\n      this.get('_languages').forEach(function(item){\r\n        item._isSelected = (item._language === language);\r\n      });\r\n    },\r\n\r\n   onDataLoaded: function() {\r\n      if (!this.get('_restoreStateOnLanguageChange')) {\r\n        return;\r\n      }\r\n      _.defer(function() {\r\n        this.locationId = Adapt.offlineStorage.get('location') || null;\r\n        this.restoreState();\r\n      }.bind(this));\r\n\r\n    },\r\n\r\n    restoreLocation: function() {\r\n      if (!Adapt.mapById(this.locationId)) return;\r\n      _.defer(function() {\r\n        Adapt.navigateToElement('.' + this.locationId);\r\n      }.bind(this));\r\n    },\r\n\r\n    /**\r\n     * Restore course progress on language change.\r\n     */\r\n    restoreState: function() {\r\n\r\n      if (this.isTrackedDataEmpty()) return;\r\n\r\n      if (this.trackedData.components) {\r\n        this.trackedData.components.forEach(this.setTrackableState);\r\n      }\r\n\r\n      if (this.trackedData.blocks) {\r\n        this.trackedData.blocks.forEach(this.setTrackableState);\r\n      }\r\n    },\r\n\r\n    isTrackedDataEmpty: function() {\r\n      return _.isEqual(this.trackedData, {\r\n        components: [],\r\n        blocks: []\r\n      });\r\n    },\r\n\r\n    getTrackableState: function() {\r\n      var components = this.getState(Adapt.components.models);\r\n      var blocks = this.getState(Adapt.blocks.models);\r\n      return {\r\n        components: _.compact(components),\r\n        blocks: _.compact(blocks)\r\n      };\r\n    },\r\n\r\n    getState: function(models) {\r\n      return models.map(function(model) {\r\n        if (model.get('_isComplete')) {\r\n          return model.getTrackableState();\r\n        }\r\n      });\r\n    },\r\n\r\n    setTrackedData: function() {\r\n      if (this.get('_restoreStateOnLanguageChange')) {\r\n        this.listenToOnce(Adapt, 'menuView:ready', this.restoreLocation);\r\n        this.trackedData = this.getTrackableState();\r\n      }\r\n    },\r\n\r\n    setTrackableState: function(stateObject) {\r\n      var restoreModel = Adapt.findById(stateObject._id);\r\n\r\n      if (restoreModel) {\r\n        restoreModel.setTrackableState(stateObject);\r\n      } else {\r\n        Adapt.log.warn('LanguagePicker unable to restore state for: ' + stateObject._id);\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  return LanguagePickerModel;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './languagePickerView',\r\n  './languagePickerNavView',\r\n  './languagePickerModel'\r\n], function(Adapt, LanguagePickerView, LanguagePickerNavView, LanguagePickerModel) {\r\n\r\n  var languagePickerModel;\r\n\r\n  Adapt.once('configModel:dataLoaded', onConfigLoaded);\r\n\r\n  /**\r\n   * Once the Adapt config has loaded, check to see if the language picker is enabled. If it is:\r\n   * - stop the rest of the .json from loading\r\n   * - set up the language picker model\r\n   * - register for events to allow us to display the language picker icon in the navbar on pages and menus\r\n   * - wait for offline storage to be ready so that we can check to see if there's a stored language choice or not\r\n   */\r\n  function onConfigLoaded() {\r\n    if (!Adapt.config.has('_languagePicker')) return;\r\n    if (!Adapt.config.get('_languagePicker')._isEnabled) return;\r\n\r\n    Adapt.config.set('_canLoadData', false);\r\n\r\n    languagePickerModel = new LanguagePickerModel(Adapt.config.get('_languagePicker'));\r\n\r\n    Adapt.on('router:menu router:page', setupNavigationView);\r\n\r\n    if (Adapt.offlineStorage.ready) {// on the offchance that it may already be ready...\r\n      onOfflineStorageReady();\r\n    } else {\r\n      Adapt.once('offlineStorage:ready', onOfflineStorageReady);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once offline storage is ready, check to see if a language was previously selected by the user\r\n   * If it was, load it. If it wasn't, show the language picker\r\n   */\r\n  function onOfflineStorageReady() {\r\n    var storedLanguage = Adapt.offlineStorage.get('lang');\r\n\r\n    if (storedLanguage) {\r\n      languagePickerModel.setLanguage(storedLanguage);\r\n    } else if (languagePickerModel.get('_showOnCourseLoad') === false) {\r\n      languagePickerModel.setLanguage(Adapt.config.get('_defaultLanguage'));\r\n    } else {\r\n      showLanguagePickerView();\r\n    }\r\n  }\r\n\r\n  function showLanguagePickerView () {\r\n    var languagePickerView = new LanguagePickerView({\r\n      model: languagePickerModel\r\n    });\r\n\r\n    languagePickerView.$el.appendTo('#wrapper');\r\n  }\r\n\r\n  function setupNavigationView () {\r\n    /*\r\n     * On the framework this isn't an issue, but courses built in the authoring tool before the ARIA label\r\n     * was added will break unless the extension is removed then added again.\r\n     */\r\n    var courseGlobals = Adapt.course.get('_globals')._extensions;\r\n    var navigationBarLabel = '';\r\n    if (courseGlobals._languagePicker) {\r\n      navigationBarLabel = courseGlobals._languagePicker.navigationBarLabel;\r\n    }\r\n\r\n    var languagePickerNavView = new LanguagePickerNavView({\r\n      model: languagePickerModel,\r\n      attributes:  {\r\n        'aria-label': navigationBarLabel\r\n      }\r\n    });\r\n\r\n    languagePickerNavView.$el.appendTo('.nav__inner');\r\n  }\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var Completion = Backbone.Controller.extend({\r\n\r\n    subProgressCompleted: 0,\r\n    subProgressTotal: 0,\r\n    nonAssessmentCompleted: 0,\r\n    nonAssessmentTotal: 0,\r\n    assessmentCompleted: 0,\r\n    assessmentTotal: 0\r\n\r\n  });\r\n\r\n  // Calculate completion of a contentObject\r\n  function calculateCompletion(contentObjectModel) {\r\n\r\n    var completion = new Completion();\r\n\r\n    var viewType = contentObjectModel.get('_type');\r\n    var isComplete = contentObjectModel.get('_isComplete') ? 1 : 0;\r\n    var children;\r\n\r\n    switch (viewType) {\r\n      case 'page':\r\n        // If it's a page\r\n        children = contentObjectModel.getAllDescendantModels().filter(function(model) {\r\n          return model.get('_isAvailable') && !model.get('_isOptional');\r\n        });\r\n\r\n        var availableChildren = filterAvailableChildren(children);\r\n        var components = getPageLevelProgressEnabledModels(availableChildren);\r\n\r\n        var nonAssessmentComponents = getNonAssessmentComponents(components);\r\n\r\n        completion.nonAssessmentTotal = nonAssessmentComponents.length;\r\n        completion.nonAssessmentCompleted = getComponentsCompleted(nonAssessmentComponents).length;\r\n\r\n        var assessmentComponents = getAssessmentComponents(components);\r\n\r\n        completion.assessmentTotal = assessmentComponents.length;\r\n        completion.assessmentCompleted = getComponentsInteractionCompleted(assessmentComponents).length;\r\n\r\n        if (contentObjectModel.get('_pageLevelProgress')._excludeAssessments !== true) {\r\n          completion.subProgressCompleted = contentObjectModel.get('_subProgressComplete') || 0;\r\n          completion.subProgressTotal = contentObjectModel.get('_subProgressTotal') || 0;\r\n        }\r\n\r\n        var showPageCompletionCourse = Adapt.course.get('_pageLevelProgress') && Adapt.course.get('_pageLevelProgress')._showPageCompletion !== false;\r\n        var showPageCompletionPage = contentObjectModel.get('_pageLevelProgress') && contentObjectModel.get('_pageLevelProgress')._showPageCompletion !== false;\r\n\r\n        if (showPageCompletionCourse && showPageCompletionPage) {\r\n          // optionally add one point extra for page completion to eliminate incomplete pages and full progress bars\r\n          // if _showPageCompletion is true then the progress bar should also consider it so add 1 to nonAssessmentTotal\r\n          completion.nonAssessmentCompleted += isComplete;\r\n          completion.nonAssessmentTotal += 1;\r\n        }\r\n\r\n        break;\r\n      case 'menu': case 'course':\r\n        // If it's a sub-menu\r\n        children = contentObjectModel.get('_children').models;\r\n        children.forEach(function(contentObject) {\r\n          var completionObject = calculateCompletion(contentObject);\r\n          completion.subProgressCompleted += completionObject.subProgressCompleted || 0;\r\n          completion.subProgressTotal += completionObject.subProgressTotal || 0;\r\n          completion.nonAssessmentTotal += completionObject.nonAssessmentTotal;\r\n          completion.nonAssessmentCompleted += completionObject.nonAssessmentCompleted;\r\n          completion.assessmentTotal += completionObject.assessmentTotal;\r\n          completion.assessmentCompleted += completionObject.assessmentCompleted;\r\n        });\r\n        break;\r\n\r\n    }\r\n\r\n    return completion;\r\n  }\r\n\r\n  function getNonAssessmentComponents(models) {\r\n    return models.filter(function(model) {\r\n      return !model.get('_isPartOfAssessment');\r\n    });\r\n  }\r\n\r\n  function getAssessmentComponents(models) {\r\n    return models.filter(function(model) {\r\n      return model.get('_isPartOfAssessment');\r\n    });\r\n  }\r\n\r\n  function getComponentsCompleted(models) {\r\n    return models.filter(function(item) {\r\n      return item.get('_isComplete');\r\n    });\r\n  }\r\n\r\n  function getComponentsInteractionCompleted(models) {\r\n    return models.filter(function(item) {\r\n      return item.get('_isComplete');\r\n    });\r\n  }\r\n\r\n  //Get only those models who were enabled for pageLevelProgress\r\n  function getPageLevelProgressEnabledModels(models) {\r\n    return models.filter(function(model) {\r\n      var config = model.get('_pageLevelProgress');\r\n      return config && config._isEnabled;\r\n    });\r\n  }\r\n\r\n  function unavailableInHierarchy(parents) {\r\n    if (!parents) return;\r\n    return parents.some(function(parent) {\r\n      return !parent.get('_isAvailable');\r\n    });\r\n  }\r\n\r\n  function filterAvailableChildren(children) {\r\n    var availableChildren = [];\r\n\r\n    for (var i = 0, count = children.length; i < count; i++) {\r\n\r\n      var parents = children[i].getAncestorModels();\r\n      if (unavailableInHierarchy(parents)) continue;\r\n      availableChildren.push(children[i]);\r\n    }\r\n\r\n    return availableChildren;\r\n  }\r\n\r\n  function calculatePercentageComplete(model) {\r\n    var completionObject = calculateCompletion(model);\r\n    // take all assessment, nonassessment and subprogress into percentage\r\n    // this allows the user to see if assessments have been passed, if assessment components can be retaken, and all other component's completion\r\n    var completed = completionObject.nonAssessmentCompleted + completionObject.assessmentCompleted + completionObject.subProgressCompleted;\r\n    var total  = completionObject.nonAssessmentTotal + completionObject.assessmentTotal + completionObject.subProgressTotal;\r\n    var percentageComplete = Math.floor((completed / total)*100);\r\n    return percentageComplete;\r\n  }\r\n\r\n  return {\r\n    calculateCompletion: calculateCompletion,\r\n    calculatePercentageComplete: calculatePercentageComplete,\r\n    getPageLevelProgressEnabledModels: getPageLevelProgressEnabledModels,\r\n    filterAvailableChildren: filterAvailableChildren\r\n  };\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var PageLevelProgressIndicatorView = Backbone.View.extend({\r\n\r\n    initialize: function(options) {\r\n      options = options || {};\r\n      this.parent = options.parent;\r\n      this.calculatePercentage = options.calculatePercentage || this.calculatePercentage;\r\n      this.ariaLabel = options.ariaLabel || '';\r\n      this.type = options.type || this.model.get('_type');\r\n      this.addClasses();\r\n      this.setUpEventListeners();\r\n      this.setPercentageComplete();\r\n      this.render();\r\n      this.refresh();\r\n    },\r\n\r\n    addClasses: function() {\r\n      this.$el.addClass([\r\n        'pagelevelprogress__indicator',\r\n        'is-' + this.type\r\n      ].join(' '));\r\n    },\r\n    \r\n    checkAria: function() {\r\n      if (!this.ariaLabel) {\r\n        this.$el.attr('aria-hidden', true);\r\n        return;\r\n      }\r\n      var data = this.getRenderData();\r\n      this.$('.js-indicator-aria-label').html(Handlebars.compile(this.ariaLabel)(data));\r\n    },\r\n\r\n    setUpEventListeners: function() {\r\n      if (this.parent) {\r\n        this.listenToOnce(this.parent, 'postRemove', this.remove);\r\n      } else {\r\n        this.listenTo(Adapt, 'remove', this.remove);\r\n      }\r\n      this.listenTo(this.model, 'change:_isComplete', this.refresh);\r\n      if (!this.collection) return;\r\n      this.listenTo(this.collection, 'change:_isComplete', this.refresh);\r\n    },\r\n    \r\n    setPercentageComplete: function() {\r\n      var percentage =  this.calculatePercentage();\r\n      this.model.set('percentageComplete', percentage);\r\n      return percentage;\r\n    },\r\n\r\n    calculatePercentage: function() {\r\n      return this.model.get('_isComplete') ? 100 : 0;\r\n    },\r\n\r\n    render: function() {\r\n      var data = this.getRenderData();\r\n      var template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n    },\r\n    \r\n    getRenderData: function() {\r\n      var data = this.model.toJSON();\r\n      data.ariaLabel = this.ariaLabel;\r\n      data.type = this.type;\r\n      return data;\r\n    },\r\n\r\n    refresh: function() {\r\n      this.checkCompletion();\r\n      this.checkAria();\r\n      this.$('.js-indicator-bar').css({\r\n        width: this.calculatePercentage() + '%'\r\n      });\r\n    },\r\n\r\n    checkCompletion: function() {\r\n      var percentage = this.setPercentageComplete();\r\n      this.$el\r\n          .toggleClass('is-complete', percentage === 100)\r\n          .toggleClass('is-incomplete', percentage !== 100);\r\n    }\r\n\r\n  }, {\r\n    template: 'pageLevelProgressIndicator'\r\n  });\r\n\r\n  return PageLevelProgressIndicatorView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './PageLevelProgressIndicatorView'\r\n], function(Adapt, PageLevelProgressIndicatorView) {\r\n\r\n  var PageLevelProgressItemView = Backbone.View.extend({\r\n\r\n    className: function () {\r\n      return [\r\n        'pagelevelprogress__item drawer__item',\r\n        this.model.get('_type') + '__indicator'\r\n      ].join(' ');\r\n    },\r\n\r\n    attributes: {\r\n      'role': 'listitem'\r\n    },\r\n\r\n    initialize: function() {\r\n      this.listenTo(Adapt, 'remove', this.remove);\r\n      this.render();\r\n      this.addIndicator();\r\n    },\r\n\r\n    render: function() {\r\n      var data = this.model.toJSON();\r\n      var template = Handlebars.templates[this.constructor.template];\r\n      this.$el.html(template(data));\r\n    },\r\n\r\n    addIndicator: function() {\r\n      if (this.model.get('_isOptional')) return;\r\n      var item = new PageLevelProgressIndicatorView({\r\n        model: this.model\r\n      });\r\n      this.$('.js-indicator').append(item.$el);\r\n    }\r\n\r\n  }, {\r\n    template: 'pageLevelProgressItem'\r\n  });\r\n\r\n  return PageLevelProgressItemView;\r\n\r\n});\r\n","define([\r\n 'core/js/adapt',\r\n './PageLevelProgressItemView'\r\n], function(Adapt, PageLevelProgressItemView) {\r\n\r\n  var PageLevelProgressView = Backbone.View.extend({\r\n\r\n    className: 'pagelevelprogress',\r\n\r\n    events: {\r\n      'click .js-pagelevelprogress-item-click': 'scrollToPageElement'\r\n    },\r\n\r\n    initialize: function() {\r\n      this.listenTo(Adapt, 'remove', this.remove);\r\n      this.render();\r\n      this.addChildren();\r\n    },\r\n\r\n    scrollToPageElement: async function(event) {\r\n      if (event && event.preventDefault) event.preventDefault();\r\n\r\n      var $target = $(event.currentTarget);\r\n      if ($target.is('.is-disabled')) return;\r\n\r\n      var id = $target.attr('data-pagelevelprogress-id');\r\n      var model = Adapt.findById(id);\r\n\r\n      if (!model.get('_isRendered')) {\r\n        try {\r\n          await Adapt.parentView.renderTo(id);\r\n        } catch(err) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      var currentComponentSelector = '.' + id;\r\n\r\n      Adapt.once('drawer:closed', function() {\r\n        Adapt.scrollTo(currentComponentSelector, { duration: 400 });\r\n      }).trigger('drawer:closeDrawer', $(currentComponentSelector));\r\n    },\r\n\r\n    render: function() {\r\n      var template = Handlebars.templates['pageLevelProgress'];\r\n      this.$el.html(template({}));\r\n    },\r\n\r\n    addChildren: function() {\r\n      var $children = this.$('.js-children');\r\n      this.collection.each(function(model) {\r\n        $children.append(new PageLevelProgressItemView({\r\n          model: model\r\n        }).$el);\r\n      }.bind(this));\r\n    }\r\n\r\n  });\r\n\r\n  return PageLevelProgressView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './completionCalculations',\r\n  './PageLevelProgressView',\r\n  './PageLevelProgressIndicatorView'\r\n], function(Adapt, completionCalculations, PageLevelProgressView, PageLevelProgressIndicatorView) {\r\n\r\n  var PageLevelProgressNavigationView = Backbone.View.extend({\r\n\r\n    tagName: 'button',\r\n\r\n    className: 'btn-icon nav__btn nav__pagelevelprogress-btn pagelevelprogress__nav-btn',\r\n\r\n    events: {\r\n      'click': 'onProgressClicked'\r\n    },\r\n\r\n    initialize: function() {\r\n      _.bindAll(this, 'updateProgressBar');\r\n      this.setUpEventListeners();\r\n      this.render();\r\n      this.addIndicator();\r\n      this.deferredUpdate();\r\n    },\r\n\r\n    setUpEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        'remove': this.remove,\r\n        'router:location': this.updateProgressBar,\r\n        'view:childAdded pageLevelProgress:update': this.refreshProgressBar\r\n      });\r\n    },\r\n\r\n    render: function() {\r\n      var template = Handlebars.templates['pageLevelProgressNavigation'];\r\n      this.$el.html(template({}));\r\n    },\r\n\r\n    addIndicator: function() {\r\n      this.indicatorView = new PageLevelProgressIndicatorView({\r\n        model: this.model,\r\n        collection: this.collection,\r\n        calculatePercentage: this._getPageCompletionPercentage,\r\n        ariaLabel: Adapt.course.get('_globals')._extensions._pageLevelProgress.pageLevelProgressIndicatorBar\r\n      });\r\n      this.$el.prepend(this.indicatorView.$el);\r\n    },\r\n\r\n    _getPageCompletionPercentage: function() {\r\n      return completionCalculations.calculatePercentageComplete(this.model);\r\n    },\r\n\r\n    deferredUpdate: function() {\r\n      _.defer(this.updateProgressBar);\r\n    },\r\n\r\n    updateProgressBar: function() {\r\n      this.indicatorView.refresh();\r\n    },\r\n\r\n    refreshProgressBar: function() {\r\n      this.collection.repopulate();\r\n      this.updateProgressBar();\r\n    },\r\n\r\n    onProgressClicked: function(event) {\r\n      if (event && event.preventDefault) event.preventDefault();\r\n      Adapt.drawer.triggerCustomView(new PageLevelProgressView({\r\n        collection: this.collection\r\n      }).$el, false);\r\n    },\r\n\r\n    remove: function() {\r\n      Backbone.View.prototype.remove.call(this);\r\n      this.collection.reset();\r\n    }\r\n\r\n  });\r\n\r\n  return PageLevelProgressNavigationView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './completionCalculations'\r\n], function(Adapt, completionCalculations) {\r\n\r\n  var PageLevelProgressCollection = Backbone.Collection.extend({\r\n\r\n    initialize: function(models, options) {\r\n      this.listenTo(Adapt, 'remove', this.reset);\r\n      if (!options || !options.pageModel) return;\r\n      this._pageModel = options.pageModel;\r\n      this.repopulate();\r\n    },\r\n\r\n    repopulate: function() {\r\n      this.reset();\r\n      if (!this._pageModel) return;\r\n\r\n      var allDescendants = this._pageModel.getAllDescendantModels(true);\r\n      var currentPageItems = allDescendants.filter(function(item) {\r\n        return item.get('_isAvailable') === true;\r\n      });\r\n      var availableItems = completionCalculations.filterAvailableChildren(currentPageItems);\r\n      var enabledProgressItems = completionCalculations.getPageLevelProgressEnabledModels(availableItems);\r\n\r\n      this.add(enabledProgressItems);\r\n    }\r\n\r\n  });\r\n\r\n  return PageLevelProgressCollection;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './completionCalculations',\r\n  './PageLevelProgressNavigationView',\r\n  './PageLevelProgressIndicatorView',\r\n  './PageLevelProgressCollection'\r\n], function(Adapt, completionCalculations, PageLevelProgressNavigationView, PageLevelProgressIndicatorView, PageLevelProgressCollection) {\r\n\r\n  var PageLevelProgress = Backbone.Controller.extend({\r\n\r\n    initialize: function() {\r\n      Adapt.on({\r\n        'app:dataReady': this.onDataReady.bind(this),\r\n        'app:languageChanged': function() {\r\n          // Remove events created by setUpEventListeners\r\n          this.stopListening();\r\n        }.bind(this)\r\n      });\r\n    },\r\n\r\n    getCourseConfig: function() {\r\n      return Adapt.course.get('_pageLevelProgress');\r\n    },\r\n\r\n    onDataReady: function() {\r\n      // Do not proceed if pageLevelProgress is not enabled in course.json\r\n      var coursePLPConfig = this.getCourseConfig();\r\n      if (!coursePLPConfig || !coursePLPConfig._isEnabled) {\r\n        return;\r\n      }\r\n      this.setUpEventListeners();\r\n    },\r\n\r\n    setUpEventListeners: function() {\r\n      var headerIndicatorTypes = [\r\n        'menu',\r\n        'menuItem',\r\n        'page',\r\n        'article',\r\n        'block',\r\n        'component'\r\n      ];\r\n\r\n      var headerIndicatorEventNames = headerIndicatorTypes\r\n        .concat(['']).join('View:render ');\r\n\r\n      this.listenTo(Adapt, headerIndicatorEventNames, this.renderHeaderIndicatorView);\r\n\r\n      this.listenTo(Adapt, {\r\n        'menuItemView:postRender': this.renderMenuItemIndicatorView,\r\n        'router:page': this.renderNavigationView\r\n      });\r\n\r\n      this.listenTo(Adapt.course, 'bubble:change:_isComplete', this.onCompletionChange);\r\n    },\r\n\r\n    onCompletionChange: function(event) {\r\n      if (!Adapt.location._currentId) return;\r\n\r\n      var currentModel = Adapt.findById(Adapt.location._currentId);\r\n      var completionState = {\r\n        currentLocation: completionCalculations.calculatePercentageComplete(currentModel),\r\n        course: completionCalculations.calculatePercentageComplete(Adapt.course)\r\n      };\r\n      var hasChanged = !_.isMatch(this._previousCompletionState, completionState);\r\n      if (!hasChanged) return;\r\n\r\n      this._previousCompletionState = completionState;\r\n      Adapt.trigger('pageLevelProgress:percentageCompleteChange', completionState);\r\n    },\r\n\r\n    renderHeaderIndicatorView: function(view) {\r\n      var model = view.model;\r\n\r\n      var config = model.get('_pageLevelProgress');\r\n      if (!config || !config._isEnabled || !config._isCompletionIndicatorEnabled) {\r\n        return;\r\n      }\r\n\r\n      var pageModel = model.findAncestor('contentObjects');\r\n      var pageConfig = pageModel && pageModel.get('_pageLevelProgress');\r\n      if (pageConfig && !pageConfig._isEnabled) {\r\n        return;\r\n      }\r\n\r\n      var $headings = view.$('.js-heading');\r\n      $headings.each(function(index, el) {\r\n        var $el = $(el);\r\n        var indicatorView = new PageLevelProgressIndicatorView({\r\n          parent: view,\r\n          model: model\r\n        });\r\n        indicatorView.$el.insertAfter($el);\r\n      });\r\n    },\r\n\r\n    // This should add/update progress on menuView\r\n    renderMenuItemIndicatorView: function(view) {\r\n      // Do not render on menu, only render on menu items\r\n      if (view.model.get('_id') === Adapt.location._currentId) {\r\n        return;\r\n      }\r\n\r\n      // Progress bar should not render for course viewType\r\n      var viewType = view.model.get('_type');\r\n      if (viewType === 'course') {\r\n        return;\r\n      }\r\n\r\n      // Do not proceed if pageLevelProgress is not enabled for the content object\r\n      var pageLevelProgress = view.model.get('_pageLevelProgress');\r\n      if (!pageLevelProgress || !pageLevelProgress._isEnabled) {\r\n        return;\r\n      }\r\n\r\n      view.$el.find('.js-menu-item-progress').append(new PageLevelProgressIndicatorView({\r\n        parent: view,\r\n        model: view.model,\r\n        type: 'menu-item',\r\n        calculatePercentage: this._getMenuItemCompletionPercentage.bind(view),\r\n        ariaLabel: Adapt.course.get('_globals')._extensions._pageLevelProgress.pageLevelProgressMenuBar\r\n      }).$el);\r\n    },\r\n\r\n    _getMenuItemCompletionPercentage: function() {\r\n      return completionCalculations.calculatePercentageComplete(this.model);\r\n    },\r\n\r\n    // This should add/update progress on page navigation bar\r\n    renderNavigationView: function(pageModel) {\r\n      // Do not render if turned off at course level\r\n      var coursePLPConfig = this.getCourseConfig();\r\n      if (coursePLPConfig && coursePLPConfig._isShownInNavigationBar === false) {\r\n        return;\r\n      }\r\n\r\n      // Do not proceed if pageLevelProgress is not enabled for the content object\r\n      var pagePLPConfig = pageModel.get('_pageLevelProgress');\r\n      if (!pagePLPConfig || !pagePLPConfig._isEnabled) {\r\n        return;\r\n      }\r\n\r\n      var collection = new PageLevelProgressCollection(null, {\r\n        pageModel: pageModel\r\n      });\r\n\r\n      if (collection.length === 0) {\r\n        return;\r\n      }\r\n\r\n      $('.nav__drawer-btn').after(new PageLevelProgressNavigationView({\r\n        model: pageModel,\r\n        collection: collection\r\n      }).$el);\r\n    }\r\n\r\n  });\r\n\r\n  Adapt.pageLevelProgress = new PageLevelProgress();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var ResourcesView = Backbone.View.extend({\r\n\r\n    className: 'resources',\r\n\r\n    initialize: function() {\r\n      this.listenTo(Adapt, 'remove', this.remove);\r\n      this.render();\r\n    },\r\n\r\n    events: {\r\n      'click .js-resources-filter-btn-click': 'onFilterClicked',\r\n    },\r\n\r\n    render: function() {\r\n      this.$el.html(Handlebars.templates.resources({\r\n        model: this.model.toJSON(),\r\n        resources: this.collection.toJSON()\r\n      }));\r\n      \r\n      _.defer(function() {\r\n        this.listenTo(Adapt, 'drawer:triggerCustomView', this.remove);\r\n      }.bind(this));\r\n\r\n      return this;\r\n    },\r\n\r\n    onFilterClicked: function(e) {\r\n      if (e && e.preventDefault) e.preventDefault();\r\n      \r\n      this.$('.js-resources-filter-btn-click').removeClass('is-selected');\r\n      \r\n      var items;\r\n      var filter = $(e.currentTarget).addClass('is-selected').attr('data-filter');\r\n      if (filter === 'all') {\r\n        items = this.$('.js-resources-item').removeClass('u-display-none');\r\n      } else {\r\n        this.$('.js-resources-item').removeClass('u-display-none').not('.is-' + filter).addClass('u-display-none');\r\n        items = this.$('.js-resources-item.is-' + filter);\r\n      }\r\n\r\n      if (items.length > 0) $(items[0]).a11y_focus();\r\n    }\r\n  });\r\n\r\n  return ResourcesView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt'\r\n], function(Handlebars, Adapt) {\r\n\r\n    var helpers = {\r\n\r\n        resources_has_type: function(resources, type, block) {\r\n            var hasType = _.some(resources, _.matcher({_type: type}));\r\n            return hasType ? block.fn(this) : block.inverse(this);\r\n        },\r\n\r\n        resources_has_multiple_types: function(resources, block) {\r\n            if (resources.length === 1) return block.inverse(this);\r\n\r\n            var allSameType = _.every(resources, _.matcher({_type: resources[0]._type}));\r\n            return allSameType ? block.inverse(this) : block.fn(this);\r\n        },\r\n\r\n        resources_get_column_count: function(resources) {\r\n            return _.uniq(_.pluck(resources, '_type')).length + 1;// add 1 for the 'All' button column\r\n        },\r\n\r\n        /**\r\n         * IE doesn't support the 'download' attribute\r\n         * https://github.com/adaptlearning/adapt_framework/issues/1559\r\n         * and iOS just opens links with that attribute in the same window\r\n         * https://github.com/adaptlearning/adapt_framework/issues/1852\r\n         */\r\n        resources_force_download: function(resource, block) {\r\n            if (Adapt.device.browser === 'internet explorer' || Adapt.device.OS === 'ios') {\r\n                return block.inverse(this);\r\n            }\r\n\r\n            return (resource._forceDownload || resource.filename) ? block.fn(this) : block.inverse(this);\r\n        }\r\n\r\n    };\r\n\r\n    for (var name in helpers) {\r\n        if (helpers.hasOwnProperty(name)) {\r\n            Handlebars.registerHelper(name, helpers[name]);\r\n        }\r\n    }\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './adapt-contrib-resourcesView',\r\n  './adapt-contrib-resourcesHelpers'\r\n], function(Adapt, ResourcesView, ResourcesHelpers) {\r\n\r\n  function setupResources(resourcesData) {\r\n\r\n    var resourcesModel = new Backbone.Model(resourcesData);\r\n    var resourcesCollection = new Backbone.Collection(resourcesModel.get('_resourcesItems'));\r\n\r\n    Adapt.on('resources:showResources', function() {\r\n      Adapt.drawer.triggerCustomView(new ResourcesView({\r\n        model: resourcesModel,\r\n        collection: resourcesCollection\r\n      }).$el);\r\n    });\r\n\r\n  }\r\n\r\n  function initResources() {\r\n\r\n    var courseResources = Adapt.course.get('_resources');\r\n\r\n    // do not proceed until resource set on course.json\r\n    if (!courseResources || courseResources._isEnabled === false) return;\r\n\r\n    var drawerObject = {\r\n      title: courseResources.title,\r\n      description: courseResources.description,\r\n      className: 'is-resources',\r\n      drawerOrder: courseResources._drawerOrder || 0\r\n    };\r\n\r\n    Adapt.drawer.addItem(drawerObject, 'resources:showResources');\r\n\r\n    setupResources(courseResources);\r\n\r\n  }\r\n\r\n  Adapt.on('adapt:start', initResources);\r\n\r\n});\r\n","define(function() {\r\n\r\n  class Logger {\r\n\r\n    constructor() {\r\n      this.logArr = [];\r\n      this.registeredViews = [];\r\n    }\r\n\r\n    static getInstance() {\r\n      if (Logger.instance === null) {\r\n        Logger.instance = new Logger();\r\n      }\r\n      return Logger.instance;\r\n    }\r\n\r\n    getEntries() {\r\n      return this.logArr;\r\n    }\r\n\r\n    getLastEntry() {\r\n      return this.logArr[this.logArr.length - 1];\r\n    }\r\n\r\n    info(str) {\r\n      this.logArr[this.logArr.length] = { str: str, type: Logger.LOG_TYPE_INFO, time: Date.now() };\r\n      this.updateViews();\r\n    }\r\n\r\n    warn(str) {\r\n      this.logArr[this.logArr.length] = { str: str, type: Logger.LOG_TYPE_WARN, time: Date.now() };\r\n      this.updateViews();\r\n    }\r\n\r\n    error(str) {\r\n      this.logArr[this.logArr.length] = { str: str, type: Logger.LOG_TYPE_ERROR, time: Date.now() };\r\n      this.updateViews();\r\n    }\r\n\r\n    debug(str) {\r\n      this.logArr[this.logArr.length] = { str: str, type: Logger.LOG_TYPE_DEBUG, time: Date.now() };\r\n      this.updateViews();\r\n    }\r\n\r\n    registerView(_view) {\r\n      this.registeredViews[this.registeredViews.length] = _view;\r\n    }\r\n\r\n    unregisterView(_view) {\r\n      for (let i = 0, l = this.registeredViews.length; i < l; i++) {\r\n        if (this.registeredViews[i] !== _view) continue;\r\n        this.registeredViews.splice(i, 1);\r\n        i--;\r\n      }\r\n    }\r\n\r\n    updateViews() {\r\n      for (let i = 0, l = this.registeredViews.length; i < l; i++) {\r\n        if (!this.registeredViews[i]) continue;\r\n        this.registeredViews[i].update(this);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  Logger.instance = null;\r\n  Logger.LOG_TYPE_INFO = 0;\r\n  Logger.LOG_TYPE_WARN = 1;\r\n  Logger.LOG_TYPE_ERROR = 2;\r\n  Logger.LOG_TYPE_DEBUG = 3;\r\n\r\n  return Logger;\r\n\r\n});\r\n","define([\r\n  'libraries/SCORM_API_wrapper',\r\n  './logger'\r\n], function(pipwerks, Logger) {\r\n\r\n  /**\r\n   * IMPORTANT: This wrapper uses the Pipwerks SCORM wrapper and should therefore support both SCORM 1.2 and 2004. Ensure any changes support both versions.\r\n   */\r\n  class ScormWrapper {\r\n\r\n    constructor() {\r\n      /* configuration */\r\n      this.setCompletedWhenFailed = true;// this only applies to SCORM 2004\r\n      /**\r\n       * whether to commit each time there's a change to lesson_status or not\r\n       */\r\n      this.commitOnStatusChange = true;\r\n      /**\r\n       * whether to commit each time there's a change to any value\r\n       */\r\n      this.commitOnAnyChange = false;\r\n      /**\r\n       * how frequently (in minutes) to commit automatically. set to 0 to disable.\r\n       */\r\n      this.timedCommitFrequency = 10;\r\n      /**\r\n       * how many times to retry if a commit fails\r\n       */\r\n      this.maxCommitRetries = 5;\r\n      /**\r\n       * time (in milliseconds) to wait between retries\r\n       */\r\n      this.commitRetryDelay = 1000;\r\n\r\n      /**\r\n       * prevents commit from being called if there's already a 'commit retry' pending.\r\n       */\r\n      this.commitRetryPending = false;\r\n      /**\r\n       * how many times we've done a 'commit retry'\r\n       */\r\n      this.commitRetries = 0;\r\n      /**\r\n       * not currently used - but you could include in an error message to show when data was last saved\r\n       */\r\n      this.lastCommitSuccessTime = null;\r\n      /**\r\n       * The exit state to use when course isn't completed yet\r\n       */\r\n      this.exitStateIfIncomplete = 'auto';\r\n      /**\r\n       * The exit state to use when the course has been completed/passed\r\n       */\r\n      this.exitStateIfComplete = 'auto';\r\n\r\n      this.timedCommitIntervalID = null;\r\n      this.retryCommitTimeoutID = null;\r\n      this.logOutputWin = null;\r\n      this.startTime = null;\r\n      this.endTime = null;\r\n\r\n      this.lmsConnected = false;\r\n      this.finishCalled = false;\r\n\r\n      this.logger = Logger.getInstance();\r\n      this.scorm = pipwerks.SCORM;\r\n      /**\r\n     * Prevent the Pipwerks SCORM API wrapper's handling of the exit status\r\n     */\r\n      this.scorm.handleExitMode = false;\r\n\r\n      this.suppressErrors = false;\r\n      this.debouncedCommit = _.debounce(this.commit.bind(this), 100);\r\n      if (window.__debug) {\r\n        this.showDebugWindow();\r\n      }\r\n\r\n      if ((window.API && window.API.__offlineAPIWrapper) || (window.API_1484_11 && window.API_1484_11.__offlineAPIWrapper)) {\r\n        this.logger.error('Offline SCORM API is being used. No data will be reported to the LMS!');\r\n      }\r\n    }\r\n\r\n    // ******************************* public methods *******************************\r\n\r\n    static getInstance() {\r\n      if (ScormWrapper.instance === null) {\r\n        ScormWrapper.instance = new ScormWrapper();\r\n      }\r\n\r\n      return ScormWrapper.instance;\r\n    }\r\n\r\n    getVersion() {\r\n      return this.scorm.version;\r\n    }\r\n\r\n    setVersion(value) {\r\n      this.logger.debug(`ScormWrapper::setVersion: ${value}`);\r\n      this.scorm.version = value;\r\n    }\r\n\r\n    initialize() {\r\n      this.logger.debug('ScormWrapper::initialize');\r\n      this.lmsConnected = this.scorm.init();\r\n\r\n      if (this.lmsConnected) {\r\n        this.startTime = new Date();\r\n\r\n        this.initTimedCommit();\r\n      } else {\r\n        this.handleError('Course could not connect to the LMS');\r\n      }\r\n\r\n      return this.lmsConnected;\r\n    }\r\n\r\n    /**\r\n     * allows you to check if this is the user's first ever 'session' of a SCO, even after the lesson_status has been set to 'incomplete'\r\n     */\r\n    isFirstSession() {\r\n      return (this.getValue(this.isSCORM2004() ? 'cmi.entry' : 'cmi.core.entry') === 'ab-initio');\r\n    }\r\n\r\n    setIncomplete() {\r\n      this.setValue(this.isSCORM2004() ? 'cmi.completion_status' : 'cmi.core.lesson_status', 'incomplete');\r\n\r\n      if (this.commitOnStatusChange && !this.commitOnAnyChange) this.commit();\r\n    }\r\n\r\n    setCompleted() {\r\n      this.setValue(this.isSCORM2004() ? 'cmi.completion_status' : 'cmi.core.lesson_status', 'completed');\r\n\r\n      if (this.commitOnStatusChange && !this.commitOnAnyChange) this.commit();\r\n    }\r\n\r\n    setPassed() {\r\n      if (this.isSCORM2004()) {\r\n        this.setValue('cmi.completion_status', 'completed');\r\n        this.setValue('cmi.success_status', 'passed');\r\n      } else {\r\n        this.setValue('cmi.core.lesson_status', 'passed');\r\n      }\r\n\r\n      if (this.commitOnStatusChange && !this.commitOnAnyChange) this.commit();\r\n    }\r\n\r\n    setFailed() {\r\n      if (this.isSCORM2004()) {\r\n        this.setValue('cmi.success_status', 'failed');\r\n\r\n        if (this.setCompletedWhenFailed) {\r\n          this.setValue('cmi.completion_status', 'completed');\r\n        }\r\n      } else {\r\n        this.setValue('cmi.core.lesson_status', 'failed');\r\n      }\r\n\r\n      if (this.commitOnStatusChange && !this.commitOnAnyChange) this.commit();\r\n    }\r\n\r\n    getStatus() {\r\n      const status = this.getValue(this.isSCORM2004() ? 'cmi.completion_status' : 'cmi.core.lesson_status');\r\n\r\n      switch (status.toLowerCase()) { // workaround for some LMSes (e.g. Arena) not adhering to the all-lowercase rule\r\n        case 'passed':\r\n        case 'completed':\r\n        case 'incomplete':\r\n        case 'failed':\r\n        case 'browsed':\r\n        case 'not attempted':\r\n        case 'not_attempted': // mentioned in SCORM 2004 docs but not sure it ever gets used\r\n        case 'unknown': // the SCORM 2004 version of not attempted\r\n          return status;\r\n        default:\r\n          this.handleError(`ScormWrapper::getStatus: invalid lesson status '${status}' received from LMS`);\r\n          return null;\r\n      }\r\n    }\r\n\r\n    setStatus(status) {\r\n      switch (status.toLowerCase()) {\r\n        case 'incomplete':\r\n          this.setIncomplete();\r\n          break;\r\n        case 'completed':\r\n          this.setCompleted();\r\n          break;\r\n        case 'passed':\r\n          this.setPassed();\r\n          break;\r\n        case 'failed':\r\n          this.setFailed();\r\n          break;\r\n        default:\r\n          this.handleError(`ScormWrapper::setStatus: the status '${status}' is not supported.`);\r\n      }\r\n    }\r\n\r\n    getScore() {\r\n      return this.getValue(this.isSCORM2004() ? 'cmi.score.raw' : 'cmi.core.score.raw');\r\n    }\r\n\r\n    setScore(_score, _minScore, _maxScore) {\r\n      if (this.isSCORM2004()) {\r\n        this.setValue('cmi.score.raw', _score);\r\n        this.setValue('cmi.score.min', _minScore);\r\n        this.setValue('cmi.score.max', _maxScore);\r\n\r\n        const range = _maxScore - _minScore;\r\n        const scaledScore = ((_score - _minScore) / range).toFixed(7);\r\n        this.setValue('cmi.score.scaled', scaledScore);\r\n        return;\r\n      }\r\n      // SCORM 1.2\r\n      this.setValue('cmi.core.score.raw', _score);\r\n      if (this.isSupported('cmi.core.score.min')) this.setValue('cmi.core.score.min', _minScore);\r\n      if (this.isSupported('cmi.core.score.max')) this.setValue('cmi.core.score.max', _maxScore);\r\n    }\r\n\r\n    getLessonLocation() {\r\n      return this.getValue(this.isSCORM2004() ? 'cmi.location' : 'cmi.core.lesson_location');\r\n    }\r\n\r\n    setLessonLocation(_location) {\r\n      this.setValue(this.isSCORM2004() ? 'cmi.location' : 'cmi.core.lesson_location', _location);\r\n    }\r\n\r\n    getSuspendData() {\r\n      return this.getValue('cmi.suspend_data');\r\n    }\r\n\r\n    setSuspendData(_data) {\r\n      this.setValue('cmi.suspend_data', _data);\r\n    }\r\n\r\n    getStudentName() {\r\n      return this.getValue(this.isSCORM2004() ? 'cmi.learner_name' : 'cmi.core.student_name');\r\n    }\r\n\r\n    getStudentId() {\r\n      return this.getValue(this.isSCORM2004() ? 'cmi.learner_id' : 'cmi.core.student_id');\r\n    }\r\n\r\n    setLanguage(_lang) {\r\n      if (this.isSCORM2004()) {\r\n        this.setValue('cmi.learner_preference.language', _lang);\r\n        return;\r\n      }\r\n      if (this.isSupported('cmi.student_preference.language')) {\r\n        this.setValue('cmi.student_preference.language', _lang);\r\n      }\r\n    }\r\n\r\n    commit() {\r\n      this.logger.debug('ScormWrapper::commit');\r\n\r\n      if (!this.lmsConnected) {\r\n        this.handleError('Course is not connected to the LMS');\r\n        return;\r\n      }\r\n\r\n      if (this.commitRetryPending) {\r\n        this.logger.debug('ScormWrapper::commit: skipping this commit call as one is already pending.');\r\n      } else {\r\n        if (this.scorm.save()) {\r\n          this.commitRetries = 0;\r\n          this.lastCommitSuccessTime = new Date();\r\n        } else {\r\n          if (this.commitRetries < this.maxCommitRetries && !this.finishCalled) {\r\n            this.commitRetries++;\r\n            this.initRetryCommit();\r\n          } else {\r\n            const _errorCode = this.scorm.debug.getCode();\r\n\r\n            let _errorMsg = 'Course could not commit data to the LMS';\r\n            _errorMsg += `\\nError ${_errorCode}: ${this.scorm.debug.getInfo(_errorCode)}`;\r\n            _errorMsg += `\\nLMS Error Info: ${this.scorm.debug.getDiagnosticInfo(_errorCode)}`;\r\n\r\n            this.handleError(_errorMsg);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    finish() {\r\n      this.logger.debug('ScormWrapper::finish');\r\n\r\n      if (!this.lmsConnected || this.finishCalled) {\r\n        this.handleError('Course is not connected to the LMS');\r\n        return;\r\n      }\r\n\r\n      this.finishCalled = true;\r\n\r\n      if (this.timedCommitIntervalID !== null) {\r\n        window.clearInterval(this.timedCommitIntervalID);\r\n      }\r\n\r\n      if (this.commitRetryPending) {\r\n        window.clearTimeout(this.retryCommitTimeoutID);\r\n        this.commitRetryPending = false;\r\n      }\r\n\r\n      if (this.logOutputWin && !this.logOutputWin.closed) {\r\n        this.logOutputWin.close();\r\n      }\r\n\r\n      this.endTime = new Date();\r\n\r\n      if (this.isSCORM2004()) {\r\n        this.scorm.set('cmi.session_time', this.convertToSCORM2004Time(this.endTime.getTime() - this.startTime.getTime()));\r\n        this.scorm.set('cmi.exit', this.getExitState());\r\n      } else {\r\n        this.scorm.set('cmi.core.session_time', this.convertToSCORM12Time(this.endTime.getTime() - this.startTime.getTime()));\r\n        this.scorm.set('cmi.core.exit', this.getExitState());\r\n      }\r\n\r\n      // api no longer available from this point\r\n      this.lmsConnected = false;\r\n\r\n      if (!this.scorm.quit()) {\r\n        this.handleError('Course could not finish');\r\n      }\r\n    }\r\n\r\n    recordInteraction(id, response, correct, latency, type) {\r\n      \r\n      if (!this.isSupported('cmi.interactions._count')) {\r\n        this.logger.info('ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...');\r\n        return;\r\n      }\r\n\r\n      switch (type) {\r\n        case 'choice':\r\n          this.recordInteractionMultipleChoice.apply(this, arguments);\r\n          break;\r\n\r\n        case 'matching':\r\n          this.recordInteractionMatching.apply(this, arguments);\r\n          break;\r\n\r\n        case 'numeric':\r\n          this.isSCORM2004() ? this.recordInteractionScorm2004.apply(this, arguments) : this.recordInteractionScorm12.apply(this, arguments);\r\n          break;\r\n\r\n        case 'fill-in':\r\n          this.recordInteractionFillIn.apply(this, arguments);\r\n          break;\r\n\r\n        // DD: New interaction type added.\r\n        case 'sequencing':\r\n          this.recordInteractionSequencing.apply(this, arguments);\r\n          break;\r\n\r\n        default:\r\n          console.error(`ScormWrapper.recordInteraction: unknown interaction type of '${type}' encountered...`);\r\n      }\r\n    }\r\n\r\n    // ****************************** private methods ******************************\r\n\r\n    getValue(_property) {\r\n      this.logger.debug(`ScormWrapper::getValue: _property=${_property}`);\r\n\r\n      if (this.finishCalled) {\r\n        this.logger.debug(`ScormWrapper::getValue: ignoring request as 'finish' has been called`);\r\n        return;\r\n      }\r\n\r\n      if (!this.lmsConnected) {\r\n        this.handleError('Course is not connected to the LMS');\r\n        return;\r\n      }\r\n\r\n      const _value = this.scorm.get(_property);\r\n      const _errorCode = this.scorm.debug.getCode();\r\n      let _errorMsg = '';\r\n\r\n      if (_errorCode !== 0) {\r\n        if (_errorCode === 403) {\r\n          this.logger.warn('ScormWrapper::getValue: data model element not initialized');\r\n        } else {\r\n          _errorMsg += `Course could not get ${_property}`;\r\n          _errorMsg += `\\nError Info: ${this.scorm.debug.getInfo(_errorCode)}`;\r\n          _errorMsg += `\\nLMS Error Info: ${this.scorm.debug.getDiagnosticInfo(_errorCode)}`;\r\n\r\n          this.handleError(_errorMsg);\r\n        }\r\n      }\r\n      this.logger.debug(`ScormWrapper::getValue: returning ${_value}`);\r\n      return _value + '';\r\n    }\r\n\r\n    setValue(_property, _value) {\r\n      this.logger.debug(`ScormWrapper::setValue: _property=${_property} _value=${_value}`);\r\n\r\n      if (this.finishCalled) {\r\n        this.logger.debug(`ScormWrapper::setValue: ignoring request as 'finish' has been called`);\r\n        return;\r\n      }\r\n\r\n      if (!this.lmsConnected) {\r\n        this.handleError('Course is not connected to the LMS');\r\n        return;\r\n      }\r\n\r\n      const _success = this.scorm.set(_property, _value);\r\n      const _errorCode = this.scorm.debug.getCode();\r\n      let _errorMsg = '';\r\n\r\n      if (!_success) {\r\n      /**\r\n       * Some LMSes have an annoying tendency to return false from a set call even when it actually worked fine.\r\n       * So, we should throw an error _only_ if there was a valid error code...\r\n       */\r\n        if (_errorCode !== 0) {\r\n          _errorMsg += `Course could not set ${_property} to ${_value}`;\r\n          _errorMsg += `\\nError Info: ${this.scorm.debug.getInfo(_errorCode)}`;\r\n          _errorMsg += `\\nLMS Error Info: ${this.scorm.debug.getDiagnosticInfo(_errorCode)}`;\r\n\r\n          this.handleError(_errorMsg);\r\n        } else {\r\n          this.logger.warn(`ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!`);\r\n        }\r\n      }\r\n\r\n\r\n      if (this.commitOnAnyChange) this.debouncedCommit();\r\n\r\n      return _success;\r\n    }\r\n\r\n    /**\r\n     * used for checking any data field that is not 'LMS Mandatory' to see whether the LMS we're running on supports it or not.\r\n     * Note that the way this check is being performed means it wouldn't work for any element that is\r\n     * 'write only', but so far we've not had a requirement to check for any optional elements that are.\r\n     */\r\n    isSupported(_property) {\r\n      this.logger.debug(`ScormWrapper::isSupported: _property=${_property}`);\r\n\r\n      if (this.finishCalled) {\r\n        this.logger.debug(`ScormWrapper::isSupported: ignoring request as 'finish' has been called`);\r\n        return;\r\n      }\r\n\r\n      if (!this.lmsConnected) {\r\n        this.handleError('Course is not connected to the LMS');\r\n        return false;\r\n      }\r\n\r\n      this.scorm.get(_property);\r\n\r\n      return (this.scorm.debug.getCode() === 401);\r\n    }\r\n\r\n    initTimedCommit() {\r\n      this.logger.debug('ScormWrapper::initTimedCommit');\r\n\r\n      if (!this.commitOnAnyChange && this.timedCommitFrequency > 0) {\r\n        const delay = this.timedCommitFrequency * (60 * 1000);\r\n        this.timedCommitIntervalID = window.setInterval(this.commit.bind(this), delay);\r\n      }\r\n    }\r\n\r\n    initRetryCommit() {\r\n      this.logger.debug(`ScormWrapper::initRetryCommit ${this.commitRetries} out of ${this.maxCommitRetries}`);\r\n\r\n      this.commitRetryPending = true;// stop anything else from calling commit until this is done\r\n\r\n      this.retryCommitTimeoutID = window.setTimeout(this.doRetryCommit.bind(this), this.commitRetryDelay);\r\n    }\r\n\r\n    doRetryCommit() {\r\n      this.logger.debug('ScormWrapper::doRetryCommit');\r\n\r\n      this.commitRetryPending = false;\r\n\r\n      this.commit();\r\n    }\r\n\r\n    handleError(_msg) {\r\n      this.logger.error(_msg);\r\n\r\n      if (!this.suppressErrors && (!this.logOutputWin || this.logOutputWin.closed) && confirm(`An error has occured:\\n\\n${_msg}\\n\\nPress 'OK' to view debug information to send to technical support.`)) {\r\n        this.showDebugWindow();\r\n      }\r\n    }\r\n\r\n    getInteractionCount() {\r\n      const count = this.getValue('cmi.interactions._count');\r\n      return count === '' ? 0 : count;\r\n    }\r\n\r\n    recordInteractionScorm12(id, response, correct, latency, type) {\r\n\r\n      id = this.trim(id);\r\n\r\n      const cmiPrefix = `cmi.interactions.${this.getInteractionCount()}`;\r\n\r\n      this.setValue(`${cmiPrefix}.id`, id);\r\n      this.setValue(`${cmiPrefix}.type`, type);\r\n      this.setValue(`${cmiPrefix}.student_response`, response);\r\n      this.setValue(`${cmiPrefix}.result`, correct ? 'correct' : 'wrong');\r\n      if (latency !== null && latency !== undefined) this.setValue(`${cmiPrefix}.latency`, this.convertToSCORM12Time(latency));\r\n      this.setValue(`${cmiPrefix}.time`, this.getCMITime());\r\n    }\r\n\r\n    recordInteractionScorm2004(id, response, correct, latency, type) {\r\n\r\n      id = this.trim(id);\r\n\r\n      const cmiPrefix = `cmi.interactions.${this.getInteractionCount()}`;\r\n\r\n      this.setValue(`${cmiPrefix}.id`, id);\r\n      this.setValue(`${cmiPrefix}.type`, type);\r\n      this.setValue(`${cmiPrefix}.learner_response`, response);\r\n      this.setValue(`${cmiPrefix}.result`, correct ? 'correct' : 'incorrect');\r\n      if (latency !== null && latency !== undefined) this.setValue(`${cmiPrefix}.latency`, this.convertToSCORM2004Time(latency));\r\n      this.setValue(`${cmiPrefix}.timestamp`, this.getISO8601Timestamp());\r\n    }\r\n\r\n    recordInteractionMultipleChoice(id, response, correct, latency, type) {\r\n\r\n      if (this.isSCORM2004()) {\r\n        response = response.replace(/,|#/g, '[,]');\r\n      } else {\r\n        response = response.replace(/#/g, ',');\r\n      }\r\n\r\n      const scormRecordInteraction = this.isSCORM2004() ? this.recordInteractionScorm2004 : this.recordInteractionScorm12;\r\n\r\n      scormRecordInteraction.call(this, id, response, correct, latency, type);\r\n    }\r\n\r\n    /**\r\n     * DD: Added support for 'sequencing' interaction.\r\n     * Adapt does NOT natively support this. \r\n     * @param {*} id \r\n     * @param {*} response \r\n     * @param {*} correct \r\n     * @param {*} latency \r\n     * @param {*} type \r\n     */\r\n    recordInteractionSequencing(id, response, correct, latency, type) {\r\n\r\n      if (this.isSCORM2004()) {\r\n        response = response.replace(/,|#/g, '[,]');\r\n      } else {\r\n        response = response.replace(/#/g, ',');\r\n      }\r\n\r\n      const scormRecordInteraction = this.isSCORM2004() ? this.recordInteractionScorm2004 : this.recordInteractionScorm12;\r\n\r\n      scormRecordInteraction.call(this, id, response, correct, latency, type);\r\n    }\r\n\r\n    recordInteractionMatching(id, response, correct, latency, type) {\r\n\r\n      response = response.replace(/#/g, ',');\r\n\r\n      if (this.isSCORM2004()) {\r\n        response = response.replace(/,/g, '[,]');\r\n        response = response.replace(/\\./g, '[.]');\r\n      } else {\r\n        response = this.checkResponse(response, 'matching');\r\n      }\r\n\r\n      const scormRecordInteraction = this.isSCORM2004() ? this.recordInteractionScorm2004 : this.recordInteractionScorm12;\r\n\r\n      scormRecordInteraction.call(this, id, response, correct, latency, type);\r\n    }\r\n\r\n    recordInteractionFillIn(id, response, correct, latency, type) {\r\n\r\n      const maxLength = this.isSCORM2004() ? 250 : 255;\r\n\r\n      if (response.length > maxLength) {\r\n        response = response.substr(0, maxLength);\r\n\r\n        this.logger.warn(`ScormWrapper::recordInteractionFillIn: response data for ${id} is longer than the maximum allowed length of ${maxLength} characters; data will be truncated to avoid an error.`);\r\n      }\r\n\r\n      const scormRecordInteraction = this.isSCORM2004() ? this.recordInteractionScorm2004 : this.recordInteractionScorm12;\r\n\r\n      scormRecordInteraction.call(this, id, response, correct, latency, type);\r\n    }\r\n\r\n    showDebugWindow() {\r\n\r\n      if (this.logOutputWin && !this.logOutputWin.closed) {\r\n        this.logOutputWin.close();\r\n      }\r\n\r\n      this.logOutputWin = window.open('log_output.html', 'Log', 'width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0');\r\n\r\n      if (this.logOutputWin) {\r\n        this.logOutputWin.focus();\r\n      }\r\n\r\n    }\r\n\r\n    convertToSCORM12Time(msConvert) {\r\n\r\n      const msPerSec = 1000;\r\n      const msPerMin = msPerSec * 60;\r\n      const msPerHour = msPerMin * 60;\r\n\r\n      const ms = msConvert % msPerSec;\r\n      msConvert = msConvert - ms;\r\n\r\n      let secs = msConvert % msPerMin;\r\n      msConvert = msConvert - secs;\r\n      secs = secs / msPerSec;\r\n\r\n      let mins = msConvert % msPerHour;\r\n      msConvert = msConvert - mins;\r\n      mins = mins / msPerMin;\r\n\r\n      const hrs = msConvert / msPerHour;\r\n\r\n      if (hrs > 9999) {\r\n        return '9999:99:99.99';\r\n      }\r\n\r\n      const str = [ this.padWithZeroes(hrs, 4), this.padWithZeroes(mins, 2), this.padWithZeroes(secs, 2) ].join(':');\r\n      return (`${str}.${Math.floor(ms / 10)}`);\r\n    }\r\n\r\n    /**\r\n     * Converts milliseconds into the SCORM 2004 data type 'timeinterval (second, 10,2)'\r\n     * this will output something like 'P1DT3H5M0S' which indicates a period of time of 1 day, 3 hours and 5 minutes\r\n     * or 'PT2M10.1S' which indicates a period of time of 2 minutes and 10.1 seconds\r\n     */\r\n    convertToSCORM2004Time(msConvert) {\r\n      let csConvert = Math.floor(msConvert / 10);\r\n      const csPerSec = 100;\r\n      const csPerMin = csPerSec * 60;\r\n      const csPerHour = csPerMin * 60;\r\n      const csPerDay = csPerHour * 24;\r\n\r\n      let days = Math.floor(csConvert / csPerDay);\r\n      csConvert -= days * csPerDay;\r\n      days = days ? days + 'D' : '';\r\n\r\n      let hours = Math.floor(csConvert / csPerHour);\r\n      csConvert -= hours * csPerHour;\r\n      hours = hours ? hours + 'H' : '';\r\n\r\n      let mins = Math.floor(csConvert / csPerMin);\r\n      csConvert -= mins * csPerMin;\r\n      mins = mins ? mins + 'M' : '';\r\n\r\n      let secs = Math.floor(csConvert / csPerSec);\r\n      csConvert -= secs * csPerSec;\r\n      secs = secs || '0';\r\n\r\n      let cs = csConvert;\r\n      cs = cs ? '.' + cs : '';\r\n\r\n      const seconds = secs + cs + 'S';\r\n\r\n      const hms = [ hours, mins, seconds ].join('');\r\n\r\n      return 'P' + days + 'T' + hms;\r\n    }\r\n\r\n    getCMITime() {\r\n\r\n      const date = new Date();\r\n\r\n      const hours = this.padWithZeroes(date.getHours(), 2);\r\n      const min = this.padWithZeroes(date.getMinutes(), 2);\r\n      const sec = this.padWithZeroes(date.getSeconds(), 2);\r\n\r\n      return [ hours, min, sec ].join(':');\r\n    }\r\n\r\n    /**\r\n     * returns the current date & time in the format YYYY-MM-DDTHH:mm:ss\r\n     */\r\n    getISO8601Timestamp() {\r\n      const date = new Date().toISOString();\r\n      return date.replace(/.\\d\\d\\dZ/, ''); // Date.toISOString returns the date in the format YYYY-MM-DDTHH:mm:ss.sssZ so we need to drop the last bit to make it SCORM 2004 conformant\r\n    }\r\n\r\n    padWithZeroes(numToPad, padBy) {\r\n\r\n      let len = padBy;\r\n\r\n      while (--len) {\r\n        numToPad = '0' + numToPad;\r\n      }\r\n\r\n      return numToPad.slice(-padBy);\r\n    }\r\n\r\n    trim(str) {\r\n      return str.replace(/^\\s*|\\s*$/g, '');\r\n    }\r\n\r\n    isSCORM2004() {\r\n      return this.scorm.version === '2004';\r\n    }\r\n\r\n    /**\r\n     * SCORM 1.2 requires that the identifiers in cmi.interactions.n.student_response for choice and matching activities be a character from [0-9a-z].\r\n     * When numeric identifiers are used this function attempts to map identifiers 10 to 35 to [a-z]. Resolves issues/1376.\r\n     */\r\n    checkResponse(response, responseType) {\r\n      if (!response) return response;\r\n      if (responseType !== 'choice' && responseType !== 'matching') return response;\r\n\r\n      response = response.split(/,|#/);\r\n\r\n      const self = this;\r\n\r\n      if (responseType === 'choice') {\r\n        response = response.map(checkIdentifier);\r\n      } else {\r\n        response = response.map(r => {\r\n          const identifiers = r.split('.');\r\n          return checkIdentifier(identifiers[0]) + '.' + checkIdentifier(identifiers[1]);\r\n        });\r\n      }\r\n\r\n      function checkIdentifier(r) {\r\n        let i;\r\n\r\n        // if [0-9] then ok\r\n        if (r.length === 1 && r >= '0' && r <= '9') return r;\r\n\r\n        // if [a-z] then ok\r\n        if (r.length === 1 && r >= 'a' && r <= 'z') return r;\r\n\r\n        // try to map integers 10-35 to [a-z]\r\n        i = parseInt(r);\r\n\r\n        if (isNaN(i) || i < 10 || i > 35) {\r\n          self.handleError('Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2');\r\n        }\r\n\r\n        return Number(i).toString(36); // 10 maps to 'a', 11 maps to 'b', ..., 35 maps to 'z'\r\n      }\r\n\r\n      return response.join(',');\r\n    }\r\n\r\n    getExitState() {\r\n      const completionStatus = this.scorm.data.completionStatus;\r\n      const isIncomplete = completionStatus === 'incomplete' || completionStatus === 'not attempted';\r\n      const exitState = isIncomplete ? this.exitStateIfIncomplete : this.exitStateIfComplete;\r\n\r\n      if (exitState !== 'auto') return exitState;\r\n\r\n      if (this.isSCORM2004()) return (isIncomplete ? 'suspend' : 'normal');\r\n\r\n      return '';\r\n    }\r\n\r\n  }\r\n\r\n  // static\r\n  ScormWrapper.instance = null;\r\n\r\n  return ScormWrapper;\r\n\r\n});\r\n","define([\r\n  'underscore'\r\n], function(_) {\r\n  /**\r\n   * 2020/05/06 SCORMSuspendData\r\n   *\r\n   * Serialize and deserialize arrays, booleans and numbers into a base64 string\r\n   * for transport over SCORM 1.2 based systems where storage space is restricted\r\n   * to only 4096 characters or 4KB.\r\n   *\r\n   * The algorithm is weighted heavily in efficiency towards storing data by\r\n   * its occurrence frequency when it is used to save Adapt question responses,\r\n   * booleans, arrays of <16 length and numbers of <4 value.\r\n   *\r\n   * Numbers can be 2 precision decimals, positive and negative numbers between\r\n   * -4294967295.99 and 4294967295.99. Arrays can have 0 to 65535 entries. Arrays\r\n   * can be nested. All arrays must have the same ES type (boolean, number or array).\r\n   *\r\n   * The appropriate binary type is chosen for each array according to the following table,\r\n   * an array must have one type which best fits its values:\r\n   *\r\n   *           VALUES                                VALUETYPE     PER ENTRY\r\n   * VALUETYPE MIN           MAX            DECIMAL  BITS          MIN BITS  MAX BITS  STORES\r\n   * ARRAY     0             65535 (items)  NO       2             6         23        Array length and valuetype\r\n   * BOOLEAN   0             1              NO       1             1         1         Entry value\r\n   * UINT3     0             7              NO       4             3         3         Entry value\r\n   * VINT8+    0             255            NO       3             3         9         Entry value\r\n   * VINT8-   -255           0              NO       6             3         9         Entry value\r\n   * SDEC15   -255.99        255.99         NO       6             8         22        Entry value\r\n   * SINT32   -4294967295    4294967295     NO       6             5         35        Entry value\r\n   * SDEC39   -4294967295.99 4294967295.99  YES      6             10        48        Entry value\r\n   *\r\n   * Output construction map:\r\n   *\r\n   *  OUTPUT = VALUETYPE + DATA\r\n   *  DATA = ( ARRAY | BOOLEAN | UINT3 | VINT8+ | VINT8- | SDEC15 | SINT32 | SDEC39 )\r\n   *  ARRAY = IS_SMALL_BIT( BOOLEAN ) + LENGTH( UINT4 | UINT16 ) + VALUETYPE + DATA[0-65535]\r\n   *\r\n   *  VALUETYPE = 0 to 111111\r\n   *   Signifies the type of value for the output or array data.\r\n   *\r\n   *   BINARY  NAME        USAGE RANKING\r\n   *   10      ARRAY       2\r\n   *   0       BOOLEAN     1\r\n   *   1110    UINT3       4\r\n   *   110     VINT8+      3\r\n   *   111100  VINT8-      7\r\n   *   111101  SDEC15      5\r\n   *   111110  SINT32      6\r\n   *   111111  SDEC39      8\r\n   *\r\n   *  ARRAY\r\n   *   Stores the number and type of items.\r\n   *\r\n   *          BINARY\r\n   *   BITS | SMALL LENGTH (UINT4/16) VALUETYPE = VALUE\r\n   *   6    | 1     0000              0         = zero length boolean array\r\n   *   6    | 1     1111              0         = 15 length boolean array\r\n   *   23   | 0     1000000000000000  111111    = 8 length sdec39 array\r\n   *   23   | 0     1111111111111111  111111    = 65535 length sdec39 array\r\n   *\r\n   *  BOOLEAN\r\n   *   A value of true or false.\r\n   *\r\n   *          BINARY\r\n   *   BITS | BOOL  = VALUE\r\n   *   1    | 0     = false\r\n   *   1    | 1     = true\r\n   *\r\n   *  UINT3\r\n   *   A value from 0 to 7 with a 3 bit fixed length output.\r\n   *\r\n   *          BINARY\r\n   *   BITS | INT (UINT3) = VALUE\r\n   *   3    | 000         = 0\r\n   *   3    | 111         = 7\r\n   *\r\n   *  UINT4\r\n   *   An array length from 0 to 15 with a 4 bit fixed length output.\r\n   *\r\n   *          BINARY\r\n   *   BITS | INT (UINT4) = VALUE\r\n   *   4    | 0000        = 0\r\n   *   4    | 1111        = 15\r\n   *\r\n   *  VINT8+\r\n   *   A value from 0 to 255 with variable length output.\r\n   *   Output is a UINT2/8 bit integer with a 1 bit header.\r\n   *\r\n   *          BINARY\r\n   *   BITS | SMALL INT (UINT2/8) = VALUE\r\n   *   3    | 1     00           =  0\r\n   *   3    | 1     11           =  3\r\n   *   9    | 0     00000100     =  4\r\n   *   9    | 0     11111111     =  255\r\n   *\r\n   *  VINT8-\r\n   *   A value from -255 to 0 with variable length output.\r\n   *   Output is a UINT2/8 bit integer with a 1 bit header.\r\n   *\r\n   *   BITS | SMALL INT (UINT2/8) = VALUE\r\n   *   3    | 1     00            =  0\r\n   *   3    | 1     11            = -3\r\n   *   9    | 0     00000100      = -4\r\n   *   9    | 0     11111111      = -255\r\n   *\r\n   *  SDEC15\r\n   *   A value from -255.99 to 255.99 preserving 2 decimals places\r\n   *   places and with variable length output.\r\n   *\r\n   *   BITS | SIGN INTSIZE INT (UINT2/8) DECSIZE DEC (UINT0/7)   = VALUE\r\n   *   5    | 0    0       00            0                       =  0\r\n   *   12   | 0    0       00            0       0000001         =  0.01\r\n   *   12   | 1    0       00            0       0000001         = -0.01\r\n   *   12   | 1    0       00            1       1100011         = -0.99\r\n   *   18   | 0    1       00001000      1       0000001         =  8.01\r\n   *   18   | 1    1       00001000      1       1100011         = -8.99\r\n   *   18   | 0    1       11111111      1       1100011         =  255.99\r\n   *   18   | 1    1       11111111      1       1100011         = -255.99\r\n   *\r\n   *  UINT16\r\n   *   An array length from 0 to 65535 with a 16 bit fixed length output.\r\n   *\r\n   *          BINARY\r\n   *   BITS | INT (UINT16)       = VALUE\r\n   *   16   | 0000000000000000  = 0\r\n   *   16   | 1111111111111111  = 65535\r\n   *\r\n   *  SINT32\r\n   *   A value from -4294967295 to 4294967295 with variable length output.\r\n   *   Output is a UINT2/4/16/32 bit integer with a 3 bit header.\r\n   *\r\n   *   BITS | SIGN SIZE  INT (UINT2/4/16/32)              = VALUE\r\n   *   5    | 0    00    00                               =  0\r\n   *   5    | 1    00    11                               = -3\r\n   *   7    | 0    01    1000                             =  8\r\n   *   7    | 1    01    1111                             = -15\r\n   *   19   | 0    10    0000000100000000                 =  256\r\n   *   19   | 1    10    1111111111111111                 = -65535\r\n   *   35   | 1    11    11111111111111111111111111111111 = -4294967295\r\n   *   35   | 0    11    11111111111111111111111111111111 =  4294967295\r\n   *\r\n   *  SDEC39\r\n   *   A value from -4294967295.99 to 4294967295.99 preserving 2 decimals places\r\n   *   places and with variable length output.\r\n   *\r\n   *   BITS | SIGN INTSIZE INT (UINT2/4/16/32)              DECSIZE DEC (UINT0/7)   = VALUE\r\n   *   6    | 0    00      00                               0                       =  0\r\n   *   13   | 0    00      11                               0       0000001         =  3.01\r\n   *   13   | 1    01      1000                             0       0000001         = -8.01\r\n   *   13   | 1    01      1111                             1       1100011         = -15.99\r\n   *   27   | 0    10      0000000100000000                 1       0000001         =  256.01\r\n   *   27   | 1    10      1111111111111111                 1       1100011         = -65535.99\r\n   *   37   | 0    11      11111111111111111111111111111111 0                       =  4294967295\r\n   *   37   | 1    11      11111111111111111111111111111111 0                       = -4294967295\r\n   *   43   | 0    11      11111111111111111111111111111111 1       1100011         =  4294967295.99\r\n   *   43   | 1    11      11111111111111111111111111111111 1       1100011         = -4294967295.99\r\n   *\r\n   * Output byte count formula:\r\n   *\r\n   *  byte_count = (bit_count * 1.5base64_expansion) / 8bits_per_byte\r\n   *\r\n   *  The output is in base64 so bit counts are always inflated by 1.5 from byte to base64.\r\n   *\r\n   * Example:\r\n   *\r\n   * [\r\n   *   [\r\n   *     0,\r\n   *     7,\r\n   *     1,\r\n   *     0\r\n   *   ],\r\n   *   [\r\n   *     true,\r\n   *     true,\r\n   *     true,\r\n   *     true,\r\n   *     true\r\n   *   ],\r\n   *   [\r\n   *     true,\r\n   *     false,\r\n   *     false,\r\n   *     false\r\n   *   ]\r\n   * ]\r\n   *\r\n   * In this example the parent array represents a completed question state for a\r\n   * single question. The first child number-array stores the block location,\r\n   * tracking id, score and attemptsLeft. The second child boolean-array stores\r\n   * the completion, correctness, submission state and user answer states. The\r\n   * third child boolean-array stores the user selections for a multiple choice question.\r\n   *\r\n   * When serialized with SCORMSuspendData.serialize() it becomes the following\r\n   * 10 characters:\r\n   *\r\n   *   hxOHIK-RAA\r\n   *\r\n   * These characters can be deserialized back into the nested arrays above using\r\n   * SCORMSuspendData.deserialize(\"hxOHIK-RAA\");\r\n   *\r\n   * In JSON this array would usually be 63 characters minified, at 10 characters this is\r\n   * a reduction of about 84%. At the worse case, storing an array containing just\r\n   * the largest possible number ([-4294967295.99]) the output will only be reduced\r\n   * by about 37% (g///////4w) when compared to the equivalent JSON. It is possible\r\n   * to store 500 of the above mcq state arrays in just 4088 characters. About 250\r\n   * question states will occupy about half of the available space in SCORM's 4096\r\n   * character suspend data.\r\n   */\r\n\r\n  // Cache for zero strings of various lengths\r\n  const ZeroString = {};\r\n  /**\r\n   * Make and cache a zero string up to the supplied length\r\n   * @param {number} length\r\n   * @returns {string}\r\n   */\r\n  function makeZeroString(length) {\r\n    ZeroString[length] = ZeroString[length] || (new Array(length + 1)).join('0');\r\n    return ZeroString[length];\r\n  }\r\n  // Initialize zero string cache up to 64 characters in length\r\n  for (let i = 1, l = 64; i <= l; i++) {\r\n    makeZeroString(i);\r\n  }\r\n\r\n  /**\r\n   * Zero pads to the right, making up to the supplied length\r\n   * @param {string} string\r\n   * @param {number} length\r\n   * @returns {string}\r\n   */\r\n  function zeroPadRightToLength(string, length) {\r\n    const padLength = (length - string.length);\r\n    if (padLength > 0) {\r\n      string += makeZeroString(padLength);\r\n    }\r\n    return string;\r\n  }\r\n\r\n  /**\r\n   * Zero pads to the left, making up to the supplied length\r\n   * @param {string} string\r\n   * @param {number} length\r\n   * @returns {string}\r\n   */\r\n  function zeroPadLeftToLength(string, length) {\r\n    const padLength = (length - string.length);\r\n    if (padLength > 0) {\r\n      string = makeZeroString(padLength) + string;\r\n    }\r\n    return string;\r\n  }\r\n\r\n  /**\r\n   * Zero pads to the right at even multiples\r\n   * @param {string} string\r\n   * @param {number} multiple\r\n   * @returns {string}\r\n   */\r\n  function zeroPadRightToMultiple(string, multiple) {\r\n    const padLength = multiple - (string.length % multiple);\r\n    if (padLength !== multiple) {\r\n      string += makeZeroString(padLength);\r\n    }\r\n    return string;\r\n  }\r\n\r\n  /**\r\n   * Returns a positive integer from the supplied binary string and binaryLength\r\n   * @param {string} binary\r\n   * @param {number} binaryLength\r\n   * @returns {number}\r\n   */\r\n  function binaryToUnsignedInteger(binary, binaryLength) {\r\n    if (binaryLength === 0) {\r\n      return 0;\r\n    }\r\n    binary = zeroPadLeftToLength(binary, binaryLength);\r\n    const integer = parseInt(binary.slice(0, binaryLength), 2);\r\n    return integer;\r\n  }\r\n\r\n  /**\r\n   * Shifts a positive integer from the supplied binary string and binaryLength,\r\n   * returning the shifted integer and the next part of the binary string\r\n   * @param {string} binary\r\n   * @param {number} binaryLength\r\n   * @returns {[number, string]}\r\n   */\r\n  function shiftUnsignedIntegerFromBinary(binary, binaryLength) {\r\n    if (binaryLength === 0) {\r\n      return [0, binary];\r\n    }\r\n    binary = zeroPadLeftToLength(binary, binaryLength);\r\n    const integer = parseInt(binary.slice(0, binaryLength), 2);\r\n    binary = binary.slice(binaryLength);\r\n    return [integer, binary];\r\n  }\r\n\r\n  /**\r\n   * Shifts binaryLength characters from the supplied binary string, returning the\r\n   * shifted binary string and the next part of the binary string\r\n   * @param {string} binary\r\n   * @param {number} binaryLength\r\n   * @returns {[string, string]}\r\n   */\r\n  function shiftBinary(binary, binaryLength) {\r\n    if (binaryLength === 0) {\r\n      return ['', binary];\r\n    }\r\n    binary = zeroPadLeftToLength(binary, binaryLength);\r\n    const shifted = binary.slice(0, binaryLength);\r\n    binary = binary.slice(binaryLength);\r\n    return [shifted, binary];\r\n  }\r\n\r\n  /**\r\n   * Converts a positive integer to a binary string\r\n   * @param {number} integer\r\n   * @param {number} [binaryLength] Length of the output string\r\n   */\r\n  function unsignedIntegerToBinary(integer, binaryLength) {\r\n    if (binaryLength === 0) {\r\n      return '';\r\n    }\r\n    let binary = Math.abs(integer).toString(2);\r\n    if (typeof binaryLength === 'undefined') {\r\n      return binary;\r\n    }\r\n    const length = binary.length;\r\n    if (length > binaryLength) {\r\n      throw new Error(`Integer too big for specified binary length. integer: ${integer} binarylen: ${binaryLength}`);\r\n    }\r\n    binary = zeroPadLeftToLength(binary, binaryLength);\r\n    return binary;\r\n  }\r\n\r\n  /**\r\n   * Converts a byte array to a string\r\n   * @param {[number]} array\r\n   * @returns {string}\r\n   */\r\n  function byteArrayToString(array) {\r\n    const arrayLength = array.length;\r\n    let string = new Array(arrayLength);\r\n    for (let i = 0, l = arrayLength; i < l; i++) {\r\n      string[i] = String.fromCharCode(array[i]);\r\n    }\r\n    string = string.join('');\r\n    return string;\r\n  }\r\n\r\n  /**\r\n   * Converts a string to a byte array\r\n   * @param {string} string\r\n   * @returns {[number]}\r\n   */\r\n  function stringToByteArray(string) {\r\n    const stringLength = string.length;\r\n    const array = new Array(stringLength);\r\n    for (let i = 0, l = stringLength; i < l; i++) {\r\n      array[i] = string.charCodeAt(i);\r\n    }\r\n    return array;\r\n  }\r\n\r\n  /** @type {number} Number of bits per byte */\r\n  const BYTE_BIT_LENGTH = 8;\r\n\r\n  /**\r\n   * Converts a binary string or nested arrays of binary strings to a base64 string\r\n   * @param {string|[string]} binary\r\n   * @returns {string}\r\n   */\r\n  function binaryToBase64(binary) {\r\n    binary = _.flatten(binary).join('');\r\n    binary = zeroPadRightToMultiple(binary, BYTE_BIT_LENGTH);\r\n    const bytesCount = binary.length / BYTE_BIT_LENGTH;\r\n    const charCodes = new Array(bytesCount);\r\n    for (let i = 0, l = bytesCount; i < l; i++) {\r\n      [ charCodes[i], binary ] = shiftUnsignedIntegerFromBinary(binary, BYTE_BIT_LENGTH);\r\n    }\r\n    let base64 = btoa(byteArrayToString(charCodes));\r\n    // Remove padding = or == as not necessary here\r\n    base64 = base64.replace(/=/g, '');\r\n    // Can't handle base64 with the + sign so swap with a -\r\n    base64 = base64.replace(/\\+/g, '-');\r\n    return base64;\r\n  }\r\n\r\n  /**\r\n   * Converts a base64 string to a binary string\r\n   * @param {string} base64\r\n   * @returns {string}\r\n   */\r\n  function base64ToBinary(base64) {\r\n    // base64 should have a + instead of a -\r\n    base64 = base64.replace(/-/g, '+');\r\n    const charCodes = stringToByteArray(atob(base64));\r\n    const bytesCount = charCodes.length;\r\n    let binary = new Array(bytesCount);\r\n    for (let i = 0, l = bytesCount; i < l; i++) {\r\n      binary[i] = unsignedIntegerToBinary(charCodes[i], BYTE_BIT_LENGTH);\r\n    }\r\n    binary = binary.join('');\r\n    return binary;\r\n  }\r\n\r\n  // Console output store\r\n  const logs = {\r\n    usedTypes: {},\r\n    typeLengths: {},\r\n    binarySamples: {}\r\n  };\r\n\r\n  /**\r\n   * An abstract base class for a ValueType value to and from binary string converter\r\n   */\r\n  class AbstractValueType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     */\r\n    constructor(options) {\r\n      Object.assign(this, options);\r\n      this.binaryTypeLength = this.binaryType.length;\r\n    }\r\n\r\n    /**\r\n     * Adds a record of the binary string production to the logging store\r\n     * @param {[Array|string]} binary\r\n     */\r\n    log(binary) {\r\n      const name = this.name;\r\n      logs.usedTypes[name] = logs.usedTypes[name] || 0;\r\n      logs.usedTypes[name]++;\r\n      logs.binarySamples[name] = logs.binarySamples[name] || [];\r\n      logs.binarySamples[name].push(binary);\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Converts a fixed length positive integer to and from a binary string.\r\n   */\r\n  class FixedIntegerType extends AbstractValueType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     * @param {number} options.valueBinaryLength Bit length of the integer\r\n     */\r\n    constructor(options) {\r\n      super(options);\r\n      this.esType = 'number';\r\n      if (!this.valueBinaryLength) {\r\n        return;\r\n      }\r\n      this.minValue = options.minValue || 0;\r\n      this.maxValue = options.maxValue || Math.pow(2, this.valueBinaryLength) - 1;\r\n    }\r\n\r\n    /**\r\n     * Converts a fixed length positive integer to an array of binary strings\r\n     * @param {number} integer\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[string]}\r\n     */\r\n    valueToBinary(integer, logStats = null) {\r\n      let binary = unsignedIntegerToBinary(integer, this.valueBinaryLength);\r\n      if (logStats) {\r\n        this.log(binary);\r\n      }\r\n      binary = [binary];\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts a fixed length positive integer from the binary string, returning\r\n     * the integer and the next part of the binary string.\r\n     * @param {string} binary\r\n     * @returns {[number, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let integer;\r\n      [integer, binary] = shiftUnsignedIntegerFromBinary(binary, this.valueBinaryLength);\r\n      return [integer, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts a boolean to and from a binary string\r\n   */\r\n  class FixedBooleanType extends FixedIntegerType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     */\r\n    constructor(options) {\r\n      options.valueBinaryLength = 1;\r\n      super(options);\r\n      this.esType = 'boolean';\r\n    }\r\n\r\n    /**\r\n     * Shifts a boolean from the binary string, returning\r\n     * the boolean and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[boolean, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      const bool = (binary[0] === '1');\r\n      binary = binary.slice(1);\r\n      return [bool, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * A helper for converting variable length positive integers to and from a binary string\r\n   */\r\n  class LengthAndValueBinary {\r\n\r\n    /**\r\n     * @param {string} parent The parent AbstractValueType\r\n     * @param {string} name The sub parent value part name \"integer\" or \"decimal\"\r\n     * @param {[number]} bitSizes An ordered array of expressible bit lengths\r\n     */\r\n    constructor(parent, name, bitSizes) {\r\n      this.parent = parent;\r\n      this.name = name;\r\n      this.bitSizes = bitSizes;\r\n      this.maxValues = _.flatten(this.bitSizes).map(value => (Math.pow(2, value) - 1));\r\n      this.maxValue = this.maxValues[this.maxValues.length - 1];\r\n      this.sizeBinaryLength = unsignedIntegerToBinary(this.bitSizes.length - 1).length;\r\n    }\r\n\r\n    /**\r\n     * Converts a positive integer to a binary string array\r\n     * @param {number} integer\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[string]}\r\n     */\r\n    valueToBinary(integer, logStats = null) {\r\n      const parentName = this.parent.name;\r\n      const sizeIndex = this.maxValues.findIndex(maxValue => (integer <= maxValue));\r\n      if (sizeIndex === -1) {\r\n        throw new Error(`Value is too large for type: ${parentName} value: ${integer} max: ${this.maxValue}`);\r\n      }\r\n      const sizeBinary = unsignedIntegerToBinary(sizeIndex, this.sizeBinaryLength);\r\n      const valueLength = this.bitSizes[sizeIndex];\r\n      const name = this.name;\r\n      if (logStats) {\r\n        logs.typeLengths[parentName] = logs.typeLengths[parentName] || {};\r\n        logs.typeLengths[parentName][name] = logs.typeLengths[parentName][name] || {};\r\n        logs.typeLengths[parentName][name][valueLength] = logs.typeLengths[parentName][name][valueLength] || 0;\r\n        logs.typeLengths[parentName][name][valueLength]++;\r\n      }\r\n      const integerBinary = unsignedIntegerToBinary(integer, valueLength);\r\n      const binary = [sizeBinary, integerBinary];\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts a positive integer from the binary string, returning\r\n     * the integer and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[number, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let sizeBinary;\r\n      [sizeBinary, binary] = shiftBinary(binary, this.sizeBinaryLength);\r\n      const sizeIndex = binaryToUnsignedInteger(sizeBinary);\r\n      const valueLength = this.bitSizes[sizeIndex];\r\n      let integer;\r\n      [integer, binary] = shiftUnsignedIntegerFromBinary(binary, valueLength);\r\n      return [integer, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts a variable length positive or negative integer to and from a\r\n   * binary string\r\n   */\r\n  class VariableIntegerType extends FixedIntegerType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     * @param {number} options.minValue Minimum value for the integer\r\n     * @param {number} options.maxValue Maximum value for the integer\r\n     * @param {[number]} options.integerBitSizes Expressible storage bit sizes\r\n     */\r\n    constructor(options) {\r\n      super(options);\r\n      this.isNegative = (this.minValue < 0 && this.maxValue === 0);\r\n      this.integer = new LengthAndValueBinary(this, 'integer', options.integerBitSizes);\r\n    }\r\n\r\n    /**\r\n     * Converts a positive or negative integer to a array of binary strings\r\n     * @param {number} integer\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[string]}\r\n     */\r\n    valueToBinary(integer, logStats = null) {\r\n      integer = integer.toFixed(0);\r\n      let binary = this.integer.valueToBinary(Math.abs(integer), logStats);\r\n      if (logStats) {\r\n        this.log(binary);\r\n      }\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts a positive or negative integer from the binary string, returning\r\n     * the integer and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[number, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let integer;\r\n      [integer, binary] = this.integer.shiftValueFromBinary(binary);\r\n      if (this.isNegative) {\r\n        integer = -integer;\r\n      }\r\n      return [integer, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts a variable length array to and from a binary string\r\n   */\r\n  class VariableArrayType extends VariableIntegerType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     * @param {[number]} options.integerBitSizes Expressible storage bit sizes\r\n     */\r\n    constructor(options) {\r\n      super(options);\r\n      this.esType = 'array';\r\n    }\r\n\r\n    /**\r\n     * Converts an array to an array of binary strings\r\n     * @param {Array} array\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[Array|string]}\r\n     */\r\n    valueToBinary(array, logStats = null) {\r\n      const arrayLength = array.length;\r\n      const binary = super.valueToBinary(arrayLength);\r\n      if (arrayLength) {\r\n        const valueType = findValueTypeFromValues(array);\r\n        binary.push(valueType.binaryType);\r\n        binary.type = valueType.name;\r\n        binary.push(array.map(value => valueType.valueToBinary(value, logStats)));\r\n      }\r\n      if (logStats) {\r\n        this.log(binary);\r\n      }\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts an array from the binary string, returning\r\n     * the array and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[Array, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let arrayLength;\r\n      [arrayLength, binary] = super.shiftValueFromBinary(binary);\r\n      const value = new Array(arrayLength);\r\n      if (arrayLength) {\r\n        let valueType;\r\n        [valueType, binary] = shiftValueTypeFromBinary(binary);\r\n        for (let i = 0, l = arrayLength; i < l; i++) {\r\n          [value[i], binary] = valueType.shiftValueFromBinary(binary);\r\n        }\r\n      }\r\n      return [value, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts a variable length signed integer to and from a binary string\r\n   */\r\n  class VariableSignedIntegerType extends VariableIntegerType {\r\n\r\n    /**\r\n     * Converts a signed positive or negative integer to a binary string array\r\n     * @param {number} integer\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[string]}\r\n     */\r\n    valueToBinary(integer, logStats = null) {\r\n      integer = integer.toFixed(0);\r\n      const isNegative = (integer < 0);\r\n      const signBinary = isNegative ? '1' : '0';\r\n      const integerBinary = this.integer.valueToBinary(Math.abs(integer), logStats);\r\n      const binary = [signBinary, integerBinary];\r\n      if (logStats) {\r\n        this.log(binary);\r\n      }\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts the first signed integer value from the binary string, returning\r\n     * the integer value and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[number, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let isNegative;\r\n      [isNegative, binary] = shiftUnsignedIntegerFromBinary(binary, 1);\r\n      let integer;\r\n      [integer, binary] = this.integer.shiftValueFromBinary(binary);\r\n      if (isNegative) {\r\n        integer = -integer;\r\n      }\r\n      return [integer, binary];\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts a variable length 2 precision decimal to and from a binary string\r\n   */\r\n  class VariableDecimalType extends VariableIntegerType {\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {string} options.name Name identifying the type\r\n     * @param {string} options.binaryType Binary string identifying the type\r\n     * @param {number} options.minValue Minimum value for the integer\r\n     * @param {number} options.maxValue Maximum value for the integer\r\n     * @param {[number]} options.integerBitSizes Expressible integer storage bit sizes\r\n     * @param {[number]} options.decimalBitSizes Expressible decimal storage bit sizes\r\n     */\r\n    constructor(options) {\r\n      super(options);\r\n      this.isFloat = true;\r\n      this.decimal = new LengthAndValueBinary(this, 'decimal', options.decimalBitSizes);\r\n    }\r\n\r\n    /**\r\n     * Converts a signed 2 precision decimal to an array of binary strings\r\n     * @param {number} float\r\n     * @param {boolean} [logStats] Log the type usage for output to the console\r\n     * @returns {[string]}\r\n     */\r\n    valueToBinary(float, logStats = null) {\r\n      float = float.toFixed(2);\r\n      const isNegative = (float < 0);\r\n      float = Math.abs(float);\r\n      const parts = String(float).split('.');\r\n      const higherInteger = parseInt(parts[0]);\r\n      const lowerInteger = parseInt(zeroPadRightToLength(parts[1] || 0, 2));\r\n      const signBinary = isNegative ? '1' : '0';\r\n      const integerValueBinary = this.integer.valueToBinary(higherInteger, logStats);\r\n      const decimalValueBinary = this.decimal.valueToBinary(lowerInteger, logStats);\r\n      const binary = [signBinary, integerValueBinary, decimalValueBinary];\r\n      if (logStats) {\r\n        this.log(binary);\r\n      }\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Shifts the first signed 2 precision decimal value from the binary string,\r\n     * returning the decimal value and the next part of the binary string\r\n     * @param {string} binary\r\n     * @returns {[number, string]}\r\n     */\r\n    shiftValueFromBinary(binary) {\r\n      let isNegative;\r\n      [isNegative, binary] = shiftUnsignedIntegerFromBinary(binary, 1);\r\n      let higherInteger;\r\n      [higherInteger, binary] = this.integer.shiftValueFromBinary(binary);\r\n      let lowerInteger;\r\n      [lowerInteger, binary] = this.decimal.shiftValueFromBinary(binary);\r\n      lowerInteger = zeroPadLeftToLength(String(lowerInteger), 2);\r\n      let float = parseFloat(higherInteger + '.' + lowerInteger);\r\n      if (isNegative) {\r\n        float = -float;\r\n      }\r\n      return [float, binary];\r\n    }\r\n\r\n  }\r\n\r\n  const arrayType = new VariableArrayType({\r\n    name: 'array',\r\n    binaryType: '10',\r\n    integerBitSizes: [4, 16]\r\n  });\r\n\r\n  const booleanType = new FixedBooleanType({\r\n    name: 'boolean',\r\n    binaryType: '0'\r\n  });\r\n\r\n  /**\r\n   * @type {[FixedIntegerType|VariableIntegerType]}\r\n   */\r\n  const integerTypes = [\r\n    new FixedIntegerType({\r\n      name: 'uint3',\r\n      binaryType: '1110',\r\n      valueBinaryLength: 3\r\n    }),\r\n    new VariableIntegerType({\r\n      name: 'vint8+',\r\n      binaryType: '110',\r\n      minValue: 0,\r\n      maxValue: 255,\r\n      integerBitSizes: [2, 8]\r\n    }),\r\n    new VariableIntegerType({\r\n      name: 'vint8-',\r\n      binaryType: '111100',\r\n      minValue: -255,\r\n      maxValue: 0,\r\n      integerBitSizes: [2, 8]\r\n    }),\r\n    new VariableSignedIntegerType({\r\n      name: 'sint32',\r\n      binaryType: '111110',\r\n      minValue: -4294967295,\r\n      maxValue: 4294967295,\r\n      integerBitSizes: [2, 4, 16, 32]\r\n    })\r\n  ];\r\n\r\n  /**\r\n   * @type {[VariableDecimalType]}\r\n   */\r\n  const decimalTypes = [\r\n    new VariableDecimalType({\r\n      name: 'sdec15',\r\n      binaryType: '111101',\r\n      minValue: -255.99,\r\n      maxValue: 255.99,\r\n      integerBitSizes: [2, 8],\r\n      decimalBitSizes: [0, 7]\r\n    }),\r\n    new VariableDecimalType({\r\n      name: 'sdec39',\r\n      binaryType: '111111',\r\n      minValue: -4294967295.99,\r\n      maxValue: 4294967295.99,\r\n      integerBitSizes: [2, 4, 16, 32],\r\n      decimalBitSizes: [0, 7]\r\n    })\r\n  ];\r\n\r\n  // Store and index all of the value types for searching by binaryType and name\r\n  const ValueTypes = [booleanType, arrayType].concat(integerTypes).concat(decimalTypes);\r\n  ValueTypes.nameIndex = {};\r\n  ValueTypes.forEach(valueType => (ValueTypes.nameIndex[valueType.name] = valueType));\r\n\r\n  /**\r\n   * Extends the native typeof keyword with array and null\r\n   * @param {*} value\r\n   * @returns {string} \"undefined\"|\"null\"|\"boolean\"|\"number\"|\"array\"|\"object\"\r\n   */\r\n  function esTypeOf(value) {\r\n    if (Array.isArray(value)) {\r\n      return 'array';\r\n    }\r\n    if (value === null) {\r\n      return 'null';\r\n    }\r\n    return typeof value;\r\n  }\r\n\r\n  /**\r\n   * Returns matching ValueType for the given name\r\n   * @param {string} name\r\n   * @returns {AbstractValueType}\r\n   */\r\n  function findValueTypeFromName(name) {\r\n    return ValueTypes.nameIndex[name.toLowerCase()];\r\n  }\r\n\r\n  /**\r\n   * Returns matching ValueType for the given value\r\n   * @param {number|boolean|Array} value\r\n   * @returns {AbstractValueType}\r\n   */\r\n  function findValueTypeFromValue(value) {\r\n    const esType = esTypeOf(value);\r\n    switch (esType) {\r\n      case 'array':\r\n        return arrayType;\r\n      case 'boolean':\r\n        return booleanType;\r\n    }\r\n    value = value.toFixed(2);\r\n    const isFloat = !Number.isInteger(value);\r\n    const isValueInValueTypeRange = valueType => (value >= valueType.minValue && value <= valueType.maxValue);\r\n    const valueType = isFloat ?\r\n      decimalTypes.find(isValueInValueTypeRange) :\r\n      integerTypes.find(isValueInValueTypeRange);\r\n    if (!valueType) {\r\n      throw new Error(`Cannot find type from value: ${value}`);\r\n    }\r\n    return valueType;\r\n  }\r\n\r\n  /**\r\n   * Returns a common ValueType for an array of values\r\n   * @param {Array} values\r\n   * @returns {AbstractValueType}\r\n   */\r\n  function findValueTypeFromValues(values) {\r\n    if (!values.length) {\r\n      return;\r\n    }\r\n    let minValue = 0;\r\n    let maxValue = 0;\r\n    let isFloat = false;\r\n    const esTypes = values.map(value => {\r\n      const valueType = findValueTypeFromValue(value, isFloat);\r\n      if (valueType.esType === 'number') {\r\n        minValue = _.min([value, minValue]);\r\n        maxValue = _.max([value, maxValue]);\r\n        isFloat = isFloat || !Number.isInteger(value);\r\n      }\r\n      return valueType.esType;\r\n    });\r\n    const uniqESTypes = _.uniq(esTypes);\r\n    if (uniqESTypes.length > 1) {\r\n      throw new Error(`Cannot resolve array to one type: ${uniqESTypes.join()}`);\r\n    }\r\n    const esType = uniqESTypes[0];\r\n    switch (esType) {\r\n      case 'array':\r\n        return arrayType;\r\n      case 'boolean':\r\n        return booleanType;\r\n    }\r\n    const isRangeInValueTypeRange = valueType => (minValue >= valueType.minValue && maxValue <= valueType.maxValue);\r\n    const valueType = isFloat ?\r\n      decimalTypes.find(isRangeInValueTypeRange) :\r\n      integerTypes.find(isRangeInValueTypeRange);\r\n    if (!valueType) {\r\n      throw new Error(`Cannot find type from value. min: ${minValue} max: ${maxValue} isfloat: ${isFloat}`);\r\n    }\r\n    return valueType;\r\n  }\r\n\r\n  /**\r\n   * Shifts the first value type representation from the binary string, returning\r\n   * the the ValueType found and next part of the binary string\r\n   * @param {string} binary\r\n   * @returns {[AbstractValueType, string]}\r\n   */\r\n  function shiftValueTypeFromBinary(binary) {\r\n    const valueType = ValueTypes.find(valueType => {\r\n      const binaryType = binary.slice(0, valueType.binaryTypeLength);\r\n      return (binaryType === valueType.binaryType);\r\n    });\r\n    if (!valueType) {\r\n      throw new Error(`Cannot find type from binary: ${binary.slice(0, 6)}...`);\r\n    }\r\n    binary = binary.slice(valueType.binaryTypeLength);\r\n    return [valueType, binary];\r\n  }\r\n\r\n  /**\r\n   * Sanitize the input throwing errors on any incorrect variable types whilst\r\n   * cloning the input arrays\r\n   * @param {number|boolean|Array} value\r\n   * @returns {number|boolean|Array}\r\n   */\r\n  function convertValuesToNumbers(value) {\r\n    const esType = esTypeOf(value);\r\n    switch (esType) {\r\n      case 'array':\r\n        return value.map(convertValuesToNumbers);\r\n      case 'undefined':\r\n      case 'null':\r\n        return (value ? 1 : 0);\r\n      case 'boolean':\r\n      case 'number':\r\n        return value;\r\n    }\r\n    throw new Error(`Cannot convert ${esType} to number`);\r\n  }\r\n\r\n  /**\r\n   * Main API\r\n   */\r\n  class Converter {\r\n\r\n    /**\r\n     * Checks the given value for conversion errors and returns the error\r\n     * @param {string|number|Array} value\r\n     * @returns {undefined|Error}\r\n     */\r\n    getInvalidTypeError(value) {\r\n      try {\r\n        value = convertValuesToNumbers(value);\r\n        (esTypeOf(value) === 'array') ?\r\n          findValueTypeFromValues(value) :\r\n          findValueTypeFromValue(value);\r\n        return;\r\n      } catch (err) {\r\n        return err;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Convert an array, boolean or number into a string binary representation\r\n     * @param {number|boolean|Array} value\r\n     * @param {string} [typeName] To force an internal data type for testing\r\n     * @param {boolean} [logStats] Console logs statistics on type use\r\n     * @returns {string}\r\n     */\r\n    valueToBinary(value, typeName = null, logStats = null) {\r\n      this.clearLog();\r\n      const hasInitialType = (typeof typeName === 'string');\r\n      value = convertValuesToNumbers(value);\r\n      const valueType = hasInitialType ?\r\n        findValueTypeFromName(typeName) :\r\n        findValueTypeFromValue(value);\r\n      if (!valueType) {\r\n        throw new Error(`Could not find value type from ${hasInitialType ? `name ${typeName}` : `value ${value}`} accepts: ${Object.keys(ValueTypes.nameIndex)}. Leave typeName empty for auto-detect.`);\r\n      }\r\n      const binary = valueType.valueToBinary(value, logStats);\r\n      if (!hasInitialType) {\r\n        binary.unshift(valueType.binaryType);\r\n      }\r\n      if (logStats) {\r\n        this.printLog();\r\n      }\r\n      return binary;\r\n    }\r\n\r\n    /**\r\n     * Convert the string binary representation back into an array, boolean or number\r\n     * @param {string} binary A string binary representation of data from valueToBinary\r\n     * @param {string} [typeName] To force an internal data type for testing\r\n     * @returns {number|boolean|Array}\r\n     */\r\n    valueFromBinary(binary, typeName = null) {\r\n      binary = _.flatten(binary).join('');\r\n      const hasInitialType = typeof typeName === 'string';\r\n      let valueType;\r\n      if (hasInitialType) {\r\n        valueType = findValueTypeFromName(typeName);\r\n      } else {\r\n        [valueType, binary] = shiftValueTypeFromBinary(binary);\r\n      }\r\n      if (!valueType || !(valueType instanceof AbstractValueType)) {\r\n        throw new Error(`Could not find value type from ${hasInitialType ? `name \"${typeName}\"` : `binary \"${binary.slice(0, 8)}\"...`} accepts: ${Object.keys(ValueTypes.nameIndex)}. Leave typeName empty for auto-detect.`);\r\n      }\r\n      const [value] = valueType.shiftValueFromBinary(binary);\r\n      return value;\r\n    }\r\n\r\n    /**\r\n     * Clears any previous logs\r\n     */\r\n    clearLog() {\r\n      logs.usedTypes = {};\r\n      logs.typeLengths = {};\r\n      logs.binarySamples = {};\r\n    }\r\n\r\n    /**\r\n     * Prints logs from last run\r\n     */\r\n    printLog() {\r\n      console.log('Types used count:', logs.usedTypes);\r\n      console.log('Type lengths used count:', logs.typeLengths);\r\n      console.log('Type binary samples:', logs.binarySamples);\r\n    }\r\n\r\n    /**\r\n     * Convert an array, boolean or number into a base64 string\r\n     * @param {number|boolean|Array} value\r\n     * @param {string} [typeName] To force an internal data type for testing\r\n     * @param {boolean} [logStats] Console logs statistics on type use\r\n     * @returns {string}\r\n     */\r\n    serialize(value, typeName = null, logStats = null) {\r\n      const binary = this.valueToBinary(value, typeName, logStats);\r\n      const base64 = binaryToBase64(binary);\r\n      return base64;\r\n    }\r\n\r\n    /**\r\n     * Convert the base64 string back into an array, boolean or number\r\n     * @param {string} base64 A string representation of data from serialize\r\n     * @param {string} [typeName] To force an internal data type for testing\r\n     * @returns {number|boolean|Array}\r\n     */\r\n    deserialize(base64, typeName = null) {\r\n      const binary = base64ToBinary(base64);\r\n      const value = this.valueFromBinary(binary, typeName);\r\n      return value;\r\n    }\r\n\r\n  }\r\n\r\n  return (window.SCORMSuspendData = new Converter());\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './SCORMSuspendData'\r\n], function (Adapt, SCORMSuspendData) {\r\n\r\n  class ComponentSerializer extends Backbone.Controller {\r\n\r\n    initialize(trackingIdType) {\r\n      this.trackingIdType = trackingIdType;\r\n    }\r\n\r\n    serialize() {\r\n      const states = [];\r\n      Adapt.data.each(model => {\r\n        if (model.get('_type') !== this.trackingIdType) {\r\n          return;\r\n        }\r\n        const trackingId = model.get('_trackingId');\r\n        if (typeof trackingId === 'undefined') {\r\n          return;\r\n        }\r\n        const isContainer = model.hasManagedChildren;\r\n        const components = isContainer ?\r\n          model.findDescendantModels('component') :\r\n          [model];\r\n        components.forEach((component, index) => {\r\n          let modelState = null;\r\n          if (!component.getAttemptState) {\r\n            // Legacy components without getAttemptState\r\n            modelState = component.get('_isQuestionType') ?\r\n              [\r\n                [\r\n                  component.get('_score') || 0,\r\n                  component.get('_attemptsLeft') || 0\r\n                ],\r\n                [\r\n                  component.get('_isComplete') || false,\r\n                  component.get('_isInteractionComplete') || false,\r\n                  component.get('_isSubmitted') || false,\r\n                  component.get('_isCorrect') || false\r\n                ],\r\n                [\r\n                  component.get('_userAnswer')\r\n                ]\r\n              ] :\r\n              [\r\n                [],\r\n                [\r\n                  component.get('_isComplete') || false,\r\n                  component.get('_isInteractionComplete') || false\r\n                ],\r\n                [\r\n                  component.get('_userAnswer')\r\n                ]\r\n              ];\r\n          } else {\r\n            modelState = component.getAttemptState();\r\n          }\r\n          // correct the useranswer array as it is sometimes not an array\r\n          // incomplete components are undefined and slider is a number\r\n          const userAnswer = modelState[2][0];\r\n          const hasUserAnswer = typeof userAnswer !== 'undefined' && userAnswer !== null;\r\n          const isUserAnswerArray = Array.isArray(userAnswer);\r\n          if (!hasUserAnswer) {\r\n            modelState[2][0] = [];\r\n          } else if (!isUserAnswerArray) {\r\n            modelState[2][0] = [modelState[2][0]];\r\n          }\r\n          // attemptstates is empty if not a question or not attempted\r\n          const attemptStates = modelState[2][0];\r\n          const hasAttemptStates = !Array.isArray(attemptStates);\r\n          if (!hasAttemptStates) {\r\n            modelState[2][1] = [];\r\n          }\r\n          // create the restoration state object\r\n          const state = [\r\n            [ trackingId, index ],\r\n            [ hasUserAnswer, isUserAnswerArray, hasAttemptStates ],\r\n            modelState\r\n          ];\r\n          states.push(state);\r\n        });\r\n      });\r\n      return SCORMSuspendData.serialize(states);\r\n    }\r\n\r\n    deserialize(binary) {\r\n      const trackingIdMap = Adapt.data.toArray().reduce((trackingIdMap, model) => {\r\n        const trackingId = model.get('_trackingId');\r\n        if (typeof trackingId === 'undefined') return trackingIdMap;\r\n        trackingIdMap[trackingId] = model;\r\n        return trackingIdMap;\r\n      }, {});\r\n      const states = SCORMSuspendData.deserialize(binary);\r\n      states.forEach(state => {\r\n        const [ trackingId, index ] = state[0];\r\n        const [ hasUserAnswer, isUserAnswerArray, hasAttemptStates ] = state[1];\r\n        const modelState = state[2];\r\n        // correct useranswer\r\n        if (!hasUserAnswer) {\r\n          modelState[2][0] = null;\r\n        } else if (!isUserAnswerArray) {\r\n          modelState[2][0] = modelState[2][0][0];\r\n        }\r\n        // allow empty attemptstates\r\n        if (!hasAttemptStates) {\r\n          modelState[2][1] = null;\r\n        }\r\n        const model = trackingIdMap[trackingId];\r\n        \r\n        // DD: Modified fallback.\r\n        if (!model) {\r\n          // Ignore any recently missing tracking ids if a course has been updated\r\n          return;\r\n        }\r\n\r\n        const isContainer = model.hasManagedChildren;\r\n        const components = isContainer ?\r\n          model.findDescendantModels('component') :\r\n          [model];\r\n        const component = components[index];\r\n\r\n        // DD: Modified fallback.\r\n        // FIXME: This error occurs when the adapt-activator is present; but the exact cause is unknown.\r\n        if (!component) {\r\n          Adapt.log.warn(`SPOOR could not restore tracking id: ${trackingId}, index: ${index}`);\r\n          return;\r\n        }\r\n\r\n        if (component.setAttemptObject) {\r\n          const attemptObject = component.getAttemptObject(modelState);\r\n          component.setAttemptObject(attemptObject, false);\r\n          return;\r\n        }\r\n        // Legacy components without getAttemptState\r\n        component.get('_isQuestionType') ?\r\n          component.set({\r\n            _score: modelState[0][0],\r\n            _attemptsLeft: modelState[0][1],\r\n            _isComplete: modelState[1][0],\r\n            _isInteractionComplete: modelState[1][1],\r\n            _isSubmitted: modelState[1][2],\r\n            _isCorrect: modelState[1][3],\r\n            _userAnswer: modelState[2][0]\r\n          }) :\r\n          component.set({\r\n            _isComplete: modelState[1][0],\r\n            _isInteractionComplete: modelState[1][1],\r\n            _userAnswer: modelState[2][0]\r\n          });\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  return ComponentSerializer;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './scorm/wrapper',\r\n  'core/js/enums/completionStateEnum',\r\n  './serializers/ComponentSerializer',\r\n  './serializers/SCORMSuspendData'\r\n], function(Adapt, ScormWrapper, COMPLETION_STATE, ComponentSerializer, SCORMSuspendData) {\r\n\r\n  class StatefulSession extends Backbone.Controller {\r\n\r\n    initialize() {\r\n      _.bindAll(this, 'beginSession', 'onVisibilityChange', 'endSession');\r\n      this.scorm = ScormWrapper.getInstance();\r\n      this._trackingIdType = 'block';\r\n      this._componentSerializer = null;\r\n      this._shouldStoreResponses = true;\r\n      this._shouldRecordInteractions = true;\r\n      this.beginSession();\r\n    }\r\n\r\n    beginSession() {\r\n      this.listenTo(Adapt, 'app:dataReady', this.restoreSession);\r\n      this._trackingIdType = Adapt.build.get('trackingIdType') || 'block';\r\n      this._componentSerializer = new ComponentSerializer(this._trackingIdType);\r\n      // suppress SCORM errors if 'nolmserrors' is found in the querystring\r\n      if (window.location.search.indexOf('nolmserrors') !== -1) {\r\n        this.scorm.suppressErrors = true;\r\n      }\r\n      const config = Adapt.spoor.config;\r\n      if (!config) return;\r\n      const tracking = config._tracking;\r\n      this._shouldStoreResponses = (tracking && tracking._shouldStoreResponses);\r\n      // Default should be to record interactions, so only avoid doing that if\r\n      // _shouldRecordInteractions is set to false\r\n      if (tracking && tracking._shouldRecordInteractions === false) {\r\n        this._shouldRecordInteractions = false;\r\n      }\r\n      const settings = config._advancedSettings;\r\n      if (!settings) {\r\n        // force use of SCORM 1.2 by default - some LMSes (SABA/Kallidus for instance)\r\n        // present both APIs to the SCO and, if given the choice, the pipwerks\r\n        // code will automatically select the SCORM 2004 API - which can lead to\r\n        // unexpected behaviour.\r\n        this.scorm.setVersion('1.2');\r\n        this.scorm.initialize();\r\n        return;\r\n      }\r\n      if (settings._showDebugWindow) {\r\n        this.scorm.showDebugWindow();\r\n      }\r\n      this.scorm.setVersion(settings._scormVersion || '1.2');\r\n      if (settings._suppressErrors) {\r\n        this.scorm.suppressErrors = settings._suppressErrors;\r\n      }\r\n      if (settings._commitOnStatusChange) {\r\n        this.scorm.commitOnStatusChange = settings._commitOnStatusChange;\r\n      }\r\n      if (settings._commitOnAnyChange) {\r\n        this.scorm.commitOnAnyChange = settings._commitOnAnyChange;\r\n      }\r\n      if (_.isFinite(settings._timedCommitFrequency)) {\r\n        this.scorm.timedCommitFrequency = settings._timedCommitFrequency;\r\n      }\r\n      if (_.isFinite(settings._maxCommitRetries)) {\r\n        this.scorm.maxCommitRetries = settings._maxCommitRetries;\r\n      }\r\n      if (_.isFinite(settings._commitRetryDelay)) {\r\n        this.scorm.commitRetryDelay = settings._commitRetryDelay;\r\n      }\r\n      if ('_exitStateIfIncomplete' in settings) {\r\n        this.scorm.exitStateIfIncomplete = settings._exitStateIfIncomplete;\r\n      }\r\n      if ('_exitStateIfComplete' in settings) {\r\n        this.scorm.exitStateIfComplete = settings._exitStateIfComplete;\r\n      }\r\n      this.scorm.initialize();\r\n    }\r\n\r\n    restoreSession() {\r\n      this.setupLearnerInfo();\r\n      this.restoreSessionState();\r\n      // defer call because AdaptModel.check*Status functions are asynchronous\r\n      _.defer(this.setupEventListeners.bind(this));\r\n    }\r\n\r\n    setupLearnerInfo() {\r\n      // Replace the hard-coded _learnerInfo data in _globals with the actual data\r\n      // from the LMS\r\n      // If the course has been published from the AT, the _learnerInfo object\r\n      // won't exist so we'll need to create it\r\n      const globals = Adapt.course.get('_globals');\r\n      if (!globals._learnerInfo) {\r\n        globals._learnerInfo = {};\r\n      }\r\n      Object.assign(globals._learnerInfo, Adapt.offlineStorage.get('learnerinfo'));\r\n    }\r\n\r\n    restoreSessionState() {\r\n      const sessionPairs = Adapt.offlineStorage.get();\r\n      const hasNoPairs = !Object.keys(sessionPairs).length;\r\n      if (hasNoPairs) return;\r\n      if (sessionPairs.c) {\r\n        const [ _isComplete, _isAssessmentPassed ] = SCORMSuspendData.deserialize(sessionPairs.c);\r\n        Adapt.course.set({\r\n          _isComplete,\r\n          _isAssessmentPassed\r\n        });\r\n      }\r\n      if (sessionPairs.q && this._shouldStoreResponses) {\r\n        this._componentSerializer.deserialize(sessionPairs.q);\r\n      }\r\n    }\r\n\r\n    setupEventListeners() {\r\n      const debouncedSaveSession = _.debounce(this.saveSessionState.bind(this), 1);\r\n      this.listenTo(Adapt.data, 'change:_isComplete', debouncedSaveSession);\r\n      if (this._shouldStoreResponses) {\r\n        this.listenTo(Adapt.data, 'change:_isSubmitted change:_userAnswer', debouncedSaveSession);\r\n      }\r\n      this.listenTo(Adapt, {\r\n        'app:languageChanged': this.onLanguageChanged,\r\n        'questionView:recordInteraction': this.onQuestionRecordInteraction,\r\n        'assessment:complete': this.onAssessmentComplete,\r\n        'tracking:complete': this.onTrackingComplete\r\n      });\r\n      const config = Adapt.spoor.config;\r\n      const advancedSettings = config._advancedSettings;\r\n      const shouldCommitOnVisibilityChange = (!advancedSettings ||\r\n          advancedSettings._commitOnVisibilityChangeHidden !== false);\r\n      if (shouldCommitOnVisibilityChange) {\r\n        document.addEventListener('visibilitychange', this.onVisibilityChange);\r\n      }\r\n      $(window).on('beforeunload unload', this.endSession);\r\n    }\r\n\r\n    saveSessionState() {\r\n      const courseState = SCORMSuspendData.serialize([\r\n        Boolean(Adapt.course.get('_isComplete')),\r\n        Boolean(Adapt.course.get('_isAssessmentPassed'))\r\n      ]);\r\n      const componentStates = (this._shouldStoreResponses === true) ?\r\n        this._componentSerializer.serialize() :\r\n        '';\r\n      const sessionPairs = {\r\n        'c': courseState,\r\n        'q': componentStates\r\n      };\r\n      this.printCompletionInformation();\r\n      Adapt.offlineStorage.set(sessionPairs);\r\n    }\r\n\r\n    printCompletionInformation() {\r\n      const courseComplete = Boolean(Adapt.course.get('_isComplete'));\r\n      const assessmentPassed = Boolean(Adapt.course.get('_isAssessmentPassed'));\r\n      const trackingIdModels = Adapt.data.filter(model => model.get('_type') === this._trackingIdType && model.has('_trackingId'));\r\n      const trackingIds = trackingIdModels.map(model => model.get('_trackingId'));\r\n      if (!trackingIds.length) {\r\n        Adapt.log.info(`course._isComplete: ${courseComplete}, course._isAssessmentPassed: ${assessmentPassed}, ${this._trackingIdType} completion: no tracking ids found`);\r\n        return;\r\n      }\r\n      const max = Math.max(...trackingIds);\r\n      const completion = trackingIdModels.reduce((completion, model) => {\r\n        const trackingId = model.get('_trackingId');\r\n        completion[trackingId] = model.get('_isComplete') ? '1' : '0';\r\n        return completion;\r\n      }, (new Array(max + 1)).join('-').split('')).join('');\r\n      Adapt.log.info(`course._isComplete: ${courseComplete}, course._isAssessmentPassed: ${assessmentPassed}, ${this._trackingIdType} completion: ${completion}`);\r\n    }\r\n\r\n    onLanguageChanged() {\r\n      // when the user switches language, we need to:\r\n      // - reattach the event listeners as the language change triggers a reload of\r\n      //   the json, which will create brand new collections\r\n      // - get and save a fresh copy of the session state. as the json has been reloaded,\r\n      //   the blocks completion data will be reset (the user is warned that this will\r\n      //   happen by the language picker extension)\r\n      // - check to see if the config requires that the lesson_status be reset to\r\n      //   'incomplete'\r\n      const config = Adapt.spoor.config;\r\n      this.removeEventListeners();\r\n      this.setupEventListeners();\r\n      this.saveSessionState();\r\n      if (config && config._reporting && config._reporting._resetStatusOnLanguageChange === true) {\r\n        Adapt.offlineStorage.set('status', 'incomplete');\r\n      }\r\n    }\r\n\r\n    onVisibilityChange() {\r\n      if (document.visibilityState === 'hidden') this.scorm.commit();\r\n    }\r\n\r\n    onQuestionRecordInteraction(questionView) {\r\n      if (!this._shouldRecordInteractions) return;\r\n      const responseType = questionView.getResponseType();\r\n      // If responseType doesn't contain any data, assume that the question\r\n      // component hasn't been set up for cmi.interaction tracking\r\n      if (_.isEmpty(responseType)) return;\r\n      const id = questionView.model.get('_id');\r\n      const response = questionView.getResponse();\r\n      const result = questionView.isCorrect();\r\n      const latency = questionView.getLatency();\r\n      Adapt.offlineStorage.set('interaction', id, response, result, latency, responseType);\r\n    }\r\n\r\n    onAssessmentComplete(stateModel) {\r\n      const config = Adapt.spoor.config;\r\n      Adapt.course.set('_isAssessmentPassed', stateModel.isPass);\r\n      this.saveSessionState();\r\n      const shouldSubmitScore = (config && config._tracking && config._tracking._shouldSubmitScore);\r\n      if (!shouldSubmitScore) return;\r\n      const scoreArgs = stateModel.isPercentageBased ?\r\n        [ stateModel.scoreAsPercent, 0, 100 ] :\r\n        [ stateModel.score, 0, stateModel.maxScore ];\r\n      Adapt.offlineStorage.set('score', ...scoreArgs);\r\n    }\r\n\r\n    onTrackingComplete(completionData) {\r\n      const config = Adapt.spoor.config;\r\n      this.saveSessionState();\r\n      let completionStatus = completionData.status.asLowerCase;\r\n      // The config allows the user to override the completion state.\r\n      switch (completionData.status) {\r\n        case COMPLETION_STATE.COMPLETED:\r\n        case COMPLETION_STATE.PASSED: {\r\n          if (!config || !config._reporting || !config._reporting._onTrackingCriteriaMet) {\r\n            Adapt.log.warn(`No value defined for '_onTrackingCriteriaMet', so defaulting to '${completionStatus}'`);\r\n          } else {\r\n            completionStatus = config._reporting._onTrackingCriteriaMet;\r\n          }\r\n\r\n          break;\r\n        }\r\n        case COMPLETION_STATE.FAILED: {\r\n          if (!config || !config._reporting || !config._reporting._onAssessmentFailure) {\r\n            Adapt.log.warn(`No value defined for '_onAssessmentFailure', so defaulting to '${completionStatus}'`);\r\n          } else {\r\n            completionStatus = config._reporting._onAssessmentFailure;\r\n          }\r\n        }\r\n      }\r\n      Adapt.offlineStorage.set('status', completionStatus);\r\n    }\r\n\r\n    endSession() {\r\n      if (!this.scorm.finishCalled) {\r\n        this.scorm.finish();\r\n      }\r\n      this.removeEventListeners();\r\n    }\r\n\r\n    removeEventListeners() {\r\n      $(window).off('beforeunload unload', this.endSession);\r\n      document.removeEventListener('visibilitychange', this.onVisibilityChange);\r\n      this.stopListening();\r\n    }\r\n\r\n  }\r\n\r\n  return StatefulSession;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './scorm/wrapper',\r\n  './serializers/SCORMSuspendData',\r\n  'core/js/offlineStorage'\r\n], function(Adapt, ScormWrapper, SCORMSuspendData) {\r\n\r\n  /**\r\n   * SCORM handler for Adapt.offlineStorage interface.\r\n   */\r\n  class OfflineStorage extends Backbone.Controller {\r\n\r\n    initialize(statefulSession) {\r\n      this.scorm = ScormWrapper.getInstance();\r\n      this.statefulSession = statefulSession;\r\n      this.temporaryStore = {};\r\n      this.suspendDataStore = {};\r\n      this.suspendDataRestored = false;\r\n      Adapt.offlineStorage.initialize(this);\r\n    }\r\n\r\n    save() {\r\n      this.statefulSession.saveSessionState();\r\n    }\r\n\r\n    serialize(...args) {\r\n      return SCORMSuspendData.serialize(...args);\r\n    }\r\n\r\n    deserialize(...args) {\r\n      return SCORMSuspendData.deserialize(...args);\r\n    }\r\n\r\n    get(name) {\r\n      if (name === undefined) {\r\n        // If not connected return just temporary store.\r\n        if (this.useTemporaryStore()) return this.temporaryStore;\r\n\r\n        // Get all values as a combined object\r\n        this.suspendDataStore = this.getCustomStates();\r\n\r\n        const data = Object.assign(_.clone(this.suspendDataStore), {\r\n          location: this.scorm.getLessonLocation(),\r\n          score: this.scorm.getScore(),\r\n          status: this.scorm.getStatus(),\r\n          student: this.scorm.getStudentName(),\r\n          learnerInfo: this.getLearnerInfo()\r\n        });\r\n\r\n        this.suspendDataRestored = true;\r\n\r\n        return data;\r\n      }\r\n\r\n      // If not connected return just temporary store value.\r\n      if (this.useTemporaryStore()) return this.temporaryStore[name];\r\n\r\n      // Get by name\r\n      let courseState;\r\n      switch (name.toLowerCase()) {\r\n        case 'location':\r\n          return this.scorm.getLessonLocation();\r\n        case 'score':\r\n          return this.scorm.getScore();\r\n        case 'status':\r\n          return this.scorm.getStatus();\r\n        case 'student':\r\n          // for backwards-compatibility. learnerInfo is preferred now and will\r\n          // give you more information\r\n          return this.scorm.getStudentName();\r\n        case 'learnerinfo':\r\n          return this.getLearnerInfo();\r\n        case 'coursestate':\r\n          courseState = this.getCustomState('c');\r\n          const stateArray = (courseState && SCORMSuspendData.deserialize(courseState)) || [];\r\n          return {\r\n            _isCourseComplete: Boolean(stateArray.slice(0, 1).map(Number)[0]),\r\n            _isAssessmentPassed: Boolean(stateArray.slice(1, 2).map(Number)[0]),\r\n            completion: stateArray.slice(2).map(Number).map(String).join('') || ''\r\n          };\r\n        case 'completion':\r\n          courseState = this.getCustomState('c');\r\n          return (courseState && SCORMSuspendData\r\n            .deserialize(courseState)\r\n            .slice(2)\r\n            .map(Number)\r\n            .map(String)\r\n            .join('')) || '';\r\n        case '_iscoursecomplete':\r\n          courseState = this.getCustomState('c');\r\n          return Boolean(courseState && SCORMSuspendData\r\n            .deserialize(courseState)\r\n            .slice(0, 1)\r\n            .map(Number)[0]);\r\n        case '_isassessmentpassed':\r\n          courseState = this.getCustomState('c');\r\n          return Boolean(courseState && SCORMSuspendData\r\n            .deserialize(courseState)\r\n            .slice(1, 2)\r\n            .map(Number)[0]);\r\n        case 'questions':\r\n          const questionsState = this.getCustomState('q');\r\n          return questionsState || '';\r\n        default:\r\n          return this.getCustomState(name);\r\n      }\r\n    }\r\n\r\n    set(name, value) {\r\n      // Convert arguments to array and drop the 'name' parameter\r\n      const args = [...arguments].slice(1);\r\n      const isObject = typeof name === 'object';\r\n\r\n      if (isObject) {\r\n        value = name;\r\n        name = 'suspendData';\r\n      }\r\n\r\n      if (this.useTemporaryStore()) {\r\n        if (isObject) {\r\n          Object.assign(this.temporaryStore, value);\r\n        } else {\r\n          this.temporaryStore[name] = value;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      switch (name.toLowerCase()) {\r\n        case 'interaction':\r\n          return this.scorm.recordInteraction(...args);\r\n        case 'location':\r\n          return this.scorm.setLessonLocation(...args);\r\n        case 'score':\r\n          return this.scorm.setScore(...args);\r\n        case 'status':\r\n          return this.scorm.setStatus(...args);\r\n        case 'student':\r\n        case 'learnerinfo':\r\n          return false;// these properties are read-only\r\n        case 'lang':\r\n          this.scorm.setLanguage(value);\r\n          // fall-through so that lang gets stored in suspend_data as well:\r\n          // because in SCORM 1.2 cmi.student_preference.language is an optional\r\n          // data element so we can't rely on the LMS having support for it.\r\n          // If it does support it we may as well save the user's choice there\r\n          // purely for reporting purposes\r\n          break;\r\n        case 'suspenddata':\r\n          break;\r\n      }\r\n\r\n      if (isObject) {\r\n        Object.assign(this.suspendDataStore, value);\r\n      } else {\r\n        this.suspendDataStore[name] = value;\r\n      }\r\n\r\n      const dataAsString = JSON.stringify(this.suspendDataStore);\r\n      return (this.suspendDataRestored) ? this.scorm.setSuspendData(dataAsString) : false;\r\n    }\r\n\r\n    getCustomStates() {\r\n      const isSuspendDataStoreEmpty = _.isEmpty(this.suspendDataStore);\r\n      if (!isSuspendDataStoreEmpty && this.suspendDataRestored) {\r\n        return _.clone(this.suspendDataStore);\r\n      }\r\n\r\n      const dataAsString = this.scorm.getSuspendData();\r\n      if (dataAsString === '' || dataAsString === ' ' || dataAsString === undefined) {\r\n        return {};\r\n      }\r\n\r\n      let dataAsJSON = JSON.parse(dataAsString);\r\n      if (!isSuspendDataStoreEmpty && !this.suspendDataRestored) {\r\n        Object.assign(dataAsJSON, this.suspendDataStore);\r\n      }\r\n      return dataAsJSON;\r\n    }\r\n\r\n    getCustomState(name) {\r\n      const dataAsJSON = this.getCustomStates();\r\n      return dataAsJSON[name];\r\n    }\r\n\r\n    useTemporaryStore() {\r\n      const cfg = Adapt.config.get('_spoor');\r\n\r\n      if (!this.scorm.lmsConnected || (cfg && cfg._isEnabled === false)) return true;\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Returns an object with the properties:\r\n     * - id (cmi.core.student_id)\r\n     * - name (cmi.core.student_name - which is usually in the format\r\n     *    'Lastname, Firstname' or 'Firstname Lastname' - but it sometimes doesn't\r\n     *    have the space after the comma\r\n     *   )\r\n     * - firstname\r\n     * - lastname\r\n     */\r\n    getLearnerInfo() {\r\n      const id = this.scorm.getStudentId();\r\n\r\n      let name = this.scorm.getStudentName();\r\n      let firstname = '';\r\n      let lastname = '';\r\n\r\n      let hasName = (name && name !== 'undefined');\r\n      const isNameCommaSeparated = hasName && name.includes(',');\r\n      const isNameSpaceSeparated = hasName && name.includes(' ');\r\n\r\n      // Name must have either a comma or a space\r\n      hasName = hasName && (isNameCommaSeparated || isNameSpaceSeparated);\r\n\r\n      if (!hasName) {\r\n        console.log(`SPOOR: LMS learner_name not in 'lastname, firstname' or 'firstname lastname' format`);\r\n        return { id, name, firstname, lastname };\r\n      }\r\n\r\n      const separator = isNameCommaSeparated ? ',' : ' ';\r\n      const nameParts = name.split(separator);\r\n      if (isNameCommaSeparated) {\r\n        // Assume lastname appears before the comma\r\n        nameParts.reverse();\r\n      }\r\n      [ firstname, lastname ] = nameParts.map(part => part.trim());\r\n      name = `${firstname} ${lastname}`;\r\n      return { id, name, firstname, lastname };\r\n    }\r\n\r\n  }\r\n\r\n  return OfflineStorage;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './scorm/wrapper',\r\n  './adapt-stateful-session',\r\n  './adapt-offlineStorage-scorm'\r\n], function(Adapt, ScormWrapper, StatefulSession, OfflineStorage) {\r\n\r\n  class Spoor extends Backbone.Controller {\r\n\r\n    initialize() {\r\n      this.config = null;\r\n      this.scorm = ScormWrapper.getInstance();\r\n      this.listenToOnce(Adapt, 'offlineStorage:prepare', this._prepare);\r\n    }\r\n\r\n    _prepare() {\r\n      this.config = Adapt.config.get('_spoor');\r\n      if (!this.isEnabled) {\r\n        Adapt.offlineStorage.setReadyStatus();\r\n        return;\r\n      }\r\n      this.statefulSession = new StatefulSession();\r\n      this.offlineStorage = new OfflineStorage(this.statefulSession);\r\n      // force offlineStorage-scorm to initialise suspendDataStore - this allows\r\n      // us to do things like store the user's chosen language before the rest\r\n      // of the course data loads\r\n      Adapt.offlineStorage.get();\r\n      Adapt.offlineStorage.setReadyStatus();\r\n      // setup debug window keyboard shortcut\r\n      require(['libraries/jquery.keycombo'], function() {\r\n        // listen for user holding 'd', 'e', 'v' keys together\r\n        $.onKeyCombo([68, 69, 86], function() {\r\n          Adapt.spoor.scorm.showDebugWindow();\r\n        });\r\n      });\r\n    }\r\n\r\n    get isEnabled() {\r\n      return (this.config && this.config._isEnabled);\r\n    }\r\n\r\n  }\r\n\r\n  Adapt.spoor = new Spoor();\r\n\r\n  return Spoor;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleView = Backbone.View.extend({\r\n\r\n    isSteplocked: false,\r\n\r\n    completionAttribute : null,\r\n\r\n    initialize: function(options) {\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      var AdaptEvents = {\r\n        \"trickle:kill\": this.onKill,\r\n        \"remove\": this.onRemove\r\n      };\r\n\r\n      this.onPreRender(this);\r\n\r\n      AdaptEvents[this.model.get(\"_type\") + \"View:postRender\"] = this.onPostRender;\r\n      this.listenTo(Adapt, AdaptEvents);\r\n\r\n      this.on(\"steplock\", this.onStepLock);\r\n      this.on(\"stepunlock\", this.onStepUnlock);\r\n    },\r\n\r\n    onPreRender: function(view) {\r\n      this.completionAttribute = Adapt.trickle.getCompletionAttribute();\r\n      if (!this.isElementEnabled()) return;\r\n\r\n      Adapt.trigger(\"trickle:preRender\", this);\r\n    },\r\n\r\n    onPostRender: function(view) {\r\n      if (view.model.get(\"_id\") !== this.model.get(\"_id\")) return;\r\n      if (!this.isElementEnabled()) return;\r\n\r\n      Adapt.trigger(\"trickle:postRender\", this);\r\n    },\r\n\r\n    isElementEnabled: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      if (!trickle) return false;\r\n\r\n      if (this.model.get(this.completionAttribute)) return false;\r\n\r\n      var isArticleWithOnChildren = (this.model.get(\"_type\") === \"article\" && trickle._onChildren);\r\n      if (isArticleWithOnChildren) {\r\n        return false;\r\n      }\r\n\r\n      if (trickle._isEnabled === true) return true;\r\n      return false;\r\n    },\r\n\r\n    onStepLock: function() {\r\n      if (!this.isElementEnabled()) {\r\n        this.continueToNext();\r\n        return;\r\n      }\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      var isSteplocking = (trickle._stepLocking && trickle._stepLocking._isEnabled);\r\n      if (!isSteplocking) {\r\n        this.continueToNext();\r\n        return;\r\n      }\r\n\r\n      Adapt.trigger(\"trickle:steplock\", this);\r\n      this.isSteplocked = true;\r\n    },\r\n\r\n    continueToNext: function() {\r\n      Adapt.trigger(\"trickle:continue\", this);\r\n    },\r\n\r\n\r\n    onStepUnlock: function() {\r\n      if (!this.isSteplocked) return;\r\n      this.isSteplocked = false;\r\n      Adapt.trigger(\"trickle:stepunlock\", this);\r\n    },\r\n\r\n    onKill: function() {\r\n      this.detachFromElement();\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.detachFromElement();\r\n    },\r\n\r\n    detachFromElement: function() {\r\n      this.undelegateEvents();\r\n      this.stopListening();\r\n      this.model = null;\r\n      this.articleModel = null;\r\n      this.$el = null;\r\n      this.el = null;\r\n    }\r\n\r\n  });\r\n\r\n  return TrickleView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './trickleView'\r\n], function(Adapt, TrickleView) {\r\n\r\n  var PageView = Backbone.View.extend({\r\n\r\n    currentDescendantIndex: 0,\r\n    currentLocksOnDescendant: 0,\r\n    currentDescendant: null,\r\n\r\n    initialize: function(options) {\r\n      if (!this.isPageEnabled()) {\r\n        return this.detachFromPage();\r\n      }\r\n      this.setupDescendants();\r\n      if (!this.haveDescendantsGotTrickle()) {\r\n        return this.detachFromPage();\r\n      }\r\n      this.addClassToHtml();\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    isPageEnabled: function() {\r\n      var trickleConfig = Adapt.trickle.getModelConfig(this.model);\r\n      if (trickleConfig && trickleConfig._isEnabled === false) return false;\r\n      return true;\r\n    },\r\n\r\n    setupDescendants: function() {\r\n      this.currentDescendant = null;\r\n      this.descendantViews = {};\r\n      this.getDescendants();\r\n      Adapt.trigger(\"trickle:descendants\", this);\r\n    },\r\n\r\n    descendantsChildFirst: null,\r\n    descendantsParentFirst: null,\r\n    descendantViews: null,\r\n\r\n    getDescendants: function() {\r\n      this.descendantsChildFirst = this.model.getAllDescendantModels();\r\n      this.descendantsParentFirst = this.model.getAllDescendantModels(true);\r\n\r\n      // if some descendants flip between _isAvailable true/false they\r\n      // must have their defaults set before the filter is applied\r\n      this.setDescendantsTrickleDefaults();\r\n\r\n      this.descendantsChildFirst = this.filterComponents(this.descendantsChildFirst);\r\n      this.descendantsParentFirst = this.filterComponents(this.descendantsParentFirst);\r\n\r\n    },\r\n\r\n    filterComponents: function(descendants) {\r\n      return descendants.filter(function(descendant) {\r\n        if (descendant.get(\"_type\") === \"component\") return false;\r\n        if (!descendant.get(\"_isAvailable\")) return false;\r\n        return true;\r\n      });\r\n    },\r\n\r\n    setDescendantsTrickleDefaults: function() {\r\n      // use parent first as likely to get to article\r\n      this.descendantsParentFirst.forEach(function(descendant) {\r\n        var trickle = Adapt.trickle.getModelConfig(descendant);\r\n        if (!trickle) {\r\n          return;\r\n        }\r\n\r\n        // check if trickle is configures on descendant\r\n        // NOTE: Removed for banked assessments\r\n        // var isTrickleConfigured = descendant.get(\"_isTrickleConfigured\");\r\n        // if (isTrickleConfigured) return;\r\n\r\n        // setup steplocking defaults\r\n        trickle._stepLocking = _.extend({\r\n          \"_isEnabled\": true, //(default=true)\r\n          \"_isCompletionRequired\": true, //(default=true)\r\n          \"_isLockedOnRevisit\": false //(default=false)\r\n        }, trickle._stepLocking);\r\n\r\n        // setup main trickle defaults\r\n        trickle = _.extend({\r\n          \"_isEnabled\": true, //(default=true)\r\n          \"_autoScroll\": true, //(default=true)\r\n          \"_scrollDuration\": 500, //(default=500)\r\n          \"_onChildren\": true, //(default=true)\r\n          \"_scrollTo\": \"@block +1\" //(default=\"@block +1\")\r\n        }, trickle);\r\n\r\n        Adapt.trickle.setModelConfig(descendant, trickle);\r\n\r\n        //check article \"onChildren\" rule\r\n        if (trickle._onChildren &&\r\n          descendant.get(\"_type\") === \"article\") {\r\n          this.setupArticleOnChildren(descendant, trickle);\r\n        }\r\n\r\n        // set descendant trickle as configured\r\n        descendant.set(\"_isTrickleConfigured\", true);\r\n\r\n      }.bind(this));\r\n    },\r\n\r\n    setupArticleOnChildren: function(articleModel, articleTrickleConfig) {\r\n      // set trickle on all blocks, using article config with block overrides\r\n      var articleBlocks = articleModel.getChildren();\r\n\r\n      articleBlocks.each(function(blockModel, index) {\r\n        var blockTrickleConfig = Adapt.trickle.getModelConfig(blockModel);\r\n\r\n        // overlay block trickle on article trickle\r\n        // this allows values to carry through from the article to the block\r\n        // retains any value overriden in the block\r\n        for (var k in blockTrickleConfig) {\r\n          //handle nested objects to one level\r\n          if (typeof blockTrickleConfig[k] === \"object\") {\r\n            blockTrickleConfig[k] = _.extend({}, articleTrickleConfig[k], blockTrickleConfig[k]);\r\n          }\r\n        }\r\n\r\n        blockTrickleConfig = _.extend({}, articleTrickleConfig, blockTrickleConfig);\r\n\r\n\r\n        // setup start/final config\r\n        if (articleBlocks.length === index+1) {\r\n          blockTrickleConfig._isFinal = true;\r\n        }\r\n        if (index === 0) {\r\n          blockTrickleConfig._isStart = true;\r\n        }\r\n\r\n        Adapt.trickle.setModelConfig(blockModel, blockTrickleConfig);\r\n      });\r\n\r\n    },\r\n\r\n    haveDescendantsGotTrickle: function() {\r\n      return this.descendantsChildFirst.some(function(descendant) {\r\n        var trickle = Adapt.trickle.getModelConfig(descendant);\r\n        return trickle && trickle._isEnabled === true;\r\n      });\r\n    },\r\n\r\n    addClassToHtml: function() {\r\n      $(\"html\").addClass(\"trickle\");\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"remove\": this.onRemove,\r\n\r\n        \"articleView:preRender\": this.onDescendantPreRender,\r\n        \"blockView:preRender\": this.onDescendantPreRender,\r\n\r\n        \"trickle:unwait\": this.onUnwait,\r\n        \"trickle:wait\": this.onWait,\r\n        \"trickle:continue\": this.onContinue,\r\n        \"trickle:skip\": this.onSkip,\r\n\r\n        \"trickle:kill\": this.onKill\r\n      });\r\n      this.listenToOnce(this.model, \"change:_isReady\", this.onPageReady);\r\n    },\r\n\r\n    onDescendantPreRender: function(view) {\r\n      // ignore components\r\n      if (view.model.get(\"_type\") === \"component\") return;\r\n\r\n      var descendantView = new TrickleView({\r\n        model: view.model,\r\n        el: view.el\r\n      });\r\n      this.descendantViews[view.model.get(\"_id\")] = descendantView;\r\n    },\r\n\r\n    // trickle lifecycle\r\n\r\n    onPageReady: function(model, value) {\r\n      if (!value) return;\r\n\r\n      this.currentDescendant = null;\r\n\r\n      Adapt.trigger(\"trickle:started\");\r\n      this.gotoNextDescendant();\r\n    },\r\n\r\n    gotoNextDescendant: function() {\r\n      this.getDescendants();\r\n\r\n      if (this.currentDescendant) {\r\n        this.currentDescendant.trigger(\"stepunlock\");\r\n        this.currentDescendant = null;\r\n      }\r\n\r\n      for (var index = this.currentDescendantIndex || 0, l = this.descendantsChildFirst.length; index < l; index++) {\r\n        var descendant = this.descendantsChildFirst[index];\r\n        switch ( descendant.get(\"_type\") ) {\r\n          case \"block\":\r\n          case \"article\":\r\n            this.currentLocksOnDescendant = 0;\r\n            this.currentDescendantIndex = index;\r\n            var currentId = descendant.get(\"_id\");\r\n            this.currentDescendant = this.descendantViews[currentId];\r\n            this.currentDescendant.trigger(\"steplock\");\r\n            return;\r\n        }\r\n      }\r\n      this.finished();\r\n    },\r\n\r\n    onContinue: function(view) {\r\n      if (!this.currentDescendant) return;\r\n      if (view.model.get(\"_id\") !== this.currentDescendant.model.get(\"_id\")) return;\r\n\r\n      this.onSkip();\r\n    },\r\n\r\n    onWait: function() {\r\n      this.currentLocksOnDescendant++;\r\n    },\r\n\r\n    onUnwait: function() {\r\n      this.currentLocksOnDescendant--;\r\n      if (this.currentLocksOnDescendant > 0) return;\r\n\r\n      var lastDescendant = this.currentDescendant.model;\r\n\r\n      this.currentDescendantIndex++;\r\n      this.gotoNextDescendant();\r\n\r\n      Adapt.trickle.scroll(lastDescendant);\r\n\r\n    },\r\n\r\n    onSkip: function() {\r\n      // wait for all handlers to accept skip\r\n      this.currentDescendantIndex++;\r\n      this.gotoNextDescendant();\r\n    },\r\n\r\n    onKill: function() {\r\n      this.finished();\r\n      this.detachFromPage();\r\n    },\r\n\r\n    finished: function() {\r\n      Adapt.trigger(\"trickle:finished\");\r\n      this.detachFromPage();\r\n    },\r\n\r\n    // end of trickle lifecycle\r\n\r\n    onRemove: function() {\r\n      this.finished();\r\n    },\r\n\r\n    detachFromPage: function() {\r\n      $(\"html\").removeClass(\"trickle\");\r\n      this.undelegateEvents();\r\n      this.stopListening();\r\n      this.model = null;\r\n      this.$el = null;\r\n      this.el = null;\r\n      this.currentDescendant = null;\r\n      this.descendantViews = null;\r\n      this.descendantsChildFirst = null;\r\n      this.descendantsParentFirst = null;\r\n      Adapt.trickle.pageView = null;\r\n    }\r\n\r\n  });\r\n\r\n  return PageView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/componentView'\r\n], function(Adapt, ComponentView) {\r\n\r\n  var completionAttribute = \"_isComplete\";\r\n\r\n  var TrickleButtonView = Backbone.View.extend({\r\n\r\n    isStepLocking: false,\r\n    hasStepLocked: false,\r\n    isStepLocked: false,\r\n    isStepLockFinished: false,\r\n    hasStepPreCompleted: false,\r\n    isWaitingForClick: false,\r\n    allowVisible: false,\r\n    allowEnabled: true,\r\n    overlayShownCount: 0,\r\n\r\n    el: function() {\r\n\r\n      this.setupPreRender();\r\n\r\n      return Handlebars.templates['trickle-button'](this.model.toJSON());\r\n    },\r\n\r\n    setupPreRender: function() {\r\n\r\n      this.setupButtonVisible();\r\n      this.setupButtonEnabled();\r\n    },\r\n\r\n    setupButtonVisible: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      this.allowVisible = false;\r\n      trickle._button._isVisible = false;\r\n\r\n      if (trickle._button._styleBeforeCompletion === \"visible\") {\r\n        this.allowVisible = true;\r\n        if (trickle._button._autoHide && trickle._button._isFullWidth) {\r\n          trickle._button._isVisible = false;\r\n        } else {\r\n          trickle._button._isVisible = true;\r\n        }\r\n      }\r\n    },\r\n\r\n    setupButtonEnabled: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n\r\n      if (trickle._stepLocking._isCompletionRequired === false) {\r\n        this.allowEnabled = true;\r\n        trickle._button._isDisabled = false;\r\n      } else if (trickle._button._styleBeforeCompletion === \"visible\") {\r\n        this.allowEnabled = false;\r\n        trickle._button._isDisabled = true;\r\n      } else {\r\n        trickle._button._isDisabled = false;\r\n        this.allowEnabled = true;\r\n      }\r\n\r\n    },\r\n\r\n    events: {\r\n      \"click .js-trickle-btn\": \"onButtonClick\"\r\n    },\r\n\r\n    initialize: function(options) {\r\n      this.getCompletionAttribute();\r\n      this.debounceCheckAutoHide();\r\n      this.setupStepLocking();\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    getCompletionAttribute: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(Adapt.config);\r\n      if (!trickle) return;\r\n      if (!trickle._completionAttribute) return;\r\n      completionAttribute = trickle._completionAttribute;\r\n    },\r\n\r\n    setupStepLocking: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      this.isStepLocked = Boolean(trickle._stepLocking._isEnabled);\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:overlay\": this.onOverlay,\r\n        \"trickle:unoverlay\": this.onUnoverlay,\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"trickle:skip\": this.onSkip,\r\n        \"trickle:kill\": this.onKill,\r\n        \"trickle:update\": this.onUpdate,\r\n        \"remove\": this.onRemove\r\n      });\r\n\r\n      this.listenTo(this.model, \"change:\"+completionAttribute, this.onCompletion);\r\n    },\r\n\r\n    debounceCheckAutoHide: function() {\r\n      this.checkButtonAutoHideSync = this.checkButtonAutoHide.bind(this);\r\n      this.checkButtonAutoHide = _.debounce(this.checkButtonAutoHideSync, 100);\r\n    },\r\n\r\n    checkButtonAutoHide: function() {\r\n      if (!this.allowVisible) {\r\n        this.setButtonVisible(false);\r\n        return;\r\n      }\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      if (!trickle._button._autoHide) {\r\n        this.setButtonVisible(true);\r\n        return;\r\n      } else if (this.overlayShownCount > 0) {\r\n        this.setButtonVisible(false);\r\n        return;\r\n      }\r\n\r\n      var measurements = this.$el.onscreen();\r\n\r\n      // This is to fix common miscalculation issues\r\n      var isJustOffscreen = (measurements.bottom > -100);\r\n\r\n      // add show/hide animation here if needed\r\n      if (measurements.onscreen || isJustOffscreen) {\r\n        this.setButtonVisible(true);\r\n      } else {\r\n        this.setButtonVisible(false);\r\n      }\r\n    },\r\n\r\n    setButtonVisible: function(isVisible) {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      trickle._button._isVisible = Boolean(isVisible);\r\n      this.$(\".js-trickle-btn-container\").toggleClass(\"u-display-none\", !trickle._button._isVisible);\r\n    },\r\n\r\n    checkButtonEnabled: function() {\r\n      this.setButtonEnabled(this.allowEnabled);\r\n    },\r\n\r\n    setButtonEnabled: function(isEnabled) {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n      var $button = this.$(\".js-trickle-btn\");\r\n      if (isEnabled) {\r\n        $button.removeClass(\"is-disabled\").removeAttr(\"disabled\");\r\n        trickle._button._isDisabled = true;\r\n        // move focus forward if it's on the aria-label\r\n        if (document.activeElement && document.activeElement.isSameNode(this.$('.aria-label')[0])) {\r\n          this.$('.aria-label').focusNext();\r\n        }\r\n        // make label unfocusable as it is no longer needed\r\n        this.$('.aria-label').a11y_cntrl(false);\r\n      } else {\r\n        $button.addClass(\"is-disabled\").attr(\"disabled\", \"disabled\");\r\n        trickle._button._isDisabled = false;\r\n      }\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      if (!this.isViewMatch(view)) return;\r\n\r\n      this.hasStepLocked = true;\r\n      this.isStepLocking = true;\r\n      this.overlayShownCount = 0;\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n\r\n      if (!this.isButtonEnabled()) return;\r\n      var isCompleteAndShouldRelock = (trickle._stepLocking._isLockedOnRevisit &&\r\n          this.model.get(completionAttribute));\r\n\r\n      if (isCompleteAndShouldRelock) {\r\n        this.isStepLocked = true;\r\n        this.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n        Adapt.trigger(\"trickle:wait\");\r\n        this.allowVisible = true;\r\n        this.checkButtonAutoHide();\r\n      } else if (this.hasStepPreCompleted) {\r\n        // force the button to show if section completed before it was steplocked\r\n        this.isStepLocked = true;\r\n        this.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n        this.allowVisible = true;\r\n        this.stepCompleted();\r\n      }\r\n      this.setupOnScreenListener();\r\n    },\r\n\r\n    onOverlay: function() {\r\n      this.overlayShownCount++;\r\n    },\r\n\r\n    onUnoverlay: function() {\r\n      this.overlayShownCount--;\r\n      this.checkButtonAutoHide();\r\n    },\r\n\r\n    setupOnScreenListener: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n\r\n      if (!trickle._button._autoHide) return;\r\n      this.$el.on(\"onscreen\", this.checkButtonAutoHideSync);\r\n\r\n    },\r\n\r\n    isViewMatch: function(view) {\r\n      return view.model.get(\"_id\") === this.model.get(\"_id\");\r\n    },\r\n\r\n    isButtonEnabled: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n\r\n      if (!trickle._isEnabled || !trickle._button._isEnabled) return false;\r\n      return true;\r\n    },\r\n\r\n    onCompletion: function(model, value) {\r\n      if (value === false) return;\r\n\r\n      this.hasStepPreCompleted = true;\r\n\r\n      if (!this.hasStepLocked) return;\r\n\r\n      this.stepCompleted();\r\n    },\r\n\r\n    stepCompleted: function() {\r\n\r\n      if (this.isStepLockFinished) return;\r\n\r\n      this.isStepLocked = false;\r\n      this.allowVisible = false;\r\n      this.allowEnabled = false;\r\n\r\n      if (this.isButtonEnabled()) {\r\n        if (this.isStepLocking) {\r\n\r\n          this.isStepLocked = true;\r\n          this.isWaitingForClick = true;\r\n          Adapt.trigger(\"trickle:wait\");\r\n\r\n        } else {\r\n\r\n          this.isStepLockFinished = true;\r\n        }\r\n\r\n        this.allowVisible = true;\r\n        this.allowEnabled = true;\r\n      }\r\n\r\n      this.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n      this.checkButtonAutoHideSync();\r\n      this.checkButtonEnabled();\r\n\r\n    },\r\n\r\n    onButtonClick: function() {\r\n      if (this.isStepLocked) {\r\n        Adapt.trigger(\"trickle:unwait\");\r\n        this.isStepLocked = false;\r\n        this.isStepLockFinished = true;\r\n      } else {\r\n        this.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n        Adapt.trickle.scroll(this.model);\r\n      }\r\n\r\n      var trickle = this.model.get(\"_trickle\");\r\n      switch (trickle._button._styleAfterClick) {\r\n      case \"hidden\":\r\n        this.allowVisible = false;\r\n        this.checkButtonAutoHideSync();\r\n        break;\r\n      case \"disabled\":\r\n        this.allowEnabled = false;\r\n        this.checkButtonAutoHideSync();\r\n      }\r\n    },\r\n\r\n    onUpdate: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(this.model);\r\n\r\n      if (trickle._button._autoHide && this.isStepLocking) {\r\n        this.$el.off(\"onscreen\", this.checkButtonAutoHideSync);\r\n      }\r\n\r\n      var $original = this.$el;\r\n      var $newEl = $(Handlebars.templates['trickle-button'](this.model.toJSON()));\r\n      $original.replaceWith($newEl);\r\n\r\n      this.setElement($newEl);\r\n\r\n      if (trickle._button._autoHide && this.isStepLocking) {\r\n        this.$el.on(\"onscreen\", this.checkButtonAutoHideSync);\r\n      }\r\n    },\r\n\r\n    onStepUnlock: function(view) {\r\n      if (!this.isViewMatch(view)) return;\r\n      this.$el.off(\"onscreen\", this.checkButtonAutoHideSync);\r\n      this.isStepLocking = false;\r\n      this.overlayShownCount = 0;\r\n      // move focus forward if it's on the aria-label\r\n      if (document.activeElement && document.activeElement.isSameNode(this.$('.aria-label')[0])) {\r\n        this.$('.aria-label').focusNext();\r\n      }\r\n      // make label unfocusable as it is no longer needed\r\n      this.$('.aria-label').a11y_cntrl(false);\r\n    },\r\n\r\n    onSkip: function() {\r\n      if (!this.isStepLocking) return;\r\n\r\n      this.onKill();\r\n    },\r\n\r\n    onKill: function() {\r\n      this.$el.off(\"onscreen\", this.checkButtonAutoHideSync);\r\n      if (this.isWaitingForClick) {\r\n        this.model.set(\"_isTrickleAutoScrollComplete\", true);\r\n      }\r\n      this.isWaitingForClick = false;\r\n      this.isStepLocked = false;\r\n      this.isStepLocking = false;\r\n      this.allowVisible = false;\r\n      this.allowEnabled = false;\r\n      this.isStepLockFinished = true;\r\n      this.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n      this.checkButtonAutoHide();\r\n      this.checkButtonEnabled();\r\n    },\r\n\r\n    onRemove: function() {\r\n      if (this.isWaitingForClick) {\r\n        this.model.set(\"_isTrickleAutoScrollComplete\", true);\r\n      }\r\n      this.isWaitingForClick = false;\r\n      this.$el.off(\"onscreen\", this.checkButtonAutoHideSync);\r\n      this.isStepLocking = true;\r\n      this.remove();\r\n    }\r\n\r\n  });\r\n\r\n  return TrickleButtonView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './buttonView'\r\n], function(Adapt, ButtonView) {\r\n\r\n  var TrickleButtonHandler = Backbone.Controller.extend({\r\n\r\n    buttonViews: null,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, {\r\n        'app:dataReady': this.onAppDataReady,\r\n        remove: this.onRemove\r\n      });\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.buttonViews = {};\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        'trickle:preRender': this.onPreRender,\r\n        'trickle:postRender': this.onPostRender\r\n      });\r\n    },\r\n\r\n    onPreRender: function(view) {\r\n      // setup button on prerender to allow it to control the steplocking process\r\n      if (!this.isTrickleEnabled(view.model)) return;\r\n\r\n      this.setupConfigDefaults(view.model);\r\n\r\n      this.buttonViews[view.model.get('_id')] = new ButtonView({\r\n        model: view.model\r\n      });\r\n    },\r\n\r\n    onPostRender: function(view) {\r\n      // inject the button at post render\r\n      if (!this.isTrickleEnabled(view.model)) return;\r\n\r\n      view.$el.append(this.buttonViews[view.model.get('_id')].$el);\r\n    },\r\n\r\n    isTrickleEnabled: function(model) {\r\n      var trickle = Adapt.trickle.getModelConfig(model);\r\n      if (!trickle || !trickle._isEnabled) return false;\r\n\r\n      if (trickle._onChildren && model.get('_type') === 'article') return false;\r\n\r\n      return true;\r\n    },\r\n\r\n    setupConfigDefaults: function(model) {\r\n      if (model.get('_isTrickleButtonConfigured')) return;\r\n\r\n      var defaults = {\r\n        _isEnabled: true,\r\n        _styleBeforeCompletion: 'hidden',\r\n        _styleAfterClick: 'hidden',\r\n        _isFullWidth: true,\r\n        _autoHide: false,\r\n        _className: '',\r\n        _hasIcon: false,\r\n        text: 'Continue',\r\n        startText: 'Begin',\r\n        finalText: 'Finish',\r\n        _component: 'trickle-button',\r\n        _isLocking: true,\r\n        _isVisible: false,\r\n        _isDisabled: false\r\n      };\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(model);\r\n      trickle._button = _.extend(defaults, trickle._button);\r\n\r\n      if (trickle._button._isFullWidth) {\r\n        trickle._stepLocking._isEnabled = true;\r\n        trickle._button._styleAfterClick = 'hidden';\r\n      } else {\r\n        trickle._button._autoHide = false;\r\n      }\r\n\r\n      Adapt.trickle.setModelConfig(model, trickle);\r\n      model.set('_isTrickleButtonConfigured', true);\r\n\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.buttonViews = {};\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleButtonHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var completionAttribute = \"_isComplete\";\r\n\r\n  var TrickleCompletionHandler = Backbone.Controller.extend({\r\n\r\n    isStepLocking: false,\r\n    isCompleted: false,\r\n\r\n    stepModel: null,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, \"app:dataReady\", this.onAppDataReady);\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.getCompletionAttribute();\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    getCompletionAttribute: function() {\r\n      var trickle = Adapt.trickle.getModelConfig(Adapt.config);\r\n      if (!trickle) return;\r\n      if (!trickle._completionAttribute) return;\r\n      completionAttribute = trickle._completionAttribute;\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:descendants\": this.onDescendants,\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"trickle:kill\": this.onKill,\r\n        \"remove\": this.onRemove\r\n      });\r\n    },\r\n\r\n    onDescendants: function(view) {\r\n      // save the original completion state of the component before steplocking\r\n      view.descendantsParentFirst.forEach(function(descendant) {\r\n        var trickle = Adapt.trickle.getModelConfig(descendant);\r\n        if (!trickle) return;\r\n        trickle._wasCompletedPreRender = descendant.get(completionAttribute);\r\n      });\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      var isModelComplete = view.model.get(completionAttribute);\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(view.model);\r\n      if (!trickle._stepLocking._isCompletionRequired &&\r\n          !trickle._stepLocking._isLockedOnRevisit) {\r\n        if (!isModelComplete) return;\r\n        // skip any components that do not require completion but that are already complete\r\n        // this is needed for a second visit to a page with 'inview'\r\n        // components that aren't reset and don't require completion and are not relocked on revisit\r\n        Adapt.trigger(\"trickle:continue\", view);\r\n        return;\r\n      }\r\n\r\n      if (trickle._stepLocking._isCompletionRequired\r\n        && isModelComplete\r\n        && trickle._wasCompletedPreRender) {\r\n        // skip any components that are complete, have require completion\r\n        // and we completed before the page rendered\r\n        Adapt.trigger(\"trickle:continue\", view);\r\n        return;\r\n      }\r\n\r\n      Adapt.trigger(\"trickle:wait\");\r\n\r\n      if (isModelComplete) {\r\n        Adapt.trigger(\"trickle:unwait\");\r\n        return;\r\n      }\r\n\r\n      view.model.set(\"_isTrickleAutoScrollComplete\", false);\r\n      this.isCompleted = false;\r\n      this.isStepLocking = true;\r\n      this.stepModel = view.model;\r\n\r\n      this.listenTo(this.stepModel, \"change:\"+completionAttribute, this.onCompletion);\r\n    },\r\n\r\n    onCompletion: function(model, value) {\r\n      if (value === false) return;\r\n      this.stepCompleted();\r\n    },\r\n\r\n    stepCompleted: function() {\r\n\r\n      if (!this.isStepLocking) return;\r\n\r\n      if (this.isCompleted) return;\r\n      this.isCompleted = true;\r\n\r\n      this.stopListening(this.stepModel, \"change:\"+completionAttribute, this.onCompletion);\r\n\r\n      Adapt.trigger(\"trickle:unwait\");\r\n    },\r\n\r\n    onKill: function() {\r\n      this.onStepUnlock();\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.onStepUnlock();\r\n    },\r\n\r\n    onStepUnlock: function() {\r\n      this.stopListening(this.stepModel, \"change:\"+completionAttribute, this.onCompletion);\r\n      this.isStepLocking = false;\r\n      this.stepModel = null;\r\n      this.isCompleted = false;\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleCompletionHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleNotifyHandler = Backbone.Controller.extend({\r\n\r\n    isStepLocking: false,\r\n    isNotifyOpen: false,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, \"app:dataReady\", this.onAppDataReady);\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"notify:opened\": this.onNotifyOpened,\r\n        \"notify:closed\": this.onNotifyClosed,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"remove\": this.onRemove\r\n      });\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      this.isStepLocking = true;\r\n    },\r\n\r\n    onNotifyOpened: function() {\r\n      if (!this.isStepLocking) return;\r\n\r\n      this.isNotifyOpen = true;\r\n      Adapt.trigger(\"trickle:overlay\");\r\n      Adapt.trigger(\"trickle:wait\");\r\n    },\r\n\r\n    onNotifyClosed: function() {\r\n      if (!this.isStepLocking) return;\r\n      if (!this.isNotifyOpen) return;\r\n\r\n      this.isNotifyOpen = false;\r\n      Adapt.trigger(\"trickle:unoverlay\");\r\n      Adapt.trigger(\"trickle:unwait\");\r\n    },\r\n\r\n    onStepUnlock: function() {\r\n      this.isStepLocking = false;\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.onStepUnlock();\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleNotifyHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleBodyResizeHandler = Backbone.Controller.extend({\r\n\r\n    isStepLocking: false,\r\n\r\n    stepView: null,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, {\r\n        \"app:dataReady\": this.onAppDataReady,\r\n        \"adapt:initialize\": this.onAdaptInitialized\r\n      });\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.onResize = this.onResize.bind(this);\r\n      this.preventWrapperScroll = this.preventWrapperScroll.bind(this);\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"trickle:resize\": this.onTrickleResize,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"trickle:kill\": this.onKill,\r\n        \"trickle:finished\": this.onFinished,\r\n        \"remove\": this.onRemove\r\n      });\r\n    },\r\n\r\n    onAdaptInitialized: function() {\r\n      this.wrapper = document.getElementById('wrapper');\r\n      this.wrapper.addEventListener(\"scroll\", this.preventWrapperScroll);\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      this.isStepLocking = true;\r\n      this.stepView = view;\r\n      $(window).on(\"resize\", this.onResize);\r\n      $(\".page\").on(\"resize\", this.onResize);\r\n\r\n      // wait for height / visibility to adjust\r\n      Adapt.trigger(\"trickle:resize\");\r\n    },\r\n\r\n    preventWrapperScroll: function(event) {\r\n      if (!this.isStepLocking) return;\r\n      // Screen reader can scroll the #wrapper instead of the window.\r\n      // This code overcomes that behaviour.\r\n      var top = this.wrapper.scrollTop;\r\n      if (top === 0) return;\r\n      this.wrapper.scrollTop = 0;\r\n      window.scrollTo(0, window.pageYOffset + top);\r\n    },\r\n\r\n    onResize: function() {\r\n      if (!this.isStepLocking) return;\r\n      Adapt.trigger(\"trickle:resize\");\r\n    },\r\n\r\n    onTrickleResize: function() {\r\n      if (!this.isStepLocking) return;\r\n      var offset = this.stepView.$el.offset();\r\n      var height = this.stepView.$el.height();\r\n\r\n      var $wrapper = $(this.wrapper);\r\n\r\n      var bottom = offset['top'] + height;\r\n\r\n      $wrapper.css(\"height\", bottom );\r\n    },\r\n\r\n    onStepUnlock: function(view) {\r\n      this.isStepLocking = false;\r\n      this.stepView = null;\r\n      $(window).off(\"resize\", this.onResize);\r\n      $(\".page\").off(\"resize\", this.onResize);\r\n    },\r\n\r\n    onKill: function() {\r\n      this.onFinished();\r\n      this.onStepUnlock();\r\n    },\r\n\r\n    onFinished: function() {\r\n      this.wrapper.removeEventListener(\"scroll\", this.preventWrapperScroll);\r\n      $(this.wrapper).css(\"height\", \"\");\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.onStepUnlock();\r\n      this.stepView = null;\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleBodyResizeHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleTutorHandler = Backbone.Controller.extend({\r\n\r\n    stepLockedId: null,\r\n    isStepLocking: false,\r\n    isTutorOpen: false,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, \"app:dataReady\", this.onAppDataReady);\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"tutor:opened\": this.onTutorOpened,\r\n        \"tutor:closed\": this.onTutorClosed,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"remove\": this.onRemove\r\n      });\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      if (view) {\r\n        this.stepLockedId = view.model.get(\"_id\");\r\n      }\r\n      this.isStepLocking = true;\r\n    },\r\n\r\n    onTutorOpened: function(view, alertObject) {\r\n      if (!this.isStepLocking) return;\r\n      if (!this.isOriginStepLocked(view)) return;\r\n\r\n      this.isTutorOpen = true;\r\n      Adapt.trigger(\"trickle:overlay\");\r\n      Adapt.trigger(\"trickle:wait\");\r\n    },\r\n\r\n    isOriginStepLocked: function(view) {\r\n      if (!view || !this.stepLockedId) return true;\r\n\r\n      var parents = view.model.getAncestorModels();\r\n      var hasStepLockedParent = _.find(parents, function(ancestor) {\r\n        return ancestor.get('_id') === this.stepLockedId;\r\n      }, this);\r\n      if (!hasStepLockedParent) return false;\r\n      return true;\r\n    },\r\n\r\n    onTutorClosed: function(view, alertObject) {\r\n      if (!this.isStepLocking) return;\r\n      if (!this.isTutorOpen) return;\r\n      if (!this.isOriginStepLocked(view)) return;\r\n\r\n      this.isTutorOpen = false;\r\n      Adapt.trigger(\"trickle:unoverlay\");\r\n      Adapt.trigger(\"trickle:unwait\");\r\n    },\r\n\r\n    onStepUnlock: function() {\r\n      this.isStepLocking = false;\r\n      this.stepLockedId = null;\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.onStepUnlock();\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleTutorHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleVisibilityHandler = Backbone.Controller.extend({\r\n\r\n    isStepLocking: false,\r\n\r\n    trickleModel: null,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, \"app:dataReady\", this.onAppDataReady);\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.listenTo(Adapt, {\r\n        \"trickle:steplock\": this.onStepLock,\r\n        \"trickle:visibility\": this.onVisibility,\r\n        \"trickle:stepunlock\": this.onStepUnlock,\r\n        \"trickle:kill\": this.onKill,\r\n        \"trickle:finished\": this.onFinished,\r\n        \"remove\": this.onRemove\r\n      });\r\n\r\n    },\r\n\r\n    onStepLock: function(view) {\r\n      this.isStepLocking = true;\r\n      this.trickleModel = view.model;\r\n      Adapt.trigger(\"trickle:visibility\");\r\n    },\r\n\r\n    onVisibility: function() {\r\n      if (!this.isStepLocking) return;\r\n\r\n      if (!Adapt.trickle.pageView) return;\r\n\r\n      var descendantsParentFirst = Adapt.trickle.pageView.descendantsParentFirst;\r\n\r\n      var trickleModelId = this.trickleModel.get(\"_id\");\r\n      var trickleType = this.trickleModel.get(\"_type\");\r\n\r\n      var atIndex = _.findIndex(descendantsParentFirst, function(descendant) {\r\n        if (descendant.get(\"_id\") === trickleModelId) return true;\r\n      });\r\n\r\n      descendantsParentFirst.forEach(function(descendant, index) {\r\n        var components = descendant.findDescendantModels(\"components\");\r\n        if (index <= atIndex) {\r\n          descendant.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n          components.forEach(function(componentModel) {\r\n            componentModel.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n          });\r\n          return;\r\n        }\r\n\r\n        if (trickleType === \"article\" && descendant.get(\"_type\") === \"block\") {\r\n          // make sure article blocks are shown\r\n          if (descendant.get(\"_parentId\") === trickleModelId) {\r\n            descendant.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n            components.forEach(function(componentModel) {\r\n              componentModel.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n            });\r\n            return;\r\n          }\r\n        }\r\n\r\n        descendant.set(\"_isVisible\", false, {pluginName:\"trickle\"});\r\n        components.forEach(function(componentModel) {\r\n          componentModel.set(\"_isVisible\", false, {pluginName:\"trickle\"});\r\n        });\r\n\r\n      });\r\n\r\n    },\r\n\r\n    onStepUnlock: function(view) {\r\n      this.isStepLocking = false;\r\n      this.trickleModel = null;\r\n    },\r\n\r\n    onKill: function() {\r\n      this.onFinished();\r\n      this.onStepUnlock();\r\n    },\r\n\r\n    onFinished: function() {\r\n\r\n      var descendantsParentFirst = Adapt.trickle.pageView.descendantsParentFirst;\r\n      descendantsParentFirst.forEach(function(descendant) {\r\n        descendant.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n        var components = descendant.findDescendantModels(\"components\");\r\n        components.forEach(function(componentModel) {\r\n          componentModel.set(\"_isVisible\", true, {pluginName:\"trickle\"});\r\n        });\r\n      });\r\n\r\n    },\r\n\r\n    onRemove: function() {\r\n      this.onStepUnlock();\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleVisibilityHandler();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n  var TrickleDone = Backbone.Controller.extend({\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, \"app:dataReady\", this.onAppDataReady);\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.setupEventListeners();\r\n    },\r\n\r\n    setupEventListeners: function() {\r\n      this.onDone = _.debounce(this.onDone.bind(this), 50);\r\n      this.listenTo(Adapt, {\r\n        \"trickle:steplock\": this.onDone,\r\n        \"trickle:stepunlock\": this.onDone,\r\n        \"trickle:continue\": this.onDone,\r\n        \"trickle:finished\": this.onDone\r\n      });\r\n    },\r\n\r\n    onDone: function() {\r\n      Adapt.trigger(\"trickle:done\");\r\n    }\r\n\r\n  });\r\n\r\n  return new TrickleDone();\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  './pageView',\r\n  './handlers/button',\r\n  './handlers/completion',\r\n  './handlers/notify',\r\n  './handlers/resize',\r\n  './handlers/tutor',\r\n  './handlers/visibility',\r\n  './handlers/done'\r\n], function(Adapt, PageView) {\r\n\r\n  var Trickle = Backbone.Controller.extend({\r\n\r\n    model: null,\r\n    pageView: null,\r\n\r\n    initialize: function() {\r\n      this.listenToOnce(Adapt, {\r\n        'app:dataReady': this.onAppDataReady\r\n      });\r\n    },\r\n\r\n    onAppDataReady: function() {\r\n      this.getCourseModel();\r\n      if (!this.isCourseEnabled()) return;\r\n      this.setupListeners();\r\n    },\r\n\r\n    getCourseModel: function() {\r\n      this.model = Adapt.course;\r\n    },\r\n\r\n    isCourseEnabled: function() {\r\n      var trickleConfig = this.getModelConfig(this.model);\r\n      if (trickleConfig && trickleConfig._isEnabled === false) return false;\r\n      return true;\r\n    },\r\n\r\n    getModelConfig: function(model) {\r\n      return model.get('_trickle');\r\n    },\r\n\r\n    getCompletionAttribute: function() {\r\n      var trickle = this.getModelConfig(Adapt.config);\r\n      if (!trickle) return '_isComplete';\r\n      return trickle._completionAttribute || '_isComplete';\r\n    },\r\n\r\n    setModelConfig: function(model, config) {\r\n      return model.set('_trickle', config);\r\n    },\r\n\r\n    setupListeners: function() {\r\n      this.listenTo(Adapt, 'pageView:preRender', this.onPagePreRender);\r\n    },\r\n\r\n    onPagePreRender: function(view) {\r\n      this.pageView = new PageView({\r\n        model: view.model,\r\n        el: view.el\r\n      });\r\n    },\r\n\r\n    scroll: function(fromModel) {\r\n      // Wait for model visibility to handle\r\n\r\n      if (!this.shouldScrollPage(fromModel)) return;\r\n\r\n      fromModel.set('_isTrickleAutoScrollComplete', true);\r\n\r\n      var trickle = Adapt.trickle.getModelConfig(fromModel);\r\n      var isAutoScrollOff = !trickle._autoScroll;\r\n      var hasTrickleButton = trickle._button._isEnabled;\r\n      if (isAutoScrollOff && !hasTrickleButton) {\r\n        return;\r\n      }\r\n\r\n      var scrollTo = trickle._scrollTo;\r\n      if (scrollTo === undefined) scrollTo = '@block +1';\r\n\r\n      var scrollToId = '';\r\n      switch (scrollTo.substr(0,1)) {\r\n        case '@':\r\n          // NAVIGATE BY RELATIVE TYPE\r\n\r\n          // Allows trickle to scroll to a sibling / cousin component\r\n          // relative to the current trickle item\r\n          var relativeModel = fromModel.findRelativeModel(scrollTo, {\r\n            filter: function(model) {\r\n              return model.get('_isAvailable');\r\n            }\r\n          });\r\n\r\n          if (relativeModel === undefined) return;\r\n          scrollToId = relativeModel.get('_id');\r\n          break;\r\n        case '.':\r\n          // NAVIGATE BY CLASS\r\n          scrollToId = scrollTo.substr(1, scrollTo.length-1);\r\n          break;\r\n        default:\r\n          scrollToId = scrollTo;\r\n      }\r\n\r\n      if (scrollToId === '') return;\r\n\r\n      if (hasTrickleButton) { // only set focus if there's a trickle button - see https://github.com/adaptlearning/adapt_framework/issues/2813\r\n        Adapt.a11y.focusFirst($('.' + scrollToId));\r\n      }\r\n\r\n      if (isAutoScrollOff) return;\r\n\r\n      var duration = fromModel.get('_trickle')._scrollDuration || 500;\r\n      Adapt.scrollTo('.' + scrollToId, { duration: duration });\r\n    },\r\n\r\n    shouldScrollPage: function(fromModel) {\r\n      var trickle = Adapt.trickle.getModelConfig(fromModel);\r\n      if (!trickle || !trickle._isEnabled) return false;\r\n\r\n      var hasScrolled = fromModel.get('_isTrickleAutoScrollComplete');\r\n      if (hasScrolled) return false;\r\n\r\n      var isArticleWithOnChildren = (fromModel.get('_type') === 'article' && trickle._onChildren);\r\n      if (isArticleWithOnChildren) return false;\r\n\r\n      return true;\r\n    }\r\n\r\n  });\r\n\r\n  return (Adapt.trickle = new Trickle());\r\n\r\n});\r\n","define([\r\n  'core/js/adapt'\r\n],function(Adapt) {\r\n\r\n  Adapt.on('questionView:showFeedback', function(view) {\r\n\r\n    var alertObject = {\r\n      title: view.model.get('feedbackTitle'),\r\n      body: view.model.get('feedbackMessage')\r\n    };\r\n\r\n    var attributes = {};\r\n    var classes = [];\r\n\r\n    if (view.model.has('_isCorrect')) {\r\n      // Attach specific classes so that feedback can be styled.\r\n      if (view.model.get('_isCorrect')) {\r\n        classes.push('is-correct');\r\n      } else {\r\n\r\n        \r\n        // DD: Modified.\r\n        // Modified to support the _isAtLeastOneIncorrectSelection value we use.\r\n\r\n        if (view.model.has('_isAtLeastOneIncorrectSelection')) {\r\n          // Partially correct feedback is an option.\r\n          if (!view.model.get('_isAtLeastOneIncorrectSelection')) {\r\n            classes.push('is-partially-correct');\r\n          } else {\r\n            classes.push('is-incorrect');\r\n          }\r\n        }\r\n        else if (view.model.has('_isAtLeastOneCorrectSelection')) {\r\n          // Partially correct feedback is an option.\r\n          if (view.model.get('_isAtLeastOneCorrectSelection')) {\r\n            classes.push('is-partially-correct');\r\n          } else {\r\n            classes.push('is-incorrect');\r\n          }\r\n        }\r\n        else {\r\n          classes.push('is-incorrect');\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add the extension/component type which triggered this.\r\n    if (view.model.has('_component')) {\r\n      classes.push('is-component is-' + view.model.get('_component').toLowerCase());\r\n    } else if (view.model.has('_extension')) {\r\n      classes.push('is-extension is-' + view.model.get('_extension').toLowerCase());\r\n    }\r\n\r\n    // Add the _id property as attribute.\r\n    attributes['data-adapt-id'] = view.model.get('_id');\r\n\r\n    alertObject._classes = classes.join(' ');\r\n    alertObject._attributes = attributes;\r\n\r\n    Adapt.once('notify:closed', function() {\r\n      Adapt.trigger('tutor:closed', view, alertObject);\r\n    });\r\n\r\n    Adapt.trigger('notify:popup', alertObject);\r\n\r\n    Adapt.trigger('tutor:opened', view, alertObject);\r\n\r\n  });\r\n\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * adapt-dd-componentLogo\r\n     * --------------------------------------\r\n     * Adds a componentLogo in the top-right corner of the component that the following partial is added to:\r\n     * \r\n     * \"_componentLogo\": {\r\n     *  \"src\": \"assets/questionplus-logo.svg\"\r\n     * }\r\n     * \r\n     * // TODO:\r\n     * - Have the logo appear in the adapt-dd-sideMenu too.\r\n     */\r\n\r\n    class ComponentLogo extends Backbone.Controller {\r\n        \r\n        initialize() {\r\n            Adapt.on(\"componentView:postRender\", this.onComponentPostRender.bind(this));\r\n        }\r\n\r\n        onComponentPostRender(componentView) {\r\n            let data = componentView.model.get(\"_componentLogo\");\r\n            if (!data) return;\r\n\r\n            let mode = data._mode;\r\n            this.render(mode, componentView, data);\r\n\r\n            // StickyBlock + ComponentRow compatibility:\r\n            // ----------------------------------------------------------------------------\r\n            // Re-render whenever the componentRow is disabled + re-enabled.\r\n            let componentRow = componentView.model.get(\"_componentRow\");\r\n            this.listenTo(componentRow, \"change:_isEnabled\", (componentRow, isEnabled) => {\r\n                if (!isEnabled) return;\r\n                \r\n                // Delay is necessary (gives componentRow time to finish rendering).\r\n                _.delay(() => {\r\n                    this.render(mode, componentView, data);\r\n                }, 0);\r\n            });\r\n        }\r\n\r\n        render(mode, componentView, data) {\r\n            switch (mode) {\r\n                case \"small\":\r\n                    this._renderLogoSmall(componentView, data);\r\n                    break;\r\n\r\n                default:\r\n                    this._renderLogoNormal(componentView, data);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Render the logo inside of the .component__header element\r\n         */\r\n         _renderLogoNormal(componentView, data) {\r\n\r\n            let template = Handlebars.templates['componentLogo'];\r\n            let html = Handlebars.compile(template(data));\r\n\r\n            componentView.$(\".component__header\")\r\n                .addClass(\"has-componentlogo\")\r\n                .prepend(html)\r\n                .after(\"<div class='u-clearfix'></div>\"); // Prevent the floating logo affecting the .component__widget. \r\n                \r\n            // adapt-componentRow compatibility.\r\n            componentView.$el.closest(\".componentrow\").find(\".componentrow__title\").addClass(\"has-componentlogo\");\r\n        }\r\n\r\n        /**\r\n         * Render the logo inline with the component title.\r\n         * (Legacy; only used in BU11).\r\n         */\r\n         _renderLogoSmall(componentView, data) {\r\n\r\n            let template = Handlebars.templates['componentLogoSmall'];\r\n            let html = Handlebars.compile(template(data));\r\n\r\n            // Prepend the logo to the title and the componentRow replacement title (if it exists).\r\n            let $parents = componentView.$(\".component__title-inner\");\r\n            $parents = $parents.add(componentView.$el.closest(\".componentrow\").find(\".componentrow__title-inner\"));\r\n\r\n            $parents.each((i, e) => {\r\n\r\n                // Error handling: don't accidentally prepend multiple logos.\r\n                if ($(e).hasClass(\"has-componentlogo\")) return;\r\n                \r\n                $(e)\r\n                    .addClass(\"has-componentlogo\")\r\n                    .prepend(html);\r\n            });\r\n        }\r\n    }\r\n\r\n    Adapt.componentLogo = new ComponentLogo();\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt'\r\n], function(Handlebars, Adapt) {\r\n\r\n    class DownloadView extends Backbone.View {\r\n\r\n        tagName() {\r\n            return \"span\";\r\n        }\r\n\r\n        className() {\r\n            let classes = [\r\n                \"download\"\r\n            ];\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .js-download-tooltip\" : \"onTooltipClick\"\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.render();\r\n        }\r\n\r\n        render() {\r\n\r\n            let template = Handlebars.templates[\"ddDownload\"];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n        }\r\n\r\n        onTooltipClick() {\r\n            Adapt.createTooltip(this.$(\".js-download-tooltip\"), this.model.get(\"tooltip\"));\r\n        }\r\n    };\r\n\r\n    return DownloadView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './downloadView'\r\n], function(Handlebars, Adapt, DownloadView) {\r\n\r\n    /**\r\n     * adapt-dd-download\r\n     * --------------------------------------\r\n     * Register a Handlebars helper for creating download links.\r\n     */\r\n\r\n    // Helpers\r\n    // ---------------------\r\n\r\n    Adapt.on('router:page', () =>{\r\n\r\n        Handlebars.registerHelperEl(\"download\", function() {\r\n\r\n            let data = Handlebars.getContextHash.apply(this, arguments);\r\n            data._download = data.download; // Property cannot have the same name as the helper (confuses Handlebars).\r\n            data._icon = data.icon || \"download\"; // Allow for custom icons to be used.\r\n\r\n            // If in Epub mode, test if the URL is local or absolute.\r\n            if (Adapt.config.get(\"_isEpub\")){            \r\n                var rAbsoluteURL = new RegExp('^(?:[a-z]+:)?//', 'i');\r\n                \r\n                // The URL is local (inside of the .epub zip). Redirect it to an external server.\r\n                if (!rAbsoluteURL.test(data.href)) {\r\n\r\n                    let filePath;\r\n                    try {\r\n                        filePath = data.href.match(/^course[/\\\\](.+)?[/\\\\]downloads[/\\\\](.+)$/);\r\n                        filePath = filePath[2];\r\n                    }\r\n                    catch (err) {\r\n                        throw \"{{#download}} href property has invalid URL:\\n\\n\" + data.href + \"\\n\\nAll local downloadable files must be located in \\\"course/**/downloads/**.\";\r\n                    }\r\n\r\n                    const externalURL = Adapt.config.get(\"_download\")?._externalMirrorURL;\r\n                    if (!externalURL) throw \"config.json: _download._externalMirrorURL must be defined!\";\r\n\r\n                    // Replace the href with the external URL.\r\n                    let pageModel = Adapt.findById(Adapt.location._currentId);\r\n\r\n                    let productionCode =    pageModel.get(\"productionCode\");\r\n                    let topicNum =          pageModel.get(\"topicNum\");\r\n                    if (productionCode === undefined)   throw \"\\\"productionCode\\\" must be defined in contentObjects.jsonsynt!\";     \r\n                    if (topicNum === undefined)         throw \"\\\"topicNum\\\" must be defined in contentObjects.jsonsynt!\";     \r\n\r\n                    data.href = externalURL + \"/\" + productionCode + \"/\" + productionCode + \".\" + topicNum + \"/\" + filePath;\r\n                    data._isExternal = true;\r\n                }\r\n            }\r\n\r\n            // NEW: Detect if the file being provided will be automatically opened by the browser if the user clicks the download link.\r\n            // Append some instructions if that's the case (FIXME: Hardcoded message).\r\n            let modelJSON = _.extend({}, data, {\r\n                tooltip: data._isExternal ? \"Right-click and select Save link as... to save this file to your device.\" : \"\"\r\n            });\r\n\r\n            return new DownloadView({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el;\r\n        });\r\n\r\n    });\r\n});\r\n","const Handlebars = require(\"handlebars\");\r\n\r\ndefine([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class FigurePopupView extends Backbone.View {\r\n\r\n        className() {\r\n\r\n            let classes = [\r\n                \"figure-popup\",\r\n                this.model.get(\"_classes\") || \"\"\r\n            ];\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n            this.listenToOnce(Adapt, \"notify:closed\", this.onClosed);\r\n        }\r\n\r\n        onOpened() {\r\n            Adapt.scrollfix.disableA11yScroll();\r\n        }\r\n\r\n        onClosed() {\r\n            this.$el.addClass(\"is-closed\");\r\n            Adapt.scrollfix.enableA11yScroll();\r\n        }\r\n\r\n        remove() {\r\n            this.model.trigger(\"remove\");\r\n            super.remove();\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            data.view = this;\r\n\r\n            var template = Handlebars.templates['ddFigurePopup'];\r\n            this.$el.html(template(data));\r\n\r\n            // FIXME: Delay needed to be used (if this was called too early, it would detect the figure helperEl placeholder instead).\r\n            _.delay(() => {Handlebars.fixPlaceholders(this.$el);}, 50);\r\n        }\r\n\r\n        // Allow for manually closing the popup.\r\n        closePopup() {\r\n            Adapt.trigger('notify:close');\r\n        }\r\n    };\r\n\r\n    return FigurePopupView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    \"./figurePopupView\"\r\n], function(Handlebars, Adapt, FigurePopupView) {\r\n\r\n    /**\r\n     * Applied on the EXISTING item HTML by the figureView.\r\n     * (Important to apply to existing, as figureItems often contain elements with scripts which would break if the view re-renders).\r\n     */\r\n\r\n    // FIXME: This uses a lot of the same lightbox scripts ddImgPopup uses.\r\n    // Need to make these scripts shared somehow.\r\n\r\n    const HIDDEN_OBSERVER_DEBOUNCE = 500; \r\n\r\n    class FigureItemView extends Backbone.View {\r\n\r\n        events() {\r\n            \r\n            let e = {\r\n\r\n            };\r\n\r\n            if (this.model.get(\"lightbox\")) {\r\n                e[\"click\"] = \"onLightboxClick\";\r\n            }\r\n\r\n            return e;\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setUpModelData();\r\n            this.setupEventListeners();\r\n\r\n            _.delay(this.postRender.bind(this), 0);\r\n        }\r\n\r\n        // FIXME: Bad to do it this way (retrieving the model properties from the element itself).\r\n        setUpModelData(){\r\n            this.setUpLightboxData();\r\n            this.model.set(\"content\", this.$(\".js-figure-item-inner\").html());\r\n        }\r\n\r\n        setupEventListeners(){\r\n            // Slight delay added for StickyBlock compatibility.\r\n            // (This should always be calculated last anyway).\r\n            this.onDeviceResize = _.debounce(this.onDeviceResize.bind(this), 10);\r\n            this.listenTo(Adapt, 'device:resize', this.onDeviceResize);\r\n\r\n            // Trigger a resize as soon as it's ready.\r\n            // Delay added to allow for {{#img}} helpers (and other registerHelperEl() helpers) time to be rendered.\r\n            _.delay(() => {\r\n                this.$el.imageready(this.onDeviceResize.bind(this));\r\n            }, 10);\r\n\r\n            // FIXME: These events are only triggered if lightbox is enabled. Should they have a different name?\r\n            this.listenTo(this.model, \"change:_isTransformed\", this.onTransformedChange);\r\n            this.listenTo(this.model, \"change:_isHidden\", this.onHiddenChange);\r\n        }\r\n\r\n        onDeviceResize() {\r\n\r\n            let scaleDown = this.model.get(\"scaleDown\");\r\n\r\n            if (scaleDown) {\r\n                this.updateScaleDown();\r\n                this.updateLightbox();\r\n            }\r\n            else {\r\n                this.updateScrolling();\r\n            }\r\n        }\r\n\r\n        /**\r\n         * EXPERIMENTAL:\r\n         * -------------\r\n         * Only apply 'overflow: auto' if the .js-figure-item-inner element exceeds the .js-figure-item.\r\n         * This is being used instead of a global 'overflow: auto' due to the need for 'position: absolute'\r\n         * elements to be able to overflow the figureItem without being clipped.\r\n         */\r\n        updateScrolling() {\r\n\r\n            // Don't do anything if explicitly set not to scroll.\r\n            if (this.model.get(\"scrolling\") === false) return;\r\n\r\n            this.$el.toggleClass(\"has-overflow-scrolling\", false);\r\n\r\n            let $itemInner = this.$(\".js-figure-item-inner\");\r\n\r\n            // 'display: inline-block' forces the inner element to be as wide as its non-absolute contents.\r\n            $itemInner.css(\"display\", \"inline-block\");\r\n\r\n            let myWidth = this.$el[0].getBoundingClientRect().width;\r\n            let innerWidth = $itemInner[0].getBoundingClientRect().width;\r\n\r\n            $itemInner.css(\"display\", \"\");\r\n\r\n            this.$el.toggleClass(\"has-overflow-scrolling\", myWidth < innerWidth);\r\n        }\r\n\r\n        /**\r\n         * @returns {Boolean} True if this FigureItem has the lightbox setting enabled.\r\n         */\r\n        isLightboxEnabled() {\r\n            return Boolean(this.model.get(\"lightbox\")?._isEnabled);\r\n        }\r\n\r\n        /**\r\n         * @returns {Boolean} True only if this view is being scaled down (and thus, warranting a lightbox).\r\n         */\r\n        isLightboxActive() {\r\n            return Boolean(this.model.get(\"lightbox\")?._isActive);\r\n        }\r\n\r\n        onTransformedChange(model, isTransformed) {\r\n            // If using a lightbox, only show it when the figure is transformed.\r\n            let lightbox = this.model.get(\"lightbox\");\r\n            if (!lightbox) return;\r\n\r\n            lightbox._isActive = isTransformed;\r\n            this.$el.toggleClass(\"lightbox-active\", isTransformed);\r\n        }\r\n\r\n        setUpLightboxData() {\r\n            // Possible lightbox values and what they map to:\r\n            // true/false -----------> {_isEnabled: *, _backgroundEnabled: true}\r\n            // Number ---------------> {_isEnabled: true, _width: *, _backgroundEnabled: true}\r\n            // {_width:x, bg:true} --> {_isEnabled: true, _width: *, _backgroundEnabled: *}\r\n\r\n            let lightbox = this.model.get(\"lightbox\");\r\n            if (!lightbox) return;\r\n            \r\n            if (lightbox === true) lightbox = {};\r\n\r\n            this.model.set(\"lightbox\", {\r\n                _isEnabled: true,\r\n                _width: !isNaN(lightbox) ? lightbox : (lightbox._width || \"auto\"),\r\n                _backgroundEnabled: lightbox.bg === false ? false : true\r\n            });\r\n        }\r\n\r\n        onLightboxClick() {\r\n            // Check if the lightbox is active at this time (it can be toggled on/off by device resizing).\r\n            if (!this.isLightboxActive()) return;\r\n            this.openLightbox();\r\n        }\r\n\r\n        openLightbox() {\r\n\r\n            if (this._isPopupOpen) return;\r\n            this._isPopupOpen = true;\r\n            this.popupView = new FigurePopupView({\r\n                model: this.model\r\n            });\r\n    \r\n            Adapt.trigger(\"notify:popup\", {\r\n                _view: this.popupView,\r\n                _isCancellable: true,\r\n                _showCloseButton: true,\r\n                _classes: 'figure-lightbox dragscroll'// + (this.model.get('_classes') || \"\")\r\n            });\r\n\r\n            this.listenToOnce(Adapt, {\r\n                'popup:closed': this.onLightboxClosed\r\n            });\r\n        }\r\n\r\n        onLightboxClosed() {\r\n            this._isPopupOpen = false;\r\n        }\r\n\r\n        /**\r\n         * Trigger an event whenever this View becomes un-hidden.\r\n         * @param {*} model \r\n         * @param {*} isHidden \r\n         */\r\n        onHiddenChange(model, isHidden) {\r\n\r\n            if (isHidden) return;\r\n\r\n            let scaleDown = this.model.get(\"scaleDown\");\r\n\r\n            if (scaleDown) {\r\n                this.updateScaleDown();\r\n                this.updateLightbox();\r\n            }\r\n            else {\r\n                this.updateScrolling();\r\n            }\r\n        }\r\n        \r\n        postRender() {\r\n\r\n            // Only do this if using a lightbox.\r\n            if (!this.isLightboxEnabled()) return;\r\n\r\n            // First, check if this view is :hidden.\r\n            // If so, only update it once it becomes visible again.\r\n            this.model.set(\"_isHidden\", this.$el.is(\":hidden\"));\r\n\r\n            /**\r\n             * Whenever this mutation is triggered, check if this view is hidden, and update the \"_isHidden\" value.\r\n             */\r\n            let callback = _.debounce(() => {\r\n                this.model.set(\"_isHidden\", this.$el.is(\":hidden\"));\r\n            }, HIDDEN_OBSERVER_DEBOUNCE);\r\n            \r\n            this._hiddenObserver = new MutationObserver(callback);\r\n\r\n            // Find the closes component or notify element.\r\n            let closestEl = this.$el.closest(\".component\")[0];\r\n            if (!closestEl) closestEl = this.$el.closest(\".notify\")[0];\r\n\r\n            // Start observing.\r\n            this._hiddenObserver.observe(closestEl, {\r\n                attributes: true,\r\n                subtree: true\r\n            });\r\n        }\r\n\r\n        updateScaleDown() {\r\n\r\n            if (!this.model.get(\"scaleDown\")) return;\r\n            if (this.model.get(\"_isHidden\")) return; // Don't update if hidden (width can't be calculated accurately in this state).\r\n\r\n            let $item = this.$el;\r\n            let $itemInner = this.$(\".js-figure-item-inner\");\r\n\r\n            // Reset inline CSS.\r\n            $item.css(\"height\", \"\");\r\n            $itemInner.css(\"transform\", \"\");\r\n\r\n            // Scale the item-inner element to fit inside its item.\r\n            let bb = $item[0].getBoundingClientRect();\r\n            let bbInner = $itemInner[0].getBoundingClientRect();\r\n\r\n            let xPadding = parseFloat($item.css(\"padding-left\"), 10) + parseFloat($item.css(\"padding-right\"), 10);\r\n\r\n            let scale = (bb.width-xPadding) / bbInner.width;\r\n            let isTransformed = scale < 1;\r\n\r\n            this.model.set(\"_isTransformed\", isTransformed);\r\n            this.$el.toggleClass(\"is-transformed\", isTransformed);\r\n\r\n            // If the scale is >= 1, don't do anything (we don't need to upscale).\r\n            if (!isTransformed) return;\r\n\r\n            $itemInner.css(\"transform\", `scale(${scale})`);\r\n\r\n            // Resize the outer item's height to match the scaledown.\r\n            let yPadding = parseFloat($item.css(\"padding-top\"), 10) + parseFloat($item.css(\"padding-bottom\"), 10);\r\n\r\n            $item.css(\"height\", bbInner.height * scale + yPadding);\r\n        }\r\n\r\n        updateLightbox() {\r\n\r\n            \r\n        }\r\n    };\r\n\r\n    return FigureItemView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './figureItemView'\r\n], function(Handlebars, Adapt, FigureItemView) {\r\n\r\n    // Item helper\r\n    // ------------------\r\n\r\n    /**\r\n     * @param {?string} hash.class                    Additional CSS classes to add to the root item element.\r\n     * @param {?object | ?string} hash.sizing         adapt-sizing object (see adapt-sizing for more info).\r\n     * \r\n     * @param {?boolean | ?number} hash.lightbox      If not falsy, will allow the user to click the item and have it appear in a popup.\r\n     *                                                \"auto\": will make the item in the popup use auto width.\r\n     *                                                1 - 16: will make the item set its width to this sizing value.\r\n     * @param {?boolean} hash.scaledown               If true, will 'transform: scale()' down the inner item element to fit.\r\n     * \r\n     * @param {?boolean} hash.stack                   If true, will stack all child elements in the item on top of each other.\r\n     *                                                (For customs).\r\n     * \r\n     * @param {?string} hash.caption                  (LEGACY): adds a figurecaption.\r\n     * \r\n     * @returns An empty figureItem (which will be assigned a view + contents once the parent {{#figure}} is rendered).\r\n     */\r\n    function renderFigureItem() {\r\n        let data = Handlebars.getContextHash.apply(this, arguments);\r\n        \r\n        if (data.sizing === undefined) data.sizing = \"auto\"; // Default to auto width if no sizing specified.\r\n        if (data.sizing) data.sizing = Adapt.sizing.getSizingClass(data.sizing);\r\n        \r\n        // New feature: allow horizontal scrollbars to be fully disabled on figure items (if specified). Important: keep the default as true (legacy support).\r\n        if (data.scrolling === undefined) data.scrolling = true;\r\n\r\n        // If data.scaledown == true, will 'transform: scale()' down the inner item element to fit.\r\n        if (data.scaledown || data.scaleDown) {\r\n            data.scrolling = false;\r\n            data.scaleDown = true;\r\n        }\r\n\r\n        // If \"lightbox\" is enabled, will 'transform: scale()' down the inner item element to fit.\r\n        // If scaled down, will show a lightbox icon and trigger a popup to open when clicked.\r\n        if (data.lightbox) {\r\n            data.scrolling = false;\r\n            data.scaleDown = true;\r\n            data.lightbox = data.lightbox;\r\n        }\r\n\r\n        // Legacy: support for captions.\r\n        if (data.caption) {\r\n            data = _.extend({}, data, Adapt.figure.createCaptionData(data.caption, data.content));\r\n        }\r\n\r\n        // FIXME: Temporary implementation to pass the model data to the figureItemView.\r\n        let d = {\r\n            scaleDown: data.scaleDown,\r\n            lightbox: data.lightbox,\r\n            scrolling: data.scrolling,\r\n            caption: data.caption,\r\n            captionPrefix: data.captionPrefix,\r\n            stack: Boolean(data.stack)\r\n        }\r\n        data.data = JSON.stringify(d);\r\n\r\n        let html = Handlebars.templates[\"ddFigureItem\"](data);\r\n        return new Handlebars.SafeString(html);\r\n    }\r\n    \r\n    Handlebars.registerHelper(\"item\", renderFigureItem);\r\n    // Legacy.\r\n    Handlebars.registerHelper(\"figureItem\", renderFigureItem);\r\n    Handlebars.registerHelper(\"figureitem\", renderFigureItem);\r\n\r\n    // figuretext helpers\r\n    // ------------------\r\n    // FIXME: Should be figureText (for consistency).\r\n    function renderFigureText() {\r\n        let data = Handlebars.getContextHash.apply(this, arguments);\r\n        if (data.sizing) data.sizing = Adapt.sizing.getSizingClass(data.sizing);\r\n\r\n        let html = Handlebars.templates[\"ddFigureText\"](data);\r\n        return new Handlebars.SafeString(html);\r\n    }\r\n    \r\n    Handlebars.registerHelper(\"figureText\", renderFigureText);\r\n    // Legacy.\r\n    Handlebars.registerHelper(\"figuretext\", renderFigureText);\r\n\r\n    /**\r\n     * Renders a figure container element.\r\n     * These containers are frequently created with {{#figure}} helpers to create custom layouts in our content.\r\n     */\r\n    class FigureView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"figure\",\r\n                this.model.get(\"class\") || \"\",\r\n                this.model.get(\"reverse\") ? \"is-reverse\" : \"\",\r\n                this.model.get(\"align\") ? (\"align-\" + this.model.get(\"align\")) : \"\",\r\n                this.model.get(\"justify\") ? (\"justify-\" + this.model.get(\"justify\")) : \"\",\r\n                this.model.get(\"wrap\") === false ? \"no-wrap\" : \"\",\r\n                this.model.get(\"mode\") ? (\"is-mode-\" + this.model.get(\"mode\")) : \"\",\r\n                this.model.get(\"theme\") ? (\"theme-\" + this.model.get(\"theme\")) : \"\",\r\n            ];\r\n\r\n            // Flex direction (row | column | etc.).\r\n            // -----------------------------------------------------------\r\n            let direction = this.model.get(\"direction\");\r\n            \r\n            // Legacy (old naming) support (\"column\" property deprecated).\r\n            if (direction === undefined) {\r\n                direction = this.model.get(\"column\") ? \"column\" : \"row\";\r\n            }\r\n\r\n            // is-row | is-column | is-wrap\r\n            classes.push(`is-${direction}`);\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        tagName() {\r\n            return \"figure\";\r\n        }\r\n\r\n        attributes() {\r\n            let attr = {};\r\n            if (this.model.get(\"style\")) attr.style = this.model.get(\"style\");\r\n            if (this.model.get(\"name\")) attr.name = this.model.get(\"name\");\r\n            return attr;\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.render();\r\n            this.setupEventListeners();\r\n        }\r\n\r\n        setupEventListeners(){\r\n\r\n            \r\n        }\r\n\r\n        \r\n\r\n        render(){\r\n            let template = Handlebars.templates['ddFigure'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            // Ensure that the children of the figure all have the .figure__item class.\r\n            // Each child that doesn't needs to be wrapped in one.\r\n            // EDIT: Not necessary.\r\n            //this.$(\".figure__inner\").children().filter(\":not(.figure__item)\").wrap(\"<div class='figure__item'></div>\");\r\n\r\n            // Apply a view for each item.\r\n            this.$(\".js-figure-item\").each((i, e) => {\r\n\r\n                // FIXME: Very bad way of passing the data, but should work for now.\r\n                let modelData = {};\r\n                try {\r\n                    modelData = JSON.parse($(e).attr(\"data-model\"));\r\n                    $(e).removeAttr(\"data-model\");\r\n                }\r\n                // JSON.parse shouldn't fail, but if it does, use an empty object as a fallback.\r\n                catch (err) {\r\n                    modelData = {};\r\n                }\r\n\r\n                modelData = _.extend({}, modelData, {\r\n                    _parent: this.model\r\n                });\r\n                \r\n                new FigureItemView({\r\n                    model: new Backbone.Model(modelData),\r\n                    el: e\r\n                })\r\n            });\r\n\r\n            // Set up debug interact for positioning mark elements.\r\n            _.delay(() => {\r\n                if (Adapt.debug?.setUpInteract) {\r\n\r\n                    let $marks = this.$(\".mark\");\r\n                    if (!$marks.length) return;\r\n\r\n                    Adapt.debug.setUpInteract(\r\n                        this.$(\".mark\"),\r\n                        this.$(\".ddimg__inner\"),\r\n                        false\r\n                    );\r\n                }\r\n            }, 0);\r\n        }\r\n    };\r\n\r\n    return FigureView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    \r\n    class FigureModel extends Backbone.Model {\r\n\r\n        initialize() {\r\n            this.initCaption();\r\n        }\r\n\r\n        /**\r\n         * All figures which have captions need to have a \"Figure X: \" prefix.\r\n         * The value of \"X\" must be unique for each figure, and increment with each one.\r\n         */\r\n        initCaption() {\r\n            if (!this.get(\"caption\")) return;\r\n            this.set(Adapt.figure.createCaptionData(this.get(\"caption\"), this.get(\"content\")));\r\n        }\r\n    };\r\n\r\n    return FigureModel;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './figureView',\r\n    './figureModel'\r\n], function(Handlebars, Adapt, FigureView, FigureModel) {\r\n\r\n    /**\r\n     * adapt-dd-figure\r\n     * --------------------------------------\r\n     * Register a Handlebars helper for the very commonly used <figure> container element.\r\n     */\r\n\r\n    let CAPTION_COUNTS = {}; // Global value which is used to set the \"Figure X\" text on the figures which use <figcaption>.\r\n\r\n    class Figure extends Backbone.Controller {\r\n\r\n        initialize() {\r\n            Adapt.on('router:page', this.onRouterPage);\r\n        }\r\n\r\n        onRouterPage() {\r\n\r\n            // Helpers\r\n            // ---------------------\r\n            Handlebars.registerHelperEl(\"figure\", function() {\r\n                let context = arguments[arguments.length-1];\r\n                let modelJSON = _.extend({}, context.hash, {\r\n                    content: context.fn(this)\r\n                });\r\n\r\n                return new FigureView({\r\n                    model: new FigureModel(modelJSON)\r\n                }).$el;\r\n            });\r\n        }\r\n\r\n        _getCaptionCount(type, increment) {\r\n            if (CAPTION_COUNTS[type] === undefined) {\r\n                CAPTION_COUNTS[type] = 0;\r\n            }\r\n            if (increment) {\r\n                CAPTION_COUNTS[type]++;\r\n            }\r\n\r\n            return CAPTION_COUNTS[type];\r\n        }\r\n\r\n        /**\r\n         * Legacy:\r\n         * -------\r\n         * (Used for BU11; do not use elsewhere).\r\n         * Creates a prefix for a caption with a unique, incremented number.\r\n         */\r\n        createCaptionData(captionStr, content) {\r\n            \r\n            let type = \"Figure\";\r\n            // If there's a table inside, change the prefix.\r\n            if (content && (content.string || content).includes(\"<table\")) type = \"Table\";\r\n\r\n            if (captionStr === true) captionStr = \" \";\r\n\r\n            /**\r\n             * Invisible captions: if a caption string is prefixed with a \"!\", then it will be invisible.\r\n             * (this is used by BU11 StickyBlocks to keep figureItem height consistent).\r\n             */\r\n            let isInvis = captionStr[0] === \"!\";\r\n            let c = this._getCaptionCount(type, !isInvis);\r\n            if (isInvis) captionStr = captionStr.substr(1); // Remove the \"!\".\r\n\r\n            let captionPrefix = `${type} ${c}${captionStr.trim().length == 0 ? \"\" : \".\"} `;\r\n            // If there's a \"!!\" at the start of the string, don't show a prefix at all.\r\n            if (captionStr[0] === \"!\") {\r\n                captionStr = captionStr.substr(1); // Remove the second \"!\".\r\n                captionPrefix = \"\";\r\n            }\r\n\r\n            let data = {\r\n                captionPrefix: captionPrefix,\r\n                caption: captionStr,\r\n                isCaptionInvis: isInvis\r\n            }\r\n            \r\n            return data;\r\n        }\r\n    }\r\n\r\n    let figure = new Figure();\r\n    Adapt.figure = figure;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // Shortcut checks for the adapt-pdf and adapt-epub extensions (if they exist in the build).\r\n    Adapt.isPDFMode = function() {return Boolean(Adapt.pdf?._isEnabled);}\r\n    Adapt.isEpubMode = function() {return Boolean(Adapt.epub?._isEnabled);}\r\n    Adapt.isDebugEnabled = function() {return Boolean(Adapt.debug?._isEnabled);}\r\n\r\n\r\n    //#region :hidden change detection\r\n    //-----------------------------------------------\r\n    /**\r\n     * Certain Views/elements need a way to detect if they're \":hidden\" (jQuery selector), and when they stop being\r\n     * \":hidden\".\r\n     * \r\n     * This funcationality is common enough to be made global.\r\n     */\r\n     $.fn.onUnhidden = function(callback) {\r\n        const HIDDEN_OBSERVER_DEBOUNCE = 10; //500; \r\n        let $el = $(this);\r\n\r\n        // Find the closest component or notify element to the selection(s).\r\n        let closestEl = $el.closest(\".component\")[0];\r\n        if (!closestEl) closestEl = $el.closest(\".notify\")[0];\r\n        if (!closestEl) {\r\n            Adapt.log.error(\"$.fn.onUnhidden: Could not set up MutationObserver (could not find closest parent).\", $el);\r\n            return this;\r\n        }\r\n\r\n        // Whenever this mutation is triggered, check if this view is hidden, and update the \"_isHidden\" value.\r\n        let observerCallback = _.debounce(() => {\r\n            $el.each((i, e) => {\r\n                let $e = $(e);\r\n                let isHidden = $e.is(\":hidden\");\r\n                let isUnhidden = $e.data(\"_isUnhidden\");\r\n\r\n                // Don't do anything if no state was changed.\r\n                if (isHidden === !isUnhidden) return;\r\n                \r\n                $e.data(\"_isUnhidden\", !isHidden);\r\n\r\n                // Call the callback only when unhidden.\r\n                if (isHidden) return;\r\n                callback.apply($e);\r\n            });\r\n        }, HIDDEN_OBSERVER_DEBOUNCE);\r\n\r\n        let unhiddenObserver = new MutationObserver(observerCallback);\r\n        unhiddenObserver.observe(closestEl, {\r\n            attributes: true,\r\n            attributeFilter: [\"style\", \"hidden\", \"aria-expanded\", \"class\"],\r\n            subtree: true\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    //#endregion\r\n\r\n\r\n\r\n\r\n\r\n    //#region Rrror handling\r\n    //-----------------------------------------------\r\n\r\n    /**\r\n     * If require() calls are made from within components, they can sometimes (rarely) time out while trying to load script(s).\r\n     * If such a thing occurs, communicate to the user that they need to refresh by using adapt-dd-loading (if it exists).\r\n     * \r\n     * To test whether this error will occur:\r\n     * --------------------------------------\r\n     * Go to Chrome Dev tools and enable Network throttling. If the page takes long enough to load, there should be a module timeout. \r\n     * \r\n     * HOW TO AVOID:\r\n     * -------------\r\n     * Avoid using require() calls within component/extension views.\r\n     * \r\n     * Previous causes:\r\n     * ----------------\r\n     * - adapt-reorder needed both jQuery-ui (an AMD module) and jquery.touch-punch (a non-AMD module) to be loaded in a specific\r\n     *   order that was prone to timing out.\r\n     *   \r\n     *   This issue has since been resolved (however, the third-party touch-punch plugin has to be modified (bad practice).).\r\n     *   If anyone knows how to resolve this in a different way, please let me know. \r\n     * \r\n     * @param {*} err \r\n     */\r\n    requirejs.onError = function (err) {\r\n\r\n        // Module timeout. Ask the user to refresh.\r\n        if (err.requireType === 'timeout') {\r\n            if (Adapt.ddLoading) {\r\n                Adapt.ddLoading.showError(\"Load timeout.\");\r\n            }\r\n            throw err;\r\n        }\r\n        // Any other kind of error. Throw an error as normal. \r\n        else {\r\n            throw err;\r\n        }   \r\n    };\r\n    //#endregion\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    'core/js/models/componentModel',\r\n], function(Handlebars, Adapt, ComponentModel) {\r\n\r\n    /**\r\n     * adapt-dd-helpers\r\n     * --------------------------------------\r\n     * Defines Handlebars helpers for inline Adapt content commonly used in DD learning material.\r\n     * \r\n     * ! All function header parameters are optional unless otherwise specified !\r\n     * \r\n     * WARNING:\r\n     * --------\r\n     * - If any HTML inside of a helper using createHelperCallback has custom scripts / events applied to it before the helper's\r\n     *   debounce re-renders it, then they WILL BE REMOVED (due to the HTML context being re-rendered).\r\n     * \r\n     * TODO:\r\n     * - \r\n     * \r\n     * FIXME:\r\n     * - \r\n     */\r\n\r\n    /**\r\n     * This object will contain the data for all elements created with registerHelperEl.\r\n     * This is used to allow for a way to process duplicate \".registerhelperel__placeholder\" elements,\r\n     * which sometimes occur when using the helperEl function inside of notify:popups.\r\n     */\r\n    const helperElAttr = \"data-registerhelperel-id\";\r\n    let helperElData = {};\r\n\r\n    /**\r\n     * Used by the helper functions to translate expression parameters into an easy to use object.\r\n     * Returns an extended context.hash object.\r\n     * Be SURE to only call with getContextHash.apply(this, arguments);\r\n     * @param {*} args The arguments object for the specific helper function.\r\n     */\r\n    function getContextHash(args) {\r\n        \r\n        // In Handlebars, the context is always the last parameter.\r\n        let context = arguments[arguments.length-1];\r\n\r\n        // Parse certain string values in the expression parameters.\r\n        context.hash = _.mapObject(context.hash, (val, key) => {\r\n            \r\n            // Boolean\r\n            if (val == \"true\") return true;\r\n            if (val == \"false\") return false;\r\n\r\n            // Fallback\r\n            if (val === undefined) return false;\r\n\r\n            // Relaxed JSON object (EXPERIMENTAL).\r\n            // Allow for strings like this to be used:\r\n            // xxx=\"{prop1:'A', prop2:true}\"\r\n            // xxx=\"{'prop1':'A', 'prop2':true}\"\r\n            //\r\n            // FIXME: Will not work if the variables provided have a '-' in their key.\r\n            if (val[0] == \"{\" && val[val.length-1] == \"}\") {\r\n\r\n                // UPDATE: Using negative lookbehind (?<!) in a regex will NOT work in Safari.\r\n                // To fix this, the following workaround is used:\r\n                // - The string is scanned for all escaped quotes (/', ///\", etc.), and those quotes are replaced with a placeholder.\r\n                // - The main regex is used to find and wrap all property keys with ''.\r\n                // - The placeholdered quotes are replaced with normal quotes again.\r\n                const SQUOT_PLACEHOLDER = \"@@!_S_!@@\";\r\n                const DQUOT_PLACEHOLDER = \"@@!_D_!@@\";\r\n                val = val.replace(/([^\\\\]\\\\(?:\\\\{2})*)(['\"])/g, (match, $1, $2) => {\r\n                    return $1 + ($2 === \"'\" ? SQUOT_PLACEHOLDER : DQUOT_PLACEHOLDER);\r\n                });\r\n\r\n                let regex = new RegExp(/(['\"]?)([\\w-]*)(\\1)\\s*?:\\s*?((['\"]).*?(\\5)|(\\w+))/g);\r\n                \r\n                // For each key + value, ensure the key is surrounded by quotes\r\n                // (for the JSON parsing that takes place after this step).\r\n                val = val.replace(regex, (match, $1, $2, $3, $4) => {\r\n                    // $1: Left side quote (if any).\r\n                    // $2: Key\r\n                    // $3: Right side quote (if any).\r\n                    // $4: Value\r\n                    \r\n                    // If the key isn't surrounded by quotes, surround it with quotes.\r\n                    if (!$1) return `'${$2}': ${$4}`; \r\n\r\n                    // Replace all placeholders in the value with the real quotes that they were.\r\n                    $4 = $4.replace(new RegExp(SQUOT_PLACEHOLDER, 'g'), \"'\");\r\n                    $4 = $4.replace(new RegExp(DQUOT_PLACEHOLDER, 'g'), '\"');\r\n\r\n                    // Otherwise, leave it as is.\r\n                    return match;\r\n                });\r\n            }\r\n\r\n            // JSON object (EXPERIMENTAL).\r\n            // Must be formatted like this:\r\n            // xxx=\"{'prop1':'A','prop2':true}\"\r\n            // xxx=\"['A', 'B']\"\r\n            if (\r\n                (val[0] == \"{\" && val[val.length-1] == \"}\") ||\r\n                (val[0] == \"[\" && val[val.length-1] == \"]\")\r\n            ){\r\n                try {\r\n                    val = val.replace(/[']/g, '\"'); // Parsing JSON requires \"\" to be used.\r\n                    return JSON.parse(val);\r\n                }\r\n                catch(err) {\r\n                    throw \"adapt-dd-helpers could not parse string as JSON: \" + val;\r\n                }\r\n            }\r\n\r\n            return val;\r\n        });\r\n\r\n        // Add the expression's content to the object too.\r\n        context.hash.content = context.fn ? context.fn(this) : \"\";\r\n\r\n        return context.hash;\r\n    }\r\n\r\n    // Helpers\r\n    // ---------------------\r\n    // Hardcoded for DD functionality.\r\n\r\n    var helpers = {\r\n\r\n        /**\r\n         * Can be used as follows:\r\n         * {{#otherhelper class=(concat \"hotgraphicflip__image\" ../_itemSizing._itemClasses)}}{{/otherhelper}}\r\n         * \r\n         * Note: will NOT add \" \" between each joined string.\r\n         * @returns \r\n         */\r\n        concat: function() {\r\n            var arg = Array.prototype.slice.call(arguments,0);\r\n            arg.pop();\r\n            return arg.join('');\r\n        },\r\n\r\n        // Partials\r\n        // --------------------------\r\n        // These can be used to create complex parameters for the expressions below.\r\n        // Example: {{#figure sizing=(arr 4 true)}}{{/figure}}\r\n\r\n        /**\r\n         * (Partial) returns an array made from the parameters.\r\n         */\r\n        arr: function() {\r\n            return Array.from(arguments);\r\n        },\r\n\r\n        // Main helpers\r\n        // --------------------------\r\n\r\n        /**\r\n         * Creates a NON-SELETABLE Zero-Width-Space.\r\n         * Used rarely when certain text is needed to wrap.\r\n         * \r\n         * Note: you may need \"word-break: break-word;\" on the parent element for it to work.\r\n         */\r\n        zws: function() {\r\n\r\n            let data = getContextHash.apply(this, arguments);\r\n            return `<span class='u-no-select'></span>`;\r\n        },\r\n\r\n        /**\r\n         * Creates a normal hyperlink.\r\n         * \r\n         * @param {string} hash.href (Optional) specify the href. If not provided, will use the content instead.\r\n         * @param {Boolean} hash.ref (Optional) If true, will wrap the hyperlink in &lt; and &gt; (reference tags).\r\n         */\r\n        hyperlink: function() {\r\n\r\n            let data = getContextHash.apply(this, arguments);\r\n\r\n            data.content = data.content.trim();\r\n\r\n            let html = Handlebars.templates[\"ddHyperlink\"](data);\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /**\r\n         * Creates a download link to a local / external URL.\r\n         * \r\n         * EPUB MODE:\r\n         * ------------------------------------\r\n         * If the content is in _isEpub mode, all local download links will be re-directed\r\n         * to an external hosting server.\r\n         * This is done due to some EPUB readers not supporting local links to files (inside the .EPUB zip itself).\r\n         * \r\n         * FIXME:? will interpret \"www.*.com\" as local due to lack of http* prefix (href should never have values like\r\n         * this provided regardless though).\r\n         */\r\n\r\n        /** Phone link */\r\n        tel: function() {\r\n            \r\n            let data = getContextHash.apply(this, arguments);\r\n\r\n            let html = Handlebars.templates[\"ddTel\"](data);\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /**\r\n         * Keyboard key\r\n         * ------------\r\n         * Makes the content resemble a keyboard key. Should be used when instructing users on what keyboard keys to press.\r\n         */\r\n        kbd: function() {\r\n            let data = getContextHash.apply(this, arguments);\r\n            let html = Handlebars.templates[\"ddKbd\"](data);\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /** Clearfix */\r\n        clearfix: function() {\r\n\r\n            let data = getContextHash.apply(this, arguments);\r\n\r\n            let html = Handlebars.templates[\"ddClearfix\"](data);\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /**\r\n         * Inline icons\r\n         * ---------------------------------\r\n         * Creates either a font icon (using Adapt's default icon font),\r\n         * or an embedded inline image.\r\n         * \r\n         * @param {string} type             Faster way of writing \"type='type'\".\r\n         * @param {string} context.type     The name of the font icon to use.\r\n         * @param {string} context.src     [OPTIONAL]: Use an inline <img> with the provided src instead of an icon. \r\n         */\r\n        inlineIcon: function(type) {\r\n\r\n            let context = arguments[arguments.length-1];\r\n\r\n            // Get icon type:\r\n            let iconType = typeof type === \"string\" ? type : context.hash.type;\r\n\r\n            // Check that either iconType or src are defined.\r\n            if (!iconType && !context.hash.src) throw \"{{{#icon}}}: Must have a defined \\\"type\\\" or \\\"src\\\" property.\";\r\n\r\n            let data = _.extend(context.hash, {\r\n                \"iconClass\": \"icon-\" + iconType\r\n            });\r\n\r\n            let html = Handlebars.templates[\"ddIcon\"](data);\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /* Blockquote */\r\n        blockquote: function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n\r\n            let html = Handlebars.templates[\"ddBlockquote\"](_.extend(context.hash, {content: context.fn(this)}));\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /**\r\n         * Paper block (decorative).\r\n         * \r\n         * @param {string} context.class [OPTIONAL]: CSS classes.\r\n         * @param {string} context.style [OPTIONAL]: Different visual styles: \"\" | \"steps\" \r\n         */\r\n        paper: function() {\r\n            let context = arguments[arguments.length-1];\r\n            let html = Handlebars.templates[\"ddPaper\"](_.extend(context.hash, {content: context.fn(this)}));\r\n            return new Handlebars.SafeString(html);\r\n        },\r\n\r\n        /**\r\n         * Used to create inline error icons (similar to how comments are placed in a Word document).\r\n         * These expressions are debug only, and MUST be removed prior to publishing the content.\r\n         * @param {*} options \r\n         */\r\n        error: function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n\r\n            Adapt.log.error(\"Page has {{#error}} tag present.\");\r\n\r\n            let html = Handlebars.templates[\"ddError\"](_.extend(context.hash, {content: context.fn(this)}));\r\n            return new Handlebars.SafeString(html);\r\n        }\r\n\r\n    };\r\n\r\n    for (var name in helpers) {\r\n        if (helpers.hasOwnProperty(name)) {\r\n            Handlebars.registerHelper(name, helpers[name]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * registerHelperEl\r\n     * ------------------------\r\n     * Modified version of Handlebars.registerHelper.\r\n     * Helpers registered with this function will be able to return $el and el element objects instead of just HTML strings.\r\n     */\r\n    let registeredHelperEls = [];\r\n\r\n    /**\r\n     * Trigger a callback once a placeholder element has been rendered with Handlebars.\r\n     */\r\n    function observePlaceholderRender(placeholderAttrId, el, callback){\r\n\r\n        // Store the data.\r\n        helperElData[placeholderAttrId] = el;\r\n\r\n        let mutationObserver;\r\n\r\n        // Timeout\r\n        // --------------------------------------------------\r\n        // If the observer doesn't detect a mutation within this time, throw an error.\r\n        // (If everything is running correctly, the observer should have detected the mutation almost immediately after starting).\r\n        const OBSERVER_TIMEOUT = 1000;\r\n        let observerTimeout = setTimeout(() => {\r\n\r\n            let $placeholder = $(\"[\" + helperElAttr + \"='\"+ placeholderAttrId + \"']\");\r\n            if ($placeholder.length) {\r\n                Adapt.log.error(\"registerHelperEl: Could not be rendered into its placeholder element: [\" + helperElAttr + \"='\"+ placeholderAttrId + \"']\\nMutationObserver could not detect the placeholder being rendered.\", $placeholder);\r\n            }\r\n            else {\r\n                Adapt.log.warn(\"registerHelperEl: Could not be rendered into its placeholder element.\\nThis was likely caused by the placeholder being incorrectly rendered as an attribute value.\", );\r\n            }\r\n\r\n            mutationObserver.disconnect();\r\n\r\n            // FIXME: Is there a good way of preventing these placeholders being added inside of attribute values?\r\n        }, OBSERVER_TIMEOUT);\r\n\r\n        // Main\r\n        // --------------------------------------------------\r\n        mutationObserver = new MutationObserver((mutations) => {\r\n\r\n            //mutationsCount++;\r\n\r\n            _.each(mutations, (mutation) => {\r\n                if (mutation.type != \"childList\") return;\r\n                \r\n                _.find(mutation.addedNodes, (node) => {\r\n                    if (!node) return;\r\n\r\n                    // Placeholder element found. Stop the mutationObserver and call the callback.\r\n                    let placeholderEl;\r\n                    try {\r\n                        placeholderEl = node.querySelector(\"[\" + helperElAttr + \"='\"+ placeholderAttrId + \"']\");\r\n                        // If the placeholder is still undefined, check if the node itself it the cause of the mutation.\r\n                        if (!placeholderEl) {\r\n                            if (node.getAttribute(helperElAttr) == placeholderAttrId) {\r\n                                placeholderEl = node;\r\n                            }\r\n                        }\r\n                    }\r\n                    catch (err) {\r\n                        placeholderEl = false;\r\n                    }\r\n                    if (placeholderEl) {\r\n                        clearTimeout(observerTimeout);\r\n                        mutationObserver.disconnect();\r\n\r\n                        let $el = $(el);\r\n                        $(placeholderEl).replaceWith($el);\r\n\r\n                        if (callback) {\r\n                            callback($el);\r\n                        }\r\n\r\n                        return true;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        // FIXME: observing the entire body may cause slowdown.\r\n        mutationObserver.observe($(\"body\")[0], {\r\n            childList: true,\r\n            subtree: true\r\n        });\r\n\r\n        // Notify fallback:\r\n        // ----------------\r\n        // EDIT: Replaced with manual calls to Handlebars.updatePlaceholders.\r\n        /*Adapt.on(\"notify:opened\", (view) => {\r\n            \r\n            let $placeholder = view.$el.find(\"[\" + helperElAttr + \"='\"+ placeholderAttrId + \"']\");\r\n            if ($placeholder.length) {\r\n                let $el = $(el).clone();\r\n                $placeholder.replaceWith($el);\r\n            }\r\n        });*/\r\n    }\r\n\r\n    /**\r\n     * Re-used helperEl HTML fix:\r\n     * -------------------------------------------------------------------\r\n     * (Needs to be called manually).\r\n     * Looks through the $parentEl and replaces all placeholder elements generated with \"registerHelperEl()\" with\r\n     * CLONES of the \"el\" that are meant to be rendered there.\r\n     * \r\n     * Explanation:\r\n     * ------------\r\n     * - figurePopupView has a lightbox feature, which re-renders the same HTML from the main page inside of a notify:popup.\r\n     * - This breaks the helperEl, as it causes there to be two copies of the same .registerhelperel__placeholder being rendered,\r\n     *   and only the first one gets replaced by the \"el\", while the second remains a placeholder.\r\n     * - figurePopupView calls this function to have it scan through any .registerhelperel__placeholder elements that haven't\r\n     *   been replaced, and replace them with a clone of the original \"el\".\r\n     */\r\n    Handlebars.fixPlaceholders = ($parentEl) => {\r\n        let $placeholders = $parentEl.find(\".registerhelperel__placeholder\");\r\n        $placeholders.each((i, e) => {\r\n            let id = $(e).data(\"registerhelperel-id\");\r\n            $(e).replaceWith(helperElData[id].clone());\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * TODO: Allow for a way to return a custom placeholder element, and then append to that placeholder with callback later.\r\n     * \r\n     * @param {*} helperName \r\n     * @param {*} helperCallback        Called within the normal Handlebars.registerHelper. Must return an element.\r\n     * @param {*} postRenderCallback    [Optional] Gets called and passed the $el after it has replaced its placeholder.\r\n     */\r\n    Handlebars.registerHelperEl = (helperName, helperCallback, postRenderCallback) => {\r\n\r\n        // Only register each helper once.\r\n        if (_.includes(registeredHelperEls, helperName)) return;\r\n        if (!helperCallback) throw \"helperCallback must be defined\";\r\n\r\n        // Initially, render a placeholder element in Handlebars that will be replaced by the $el as soon as the mutation is observed.\r\n        Handlebars.registerHelper(helperName, function() {\r\n\r\n            let el = helperCallback.apply(this, Array.prototype.slice.call(arguments));\r\n\r\n            // If the \"el\" returned by the callback is a string, then behave like a regular Handlebars Helper\r\n            // (just render the string assuming that it's HTML; don't create and wait for a placeholder).\r\n            if (typeof el === \"string\") return el;\r\n\r\n            // Same goes for if it's a Handlebars SafeString.\r\n            if (el instanceof Handlebars.SafeString) return el;\r\n            \r\n            helperName = helperName.toLowerCase(); // Very important: ensure the attribute name is entirely lower case (for XHTML).\r\n\r\n            let _uniqueId = _.uniqueId(helperName);\r\n            let placeholderHTML = `<span class=\"registerhelperel__placeholder\" ${helperElAttr}=\"${_uniqueId}\">PLACEHOLDER(${helperName})</span>`;\r\n            \r\n            // Start a mutationObserver that will wait for the first childList mutation that includes the HTML which contains the placeholder element.\r\n            observePlaceholderRender(_uniqueId, el, postRenderCallback);\r\n\r\n            return placeholderHTML;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Finds the nearest view and returns it (if any).\r\n     * @param {*} helperContext \r\n     */\r\n    /*Handlebars.getViewFromContext = (helperContext) => {\r\n        let data = helperContext.data.root;\r\n        if (data.view) return data.view;\r\n\r\n        Adapt.log.error(`Could not find a View for helperContext:`, data);\r\n        throw \"\";\r\n    }*/\r\n\r\n    /**\r\n     * Finds and returns the componentModel belonging to the component that the Handlebars helper is placed in. \r\n     * @param {*} helperContext \r\n     */\r\n     Handlebars.getComponentModelFromContext = (helperContext) => {\r\n\r\n        let componentData = helperContext.data.root;\r\n        let model;\r\n        \r\n        // Check if the model object is an Adapt ComponentModel.\r\n        let isComponentModel = (m) => {\r\n            try {\r\n                if (\r\n                    m instanceof ComponentModel ||  // FIXME: Fails with ItemsComponentModels.\r\n                    m.get(\"_type\") === \"component\"  // Fallback if the above fails.\r\n                ) {\r\n                    //if (!(m instanceof ComponentModel)) console.log(m);\r\n                    return true;\r\n                }\r\n            }\r\n            catch (err) {\r\n                return false;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // First, try to find the nearest model by going through the \"view\" property.\r\n        // This works in most contexts (such as if the helper is in a component or a popup).\r\n        try {\r\n            model = componentData.view.model;\r\n            if (isComponentModel(model)) return model;\r\n        }\r\n        catch (err) {\r\n            // If the above fails, it's because the componentData has no view property.\r\n            // Treat the componentData as a model itself and try to continue.\r\n            model = componentData;\r\n        }\r\n\r\n        // Fallback:\r\n        // ---------\r\n        // If the context that the helper is in is NOT the componentModel, then attempt to traverse up the \"_parent\" ancestors until it\r\n        // is found. \r\n        const errMsg = `Could not find ComponentModel from provided Handlebars Helper context.\r\nSee the array below for the ancestors (\"_parent\"s) that were traversed.`;\r\n        let path = [];\r\n        do {\r\n            try {\r\n                path.push(model);\r\n\r\n                if (model instanceof Backbone.Model) {\r\n\r\n                    // Check if this model is the ComponentModel.\r\n                    if (isComponentModel(model)) break;\r\n\r\n                    // And go to its parent if it's not.\r\n                    model = model.getParent?.apply(model) || model.get(\"_parent\");\r\n                }\r\n                // Fallback in case the context is in a non-Backbone Model object.\r\n                // (This is not the component).\r\n                else {\r\n                    model = model._parent;\r\n                }\r\n            }\r\n            catch {\r\n                Adapt.log.error(errMsg, path);\r\n                throw \"\";\r\n            }\r\n\r\n        } while (Boolean(model));\r\n\r\n        if (!model) {\r\n            Adapt.log.error(errMsg, path);\r\n            throw \"\";\r\n        }\r\n\r\n        // Code should never reach this point.\r\n        return model;\r\n    }\r\n\r\n    /**\r\n     * Finds and returns the blockModel parent of the component that the Handlebars helper is placed in. \r\n     * @param {*} helperContext \r\n     */\r\n    Handlebars.getBlockModelFromContext = (helperContext) => {\r\n        let componentModel = Handlebars.getComponentModelFromContext(helperContext);\r\n        return componentModel.get(\"_parent\");\r\n    }\r\n\r\n    // Common\r\n    // -----------------------\r\n\r\n    /**\r\n     * Returns the HTML to create temporary element, then overrides it with the provided view after a debounce.\r\n     * See annotation extension implementation for an example.\r\n     * FIXME: If multiple helpers using createHelperCallback are nested within each other,\r\n     * then the debounces will stack (and cause postRender to trigger before all the content is ready)!\r\n     * @param {*} context       The last parameter of the calling helper.\r\n     * @param {string} name     The name of the calling helper\r\n     * @param {*} callback      Callback with parameters ($el, blockText, componentView).\r\n     */\r\n    let createHelperCallback = function(context, name, callback){\r\n        \r\n        Adapt.log.error(\"createHelperCallback has been depractated (had asynchronous bug). Use Handlebars.registerHelperEl instead.\");\r\n        throw \"\";\r\n\r\n        return placeholderHTML;\r\n    }\r\n    \r\n    Handlebars.createHelperCallback = createHelperCallback;\r\n    Handlebars.getComponentViewFromContext = (context) => {\r\n\r\n        Adapt.log.error(\"getComponentViewFromContext has been depractated (had asynchronous bug). Use Handlebars.getComponentModelFromContext instead.\");\r\n\r\n        let componentView = context.data.root.view;\r\n        if (componentView.model.get(\"_type\") != \"component\") {\r\n            componentView = Adapt.findViewByModelId(componentView.model.get(\"_parent\").get(\"_id\"));\r\n        }\r\n        return componentView || undefined;\r\n    }\r\n    Handlebars.getContextHash = getContextHash;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class ImgPopupView extends Backbone.View {\r\n\r\n        className() {\r\n\r\n            let classes = [\r\n                \"ddimg-popup\",\r\n                this.model.get(\"_classes\") || \"\"\r\n            ];\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setUpImgClasses();\r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpImgClasses() {\r\n\r\n            let lightbox = this.model.get(\"lightbox\");\r\n\r\n            let classes = [\r\n                \"ddimg-popup__img\",\r\n                \"ddimg-popup__size-\" + lightbox._width,\r\n                lightbox._backgroundEnabled ? \"has-bg\" : \"\"\r\n            ]\r\n\r\n            this.model.set(\"_imgClasses\", classes.join(\" \"));\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n            this.listenToOnce(Adapt, \"notify:closed\", this.onClosed);\r\n        }\r\n\r\n        onOpened() {\r\n            Adapt.scrollfix.disableA11yScroll();\r\n        }\r\n\r\n        onClosed() {\r\n            this.$el.addClass(\"is-closed\");\r\n            Adapt.scrollfix.enableA11yScroll();\r\n        }\r\n\r\n        remove() {\r\n            this.model.trigger(\"remove\");\r\n            super.remove();\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['ddImgPopup'];\r\n            this.$el.html(template(data));\r\n        }\r\n\r\n        // Allow for manually closing the popup.\r\n        closePopup() {\r\n            Adapt.trigger('notify:close');\r\n        }\r\n    };\r\n\r\n    return ImgPopupView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './imgPopupView'\r\n], function(Handlebars, Adapt, ImgPopupView) {\r\n\r\n    /**\r\n     * Renders an <img> with optional additional events attached.\r\n     */\r\n    class ImgView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"ddimg\",\r\n                this.model.get(\"content\").trim().length ? \"has-content\" : \"\",\r\n                this.model.get(\"lightbox\") ? \"has-lightbox\" : \"\",\r\n                this.model.get(\"_widthAuto\") ? \"is-auto-width\" : \"\",\r\n                this.model.get(\"class\") || \"\",\r\n                this.model.get(\"sizing\") || \"\"\r\n            ];\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                id: this.model.get(\"_id\"),                  // Completely unique ID (used by respImgView mostly).\r\n                name: this.model.get(\"name\") || undefined,\r\n                style: this.model.get(\"style\") || undefined // Allow for inline styles.\r\n            }\r\n        }\r\n\r\n        events() {\r\n            \r\n            let _events = {};\r\n\r\n            // Add a click event if using a lightbox.\r\n            if (this.model.get(\"lightbox\")) {\r\n                _events[\"click .js-ddimg-click\"] = \"onImgClick\";\r\n            }\r\n\r\n            return _events;\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setUpModelData();\r\n            this.render();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        setUpModelData() {\r\n            this.setUpLightboxData();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            \r\n            // Detect image loading errors, and add a class if it happens.\r\n            let $img = this.$(\".js-ddimg-img\");\r\n            $img.on(\"error\", () => {\r\n                this.$el.addClass(\"has-error\");\r\n                $img.addClass(\"has-error\");\r\n            });\r\n        }\r\n\r\n        setUpLightboxData() {\r\n            // Possible lightbox values and what they map to:\r\n            // true/false -----------> {_isEnabled: *}\r\n            // Number ---------------> {_isEnabled: true, _width: *}\r\n            // {_width:x, bg:true} --> {_isEnabled: true, _width: *, backgroundEnabled: *}\r\n            // {src: \"...\"} --> Specifies a different src to use inside the lightbox (instead of using the img's src by default).\r\n\r\n            let lightbox = this.model.get(\"lightbox\");\r\n            if (!lightbox) return;\r\n\r\n            // Use custom lightbox src; or use same src as the img if none specified.\r\n            const src = (!isNaN(lightbox) || !lightbox?.src) ? this.model.get(\"src\") : lightbox.src; \r\n\r\n            this.model.set(\"lightbox\", {\r\n                _isEnabled: true,\r\n                _width: !isNaN(lightbox) ? lightbox : (lightbox._width || \"auto\"),\r\n                src: src,\r\n                _backgroundEnabled: Boolean(lightbox.bg)\r\n            });\r\n        }\r\n\r\n        render(){\r\n            let template = Handlebars.templates['ddImg'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            // Legacy support\r\n            // --------------------------------------------------------------------------------------------\r\n            // FIXME: Remove once the topic which uses mark.has-shadow has been fixed.\r\n            // If the {{#img}} contains a .mark with .has-shadow, set its overflow to hidden.\r\n            if (this.$(\".mark.has-shadow\").length) {\r\n                this.$(\".ddimg__inner\").css(\"overflow\", \"hidden\");\r\n            }\r\n        }\r\n\r\n        onImgClick(event) {\r\n\r\n            // If two images are overlapping, only trigger the topmost event.\r\n            event.stopPropagation();\r\n\r\n            this.openLightbox();\r\n        }\r\n\r\n        openLightbox() {\r\n\r\n            if (!this.model.get(\"lightbox\")) return;\r\n\r\n            if (this._isPopupOpen) return;\r\n            this._isPopupOpen = true;\r\n            this.popupView = new ImgPopupView({\r\n                model: this.model\r\n            });\r\n    \r\n            Adapt.trigger(\"notify:popup\", {\r\n                _view: this.popupView,\r\n                _isCancellable: true,\r\n                _showCloseButton: true,\r\n                _classes: 'ddimg-lightbox dragscroll'// + (this.model.get('_classes') || \"\")\r\n            });\r\n\r\n            this.listenToOnce(Adapt, {\r\n                'popup:closed': this.onLightboxClosed\r\n            });\r\n        }\r\n\r\n        onLightboxClosed() {\r\n            this._isPopupOpen = false;\r\n        }\r\n    };\r\n\r\n    return ImgView;\r\n});\r\n","const { bind } = require(\"underscore\");\r\n\r\ndefine([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './imgView'\r\n], function(Handlebars, Adapt, ImgView) {\r\n\r\n    const MAX_RESIZE_ATTEMPTS = 5;\r\n    const RESIZE_BUFFER = 2; // Can go this many pixels outside the edges of the parent item (used to accomodate float rounding errors).\r\n\r\n    const HIDDEN_OBSERVER_DEBOUNCE = 500; \r\n\r\n    /**\r\n     * Renders an <img> with \"responsive\" textboxes overlayed over it.\r\n     */\r\n    class RespImgView extends ImgView {\r\n\r\n        className() {\r\n            let classes = super.className();\r\n            return classes + \" rimg\";\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.model.set(\"_isHidden\", false);\r\n            this._fontSizeMulti = 1;\r\n            super.initialize();\r\n        }\r\n\r\n        _areItemsOverflowing() {\r\n\r\n            let overflowing = false;\r\n\r\n            let $items = this.$(\".rimg__item\");\r\n            $items.each((i, e) => {\r\n\r\n                let $e = $(e);\r\n\r\n                // Deep clone to allow editing the properties.\r\n                let bb = _.extend({}, $e[0].getBoundingClientRect());\r\n\r\n                // If padding was added to the .rimg__item, factor it into the calculations.\r\n                let pTop = parseFloat($e.css(\"padding-top\"), 10);\r\n                let pLeft = parseFloat($e.css(\"padding-left\"), 10);\r\n                let pRight = parseFloat($e.css(\"padding-right\"), 10);\r\n                let pBottom = parseFloat($e.css(\"padding-bottom\"), 10);\r\n\r\n                bb.top += pTop;\r\n                bb.left += pLeft;\r\n                bb.width -= pLeft + pRight;\r\n                bb.height -= pTop + pBottom;\r\n\r\n                let bbInner = $e.find(\".rimg__item-inner\")[0].getBoundingClientRect();\r\n\r\n                if (\r\n                    (bb.top - bbInner.top) > RESIZE_BUFFER ||\r\n                    (bb.left - bbInner.left) > RESIZE_BUFFER ||\r\n                    (bbInner.bottom - bb.bottom) > RESIZE_BUFFER ||\r\n                    (bbInner.right - bb.right) > RESIZE_BUFFER\r\n                ) {\r\n                    // This item is overflowing its container.\r\n                    overflowing = $e;\r\n                    return false;\r\n                }\r\n            });\r\n\r\n            return overflowing;\r\n        }\r\n\r\n        // These listeners are specific to respImg, and need to be called at a different time to the parent ImgView's \"setUpEventListeners()\" function.\r\n        setUpRespImgEventListeners(){\r\n\r\n            $(\".rimg__img\").imageready(() => {\r\n                this.$el.addClass(\"is-ready\");\r\n            });\r\n\r\n            this.listenTo(Adapt, {\r\n                // The delay fixes a rare issues where the respImg may not re-size its text after a resize if within certain component items (HotgraphicMini).\r\n                'device:resize': _.debounce(this.onDeviceResize, 0).bind(this)\r\n            });\r\n\r\n            this.listenTo(this.model, \"change:_isHidden\", this.onHiddenChange);\r\n\r\n            // Detect if the language/html inside of the items changes.\r\n            let observer = new MutationObserver((event) => {\r\n                \r\n                this._fontSizeMulti = 1;    // Set the fontSizeMulti back to 1.\r\n                this.onDeviceResize();      // Trigger a recalculation of the main element's em value.\r\n\r\n                // Attempt to scale down the font X times to get it to fit.\r\n                let attempts = MAX_RESIZE_ATTEMPTS;\r\n                let $overflowingItem = null;\r\n                do {\r\n                    $overflowingItem = this._areItemsOverflowing();\r\n                    if ($overflowingItem) {\r\n                        this._fontSizeMulti -= 0.05;\r\n                        this.onDeviceResize();\r\n                    }\r\n                    else {\r\n                        Adapt.log.info(\"RespImg: text resized after \" + (MAX_RESIZE_ATTEMPTS - attempts) + \" attempts.\", this.$el);\r\n                        return;\r\n                    }\r\n                    attempts--;\r\n                } while (attempts > 0);\r\n\r\n                Adapt.log.warn(\"RespImg: text resize was unsuccessful after \" + MAX_RESIZE_ATTEMPTS + \" attempts.\", this.$el, $overflowingItem);\r\n            });\r\n            observer.observe(this.$(\".rimg__inner\")[0], {\r\n                subtree: true,\r\n                childList: true // When Google Translate activates, it adds <font> elements around the items.\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Ensure that at all times, the \"font-size\" property for the view is equal to:\r\n         * its current width / the svgs width (the size it was saved as).\r\n         */\r\n        onDeviceResize() {\r\n            this.recalculate();\r\n        }\r\n\r\n        recalculate() {\r\n            let width = this.$el.width();\r\n            let svgWidth = this.model.get(\"_svgWidth\") || 1;\r\n\r\n            let em = (width/svgWidth) * this._fontSizeMulti;\r\n            this.$el.css(\"font-size\", em + \"px\");\r\n        }\r\n\r\n        render(){\r\n            let template = Handlebars.templates['ddRespImg'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            this.renderItems();\r\n        }\r\n\r\n        // Whenever the view becomes un-hidden, re-calculate its content.\r\n        onHiddenChange(model, isHidden) {\r\n            if (isHidden) return;\r\n            this.onDeviceResize();\r\n            Adapt.log.info(\"respImgView: :visible event detected.\");\r\n        }\r\n\r\n        postRender() {\r\n            \r\n            // If the RespImgView starts off hidden after it's rendered, it will need to be resized once it becomes visible again.\r\n            this.model.set(\"_isHidden\", this.$el.is(\":hidden\"));\r\n\r\n            _.delay(() => {\r\n                this.recalculate();\r\n            }, 0);\r\n\r\n            /**\r\n             * Whenever this mutation is triggered, check if this view is hidden, and update the \"_isHidden\" value.\r\n             */\r\n            let callback = _.debounce(() => {\r\n                this.model.set(\"_isHidden\", this.$el.is(\":hidden\"));\r\n            }, HIDDEN_OBSERVER_DEBOUNCE);\r\n            \r\n            this._hiddenObserver = new MutationObserver(callback);\r\n\r\n            // Find the closes component or notify element.\r\n            let closestEl = this.$el.closest(\".component\")[0];\r\n            if (!closestEl) closestEl = this.$el.closest(\".notify\")[0];\r\n\r\n            this._hiddenObserver.observe(closestEl, {\r\n                attributes: true,\r\n                subtree: true\r\n            });\r\n        }\r\n\r\n        renderItems() {\r\n            \r\n            let jsonPath = this.model.get(\"src\").replace(/\\.svg$/, \".json\");\r\n\r\n            $.ajax({\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\turl: jsonPath,\r\n\t\t\t\tcache: true,\r\n\t\t\t\tsuccess: (data) => {\r\n\r\n                    this.model.set(\"_svgWidth\", data._width);\r\n                    this.model.set(\"_svgHeight\", data._height);\r\n\r\n                    // Render styles.\r\n                    let css = document.createElement('style');\r\n                    css.type = \"text/css\";\r\n                    let styles = \"\";\r\n                    _.each(data._styles, (props, className) => {\r\n                        styles += \"#\" + this.model.get(\"_id\") + \" \" + className + \"{\";\r\n                        _.each(props, (e, i) => {\r\n                            styles += i + \":\" + e + \";\";\r\n                        });\r\n                        styles += \"} \";\r\n                    });\r\n                    css.appendChild(document.createTextNode(styles));\r\n                    this.$el[0].appendChild(css);\r\n\r\n                    // Render items.\r\n                    _.each(data._items, (item) => {\r\n                        \r\n                        let $item = $(\"<div>\");\r\n                        $item.addClass(\"rimg__item\");\r\n                        $item.addClass(\"align-\" + (item.align || \"center\"));\r\n                        $item.css({\r\n                            top: item.top + \"%\",\r\n                            left: item.left + \"%\",\r\n                            width: item.width + \"%\",\r\n                            height: item.height + \"%\",\r\n                            transform: item.transform\r\n                        });\r\n                        let $itemInner = $(\"<div>\");\r\n                        $itemInner\r\n                            .attr(\"class\", item.class) // Apply any textbox classes to the INNER element\r\n                                                       //(so as to not affect the em sizing of the .rimg__item parent).\r\n                            .addClass(\"rimg__item-inner\")\r\n                            .html(item.html);\r\n                            \r\n                        this.$(\".rimg__inner\").append($item);\r\n                        $item.append($itemInner);\r\n                    });\r\n\r\n                    // Only start listening now.\r\n                    this.setUpRespImgEventListeners();\r\n\r\n                    // Initial calculation. Don't need to wait for SVG to load, as its width is dictated by external elements anyway.\r\n                    this.postRender();\r\n\t\t\t\t},\r\n\t\t\t\tfail: () => {\r\n\t\t\t\t\tthrow \"respImgView.js: Could not load \\\"\" + jsonPath + \"\\\".\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n        }\r\n    };\r\n\r\n    return RespImgView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './imgView',\r\n    './respImgView'\r\n], function(Handlebars, Adapt, ImgView, RespImgView) {\r\n\r\n    /**\r\n     * adapt-dd-img\r\n     * --------------------------------------\r\n     * Register a Handlebars helper for creating <img> elements.\r\n     * Will also automatically detect and implement any *--r.svg files as \"responsive images\". \r\n     * \r\n     * TODO: Allow the user to click and drag the img in the popup if it's scrolling horizontally.\r\n     */\r\n\r\n    // Helpers\r\n    // ---------------------\r\n\r\n    Adapt.on('router:page', () =>{\r\n\r\n        Handlebars.registerHelperEl(\"img\", function() {\r\n\r\n            let data = Handlebars.getContextHash.apply(this, arguments);\r\n\r\n            // FIXME: Likely a temp name.\r\n\r\n            //data.content = data.context\r\n\r\n            if (!data.src) {\r\n                console.log(data);\r\n                throw \"{{#img}}: \\\"src\\\" parameter must be defined.\";\r\n            }\r\n\r\n            data.src = data.src.trim();\r\n\r\n            // Niche feature: allow removing max-width restrictions on the image.\r\n            // If the image's \"contain\" is set to false, then remove its max-width style.\r\n            // (Default value is \"contain\": true).\r\n            data._contain = data.contain === undefined ? true : Boolean(data.contain);\r\n\r\n            data._widthAuto = Boolean(data.src.match(/\\.svg$/i)) ? false : true; // If the image is not a .svg, give it width: auto (prevent it scaling above its original size);\r\n\r\n            data.sizing = data.sizing ? Adapt.sizing.getSizingClass(data.sizing) : \"\";\r\n\r\n            // Determine if this is a responsive image or not.\r\n            // At the moment, this is done by matching the filename to *--r.svg\r\n            // ----------------------------------------------------------------\r\n            // This is a responsive image.\r\n            if (data.src.match(/--r\\.svg$/)){\r\n                let modelJSON = _.extend({}, data, {\r\n                    _id: \"rimg-\" + _.uniqueId()\r\n                });\r\n                return new RespImgView({\r\n                    model: new Backbone.Model(modelJSON)\r\n                }).$el;\r\n            }\r\n\r\n            // This is a normal image.\r\n            // ------------------------------------------------------\r\n            let modelJSON = _.extend({}, data, {\r\n                \r\n            });\r\n            return new ImgView({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el;\r\n            \r\n            // DEFUNCT\r\n            // This is a normal image. Render it immediately.\r\n            let html = Handlebars.templates[\"ddImg\"](data);\r\n            return new Handlebars.SafeString(html).string;\r\n        });\r\n\r\n    });\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // FIXME: If the type is \"number\", the input field may perform unpredictably if the user types \"e\".\r\n    \r\n    class InputFieldView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"inputfield\",\r\n                this.model.get(\"_isHintEnabled\") ? \"hint-enabled\" : \"\"\r\n            ];\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                name: this.model.get(\"_name\"),\r\n                \"data-inputfield-id\": this.model.get(\"_id\")\r\n            }\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                'focus .js-inputfield-input':   'onFocus',\r\n                'blur .js-inputfield-input':    'onBlur',\r\n\r\n                'change .js-inputfield-input':  'onInputChange',\r\n                'keyup .js-inputfield-input':   'onInputChange',\r\n                'click .js-inputfield-incorrect-icon':   'onIncorrectIconClick',\r\n                'click .js-inputfield-hint-icon':   'onHintIconClick'\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.setUpInputAttributes();\r\n            this.render();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        /**\r\n         * Set the attributes that the <input> element will used based on the model's _type.\r\n         */\r\n        setUpInputAttributes() {\r\n\r\n            let type = this.model.get(\"_type\");\r\n            let attr = {};\r\n\r\n            switch (type) {\r\n\r\n                case \"number\":\r\n                    attr.type = \"number\";\r\n                    attr.step = \"any\";\r\n                    attr.pattern = \"[-+]?[0-9]*[.,]?[0-9]+\";\r\n                    break;\r\n\r\n                case \"text\":\r\n                    attr.type = \"text\";\r\n                    break;\r\n\r\n                default:\r\n                    attr.type = \"text\";\r\n                    Adapt.log.error(`{{#inputField}}: \"${type}\" is not a valid value for the \"type\" attribute of an <input> element! Defaulting to input type: \"text\".`);\r\n            }\r\n\r\n            this.model.set(\"_inputAttributes\", attr);\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(this.model, \"change:_isSubmitted\", this.onIsSubmittedChange);\r\n            this.listenTo(this.model, \"change:_isCorrect\", this.onIsCorrectChange);\r\n            this.listenTo(this.model, \"change:_isLocked\", this.onIsLockedChange);\r\n            this.listenTo(this.model, \"change:_isHintEnabled\", this.onIsHintEnabledChange);\r\n\r\n            this.listenTo(this.model, \"change:_isFocused\", this.onIsFocusedChange);\r\n            this.listenTo(this.model, \"change:_val\", this.onValChange);\r\n        }\r\n\r\n        onIsSubmittedChange(model, isSubmitted) {\r\n            if (!isSubmitted) {\r\n                this.$el.removeClass(\"is-correct is-incorrect\");\r\n            }\r\n            else {\r\n                let isCorrect = this.model.get(\"_isCorrect\");\r\n                this.$el\r\n                    .toggleClass(\"is-correct\", isCorrect)\r\n                    .toggleClass(\"is-incorrect\", !isCorrect);\r\n            }\r\n        }\r\n\r\n        onIsLockedChange(model, isLocked) {\r\n            this.$(\".js-inputfield-input\").prop(\"disabled\", isLocked);\r\n        }\r\n\r\n        onFocus() {\r\n            this.model.set(\"_isFocused\", true);\r\n        }\r\n\r\n        onBlur() {\r\n            this.model.set(\"_isFocused\", false);\r\n        }\r\n\r\n        onIsFocusedChange(model, isFocused) {\r\n            this.$el.toggleClass(\"is-focused\", isFocused);\r\n        }\r\n\r\n        onValChange(model, val) {\r\n            this.$el.toggleClass(\"has-val\", Boolean(val.length));\r\n            this.$(\".js-inputfield-input\").attr(\"title\", val);\r\n        }\r\n\r\n        onIsCorrectChange(model, isCorrect) {\r\n            if (!this.model.get(\"_isSubmitted\")) return;\r\n            \r\n            this.$el\r\n                .toggleClass(\"is-correct\", isCorrect)\r\n                .toggleClass(\"is-incorrect\", !isCorrect);\r\n        }\r\n\r\n        onIncorrectIconClick(event) {\r\n            this.reset();\r\n        }\r\n\r\n        onIsHintEnabledChange(model, isHintEnabled) {\r\n            this.$el.toggleClass(\"hint-enabled\", isHintEnabled);\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            \r\n            var template = Handlebars.templates['inputField'];\r\n            this.$el.html(template(data));\r\n\r\n            this.$(\".js-inputfield-placeholder\").css({\r\n                \"min-width\": this.model.get(\"_width\") + \"em\" // Using min-width allows the textinput to be wider if its placeholder is.\r\n            });\r\n        }\r\n\r\n        reset(){\r\n            let $input = this.$(\".js-inputfield-input\");\r\n            $input.val(\"\");\r\n            $input.trigger(\"change\"); // Important to trigger an event change; in case other scripts are listening for it.\r\n            this.model.reset();\r\n        }\r\n\r\n        // Update model values whenever the input changes.\r\n        onInputChange(event) {\r\n            let $input = this.$(\"input\");\r\n            this.model.set(\"_val\", $input.val()); // If the input the user types is too long, it will be cut off (and ... added).\r\n                                                  // Set the \"title\" attribute to the unabridged input (allowing them a way to see the full thing).\r\n        }\r\n\r\n        onHintIconClick() {\r\n            this.showAnswer();\r\n        }\r\n\r\n        /**\r\n         * Set the value of the input element to that of the first element in the _answers array. \r\n         */\r\n        showAnswer() {\r\n            let $input = this.$(\"input\");\r\n            $input.val(this.model.getCorrectAnswer());\r\n            $input.trigger(\"change\"); // Important to trigger an event change; in case other scripts are listening for it.\r\n        }\r\n    }\r\n\r\n    return InputFieldView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * This extension creates a jQuery plugin that can be used to set up <input type=\"text\"> elements to consistant\r\n     * DD standards.\r\n     * \r\n     * This extension is used currently by adapt-textinputplus, but may be used again in future for other components / extensions.\r\n     * \r\n     * InputField groups:\r\n     * ------------------\r\n     * Sometimes, you may need to have multiple inputFields which allow for interchangeable values between them; so long as there's\r\n     * no double up.\r\n     * \r\n     * Example: four inputFields, and any of these user inputs are considered correct:\r\n     * \r\n     * \"A\", \"B\", \"C\", \"D\"\r\n     * \"D\", \"B\", \"C\", \"A\",\r\n     * \"D\", \"A\", \"B\", \"C\"\r\n     * \r\n     * HOWEVER, the following would still have one inputField be incorrect:\r\n     * \r\n     * \"A\", \"A\", \"B\", \"C\"\r\n     * \r\n     * InputFields weren't originally set up with this functionality; but I've added some code below that has made it possible.\r\n     * It may be a bit confusing, so here's an explanation on how it works.\r\n     * \r\n     * InputField groups explanation:\r\n     * ------------------------------\r\n     * Whenever an inputField in a GROUP checks whether the answer within it is correct; it first checks if any inputFields that\r\n     * came before it (and are in the same group) ALSO have that value.\r\n     * \r\n     * For example:\r\n     * \r\n     * \"A\", \"A\", \"B\", \"C\"\r\n     * \r\n     * In the above, the SECOND inputField would be incorrect, while the FIRST would be correct, despite \"A\" being in both of their\r\n     * \"_answers\" arrays.\r\n     * \r\n     * The SECOND inputField can still become correct if the FIRST one's values changes:\r\n     * \r\n     * \"D\", \"A\", \"B\", \"C\"\r\n     * \r\n     * Meaning that grouped inputFields are able to change states when their SIBLINGS change states too.\r\n     * (Or they would, but that feature is TBA).\r\n     * \r\n     * In a similar way, when a grouped InputField needs to reveal its answer, it picks the first value in its \"_answers\" array that none\r\n     * of its other siblings are currently using.\r\n     * \r\n     * In addition to all of this, if the \"_answers\" array is [\"A\", \"A\", \"B\", \"C\"], then the following user input:\r\n     * \r\n     * \"A\", \"B\", \"A\", \"A\"\r\n     * \r\n     * Would have the first three inputFields be correct, and the last one be incorrect. A.k.a, duplicate answers are also allowed.\r\n     * \r\n     * \r\n     * InputField groups FIXME:\r\n     * ------------------------\r\n     * - Currently, sibling inputFields don't listen for changes to their other siblings.\r\n     *   (Enter a duplicate value, then remove the first instance of that value. Despite now being correct, the latter value will\r\n     *   still be red until interacted with).\r\n     *   (This is not an issue for inputFields which don't auto-submit; like those in Questions).\r\n     * \r\n     * - When making inputField groups, the developer has to make sure that ALL of them have the exact same \"_answers\" array set.\r\n     *   There could be unforseen bugs if the \"_answers\" array differs between the inputFields in a group.\r\n     */\r\n\r\n    class InputFieldModel extends Backbone.Model {\r\n\r\n        defaults(){\r\n            return {\r\n                // Public settings (set when creating model)\r\n                // ------------------------------------\r\n\r\n                // Required\r\n                _answers: [],           // Array of acceptable answers.\r\n\r\n                // Optional\r\n                _requireSubmit: true,   // If false, will check user answer immediately whenever the value changes.\r\n                                        // If true, will only change states when the submit function is called.\r\n\r\n                _canShowMarking: true,  // If false, will not apply .is-correct / .is-incorrect styles to the element.\r\n                _isHintEnabled: false,  // If false, the hint icons will only appear after enableHint() is called.\r\n                                        // If true, the hint icon will always be visible.\r\n\r\n                _allowsAnyCase: true,\r\n                _allowsPunctuation: true,\r\n                _width: undefined,      // Explicitly set or automatically calculated width that this inputField will use.\r\n\r\n                // Private properties\r\n                // ------------------------------------\r\n                _val: \"\",               // Value in the input element.\r\n                _isCorrect: false,      \r\n                _isLocked: false,       // Don't allow interaction if locked.\r\n                \r\n                _isSubmitted: false,    // Don't show marking unless in a submitted state (unless _requireSubmit == false).\r\n                _incorrectUserAnswers: [],   // All incorrect user answers that have been explicitly submitted so far.\r\n\r\n                _submitCount: 0        // Number of times the field has checked the answer inside of it.\r\n            }\r\n        }\r\n\r\n        getAnswers() {\r\n            return this.get(\"_answers\");\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setUpWidth();\r\n            this.checkGroupError();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        /**\r\n         * The min-width of this inputfield will be based on the length of the longest allowed answer.\r\n         * (Or the explicitly set \"width\" value if it was used).\r\n         */\r\n        setUpWidth() {\r\n            let answerLength = 1;\r\n            let explicitWidth = this.get(\"_width\");\r\n\r\n            if (explicitWidth) {\r\n                answerLength = explicitWidth;\r\n            }\r\n            else {\r\n                _.each(this.get(\"_answers\"), a => {\r\n                    let s = a.toString();\r\n                    if (s.length > answerLength) answerLength = s.length;\r\n                });\r\n            }\r\n\r\n            this.set(\"_width\", answerLength);\r\n        }\r\n\r\n        /**\r\n         * If an inputField belongs to a group of inputFields, ensure that its \"_answers\" array is at least as big as the group.\r\n         * \r\n         * Note: This check is delayed to allow for all inputFields in the group to be made first.\r\n         * Since it's only purpose it to error check; the delay shouldn't cause any problems for other scripts.\r\n         */\r\n        checkGroupError() {\r\n\r\n            _.delay(() => {\r\n                let groupItems = this.getGroupItems();\r\n                if (!groupItems) return;\r\n\r\n                if (groupItems.length > this.get(\"_answers\").length) {\r\n                    throw `{{#inputField}}: inputField in group \"${this.get(\"_group\")}\" must have at least ${groupItems.length} possible answers (currently only has ${this.get(\"_answers\").length}).`;\r\n                }\r\n            }, 0);\r\n        }\r\n\r\n        setUpEventListeners(){\r\n            this.listenTo(this, \"change:_val\", this.onValChange);\r\n        }\r\n\r\n        onValChange(model, val){\r\n\r\n            // If this inputField requires submission, only check for the same incorrect answer being entered multiple times.\r\n            if (this.get(\"_requireSubmit\")) {\r\n\r\n                // This val has already been submitteed, and is incorrect.\r\n                // Turn the inputField red without submission.\r\n                if (this.checkAnswerInArray(this.get(\"_incorrectUserAnswers\"), val)) {\r\n                    this.set(\"_isCorrect\", false);\r\n                    this.set(\"_isSubmitted\", true);\r\n                }\r\n                else {\r\n                    this.set(\"_isCorrect\", false);\r\n                    this.set(\"_isSubmitted\", false);\r\n                }\r\n            }\r\n            // If this inputField automatically submits the answers, submit after each value change.\r\n            else {\r\n                this.submit();\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Checks the current _val and updates properties accordingly.\r\n         */\r\n        submit() {\r\n            \r\n            let val = this.get(\"_val\");\r\n\r\n            this.set(\"_submitCount\", this.get(\"_submitCount\") + 1);\r\n            let isCorrect = this.checkAnswerInArray(this.get(\"_answers\"), val);\r\n\r\n            // If the val === \"\" (and that isn't a correct answer), don't show a correct/incorrect state.\r\n            this.set(\"_isSubmitted\", val !== \"\" || isCorrect); \r\n            this.set(\"_isCorrect\", isCorrect);\r\n\r\n            /**\r\n             * If this inputField requires manual submission, store the user's incorrect answer.\r\n             * If they type it in again, turn the inputField red before they submit\r\n             * (prevents them submitting the same wrong answer multiple times).\r\n             */\r\n            if (!isCorrect && this.get(\"_requireSubmit\")) {\r\n                let iua = this.get(\"_incorrectUserAnswers\");\r\n                iua.push(val);\r\n\r\n                this.set(\"_incorrectUserAnswers\", _.uniq(iua));\r\n            }\r\n        }\r\n\r\n        reset() {\r\n            this.set(\"_isSubmitted\", false);\r\n            this.set(\"_isCorrect\", false);\r\n            this.set(\"_val\", \"\");\r\n        }\r\n\r\n        lock() {\r\n            this.set(\"_isLocked\", true);\r\n        }\r\n\r\n        unlock() {\r\n            this.set(\"_isLocked\", false);\r\n        }\r\n\r\n        enableHint() {\r\n            this.set(\"_isHintEnabled\", true);\r\n        }\r\n\r\n        disableHint() {\r\n            this.set(\"_isHintEnabled\", false);\r\n        }\r\n\r\n        enableRequireSubmit() {\r\n            this.set(\"_requireSubmit\", true);\r\n        }\r\n\r\n        getVal() {\r\n            return this.get(\"_val\");\r\n        }\r\n\r\n        isCorrect() {\r\n            return this.get(\"_isCorrect\");\r\n        }\r\n\r\n        isGrouped() {\r\n            return this.get(\"_group\") !== undefined;\r\n        }\r\n\r\n        /**\r\n         * Used by textInputPlus.\r\n         * \r\n         * If currently incorrect, always return -1.\r\n         * If grouped, returns the index of this model in the group.\r\n         * If un-grouped, returns the index of the first matched answer.\r\n         * \r\n         * FIXME: Un-tested with SCORM. Should work; but should be checked at some point.\r\n         */\r\n        getAnswerIndex() {\r\n\r\n            if (!this.isCorrect()) return -1;\r\n\r\n            // This inputField belongs to a group.\r\n            // Since the answers in the group can be entered in any order, instead return the index of this inputField in that group.\r\n            //\r\n            // Explanation: This is done so that, as far as the SCORM data is concerned, the user entered the values into the group\r\n            // using the default order.\r\n            let groupItems = this.getGroupItems();\r\n            if (groupItems) {\r\n                return groupItems.indexOf(this);\r\n            }\r\n\r\n            // This inputField is ungrouped. Find the first answer that it matches in the \"_answers\" array, and return it.\r\n            let idx = -1;\r\n            _.find(this.model.get(\"_answers\"), (a, i) => {\r\n                let isCorrect = this.compareVals(this.getVal(), a);\r\n                if (isCorrect) idx = i;\r\n                return isCorrect;\r\n            });\r\n\r\n            return idx;\r\n        }\r\n\r\n        /**\r\n         * Converts the value to a number and then returns it.\r\n         * If there's no value (\"\"), the default is 0.\r\n         * If the value isNaN(), an error is logged.\r\n         */\r\n        getNumber() {\r\n            let val = this.get(\"_val\");\r\n            \r\n            if (!val) return 0;\r\n            if (!isNaN(val)) return parseFloat(val);\r\n\r\n            Adapt.log.error(`inputFieldModel.getNumber(): value \"${val}\" is not a number. Fallback value of \"0\" used.`);\r\n            return 0;\r\n        }\r\n\r\n        /**\r\n         * These need to be gotten on the fly each time; as when this inputFieldModel is initially created; the others in its\r\n         * group may not exist yet (due to its index).\r\n         * @returns \r\n         */\r\n        getGroupItems() {\r\n            let group = this.get(\"_group\");\r\n            let groupItems = [this];\r\n\r\n            if (group !== undefined) {\r\n                groupItems = this.get(\"_parent\").get(\"_inputField\")._items.filter((itemModel) => {\r\n                    // Important to include self in the array.\r\n                    return itemModel.get(\"_group\") === group\r\n                });\r\n            }\r\n\r\n            return groupItems;\r\n        }\r\n\r\n        /**\r\n         * Returns true if both values equal each other; given the settings applied to this specific inputField.\r\n         * @param {*} val1 \r\n         * @param {*} val2 \r\n         */\r\n        compareVals(val1, val2) {\r\n            let type = this.get(\"_type\");\r\n            let decimals = this.get(\"_decimals\");\r\n\r\n            let v1 = this.cleanupUserAnswer(val1);\r\n            let v2 = this.cleanupUserAnswer(val2);\r\n\r\n            // If this is a number input, use number comparisson.\r\n            if (type == \"number\") {\r\n\r\n                // If the \"_decimals\" property was set, ensure that the user answer was to that many decimal points.\r\n                // (This can be easily achieved by just comparing the two numbers as strings instead).\r\n                if (decimals !== undefined) {\r\n                    return v1.toString() == v2.toString();\r\n                }\r\n\r\n                let num1 = parseFloat(v1);\r\n                let num2 = parseFloat(v2);\r\n\r\n                return num1 == num2;\r\n            }\r\n\r\n            return v1 == v2;\r\n        }\r\n\r\n        // Below functions copied from adapt-contrib-textinput/js/textinputModel\r\n        // ---------------------------------------------------------------------\r\n\r\n        checkAnswerInArray(arr, val) {\r\n\r\n            /**\r\n             * If this inputField belongs to a group; it will only ever be correct if the value entered into it is unique among the\r\n             * other values entered into the other inputFields in the group.\r\n             * \r\n             * FIXME: If the user enters \"A\" into inputField 1, and \"A\" into inputField 2, the latter will validate wrong (intentional).\r\n             * However, if they then remove \"A\" from inputField 1, inputField 2 will remain red; despite it now containing a unique value.\r\n             * This is only an issue for auto-submiting inputFields.\r\n             */\r\n            let group = this.get(\"_group\");\r\n            let groupItems = this.getGroupItems();\r\n\r\n            var uAnswer = this.cleanupUserAnswer(val);\r\n            var matched = arr.filter(function(cAnswer, idx) {\r\n                return this.compareVals(uAnswer, cAnswer);\r\n            }, this);\r\n        \r\n            let answerIsCorrect = matched && matched.length > 0;\r\n\r\n            /**\r\n             * If this inputField is in a group, then the answer can still be wrong if an EARLIER item in the group has the\r\n             * exact same answer.\r\n             */\r\n            if (answerIsCorrect && group !== undefined) {\r\n\r\n                // Count how many times the value entered appears in the \"_answers\" array.\r\n                let maxCorrect = matched.length;\r\n\r\n                // Starting from the beginning of the group, iterate through the inputFields until a maxCorrect number of myVals are found.\r\n                // If this model isn't found by then, then consider it wrong.\r\n                _.find(groupItems, (itemModel) => {\r\n\r\n                    // If itemModel is THIS model, and maxCorrect > 0, then consider it valid.\r\n                    if (itemModel == this) return true; \r\n\r\n                    // Otherwise, detract from maxCorrect.\r\n                    if (this.compareVals(itemModel.getVal(), this.getVal())) {\r\n                        maxCorrect--;\r\n                        \r\n                        // If that was the last inputFieldModel that could have had the value, consider this one incorrect.\r\n                        if (maxCorrect <= 0) {\r\n                            answerIsCorrect = false;\r\n                            return true;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (answerIsCorrect) this.set('_isCorrect', true);\r\n            return answerIsCorrect;\r\n        }\r\n\r\n        /**\r\n         * Returns the correct answer that this input needs (is _answers[0] by default; but if groups are used, this may change).\r\n         */\r\n        getCorrectAnswer() {\r\n\r\n            let answers = this.get(\"_answers\");\r\n            let group = this.get(\"_group\");\r\n\r\n            if (group === undefined) {\r\n                // Allow for empty _answers arrays to be used (for inputs which should be left intentionally blank).\r\n                // FIXME: Blank inputs not fully implemented yet.\r\n                return answers ? answers[0] : \"\";\r\n            }\r\n\r\n            // If in a group, find and return a value from the _answers array that none of the other inputFields in the group have. \r\n            let groupItems = this.getGroupItems();\r\n\r\n            // Go through each element in the answer array and find a unique groupItem which has it.\r\n            return _.find(answers, (a) => {\r\n\r\n                let matchingItem = _.find(groupItems, (itemModel) => {\r\n                    \r\n                    // Don't match self.\r\n                    if (itemModel === this) return false;\r\n\r\n                    return this.compareVals(itemModel.getVal(), a);\r\n                });\r\n                \r\n                // If no other inputFields in the group have this value. Return it.\r\n                if (!matchingItem) return true;\r\n\r\n                // Another inputField already has this value. Remove it from the groupItems being checked.\r\n                groupItems.splice(groupItems.indexOf(matchingItem), 1);\r\n            });\r\n        }\r\n        \r\n        cleanupUserAnswer(userAnswer) {\r\n            if (this.get('_allowsAnyCase')) {\r\n                userAnswer = userAnswer.toLowerCase();\r\n            }\r\n            if (this.get('_allowsPunctuation')) {\r\n                userAnswer = userAnswer.replace(/[\\.,-\\/#!$%\\^&\\*;:{}=\\-_`~()]/g, '');\r\n                //remove any orphan double spaces and replace with single space (B & Q)->(B  Q)->(B Q)\r\n                userAnswer = userAnswer.replace(/(  +)+/g, ' ');\r\n            }\r\n            // removes whitespace from beginning/end (leave any in the middle)\r\n            return $.trim(userAnswer);\r\n        }\r\n    }\r\n\r\n    return InputFieldModel;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * Regular expression for selecting the inputField names inside of the \"fn\" string.\r\n     * \r\n     * Example: \"(1 / ${i1}) * ${i2}\"\r\n     * $1: [\"${i1}\", \"${i2}\"]\r\n     * $2: [\"i1\", \"i2\"]\r\n     */ \r\n    const FN_REGEX = new RegExp(/(\\${([\\w-]*?)})/g);\r\n\r\n    class OutputFieldView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"outputfield\",\r\n                this.model.get(\"_hasError\") ? \"has-error\" : \"\"\r\n            ];\r\n\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.setUpModelData();\r\n            \r\n            this.render();\r\n            this.setUpEventListeners();\r\n\r\n            // Set the initial value + state.\r\n            this.updateResult();\r\n            this.updateValidationState();\r\n        }\r\n\r\n        /**\r\n         * It's important to set up the collection of InputFields that this view listens to HERE, and not in the OutputFieldModel.\r\n         * \r\n         * Reason: If this data was set up during the creation of the OutputFieldModel instead, there's a chance that not all\r\n         * InputFieldModels would be ready yet.\r\n         */\r\n        setUpModelData() {\r\n\r\n            // Get the function that this outputField will use for its calculations.\r\n            let fn = this.model.get(\"fn\"); // Example: \"(1 / ${i1}) * ${i2}\";\r\n            let allItems = this.model.get(\"_parent\").get(\"_inputField\")._items; // Reference to ALL inputFields in this block.\r\n\r\n            // Find the names of all inputFields this outputField will need to read.\r\n            let names = [];\r\n            fn.replace(FN_REGEX, (match, $1, $2) => { // No need to replace anything; we just need to iterate through all matched groups.\r\n                names.push($2);\r\n                return match;\r\n            });\r\n            \r\n            // Find all input fields of matching names.\r\n            let items = allItems.filter(item => {return names.indexOf(item.get(\"_name\")) >= 0; });\r\n            \r\n            // Create a new collection using only the InputFieldModels that this OutputField uses for its calculation.\r\n            this.model.set(\"_inputFields\", new Backbone.Collection(items));\r\n        }\r\n\r\n        setUpEventListeners() {\r\n\r\n            // Listen for changes to the parent BlockModel's \"_inputField._items\" collection Models.\r\n            this.listenTo(this.model.get(\"_inputFields\"), {\r\n                \"change:_val\" : this.onInputFieldValChange,\r\n                \"change:_isCorrect\" : this.onInputFieldStateChange\r\n            });\r\n\r\n            this.listenTo(this.model, \"change:result\", this.onResultChange);\r\n            this.listenTo(this.model, \"change:_hasError\", this.onHasErrorChange);\r\n            this.listenTo(this.model, \"change:_isVisited\", this.onIsVisitedChange);\r\n        }\r\n\r\n        onInputFieldValChange(inputFieldModel, val) {\r\n            this.updateResult();\r\n\r\n            // Consider this outputField \"visited\" once any of the inputFields that it monitors has been interacted with.\r\n            this.model.set(\"_isVisited\", true);\r\n        }\r\n\r\n        onIsVisitedChange(model, isVisited) {\r\n            this.$el.toggleClass(\"is-visited\", isVisited);\r\n        }\r\n\r\n        /**\r\n         * Whenever any inputField changes its state to correct/incorrect, check ALL inputFields this outputField references.\r\n         * Set the state of this outputField based on these values.\r\n         */\r\n        onInputFieldStateChange(inputFieldModel) {\r\n            this.updateValidationState();\r\n        }\r\n\r\n        /**\r\n         * If even a single InputField that this OutputField references is incorrect, set this OutputField to be incorrect too.\r\n         */\r\n        updateValidationState() {\r\n            \r\n            let isAnyIncorrect = Boolean(this.model.get(\"_inputFields\").find(inputField => {return !inputField.get(\"_isCorrect\");}));\r\n           \r\n            this.model.set(\"_isCorrect\", !isAnyIncorrect);\r\n            this.model.set(\"_isIncorrect\", isAnyIncorrect);\r\n\r\n            this.$el\r\n                .toggleClass(\"is-incorrect\", isAnyIncorrect)\r\n                .toggleClass(\"is-correct\", !isAnyIncorrect);\r\n        }\r\n\r\n        /**\r\n         * Recalculate the \"fn\" and update the .js-outputfield-result with the result.\r\n         */\r\n        updateResult() {\r\n\r\n            let fn = this.model.get(\"fn\");\r\n            let eqn = fn.replace(FN_REGEX, (match, $1, $2) => {\r\n\r\n                // Swap each $1 group with the value from its corresponding inputFieldModel.\r\n                // $1: \"${name}\"\r\n                // $2: \"name\"\r\n\r\n                let inputField = this.model.get(\"_inputFields\").find(inputField => {return inputField.get(\"_name\") == $2;});\r\n                if (!inputField) throw `OutputFieldView: could not find inputField with name: \"${$2}\"!\\n\\nfn: ${fn}`;\r\n\r\n                let val = inputField.getNumber();\r\n\r\n                return val;\r\n            });\r\n\r\n            // FIXME: eval() used (should be safe).\r\n            let result = eval(eqn);\r\n\r\n            // It's possible for the result to be \"Infinity\", or isNan(). If either, show \"N/A\" instead.\r\n            if (isNaN(result) || !isFinite(result)) {\r\n                this.model.set(\"result\", \"N/A\");\r\n                this.model.set(\"_hasError\", true);\r\n                return;\r\n            }\r\n\r\n            this.model.set(\"result\", result);\r\n            this.model.set(\"_hasError\", false);\r\n        }\r\n\r\n        onResultChange(model, result) {\r\n\r\n            let r = result;\r\n\r\n            // Round the result to X decimal places.\r\n            if (!isNaN(r)) r = parseFloat(r.toFixed(this.model.get(\"decimals\") || 0));\r\n\r\n            // If the result was rounded, indicate that it was by appending ... to it.\r\n            // TODO: Enable this? I don't think it's necessary.\r\n            //if (r != result) r += \"...\";\r\n\r\n            this.$(\".js-outputfield-result\").html(r);\r\n\r\n            // Update the \"title\" attribute of the container.\r\n            this.$(\".js-outputfield-content\").attr(\r\n                \"title\",\r\n                `${this.model.get(\"prefix\") || \"\"}${result}${this.model.get(\"suffix\") || \"\"}`\r\n            );\r\n        }\r\n\r\n        onHasErrorChange(model, hasError) {\r\n            this.$el.toggleClass(\"has-error\", hasError);\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            \r\n            var template = Handlebars.templates['outputField'];\r\n            this.$el.html(template(data));\r\n        }\r\n    }\r\n\r\n    return OutputFieldView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n\r\n    './inputFieldView',\r\n    './inputFieldModel',\r\n    \"./outputFieldView\"\r\n], function(\r\n    Adapt,\r\n\r\n    InputFieldView,\r\n    InputFieldModel,\r\n    \r\n    OutputFieldView) {\r\n\r\n    /**\r\n     * This extension creates a jQuery plugin that can be used to set up <input type=\"text\"> elements to consistant\r\n     * DD standards.\r\n     * \r\n     * This extension is used currently by adapt-textinputplus, but may be used again in future for other components / extensions.\r\n     * \r\n     * FIXME: Uses weird blend of custom jQuery plugin and Backbone. The jQuery plugin aspect should be removed in future.\r\n     * TODO: Remove the legacy versions.\r\n     */\r\n\r\n    //const pluginName = \"inputField\";\r\n\r\n    class InputFieldController extends Backbone.Controller {\r\n        \r\n        initialize() {\r\n            //this.setUpJQueryPlugin();\r\n            Adapt.on('router:page', this.setUpHelpers.bind(this));\r\n\r\n            // Dictionary of all inputFieldViews made so far.\r\n            // FIXME: Doesn't remove the references to them if they're deleted, but that happens very rarely.\r\n            // WARNING: Will not store references to duplicated inputField Views (like those that get cloned for notify:popups).\r\n            this._inputFieldViews = {};\r\n        }\r\n\r\n        // Legacy\r\n        // ------\r\n        // Used by adapt-textInputPlus.\r\n        /*setUpJQueryPlugin() {\r\n\r\n            // Register as a jQuery plugin.\r\n            $.fn[pluginName] = function(options) {\r\n                var args = Array.prototype.slice.call(arguments, 1);\r\n\r\n                return this.each(function(i) {\r\n                    var $this = $(this),\r\n                        data  = $this.data('plugin_' + pluginName);\r\n\r\n                    // Create a new instance.\r\n                    if (!data) {\r\n\r\n                        let model = new InputFieldLegacyModel(options);\r\n\r\n                        // Render the Handlebars template after the input.\r\n                        // Move the input element into the template,\r\n                        // then set the whole template to be the actual view.\r\n                        // This is done to preserve any other events that may have been placed on the original input prior to this plugin\r\n                        // rendering.\r\n                        var data = model.toJSON();\r\n                        var template = Handlebars.templates['inputFieldLegacy'];\r\n                        let $template = $(template(data));\r\n                        $this.after($template);\r\n\r\n                        $template.find(\".inputfield__input-container\").append($this);\r\n                        $this.addClass(\"inputfield__input js-inputfield-input\");\r\n\r\n                        let view = new InputFieldLegacyView({\r\n                            model: model,\r\n                            el: $template\r\n                        });\r\n                        data = model;\r\n                        $this.data('plugin_' + pluginName, data);\r\n                    }\r\n\r\n                    // Make it possible to access methods from public.\r\n                    // e.g `$element.rangeslider('method');`\r\n                    if (typeof options === 'string') {\r\n                        data[options].apply(data, args);\r\n                    }\r\n                });\r\n            };\r\n        }*/\r\n\r\n        findViewByModelId(id) {\r\n            return this._inputFieldViews[id];\r\n        }\r\n\r\n        findViewByEl(el) {\r\n            return this._inputFieldViews[$(el).attr(\"data-inputfield-id\")];\r\n        }\r\n\r\n        setUpHelpers() {\r\n\r\n            Adapt.stickyBlock?.addResetOnReRender(\"_inputField\");\r\n            let t = this;\r\n\r\n            // InputField\r\n            // ---------------------------------------------\r\n            Handlebars.registerHelperEl(\"inputField\", function() {\r\n\r\n                let context = arguments[arguments.length-1];\r\n                let data = Handlebars.getContextHash.apply(this, arguments);\r\n\r\n                // Find the componentModel that this Helper was placed in.\r\n                let componentModel = Handlebars.getComponentModelFromContext(context);\r\n                let name = data.name;\r\n                let id = _.uniqueId(\"inputfield\"); // Generate a uniqueId (used to get a reference to the model data).\r\n\r\n                // data.correct is a legacy value.\r\n                data.answers = data.answers || data.correct;\r\n\r\n                if (data.decimals && isNaN(data.decimals))\r\n                    throw `{{#inputField}}: \"decimals\" property must be a number (value given: ${decimals}).`;\r\n\r\n                let modelJSON = {\r\n\r\n                    _id: id,\r\n\r\n                    _parent: componentModel,\r\n                    _name: name,\r\n                    _group: data.group, // inputFields in the same group will only be correct if each of them has a UNIQUE answer entered into them.\r\n\r\n                    // Allows for custom HTML to be used for the placeholder.\r\n                    placeholder: data.content || data.placeholder || \"?\",\r\n\r\n                    // TODO: Have the data.type be determined automatically from the values provided if not specified.\r\n                    _type: data.type || \"number\", // The datatype that this input field will allow.\r\n\r\n                    // Provide an array of answers (even if only one answer is given).\r\n                    _answers: Array.isArray(data.answers) ? data.answers : [data.answers],\r\n\r\n                    // Allow for manually setting the width of the inputField.\r\n                    _width: data.width,\r\n\r\n                    // Defaults are for math.\r\n                    _allowsAnyCase:     data.allowsAnyCase || false,\r\n                    _allowsPunctuation: data.allowsPunctuation || false,\r\n                    _decimals:          data.decimals || undefined, // Force the answer to be to this many decimals.\r\n\r\n                    // Auto-check answers as soon as they're typed.\r\n                    _requireSubmit: false,\r\n\r\n                    // The hint icon should be enabled from the get-go.\r\n                    _isHintEnabled: true\r\n                }\r\n\r\n                let model = new InputFieldModel(modelJSON);\r\n\r\n                // Store this model in a collection, then assign/add to the collection in the parent ComponentModel.\r\n                // (if a {{#textOutput}} helper is present in same component, it will read from there).\r\n\r\n                //let blockModel = componentModel.getParent();\r\n                if (!componentModel.get(\"_inputField\")) {\r\n                    componentModel.set(\"_inputField\", {\r\n                        _items: new Backbone.Collection(null, {model: InputFieldModel})\r\n                    });\r\n                }\r\n                let inputFieldCollection = componentModel.get(\"_inputField\")._items;\r\n                inputFieldCollection.push(model);\r\n\r\n                // Check for duplicate names being used (only if a name is explicitly set).\r\n                if (name !== undefined) {\r\n                    if (inputFieldCollection.filter(inputField => {return inputField.get(\"_name\") == name;}).length > 1) {\r\n                        throw `{{#inputField}}: Duplicate names are not allowed (\"${name}\" name used more than once in block ${componentModel.getParent().get(\"_id\")}.`;\r\n                    }\r\n                }\r\n\r\n                let view = new InputFieldView({model: model});\r\n                if (t._inputFieldViews[id] === undefined) { // Only add if undefined (prevents cloned views being added...?)\r\n                    t._inputFieldViews[id] = view;\r\n                }\r\n                else {\r\n                    // I don't think this code is ever reached.\r\n                    Adapt.log.warning(`adapt-dd-inputField: duplicate {{#inputField}} detected: ${id}`);\r\n                }\r\n\r\n                return view.$el;\r\n            });\r\n\r\n            /**\r\n             * OutputField\r\n             * -----------\r\n             * \r\n             * Hash properties:\r\n             * @param {String} fn The function which will be executed to calculate the result. Example: \"(1 / ${i1}) * ${i2}\".\r\n             * @param {Number=2} decimals How many decimal places to round the result to.\r\n             */\r\n            Handlebars.registerHelperEl(\"outputField\", function() {\r\n\r\n                let context = arguments[arguments.length-1];\r\n                let data = Handlebars.getContextHash.apply(this, arguments);\r\n                \r\n                // TextOutput MUST have a defined fn.\r\n                if (!data.fn) throw \"{{#outputField}}: \\\"fn\\\" property must be defined!\";\r\n\r\n                // Find the componentModel that this Helper was placed in.\r\n                let componentModel = Handlebars.getComponentModelFromContext(context);\r\n                \r\n                data = _.extend({\r\n                    // Default values.\r\n                    decimals: 2 // Default to two decimal places.\r\n                },\r\n                data,\r\n                {_parent: componentModel});\r\n                \r\n                data._parent = componentModel;\r\n                \r\n\r\n                let model = new Backbone.Model(data);\r\n\r\n                /**\r\n                 * Important explanation:\r\n                 * ----------------------\r\n                 * - OutputField listens for changes to the parent BlockModel's _inputField._items collection.\r\n                 * - Both inputFields and outputFields are set up at the same time, so it's possible that at the time of the OutputField\r\n                 *   model's creation, not all inputFields are ready.\r\n                 * - This isn't an issue however, as the OutputField only starts listening for inputFields when its VIEW is created (we assume all InputFieldModels for the parent component are ready once the Views are being created). \r\n                 */\r\n\r\n                return new OutputFieldView({model: model}).$el;\r\n            });\r\n        }\r\n    }\r\n\r\n    Adapt.inputField = new InputFieldController();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * TODO:\r\n     * - Needs to detect (and show an error message) if the content fails to start (seems to be an issue with EPUB Bookshelf).\r\n     * - Needs to allow for adding a message above the loading GIF.\r\n     * \r\n     * - Once loaded, needs to change to a normal animation.\r\n     */\r\n\r\n    const OPACITY = 0.1;\r\n\r\n    class DDLoadingModel extends Backbone.Model {\r\n        \r\n        defaults() {\r\n            return {\r\n                \"_percentLoaded\": 0,\r\n                \"_hasLoaded\": false,\r\n                \"_hasError\": false,\r\n                \"text\": \"\" // Text which appears above the loading icon.\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n\r\n            this.initHelpers();\r\n\r\n            this.set(\"_componentsReady\", 0);\r\n\r\n            // The \"_isReady\" property is listened to instead of componentView:postRender, as the latter triggers a lot earlier than\r\n            // the former. \r\n            this.listenTo(Adapt.components, \"change:_isReady\", this.onComponentReadyChange.bind(this));\r\n            this.listenTo(Adapt, \"contentObjectView:postReady\", this.onLoaded.bind(this));\r\n        }\r\n\r\n        initHelpers() {\r\n\r\n            /**\r\n             * Register Handlebars helper.\r\n             */\r\n            var helpers = {\r\n\r\n                loadingIcon: function() {\r\n                    let context = arguments[arguments.length-1];\r\n                    var template = Handlebars.templates['ddLoadingIcon'];\r\n\r\n                    return template(context.hash);\r\n                }\r\n            }\r\n        \r\n            for (var name in helpers) {\r\n                if (!helpers.hasOwnProperty(name)) continue;\r\n                Handlebars.registerHelper(name, helpers[name]);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Once loaded, the loading graphic will change its appearance slightly.\r\n         * @param {*} contentObjectView \r\n         */\r\n        onLoaded(contentObjectView) {\r\n            this.set(\"_hasLoaded\", true);\r\n            this.clearText(); // Remove any custom text that was being shown during the loading phase.\r\n            /*if (this._debugCommentEl) {\r\n                this._debugCommentEl.remove();\r\n                this._debugCommentEl = null;\r\n            }*/\r\n        }\r\n\r\n        /**\r\n         * Whenever a component finishes rendering, update the percentage complete.\r\n         */\r\n        onComponentReadyChange(componentModel, _isReady) {\r\n            \r\n            let componentsReady = [];\r\n            Adapt.components.each((componentModel) => {\r\n                if (componentModel.get(\"_isReady\")) {\r\n                    componentsReady.push(componentModel);\r\n                }\r\n            });\r\n\r\n            let percentage = componentsReady.length / Adapt.components.length * 100;\r\n            this.set(\"_percentLoaded\", percentage);\r\n            \r\n            // FIXME: If there's a better way of communicating this in the debug (without a large amount of console.logs),\r\n            // please change to that.\r\n            // \r\n            // DEBUG: Render a hidden list of ready components inside of a comment (useful to determine if and which components\r\n            // aren't loading).\r\n            if (this._debugCommentEl) {\r\n                this._debugCommentEl.remove();\r\n                this._debugCommentEl = null;\r\n            }\r\n\r\n            let commentStr = ``;\r\n            Adapt.blocks.each(blockModel => {\r\n\r\n                commentStr += blockModel.get(\"_id\") + \" --- \";\r\n\r\n                let readyComponentCount = 0;\r\n                let waiting = [];\r\n                blockModel.getChildren().each((componentModel) => {\r\n                    let isReady = componentModel.get(\"_isReady\");\r\n                    if (isReady) readyComponentCount++;\r\n                    else waiting.push(componentModel.get(\"_id\"));\r\n                });\r\n                \r\n                commentStr += `${readyComponentCount}/${blockModel.getChildren().length}${waiting.length ? (\" [\" + waiting.join(\", \") + \"]\") : ''}\r\n`;\r\n            });\r\n\r\n            \r\n            this._debugCommentEl = document.createComment(`\r\nComponents loaded\r\n-----------------\r\n${commentStr}\r\n`);\r\n            document.body.appendChild(this._debugCommentEl);\r\n        }\r\n\r\n        setText(text) {\r\n            this.set(\"text\", text || \"\");\r\n        }\r\n\r\n        /**\r\n         * Shows the loading element with an error message over it.\r\n         * Used to communicate errors to the user that will require their own actions to fix (usually requiring them to refresh).\r\n         * @param {*} errorText \r\n         */\r\n        showError(errorText) {\r\n            $(\".js-loading\").show();\r\n\r\n            var template = Handlebars.templates['ddLoadingErrorText'];\r\n            this.set(\"text\", template({\r\n                text: errorText\r\n            }));\r\n            this.set(\"_hasError\", true);\r\n        }\r\n\r\n        clearText() {\r\n            this.set(\"text\", \"\");\r\n        }\r\n\r\n        /**\r\n         * Core Adapt doesn't have any inbuilt function for showing/hiding the loading element, instead it does this.\r\n         */\r\n        show() {\r\n            $(\".js-loading\").show();\r\n        }\r\n        hide() {\r\n            $(\".js-loading\").hide();\r\n        }\r\n    }\r\n\r\n    class DDLoadingView extends Backbone.View {\r\n\r\n        initialize() {\r\n\r\n            // As soon as possible, render the ddLoadingGraphic into the .js-loading element.\r\n            this.render();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(this.model, \"change:_percentLoaded\", this.onPercentLoadedChange.bind(this));\r\n            this.listenTo(this.model, \"change:_hasLoaded\", this.onHasLoadedChange.bind(this));\r\n            this.listenTo(this.model, \"change:_hasError\", this.onHasErrorChange.bind(this));\r\n            this.listenTo(this.model, \"change:text\", this.onTextChange.bind(this));\r\n        }\r\n\r\n        onHasErrorChange(model, hasError) {\r\n            this.$el.toggleClass(\"has-error\", hasError);\r\n        }\r\n        \r\n        /**\r\n         * Allow for custom messages to be shown during loading.\r\n         * @param {*} model \r\n         * @param {*} text \r\n         */\r\n        onTextChange(model, text) {\r\n            this.$(\".js-ddloading-text\").html(text);\r\n        }\r\n\r\n        /**\r\n         * Adapt sometimes briefly re-shows the loading element when it needs to load something on the fly.\r\n         * \r\n         * Change the appearance of the loading graphic from a progress animation with a %, to an infinitely looping spinning\r\n         * animation with no % (as that will be harder to calculate when rthings are loading on the fly).\r\n         */\r\n        onHasLoadedChange(model, hasLoaded) {\r\n            this.$(\".js-ddloading-graphic\").toggleClass(\"is-idle\", hasLoaded);\r\n            this.$(\".js-ddloading-img\").css(\"opacity\", \"\");\r\n        }\r\n\r\n        onPercentLoadedChange(model, percentLoaded) {\r\n\r\n            const o = 1 - OPACITY;\r\n            const graphicCount = 16; // How many images are a part of the graphic.\r\n            const segment = 100/graphicCount;\r\n\r\n            let idx = Math.floor(percentLoaded/segment);\r\n            let opacity = (1 - o) + o*((percentLoaded % segment)/segment);\r\n\r\n            // Set the opacity for the img index selected.\r\n            let $img = this.$(\".js-ddloading-img\").filter(\"[data-logo-index=\" + idx + \"]\");\r\n            $img.css(\"opacity\", opacity);\r\n\r\n            // Set the opacity to 1 for all img indexes prior to this one.\r\n            for (let i = 0; i < idx-1; i++) {\r\n                let $i = this.$(\".js-ddloading-img\").filter(\"[data-logo-index=\" + i + \"]\").css(\"opacity\", 1);\r\n            }\r\n            \r\n            // Update the percentage text.\r\n            this.$(\".js-ddloading-percent\").html(Math.floor(percentLoaded) + \"%\");\r\n        }\r\n        \r\n        render() {\r\n\r\n            // EDIT: Don't render anything.\r\n            // The \"dd-loading\" grunt task will insert the assets/dd-loading-html.html into the index.html/index.xhtml automatically. \r\n\r\n            /*var data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['ddLoading'];\r\n            this.$el.html(template(data));*/\r\n        }\r\n    }\r\n\r\n    Adapt.on(\"router:page\", () => {\r\n\r\n        let $loading = $(\".js-loading\").first();\r\n        $loading.addClass(\"ddloading\");\r\n\r\n        let model = new DDLoadingModel();\r\n        new DDLoadingView({\r\n            model: model,\r\n            el: $loading[0]\r\n        });\r\n\r\n        Adapt.ddLoading = model;\r\n    });\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt'\r\n], function(Handlebars, Adapt) {\r\n\r\n    /**\r\n     * FIXME: This extension is a WIP.\r\n     * TODO: port all styles from the theme that modify notify to our DD standards into this extension.\r\n     */\r\n\r\n    Adapt.on(\"notify:opened\", (notifyView) => {\r\n\r\n        /**\r\n         * Bugfix: allow the user to click on the background element(s) to close it.\r\n         * \r\n         * EDIT:\r\n         * Added \".notify__popup\" element too (if the notify is set to scroll, \".notify__popup-inner\" won't cover the full area).\r\n         * Relevant for popups like figure lightboxes.\r\n         */\r\n        notifyView.$(\".js-notify-bg\").on(\"click\", (event) => {\r\n            \r\n            //event.stopPropagation();\r\n            if (event.target != event.currentTarget) return;\r\n\r\n            Adapt.trigger('notify:close');\r\n        });\r\n    });\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /** \r\n     * FIXME: very rough port from Adapt v3.0. Needs to be cleaned up.\r\n     * FIXME: This should be replaced with adapt-dd-debug when possible.\r\n     */\r\n\r\n\r\n    /**\r\n     * Extract url parameters.\r\n     * \r\n     * Example URL:\r\n     * http://localhost:9001/?block=3&value2=99#/id/co-05\r\n     */\r\n    function getUrlVars() {\r\n        var vars = {};\r\n        window.location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi, function(m,key,value) {\r\n            vars[key] = value;\r\n        });\r\n        return vars;\r\n    };\r\n\r\n    var CLASSNAME_PREFIX = \"mode-\";\r\n\r\n    // May alter some data, so called at the dataLoaded step.\r\n    Adapt.on(\"app:dataLoaded\", function(test){\r\n\r\n        // Temp. precaution:\r\n        // Only allow non-default modes on one of our debug servers\r\n        var url = window.location.href;\r\n        var DEBUG_FORCED = url.indexOf(\"proofingsite.didaskogroup.com\") >= 0;\r\n        var DEBUG_DISABLED = getUrlVars().debug === \"false\";\r\n        var PAGEMODE_ENABLED = url.indexOf(\"localhost\") >= 0 || DEBUG_FORCED;\r\n        if (DEBUG_DISABLED) PAGEMODE_ENABLED = false;\r\n\r\n        var config = getCourseConfig();\r\n        \r\n        // Allow blocks to be isolated outside of any special mode.\r\n        debugIsolateBlock();\r\n        disablePageNavigation();\r\n        \r\n        if (/*config && config._isEnabled &&*/ PAGEMODE_ENABLED) {\r\n            \r\n            if (DEBUG_FORCED) config._mode = \"debug\";\r\n\r\n            // If a non-default mode is being used...\r\n            if (config._mode)\r\n            {\r\n                $(\"html\").addClass(CLASSNAME_PREFIX + config._mode);\r\n                Adapt.log.info(\"Page mode set to: \" + config._mode);\r\n\r\n                /**\r\n                 * Debug mode.\r\n                 */\r\n                if (config._mode == \"debug\" /*&& config._parentSelector*/) {\r\n                    setUpDebugMode();\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            /**\r\n             * No unique page mode.\r\n             */\r\n            _.each(Adapt.blocks.models, function(e, i){\r\n                e.set(\"_mode\", undefined); // Remove the \"_mode\" property from the blocks (it specifies special behaviour for pageModes, so it isn't needed).\r\n            });\r\n\r\n            //setUpEventListeners();\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Used by the DD Adapt template guides v2.1.\r\n     */\r\n    function disablePageNavigation() {\r\n        let url = getUrlVars();\r\n        if (url.navigationEnabled !== \"false\") return;\r\n\r\n        $(\"html\").addClass(\"navigation-hidden\");\r\n        // Append styles which will hide the navigation entirely (hardcoded for the current implementation of Adapt).\r\n        $(\"body\").append(\"<style>[role='navigation'],.sidemenu{display: none;}.component__container{margin-left: 0;}#app{border-top: 0;}.page::after{content: none;}\");\r\n    }\r\n\r\n    /**\r\n     * [DEBUG MODE ONLY] \r\n     * If the URL has a \"block\" parameter, then only that block will be rendered on refresh.\r\n     * \r\n     * Example: block=2,5,6\r\n     */\r\n    function debugIsolateBlock(){\r\n\r\n        let url = getUrlVars();\r\n        if (url.block === undefined) return;\r\n\r\n        // FIXME: Temp: if \"blocks=6+\" is used, then isolate from block 6 onwards.\r\n        let blocksPlus = url.block[url.block.length-1] == \"+\";\r\n        if (blocksPlus) url.block = url.block.slice(0, -1);\r\n        let blockNums = url.block.split(\",\");\r\n\r\n        // FIXME: Very rushed.\r\n        if (blocksPlus){\r\n            \r\n            let found = false;\r\n            _.each(Adapt.blocks.models, (block) => {\r\n                \r\n                let blockId = block.get(\"_id\");\r\n\r\n                if (found) {\r\n                    blockNums.push(blockId.substr(2));\r\n                    return;\r\n                }\r\n                \r\n                if (blockId == (\"b-\" + blockNums[blockNums.length-1])){\r\n                    found = true;\r\n                    return;\r\n                };\r\n            });  \r\n        }\r\n\r\n        let disabledBlocks = [];\r\n\r\n        /** Make all but the chosen block (and its parents) unavailable. */\r\n        _.each(Adapt.articles.models, (article) => {article.set(\"_isAvailable\", false);});\r\n        _.each(Adapt.blocks.models, (block) => {\r\n            let blockId = block.get(\"_id\");\r\n\r\n            // If a block was manually set to be unavailable, don't let it be isolated.\r\n            if (!block.get(\"_isAvailable\")) { \r\n                disabledBlocks.push(block);\r\n            }\r\n            block.set(\"_isAvailable\", false);\r\n        });\r\n\r\n        let isolatedBlocks = [];\r\n        _.each(blockNums, (blockNum, sortIndex) => {\r\n\r\n            var block = _.find(Adapt.blocks.models, (block) => {\r\n                let blockId = block.get(\"_id\");\r\n                if (blockId == (\"b-\" + blockNum)){\r\n\r\n                    if (_.includes(disabledBlocks, block)) {\r\n                        throw \"Block \" + blockId + \" has been manually removed (its \\\"_isAvailable\\\" property is set to false) and cannot be isolated.\";\r\n                    }\r\n\r\n                    block.set(\"_isAvailable\", true);\r\n                    block.set(\"_pageModeSortIndex\", sortIndex);\r\n                    block.getParent().set(\"_isAvailable\", true);\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            if (!block) {\r\n                throw \"Could not find block \\\"b-\" + url.block + \"\\\" to isolate. Change/remove the block parameter in the URL and try again.\";\r\n            }\r\n\r\n            isolatedBlocks.push(block);\r\n        });\r\n        \r\n        // If block isolation is used, hide the header (unless the first block is included in the isolation).\r\n        //console.log(isolatedBlocks.length);\r\n        if (isolatedBlocks.length && !_.includes(isolatedBlocks, Adapt.blocks.first())) {\r\n            Adapt.on(\"router:page\", function(pageModel){\r\n                pageModel.get(\"_didasko\")._pageHeader._isEnabled = false;\r\n            });\r\n        }\r\n\r\n        // Sort the blocks in each active article (allows the debug to rearrange the block order).\r\n        _.each(Adapt.articles.models, (article) => {\r\n            if (!article.get(\"_isAvailable\")) return;\r\n\r\n            article.getChildren().comparator = function(model) {return model.get(\"_pageModeSortIndex\");};\r\n            article.getChildren().sort();\r\n        });\r\n    }\r\n\r\n    Adapt.on(\"pageView:ready\", function(pageView){\r\n        \r\n        return;\r\n\r\n        // Render the copyright template at the bottom of the page.\r\n        // FIXME: Temporary.\r\n        var template = Handlebars.templates['ddPageModeCopyright'];\r\n        pageView.$el.append(template({\r\n            year: new Date().getFullYear()\r\n        }));\r\n\r\n        return;\r\n        // Temp.\r\n        // Allow the page to be set to auto scroll to a specified block from the URL.\r\n        var urlParams = getUrlVars();\r\n        if (urlParams.anchor) {\r\n            Adapt.scrollTo($(\"[data-adapt-id=\" + urlParams.anchor + \"]\"), {duration: 0});\r\n        }\r\n    });\r\n\r\n    function getCourseConfig() {\r\n        return Adapt.course.get('_pageMode') || {_mode: \"debug\"};\r\n    };\r\n\r\n    function setUpDebugMode() {\r\n\r\n        var urlParams = getUrlVars();\r\n\r\n        // Allow other scripts to change their behaviour if debug mode is enabled.\r\n        if (!Adapt.debug) Adapt.debug = {};\r\n        Adapt.debug._isEnabled = true;\r\n\r\n        /**\r\n         * Data\r\n         */\r\n        // If a block has _mode._debug._bump == true set, then move its element to the first index\r\n        // (makes it easier to test later blocks by allowing the page to just be refreshed and for it to be the first block(s) in the page).\r\n        if (false && urlParams.block !== undefined) {\r\n            Adapt[\"blocks\"].models.sort(function(a, b){\r\n\r\n                /**\r\n                 * Alternate bump feature:\r\n                 * If the URL has the \"block\" parameter set, then bump the block with a matching id.\r\n                 * \r\n                 * Todo: the way blockNum is set is a bit arbitrary. Maybe make it an extension that adds it,\r\n                 * and then have this extension require it. \r\n                 */\r\n                if (urlParams.block) {\r\n\r\n                    if (a.get(\"_id\").substr(2) == urlParams.block) {\r\n                        Adapt.log.debug(\"Bumped block: \" + a.get(\"_id\"));\r\n                        return -1;\r\n                    }\r\n                    if (b.get(\"_id\").substr(2) == urlParams.block) {\r\n                        Adapt.log.debug(\"Bumped block: \" + b.get(\"_id\"));\r\n                        return 1;\r\n                    }\r\n                }\r\n\r\n                var bMode = b.get(\"_mode\");\r\n                if (bMode && bMode._debug && bMode._debug._bump) {\r\n                    Adapt.log.debug(\"Bumped block: \" + a.get(\"_id\"));\r\n                    return 1;\r\n                }\r\n                var aMode = a.get(\"_mode\");\r\n                if (aMode && aMode._debug && aMode._debug._bump) {\r\n                    Adapt.log.debug(\"Bumped block: \" + b.get(\"_id\"));\r\n                    return -1;\r\n                }\r\n\r\n                return a.cid.localeCompare(b.cid);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Events\r\n         */\r\n        Adapt.on(\"blockView:postRender\", onDebugBlockViewPostRender);\r\n        //Adapt.on(\"pageView:ready\", renderDebugToggle);\r\n\r\n        // Add a debug toggle button to the navbar.\r\n        setTimeout(() => {\r\n            let $debugBtn = $(\"<button class='debug__toggle'>D</button>\");\r\n            $('.nav__inner').append($debugBtn);\r\n            $debugBtn.on(\"click\", () => {\r\n                $(\"html\").toggleClass(CLASSNAME_PREFIX + \"debug\");\r\n            });\r\n        }, 250);\r\n    }\r\n\r\n    function onDebugBlockViewPostRender(view) {\r\n\r\n        let blockId = view.model.get(\"_id\");\r\n\r\n        // Add an element in the corner to show the block's _id value.\r\n        let $blockId = $(\"<div class='debug-block-id'>\" + blockId + \"</div>\");\r\n        view.$el.append($blockId);\r\n\r\n        // If this element is clicked, show the source JSONSYNT.\r\n        $blockId.on(\"click\", () => {\r\n\r\n            // Note: very important that this can NEVER be activated outside of Proofing.\r\n            //if (url.indexOf(\"proofingsite.didaskogroup.com\") < 0) return;\r\n\r\n            $.ajax({\r\n\t\t\t\tdataType: \"text\",\r\n\t\t\t\turl: \"course/en/components.jsonsynt\",\r\n\t\t\t\tcache: true,\r\n\t\t\t\tsuccess: (data) => {\r\n                    getComponentJSONSYNT(blockId, data);\r\n\t\t\t\t},\r\n\t\t\t\tfail: () => {\r\n\t\t\t\t\talert(\"Could not load .jsonsynt preview.\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Debug feature:\r\n     * Clicking on a debug block ID should open a new page containing the JSONSYNT used to make the components in that block.\r\n     * @param {*} blockId \r\n     * @param {*} data \r\n     */\r\n    function getComponentJSONSYNT(blockId, data) {\r\n\r\n        const warning = \"<<<!\\n\\\r\nThis is a .jsonsynt snippet from [INSERT TOPIC HERE]. You can examine it to see how certain components are made.\\n\\\r\nHOWEVER, please keep the following in mind:\\n\\n\\\r\n\\\r\n- This code MAY BE OUTDATED! If possible, you should ALWAYS try to use code from the Didasko Adapt template guides\\n\\\r\n  to create your content (you can however, use this to find out the names of features your require).\\n\\\r\n- You're seeing this script as it was uploaded to Proofing. Newer versions of it may exist.\\n\\\r\n!>>>\"\r\n\r\n        // Crudely try to isolate only the components which have \"_parentId\" === blockId.\r\n        // Note: I've hardcoded this to expect DD formatting standards. If those are not followed, then this will likely break.\r\n        let lines = data.split(\"\\n\");\r\n\r\n        // TODO: Finish this.\r\n\r\n        //console.log(lines);\r\n\r\n    }\r\n\r\n    function renderDebugToggle() {\r\n        var $par = $(\"body \" + getCourseConfig()._parentSelector);\r\n        if (!$par.length) Adapt.log.warn(\"Could not append adapt-pageMode.js toggle button (could not find element matching the _parentSelector).\");\r\n        \r\n        var $button = $(\"<button class='page-mode-debug-toggle base'>D</button>\");\r\n        $par.prepend($button);\r\n        \r\n        $button.click(function(){\r\n            $(\"html\").toggleClass(CLASSNAME_PREFIX + \"debug\");\r\n        });\r\n    };\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * QuestionPlusMultiModel\r\n     * ---------------------------\r\n     * This handles instances where a block contains multiple Question components at once, and creates a stylish transition\r\n     * between them,\r\n     * as well as slightly modifying how the feedback is displayed.\r\n     * \r\n     * This functionality creates a Question block with multiple \"steps\".\r\n     * In DD's Adobe Edge Animate templates, this was referred to as a \"Your Turn: Learning Pathway\" type functionality.\r\n     * \r\n     * WARNING:\r\n     * - Will have errors if there are multiple question component's inside of the same componentRow.\r\n     * \r\n     * FIXME:\r\n     * - Assumes all componentRows in the block have _isQuestionType: true.\r\n     */\r\n\r\n    class QuestionPlusMultiModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                \"_parent\": undefined,       // Reference to the blockModel that contains the question components.\r\n                \"_children\": undefined,     // Collection of ComponentRows that have _isQuestionType: true.\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n\r\n            this.hideQuestionRows();\r\n\r\n            // All (except the first) componentRow's in this block should have dividers.\r\n            this.get(\"_children\").each((model, i) => {\r\n                if (i == 0) return;\r\n                model.set(\"_hasDivider\", true);\r\n            });\r\n\r\n            /*this.listenTo(this.get(\"_parent\"), \"change:_isComplete\", (model, _isComplete) => {\r\n                console.log(_isComplete);\r\n            });*/\r\n\r\n            this.listenTo(this.get(\"_parent\").get(\"_children\"), \"change:_isComplete\", this.onQuestionComponentComplete);\r\n        }\r\n\r\n        /**\r\n         * Hides all question componentRows after the first incomplete question componentRow encountered.\r\n         * This won't prevent the other components being rendered, but it will ensure the user will have to step through each\r\n         * Question componentRows in sequential order.\r\n         */\r\n        hideQuestionRows() {\r\n\r\n            let crVisible = true;\r\n\r\n            _.each(this.get(\"_children\").models, (componentRow, i) => {\r\n\r\n                // If this componentRow is not complete, then hide all componentRows which come after it.\r\n                if (crVisible && !componentRow.get(\"_isComplete\")) {\r\n                    crVisible = false;\r\n                    return;\r\n                }\r\n\r\n                // Set the componentRows of all other componentRows to hide themselves.\r\n                // (They'll still render, but won't be visible until the previous child is completed).\r\n                componentRow.set(\"_isVisible\", crVisible);\r\n                \r\n                /*setTimeout(() => {\r\n                    Adapt.findViewByModelId(component.get(\"_id\")).$el.slideUp();\r\n                }, 5000);*/\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Whenever a Question component in this block is complete, reveal the next one and scroll to it.\r\n         */\r\n        onQuestionComponentComplete(model, _isComplete) {\r\n\r\n            if (!_isComplete) return;\r\n\r\n            let nextIncompleteComponent = this.showNextQuestionComponent();\r\n            if (!nextIncompleteComponent) return; // If there's no more incomplete Question components in the Block, do nothing.\r\n\r\n            // And scroll to it once the user closes the feedback.\r\n            this.listenToOnce(Adapt, \"notify:closed\", () => {\r\n                \r\n                _.debounce(() => {\r\n                    Adapt.navigateToElement(\".\" + nextIncompleteComponent.get(\"_id\"), {duration: 400});\r\n                })();\r\n            });\r\n        }\r\n\r\n        showNextQuestionComponent() {\r\n\r\n            let nextIncompleteComponent = _.find(this.get(\"_parent\").getChildren().models, (component) => {\r\n                if (!component.get(\"_isComplete\")) return true;\r\n            });\r\n            \r\n            // If there's no more components to complete, do nothing.\r\n            if (!nextIncompleteComponent) return undefined;\r\n            \r\n            // Have the next incomplete component's componentRow reveal itself.\r\n            // Note: was originally placed inside of notify:closed callback, but if something were to go wrong\r\n            // and prevent the callback, it would leave the componentRow inaccessible.\r\n            // This way looks slightly worse, but removes that risk.\r\n            nextIncompleteComponent.get(\"_componentRow\").set(\"_isVisible\", true);\r\n\r\n            return nextIncompleteComponent;\r\n        }\r\n    };\r\n\r\n    return QuestionPlusMultiModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './questionPlusMultiModel'\r\n], function(Adapt, QuestionPlusMultiModel) {\r\n\r\n    /**\r\n     * adapt-dd-questionPlus\r\n     * --------------------------------------\r\n     * Note:\r\n     * Due to the change in the core Question functionality, each Question's reset function + incorrect states will\r\n     * need to be modified to function correctly with this extension.\r\n     * \r\n     * Explanation:\r\n     * - In Adapt core, it waits for Submit to be clicked, then applies .is-incorrect and .is-correct to ALL items, then locks\r\n     *   the Question until Reset is clicked. Once Reset has been clicked, all .is-incorrect and .is-correct classes are removed\r\n     *   from the items, and the user tries again.\r\n     * - The way we have it set up is as follows. The user clicks on Submit, then .is-incorrect and .is-correct is applied ONLY\r\n     *   to the items which have been interacted with by the user. If the answer isn't correct, the user can then change their answer,\r\n     *   while keeping track of all the items which they've already tried. In essence, \"narrowing down\" their options until the\r\n     *   correct answer is reached.\r\n     * - As such, individual Question components will need slight modifications to how they mark their items; to prevent them marking\r\n     *   them all at once.\r\n     * \r\n     * Important:\r\n     * - All Question components will need to REMOVE updateMarking() calls from inside their update() functions.\r\n     *   updateMarking() will be set by questionPlus to be called automatically ONLY when the user clicks Submit.\r\n     * - Furthermore, updateMarking() should be modified to only mark the items which the user has submitted, and not all items.\r\n     *   Example: for an item with 3 options for the answer, apply .is-correct / .is-incorrect only to the answer the user submitted, \r\n     *            leaving the other two unknown.\r\n     * - The _feedback property has been modified to be formatted as follows (core Adapt formatting doesn't suit our implementation):\r\n     * \"_feedback\":{\r\n\t\t\t\"_correct\": {\r\n\t\t\t\t\"title\": \"\",\r\n\t\t\t\t\"body\": <<<\"\r\n\t\t\t\t\tCORRECT\r\n\t\t\t\t\">>>\r\n\t\t\t},\r\n\t\t\t\"_incorrect\": {\r\n\t\t\t\t\"title\": \"\",\r\n\t\t\t\t\"body\": <<<\"\r\n\t\t\t\t\tINCORRECT\r\n\t\t\t\t\">>>\r\n\t\t\t},\r\n\t\t\t\"_partlyCorrect\": {\r\n\t\t\t\t\"title\": \"\",\r\n\t\t\t\t\"body\": <<<\"\r\n\t\t\t\t\tPARTLY CORRECT\r\n\t\t\t\t\">>>\r\n\t\t\t}\r\n     * \r\n     */\r\n\r\n    /**\r\n     * If true, all question components will reset their answers on pageload\r\n     * regardless of whether the user answered the question correctly/incorrectly in a previous session.\r\n     * This type of functionality is used throughout DD content, as our Questions are for self testing,\r\n     * and do not need strict \"lock the user out of attempting again\" rules.\r\n     */\r\n    const RESET_ON_RELOAD = true;\r\n\r\n    function _fixString(val) {\r\n        if (!val) return \"\";\r\n        if (typeof val === \"string\") return val.trim();\r\n        return val;\r\n    }\r\n\r\n    class QuestionPlus extends Backbone.Controller{\r\n\r\n        initialize() {\r\n            \r\n            Adapt.on({\r\n                'app:dataReady': this.onDataReady.bind(this)\r\n            });\r\n        }\r\n\r\n        onDataReady() {\r\n            this._onDataReady();\r\n\r\n            Adapt.on(\"blockView:preRender\", this.onBlockViewPrerender.bind(this));\r\n            Adapt.on(\"blockView:postRender\", this.onBlockViewPostRender.bind(this));\r\n            //Adapt.on(\"componentView:preRender\", this.onComponentViewPreRender.bind(this));\r\n            Adapt.on(\"componentView:postRender\", this.onComponentViewPostRender.bind(this));\r\n            Adapt.on(\"questionView:showFeedback\", this.onQuestionViewShowFeedback.bind(this));\r\n        }\r\n\r\n        /**\r\n         * Set a property on any block containing a Question component.\r\n         */\r\n        onBlockViewPrerender(blockView) {\r\n\r\n            // Count how many Question components are in this block.\r\n            let questionRowCount = 0;\r\n            let questionRows = [];\r\n            _.each(blockView.model.get(\"_componentRow\").get(\"_children\").models, (componentRow) => {\r\n                // FIXME: Currently assumes ALL children in the block are question components.\r\n                if (componentRow.get(\"_isQuestionType\")) {\r\n                    questionRowCount++;\r\n                    questionRows.push(componentRow);\r\n                }\r\n                /*else {\r\n                    throw \"adapt-dd-questionPlus does not yet support a mixture of Question and non-Question type components in the same block: \" + blockView.model.get(\"_id\");\r\n                }*/\r\n            });\r\n\r\n            if (questionRowCount == 0) return;\r\n\r\n            // This block has Question components in it. Consider it a \"Question\" block.\r\n            blockView.model.set(\"_isQuestionType\", true);\r\n\r\n            // Add the questionPlus logo to the first component (using the adapt-dd-componentLogo extension).\r\n            blockView.model.getChildren().first().set(\"_componentLogo\", {\r\n                src: \"assets/questionplus-logo.svg\"\r\n            });\r\n\r\n            // If this block has more than one Question component, then it will be modified to use the QuestionPlusMulti functionality.\r\n            if (questionRowCount > 1){\r\n                blockView.model.set(\"_questionPlusMulti\", new QuestionPlusMultiModel({\r\n                    _parent: blockView.model,\r\n                    _children: new Backbone.Collection(questionRows)\r\n                }));\r\n            }\r\n\r\n            // Add a class to question blocks.\r\n            blockView.model.set(\"_classes\", blockView.model.get(\"_classes\") + \" is-question\");\r\n            blockView.$el.addClass(\"is-question\"); // FIXME: Why can I do this in preRender? Weird implementation on Adapt's part.\r\n        }\r\n\r\n    \r\n        // Ensure the correct settings are used for the question components\r\n        // ----------------------------------------------------------------\r\n        _onDataReady() {\r\n\r\n            Adapt.components.each(componentModel => {\r\n\r\n                if (!componentModel.get(\"_isQuestionType\")) return;\r\n                \r\n                // This causes Adapt to show the 100% correct answer to the user once they've used their all of their attempts.\r\n                // We don't use this feature (we instead narrow down the user's options to the correct answer with each user attempt).\r\n                componentModel.set(\"_canShowModelAnswer\", false);\r\n\r\n                // Fallback: this extension already has scripts to give infinite attempts. This is just in case.\r\n                componentModel.set(\"_attempts\", 999);\r\n\r\n                if (RESET_ON_RELOAD) {\r\n                    // FIXME: Arbitrary use of debounce to delay this call until questionModel's trackable triggers.\r\n                    _.debounce(() => {\r\n                        componentModel.reset(true,true);\r\n                    })();\r\n                }\r\n\r\n                // ----------------------------------------------------------------\r\n\r\n                let block = componentModel.getParent();\r\n\r\n                // This block has multiple Question components in it. It needs to be set up to use the QuestionPlusMulti behaviour.\r\n                //if (block.get(\"_isQuestionType\")) return;\r\n\r\n                // This block contains Question components.\r\n                block.set(\"_isQuestionType\", true);\r\n                \r\n                //Adapt.findViewByModelId(block.get(\"_id\")).$el.addClass(\"is-question\");\r\n            });\r\n        }\r\n\r\n        // Add a class to question blocks.\r\n        onBlockViewPostRender(blockView) {\r\n            blockView.$el.toggleClass(\"is-question\", Boolean(blockView.model.get(\"_isQuestionType\")));\r\n        }\r\n\r\n        /**\r\n         * Custom DD functionality: always have the question components reset on pageload\r\n         * (even if the user has already completed them in the LMS, don't carry over their answers).\r\n         * @param {*} componentView \r\n         */\r\n        onComponentViewPreRender(componentView) {\r\n            \r\n            if (!RESET_ON_RELOAD) return;\r\n\r\n            let componentModel = componentView.model;\r\n            if (!componentModel.get(\"_isQuestionType\")) return;\r\n            componentModel.reset(true,true);\r\n        }\r\n\r\n        /**\r\n         * Override default submit behaviour.\r\n         */\r\n        onComponentViewPostRender(componentView) {\r\n\r\n            let componentModel = componentView.model;\r\n\r\n            // Only extend Question components\r\n            if (!componentModel.get(\"_isQuestionType\")) return;\r\n\r\n            // Only extend once.\r\n            if (componentModel.get(\"_isQuestionPlus\")) return;\r\n            componentModel.set(\"_isQuestionPlus\", true);\r\n\r\n            // Add a class (for styling)\r\n            componentView.$el.addClass(\"is-questionplus\");\r\n            \r\n            // To prevent the Question locking itself on Submit, and to prevent the buttonsView from changing to its RESET state,\r\n            // the following modifications must be made.\r\n            componentModel.setQuestionAsSubmitted = function(){\r\n\r\n                // If the question isn't complete yet, don't disable the component.\r\n                let isCorrect = componentModel.isCorrect();\r\n\r\n                // Changed:\r\n                componentModel.set({\r\n                    _isEnabled: !isCorrect,\r\n                    _isSubmitted: isCorrect\r\n                });\r\n            }\r\n\r\n            // Give the user infinite attempts by preventing the model from decrementing the count.\r\n            componentModel.updateAttempts = function(){\r\n                // Infinite attempts.\r\n                this.set('_attemptsLeft', 999);\r\n            }\r\n\r\n            this.setUpFeedback(componentModel);\r\n\r\n            // Add the .show-user-answer class after the Submit has been clicked once.\r\n            let _onSubmitClicked = componentView.onSubmitClicked;\r\n            if (!_onSubmitClicked.prototype._questionPlusOverride) { \r\n                componentView.onSubmitClicked = function(){\r\n                    _onSubmitClicked.apply(componentView, arguments);\r\n                    this.$('.component__widget')\r\n                        .addClass('show-user-answer');\r\n                }\r\n                componentView.onSubmitClicked.prototype._questionPlusOverride = true; // Override only once.\r\n            }\r\n\r\n            // ButtonsView behaviour change\r\n            // ----------------------------\r\n            // The buttonView.onFeedbackMessageChanged will disable the feedback button if no _feedback.correct text is provided.\r\n            // Since DD sometimes doesn't provide a value for _feedback.correct, this feature is removed here.\r\n            let buttonsView = componentView.buttonsView;\r\n            let _onFeedbackMessageChanged = buttonsView.onFeedbackMessageChanged;\r\n            if (!_onFeedbackMessageChanged.prototype._questionPlusOverride) { \r\n                buttonsView.onFeedbackMessageChanged = () => {\r\n\r\n                    let canShowFeedback = buttonsView.model.get('_canShowFeedback');\r\n\r\n                    Adapt.a11y.toggleAccessibleEnabled(\r\n                        buttonsView.$('.js-btn-feedback'),\r\n                        canShowFeedback\r\n                    );\r\n\r\n                    buttonsView.$('.js-btn-feedback').prop(\"disabled\", !canShowFeedback);\r\n                }\r\n                buttonsView.onFeedbackMessageChanged.prototype._questionPlusOverride = true; // Override only once.\r\n            }\r\n            // Re-apply the listener.\r\n            buttonsView.stopListening(buttonsView.model, 'change:feedbackMessage');\r\n            buttonsView.listenTo(buttonsView.model, 'change:feedbackMessage', buttonsView.onFeedbackMessageChanged);\r\n        }\r\n\r\n        // Modify the questionModel to get its feedback title and messages from our DD formatted feedback instead.\r\n        setUpFeedback(questionModel){\r\n\r\n            let _getFeedbackTitle = questionModel.getFeedbackTitle;\r\n\r\n            let _default = Adapt.course.get(\"_feedback\");\r\n            if (!_default) throw \"\\\"course._feedback\\\" must be defined for un-set component._feedback titles to fall back on.\";\r\n\r\n            if (!_getFeedbackTitle.prototype._questionPlusOverride) {\r\n                questionModel.getFeedbackTitle = function() {\r\n\r\n                    let _feedback = questionModel.get(\"_feedback\");\r\n                    \r\n                    if (Boolean(questionModel.get(\"_isCorrect\"))) {\r\n                        if (!_feedback._correct) return _getFeedbackTitle.apply(questionModel, arguments);\r\n                        return _feedback._correct.title || _default._correct.title || _getFeedbackTitle.apply(questionModel, arguments);\r\n                    }\r\n\r\n                    if (Boolean(questionModel.get(\"_isAtLeastOneCorrectSelection\"))) {\r\n                        if (!_feedback._partlyCorrect) return _getFeedbackTitle.apply(questionModel, arguments);\r\n                        return _feedback._partlyCorrect.title || _default._partlyCorrect.title || _getFeedbackTitle.apply(questionModel, arguments);\r\n                    }\r\n\r\n                    if (!_feedback._incorrect) return _getFeedbackTitle.apply(questionModel, arguments);\r\n                    return _feedback._incorrect.title || _default._incorrect.title || _getFeedbackTitle.apply(questionModel, arguments);\r\n                }\r\n                questionModel.getFeedbackTitle.prototype._questionPlusOverride = true; // Only once.\r\n            }\r\n\r\n            // Copy over the message text from the DD formater _feedback to the _feedback format core Adapt expects.\r\n            let _feedback = questionModel.get(\"_feedback\");\r\n            let formatMessage = (body, instruction) => {\r\n                return Handlebars.templates[\"questionPlusFeedbackBody\"]({\r\n                    body: body,\r\n                    instruction: instruction\r\n                });\r\n            }\r\n\r\n            _feedback = _.extend({}, _feedback, {\r\n                correct: formatMessage((_fixString(_feedback._correct) ? _fixString(_feedback._correct.body) : \"\") || \"\"),\r\n                _incorrect: _.extend({}, _feedback._incorrect, {\r\n                    final: formatMessage(\r\n                        _fixString(_feedback._incorrect.body) || \"\",\r\n                        _fixString(_feedback._incorrect.instruction) || _fixString(_default._incorrect.instruction) || \"\")\r\n                }),\r\n                // Partly correct will automatically use the _incorrect body and instruction unless told otherwise.\r\n                _partlyCorrect: _.extend({}, _feedback._partlyCorrect, {\r\n                    final: formatMessage(\r\n                        _fixString(_feedback._partlyCorrect.body) || _fixString(_feedback._incorrect.body) || \"\",\r\n                        _fixString(_feedback._partlyCorrect.instruction) ||  _fixString(_feedback._incorrect.instruction) || _fixString(_default._partlyCorrect.instruction) || \"\")\r\n                })\r\n            });\r\n\r\n            questionModel.set(\"_feedback\", _feedback);\r\n        }\r\n\r\n        /**\r\n         * Call the component's updateMarking() function whenever the user clicks submit.\r\n         */\r\n        onQuestionViewShowFeedback(questionView) {\r\n            if (questionView.updateMarking) questionView.updateMarking();\r\n\r\n            // If the question is incomplete, scroll the component intruction text into view once the feedback has been closed.\r\n            if (questionView.model.get(\"_isComplete\")) return;\r\n\r\n            this.listenToOnce(Adapt, {\r\n                'notify:closed': () => {\r\n\r\n                    _.debounce(() => {\r\n                        Adapt.navigateToElement(questionView.$(\".component__instruction\"), {\r\n                            align: 'inview'\r\n                        });\r\n                    }, 500)();\r\n\r\n                    return;\r\n\r\n                    // Scroll the user back to the top of the component_widget on wrong answer.\r\n                    _.debounce(() => {\r\n                        this.model.getChildren().each((itemModel) => {\r\n                \r\n                          // Only deselect visited answers.\r\n                          let isVisited = Boolean(itemModel.get(\"_isVisited\"));\r\n                          if (!isVisited) return;\r\n                \r\n                          let shouldBeSelected = Boolean(itemModel.get(\"_shouldBeSelected\"));\r\n                          let isActive = Boolean(itemModel.get(\"_isActive\"));\r\n                          let isCorrect = shouldBeSelected && isActive;\r\n                \r\n                          if (!isCorrect && isActive) itemModel.set(\"_isActive\", false);\r\n                        })\r\n                    }, 500)();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    let questionPlus = new QuestionPlus();\r\n    Adapt.questionPlus = questionPlus;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * Base model for each category inside the sidemenu__accordion.\r\n     * (Each category will have a different collection of items assigned to its SideMenuCategoryModel).\r\n     */\r\n    \r\n    class SideMenuCategoryModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                title: \"UNDEFINED\", // Title on the accordion.\r\n                type: \"UNDEFINED\",  // Used for classnames.\r\n                _items: undefined,  // Collection of item models.\r\n                \r\n                _isActive: false    // Whether the view for this category has been expanded in the parent accordion.\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n        }\r\n\r\n        toggle(){\r\n            this.set(\"_isActive\", !this.get(\"_isActive\"));\r\n        }\r\n    };\r\n\r\n    return SideMenuCategoryModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './SideMenuCategoryModel'\r\n  ], function(Adapt, SideMenuCategoryModel) {\r\n  \r\n    /**\r\n     * Stores the collections for each category in the SideMenu.\r\n     */\r\n    class SideMenuCategoryCollection extends Backbone.Collection{\r\n  \r\n      initialize(models, options) {\r\n        this.listenTo(Adapt, 'remove', this.reset);\r\n        if (!options || !options.pageModel) return;\r\n        this._pageModel = options.pageModel;\r\n        this.repopulate();\r\n      }\r\n  \r\n      repopulate() {\r\n        this.reset();\r\n        if (!this._pageModel) return;\r\n  \r\n        // Get the raw menu data from the current pageModel (data set in contentObjects.json).\r\n        let menuData = this._pageModel.get(\"_menuData\");\r\n\r\n        // Create a model with a collection for navigation.\r\n        // This one receives special scripting (clicking the items needs to scroll the page + affect articleNav).\r\n        // (Inherited from adapt-dd-sideNav).\r\n        let m = new SideMenuCategoryModel({\r\n          title: \"Content\",\r\n          _type: \"nav\",\r\n          _items: Adapt.blocks//,\r\n          //_isActive: true  // Open by default.\r\n        });\r\n        this.add(m);\r\n\r\n        // Create a model with a collection for each menuData category.\r\n        _.each(menuData, (cat, name) => {\r\n\r\n            let models = [];\r\n            _.each(cat._items, (item) => {\r\n                models.push(new Backbone.Model(item));\r\n            });\r\n\r\n            let m = new SideMenuCategoryModel({\r\n              title: cat.title,\r\n              _type: cat.title.toLowerCase(),\r\n              _items: new Backbone.Collection(models)\r\n            });\r\n            \r\n            this.add(m);\r\n        });\r\n      }\r\n    }\r\n\r\n    return SideMenuCategoryCollection;\r\n  \r\n  });\r\n  ","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * Model for the entire sliding menu (behaves similar to the Adapt drawer).\r\n     */\r\n    \r\n    class SideMenuModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                title: \"\",                   // PageModel (current contentObject) title.\r\n                _pageModel: undefined,       // Current pageModel.\r\n                _categories: undefined,      // categoryCollection (set by adapt-dd-sideMenu). \r\n                _isActive: false\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            this.set(\"title\", this.get(\"_pageModel\").get(\"title\"));\r\n        }\r\n\r\n        toggle(){\r\n            this.set(\"_isActive\", !this.get(\"_isActive\"));\r\n        }\r\n    };\r\n\r\n    return SideMenuModel;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // View for each individual category's content.\r\n    // Gets passed a collection by SideMenuView.\r\n\r\n    class SideMenuCategoryContentView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"smcategory smcategory-type-\" + this.model.get(\"_type\");\r\n        }\r\n\r\n        init(){}\r\n\r\n        initialize(){\r\n            \r\n            this.init();\r\n            this.render();\r\n\r\n            //this.setupTopicData();\r\n        }\r\n\r\n        render(){\r\n            var template = Handlebars.templates[this.constructor.template];\r\n\r\n            var data = {\r\n                title: this.model.get(\"title\"),\r\n                _type: this.model.get(\"_type\"),\r\n                _items: this.model.get(\"_items\").toJSON()\r\n            }\r\n            this.$el.html(template(data));\r\n        }\r\n        \r\n    };\r\n\r\n    SideMenuCategoryContentView.template = 'sideMenuCategory';\r\n    return SideMenuCategoryContentView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    \"./SideMenuCategoryView\"\r\n], function(Adapt, SideMenuCategoryView) {\r\n\r\n    // View specifically for the \"nav\" category.\r\n    // Clicking its items will cause the page to scroll to them.\r\n\r\n    class SideMenuCategoryNavView extends SideMenuCategoryView {\r\n\r\n        events() {\r\n            return {\r\n                'click .js-nav-item-btn-click': 'scrollToPageElement'\r\n            }\r\n        }\r\n\r\n        init(){\r\n            this.setUpModelData();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(Adapt.blocks, \"change:_isComplete\", this.onBlockCompleteChange);\r\n            this.listenTo(Adapt.blocks, \"change:_isInview\", this.onBlockInviewChange);\r\n        }\r\n\r\n        setUpModelData(){\r\n            \r\n            // Determine the title used to refer to each block by finding the first title in its child components.\r\n            _.each(this.model.get(\"_items\").models, (block) => {\r\n\r\n                if (!block.get(\"_sideMenu\")) block.set(\"_sideMenu\", {});\r\n\r\n                let title = \"\";\r\n                _.find(block.getChildren().models, (component) => {\r\n                    title = component.get(\"title\");\r\n                    if (title) return true;\r\n                });\r\n\r\n                if (!title) throw \"Block \" + block.get(\"_id\") + \" doesn't have any child components with a defined title.\";\r\n                block.get(\"_sideMenu\").title = title;\r\n                //block.get(\"_sideMenu\")._isQuestionType = block.get(\"_isQuestionType\");\r\n            });\r\n        }\r\n\r\n        onBlockCompleteChange(blockModel, isComplete) {\r\n\r\n            this.$(\".js-nav-item-btn-click[data-id='\" +blockModel.get(\"_id\") + \"']\").toggleClass(\"is-complete\", isComplete);\r\n        }\r\n\r\n        onBlockInviewChange(blockModel, isInview) {\r\n            this.$(\".js-nav-item-btn-click[data-id='\" +blockModel.get(\"_id\") + \"']\").toggleClass(\"is-inview\", isInview);\r\n        }\r\n\r\n        /**\r\n         * Used implementation from PageLevelProgressView.js\r\n         * @param {*} event \r\n         */\r\n        async scrollToPageElement(event) {\r\n            if (event && event.cancelable && event.preventDefault) event.preventDefault();\r\n      \r\n            var $target = $(event.currentTarget);\r\n            if ($target.is('.is-disabled')) return;\r\n      \r\n            var id = $target.attr('data-id');\r\n            var model = Adapt.findById(id);\r\n      \r\n            // Trigger an event on the model being scrolled to.\r\n            // The articleNav extension will catch it and change articles as necessary.\r\n            model.trigger(\"blockView:navigate\", model);\r\n            \r\n            if (!model.get('_isRendered')) {\r\n              try {\r\n                await Adapt.parentView.renderTo(id);\r\n              } catch(err) {\r\n                return;\r\n              }\r\n            }\r\n      \r\n            var currentComponentSelector = '.' + id;\r\n            Adapt.navigateToElement(currentComponentSelector, {duration: 400});\r\n\r\n            // Hide the menu if on a smaller device.\r\n            // FIXME: Currently determined by the CSS opacity of the shadow.\r\n            let $shadow = $(\".sidemenu__shadow.js-sidemenu-shadow-click\");\r\n            if (parseFloat($shadow.css(\"opacity\"))) {\r\n                Adapt.sideMenu.toggle();\r\n            }\r\n        }\r\n        \r\n    };\r\n\r\n    SideMenuCategoryNavView.template = 'sideMenuCategoryNav';\r\n    return SideMenuCategoryNavView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // View for each individual category's content.\r\n    // Gets passed a collection by SideMenuView.\r\n\r\n    class SideMenuCategoryResourcesView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"smcategory smcategory-type-\" + this.model.get(\"_type\");\r\n        }\r\n\r\n        init(){}\r\n\r\n        initialize(){\r\n            \r\n            this.init();\r\n            this.render();\r\n\r\n            //this.setupTopicData();\r\n        }\r\n\r\n        render(){\r\n\r\n            var template = Handlebars.templates[this.constructor.template];\r\n\r\n            // Always provide a link to a PDF version of the content.\r\n            // FIXME: Need to throw an error (in Grunt) if the PDF doesn't exist!\r\n            let pdfDownloadName = Adapt.course.get(\"title\") + \" - \" + this.model.get(\"_parent\").get(\"title\") + \".pdf\";\r\n\r\n            // FIXME: Hardcoded.\r\n            let resources = this.model.get(\"_parent\").get(\"_pageModel\").get(\"_menuData\")._resources;\r\n\r\n            var data = {\r\n                _type:              this.model.get(\"_type\"),\r\n                _pdfDownloadName:   pdfDownloadName,\r\n                _isPDFEnabled:      resources._isPDFEnabled, // TEMP.\r\n                _items:             resources._items || []   // FIXME: Resources not implemented yet.\r\n            }\r\n\r\n            this.$el.html(template(data));\r\n        }\r\n        \r\n    };\r\n\r\n    SideMenuCategoryResourcesView.template = 'sideMenuCategoryResources';\r\n    return SideMenuCategoryResourcesView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // View for each individual category's content.\r\n    // Gets passed a collection by SideMenuView.\r\n\r\n    class SideMenuCategoryCreditsView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"smcategory smcategory-type-\" + this.model.get(\"_type\");\r\n        }\r\n\r\n        init(){}\r\n\r\n        initialize(){\r\n            \r\n            this.init();\r\n            this.render();\r\n\r\n            //this.setupTopicData();\r\n        }\r\n\r\n        render(){\r\n\r\n            var template = Handlebars.templates[this.constructor.template];\r\n\r\n            var data = {\r\n                _type: this.model.get(\"_type\"),\r\n                _items: this.model.get(\"_items\").toJSON(),\r\n                copyright: this.getDDCopyrightHtml()\r\n            }\r\n\r\n            this.$el.html(template(data));\r\n        }\r\n\r\n        /**\r\n         * FIXME: Hardcoded.\r\n         * Generates the standard DD copyright message.\r\n         */\r\n        getDDCopyrightHtml() {\r\n\r\n            // Ensure the copyright is using whatever the current year is.\r\n            let year = new Date().getFullYear();\r\n\r\n            return `&#169; ${year} Didasko Digital. All Rights Reserved.`;\r\n        }\r\n        \r\n    };\r\n\r\n    SideMenuCategoryCreditsView.template = 'sideMenuCategoryCredits';\r\n    return SideMenuCategoryCreditsView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt'\r\n], function(Handlebars, Adapt) {\r\n\r\n    var helpers = {\r\n\r\n        category_is_type: function(category, type, block) {\r\n            var isType = category._type.toLowerCase() == type.toLowerCase();\r\n            return isType ? block.fn(this) : block.inverse(this);\r\n        }\r\n\r\n    };\r\n\r\n    for (var name in helpers) {\r\n        if (helpers.hasOwnProperty(name)) {\r\n            Handlebars.registerHelper(name, helpers[name]);\r\n        }\r\n    }\r\n\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './SideMenuCategoryView',\r\n    './SideMenuCategoryNavView',\r\n    './SideMenuCategoryResourcesView',\r\n    './SideMenuCategoryCreditsView',\r\n    './SideMenuHelpers'\r\n], function(Adapt, SideMenuCategoryView, SideMenuCategoryNavView, SideMenuCategoryResourcesView, SideMenuCategoryCreditsView) {\r\n\r\n    /**\r\n     * View for the main menu. Handles revealing the menu, as well as the accordion functionality within it.\r\n     * A plugin for the accordion is not used, due to the very specific requirements that our menu requires.\r\n     * \r\n     * FIXME: Menu must be fully hidden (display: none) when not visible.\r\n     */\r\n\r\n    class SideMenuView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"sidemenu\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .sidemenu__btn\" :                    \"onCloseBtnClick\",\r\n                //\"touchstart .js-sidemenu-shadow-click\" :  \"onShadowTouchstart\",\r\n                //\"touchstart .sidemenu__menu\" :  \"onShadowTouchstart\",\r\n                \"click .js-sidemenu-shadow-click\" :         \"onCloseBtnClick\",\r\n                \"click .js-toggle-accordion-item\" :         \"onAccordionItemClick\",\r\n                \"click .js-sidemenu-drawer-btn\" :           \"onMenuBtnClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setupEventListeners();\r\n            this.render();\r\n\r\n            // FIXME: Temp.\r\n            _.debounce(() => {this.model.get(\"_categories\").models[0].set(\"_isActive\", true);})();\r\n        }\r\n\r\n        render(){\r\n            var template = Handlebars.templates['sideMenu'];\r\n            this.$el.html(template(_.extend(this.model.get(\"_categories\").toJSON(), {title: this.model.get(\"title\")})));\r\n\r\n            this.renderCategories();\r\n\r\n            // Append the main toggle button.\r\n            this.$('.sidemenu__btn-container').html(Handlebars.templates['sideMenuBtn']());\r\n        }\r\n\r\n        onMenuBtnClick(event) {\r\n\r\n            //if (event.currentTarget != event.target) return;\r\n            this.model.toggle();\r\n        }\r\n\r\n        setupEventListeners(){\r\n            this.listenTo(this.model, \"change:_isActive\", this.onIsActiveChange);\r\n            this.listenTo(Adapt, \"device:resize\", this.onDeviceResize);\r\n\r\n            this.listenTo(this.model.get(\"_categories\"), {\r\n                \"change:_isActive\": this.onAccordionItemActiveChange\r\n            })\r\n        }\r\n\r\n        /**\r\n         * iOS fix. Prevents the user being able to scroll the page while it's covered by the shadow.\r\n         * Also fixes a bug where the user couldn't scroll the sideMenuCategory views.\r\n         * @param {*} event \r\n         */\r\n        onShadowTouchstart(event) {\r\n            event.preventDefault();\r\n        }\r\n\r\n        onDeviceResize(){\r\n            this.updateAccordion();\r\n\r\n            // FIXME: \\/ doesn't work (due to being CSS based at this time).\r\n            this.updateScrollEnabled(); // Check if this device resize has made the shadow appear.\r\n        }\r\n\r\n        onIsActiveChange(model, _isActive){\r\n            \r\n            //this.handleFocus();\r\n            //return;\r\n\r\n            //Adapt.drawer.triggerCustomView(new SideMenuView({model: this.model}));\r\n            \r\n            this.$el.toggleClass(\"is-active\", _isActive);\r\n            $(\"#wrapper\").toggleClass(\"is-sidemenu-active\", _isActive);\r\n\r\n            // Change the state of the menu button.\r\n            $(\".js-sidemenu-drawer-btn\")\r\n                .toggleClass(\"is-burger\", !_isActive)\r\n                .toggleClass(\"is-cross\", _isActive);\r\n            \r\n            this.updateScrollEnabled();\r\n\r\n            if (_isActive) {\r\n                this.focus();\r\n            }\r\n            else {\r\n                this.unfocus();\r\n            }\r\n        }\r\n\r\n        focus() {\r\n\r\n            // Keep focus from previous action\r\n            this.$previousActiveElement = $(document.activeElement);\r\n\r\n            // Focus on the menu\r\n            // FIXME: The following scripts were copied from notifyView.js.\r\n            // It's likely they're not working as intended.\r\n            $.inview();\r\n            Adapt.a11y.popupOpened(this.$el);\r\n            Adapt.a11y.scrollDisable('body');\r\n            $('html').addClass('notify');\r\n            // Set focus to first accessible element\r\n            Adapt.a11y.focusFirst(this.$(\".sidemenu__menu\"), { defer: false });\r\n        }\r\n\r\n        unfocus() {\r\n\r\n            // FIXME: The following scripts were copied from notifyView.js.\r\n            // It's likely they're not working as intended.\r\n            Adapt.a11y.scrollEnable('body');\r\n            $('html').removeClass('notify');\r\n            // Return focus to previous active element\r\n            Adapt.a11y.popupClosed(this.$previousActiveElement);\r\n        }\r\n\r\n        /**\r\n         * FIXME:\r\n         * BUG: Disabling scroll on the body breaks scrolling of SideMenuCategories on touch devices! \r\n         * Throws this error:\r\n         * \"Ignored attempt to cancel a touchmove event with cancelable=false, for example because scrolling is in progress and cannot be interrupted.\"\r\n         */\r\n        updateScrollEnabled() {\r\n\r\n            let _isActive = this.model.get(\"_isActive\");\r\n\r\n            // Disable/enable scroll if the shadow became active.\r\n            // FIXME: BAD way of detecting this.\r\n            if (_isActive) {\r\n                _.debounce(() => {\r\n                    if (this.$(\".js-sidemenu-shadow-click\").css(\"opacity\") > 0) {\r\n                        Adapt.a11y.scrollDisable('body');\r\n                    }\r\n                }, 50)();\r\n            }\r\n            else {\r\n                Adapt.a11y.scrollEnable('body');\r\n            }\r\n        }\r\n\r\n        onAccordionItemClick(event) {\r\n\r\n            // Get the category item in the collection.\r\n            let index = $(event.currentTarget).data(\"index\");\r\n            let item = this.model.get(\"_categories\").models[index];\r\n\r\n            let _isActive = item.get(\"_isActive\");\r\n            if (_isActive) return; // Don't do anything if the accordion item is already open.\r\n\r\n            // Close all other accordion items.\r\n            _.each(this.model.get(\"_categories\").models, (model) => {\r\n                model.set(\"_isActive\", false);\r\n            });\r\n            item.set(\"_isActive\", true);\r\n\r\n            /*\r\n            this.$(\".sidemenu__accordion-content\").slideUp();\r\n\r\n            let $content = this.$(\".sidemenu__accordion-content\").filter(\"[data-index=\" + id + \"]\");\r\n            $content.slideDown();*/\r\n        }\r\n\r\n        // Slide down the clicked item, and slide up all the others.\r\n        onAccordionItemActiveChange(model, isActive){\r\n\r\n            if (!isActive) return;\r\n\r\n            let $btns = this.$(\".sidemenu__accordion-item-btn\");\r\n            let $items = this.$(\".sidemenu__accordion-item-content\");\r\n\r\n            $btns.toggleClass(\"is-active\", false);\r\n            $items.toggleClass(\"is-active\", false);\r\n\r\n            let index = this.model.get(\"_categories\").indexOf(model);\r\n            let $item = $items.filter(\"[data-index=\" + index + \"]\").toggleClass(\"is-active\", true); // The only active item.\r\n            $btns.filter(\"[data-index=\" + index + \"]\").toggleClass(\"is-active\", true);\r\n\r\n            // Set the max-height styles for all $items.\r\n            let $accordion = this.$(\".sidemenu__accordion\");\r\n            let accordionHeight = $accordion.height();\r\n            \r\n            let itemHeight = accordionHeight - $btns.outerHeight() * this.model.get(\"_categories\").models.length;\r\n            $items.each((i, e) => {\r\n                $(e).css(\"height\", \"\");\r\n                $(e).css(\"max-height\", $(e).height())\r\n            });\r\n            $items.hide(0).show(0).css(\"max-height\", 0); // Finish any previous transition that may still be playing.\r\n            $item.css(\"max-height\", itemHeight);\r\n\r\n            $item.one('transitionend', () => {\r\n                // Re-selecting the active item ensures the correct one is targetted (if many transitions are activated at once, the active item may change).\r\n                let $activeItem = $items.filter(\".is-active\");\r\n                $activeItem.css({\r\n                    \"max-height\": \"none\",\r\n                    \"height\": $activeItem.height()      // iOS fix. The scrollable element needs to have a fixed height.\r\n                });\r\n                $items.filter(\":not(.is-active)\").hide(0);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Update the active accordion item's height (iOS fix).\r\n         */\r\n        updateAccordion(){\r\n            let $item = this.$(\".sidemenu__accordion-item-content\").filter(\".is-active\");\r\n            $item.css(\"height\",\"\").css(\"height\", $item.height());\r\n        }\r\n\r\n        renderCategories() {\r\n\r\n            let parentModel = this.model;\r\n            \r\n            // Create a new view for each one.\r\n            this.model.get(\"_categories\").each((model, idx) => {\r\n\r\n                var view = undefined;\r\n                model.set(\"_parent\", parentModel);\r\n\r\n                switch(model.get(\"_type\"))\r\n                {\r\n                    case \"nav\":\r\n\r\n                        view = new SideMenuCategoryNavView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    case \"resources\":\r\n                        view = new SideMenuCategoryResourcesView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    // Legacy (defunt): \"Authors\" has now been fully replaced with \"Credits\".\r\n                    case \"authors\":\r\n                        Adapt.log.error(`SideMenuView:\\n the contentObjects \"_authors\" property is no longer being used. Please remove it and replace it with \"_credits\".`);\r\n                        view = new SideMenuCategoryView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    case \"credits\":\r\n                        view = new SideMenuCategoryCreditsView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    case \"references\":\r\n                        model.get(\"_items\").comparator = (model) => {return model.get(\"body\").toLowerCase();};\r\n                        model.get(\"_items\").sort();\r\n                        view = new SideMenuCategoryView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    case \"glossaries\":\r\n                        model.get(\"_items\").comparator = (model) => {return model.get(\"title\").toLowerCase();}\r\n                        model.get(\"_items\").sort();\r\n                        view = new SideMenuCategoryView({\r\n                            model: model\r\n                        });\r\n                        break;\r\n\r\n                    default:\r\n                        view = new SideMenuCategoryView({\r\n                            model: model\r\n                        });\r\n                }\r\n\r\n                this.$(\".sidemenu__accordion-item-content\").filter(\"[data-index=\" + idx + \"]\").html(view.$el);\r\n            });\r\n\r\n            return;\r\n        }\r\n\r\n        onCloseBtnClick(event) {\r\n            this.model.toggle();\r\n        }\r\n        \r\n    };\r\n\r\n    return SideMenuView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './SideMenuCategoryCollection',\r\n    './SideMenuModel',\r\n    './SideMenuView'\r\n], function(Adapt, SideMenuCategoryCollection, SideMenuModel, SideMenuView) {\r\n\r\n    class SideMenu extends Backbone.Controller{\r\n\r\n        initialize() {\r\n\r\n            Adapt.on({\r\n                'app:dataReady': this.onDataReady.bind(this)\r\n            });\r\n            \r\n        }\r\n\r\n        onDataReady() {\r\n            \r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(Adapt, {\r\n                'router:page': this.renderSideMenuBtn\r\n            });\r\n        }\r\n\r\n        renderSideMenuBtn(pageModel) {\r\n\r\n            var categoryCollection = new SideMenuCategoryCollection(null, {\r\n                pageModel: pageModel\r\n            });\r\n\r\n            /**\r\n             * Going with non-drawer implementation (Adapt's core drawer functionality is too different).\r\n             * TODO: Have it still trigger the same drawer events as the core drawer.\r\n             */\r\n\r\n            // FIXME: BEING RENDERED TOO SOON! ArticleNav needs to change values on blocks first.\r\n            // Note: not sure what that FIXME means. It seems to be working now.\r\n            let sideMenuModel = new SideMenuModel({\r\n                \"_pageModel\": pageModel,\r\n                \"_categories\": categoryCollection\r\n            });\r\n            let sideMenuView = new SideMenuView({\r\n                model: sideMenuModel\r\n            });\r\n\r\n            this.sideMenuModel = sideMenuModel;\r\n\r\n            // Insert the sidemenu just after the real drawer.\r\n            $(\".drawer\").first().after(sideMenuView.$el);\r\n        }\r\n\r\n        toggle() {\r\n            this.sideMenuModel.toggle();\r\n        }\r\n    }\r\n\r\n    Adapt.sideMenu = new SideMenu();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n  \r\n    /**\r\n     * Collection hardcoded to store only Blocks.\r\n     */\r\n\r\n    class SideNavCollection extends Backbone.Collection {\r\n  \r\n      initialize(models, options) {\r\n        this.listenTo(Adapt, 'remove', this.reset);\r\n        if (!options || !options.pageModel) return;\r\n        this._pageModel = options.pageModel;\r\n        this.repopulate();\r\n      }\r\n  \r\n      repopulate() {\r\n        this.reset();\r\n        if (!this._pageModel) return;\r\n        \r\n        var allDescendants = this._pageModel.getAllDescendantModels(true);\r\n\r\n        // For our DD menu, we want to add all enabled Blocks\r\n        // (we don't use isActive because articleNav may have temporarily disabled it).\r\n        var allProgressItems = allDescendants.filter((item) => {\r\n            if (item.get(\"_type\") != \"block\") return false;\r\n            return Boolean(item.get(\"_isEnabled\"));\r\n        });\r\n\r\n        this.add(allProgressItems);\r\n      }\r\n    }\r\n  \r\n    return SideNavCollection;\r\n});\r\n  ","define([\r\n    'core/js/adapt',\r\n    'extensions/adapt-contrib-pageLevelProgress/js/completionCalculations'\r\n], function(Adapt, CompletionCalculations) {\r\n\r\n    /**\r\n     * FIXME: Doesn't support blocks with _isAvailable: false.\r\n     */\r\n\r\n    class SideNavProgressView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"sidenav__progress\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n           \r\n            this.setupEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setupEventListeners() {\r\n            this.listenTo(Adapt.blocks, 'change:_isComplete', this.onBlockCompletionChange);\r\n        }\r\n\r\n        render(){\r\n            var template = Handlebars.templates['sideNavProgress'];\r\n            this.$el.html(template(/*this.model.toJSON()*/));\r\n        }\r\n\r\n        onBlockCompletionChange(){\r\n\r\n            /*if (!Adapt.location._currentId) return;\r\n\r\n            var currentModel = Adapt.findById(Adapt.location._currentId);\r\n            var completionState = {\r\n                currentLocation: CompletionCalculations.calculatePercentageComplete(currentModel),\r\n                course: CompletionCalculations.calculatePercentageComplete(Adapt.course)\r\n            };\r\n\r\n            console.log(completionState);*/\r\n\r\n            let completionPercent = 0;\r\n            Adapt.blocks.each((model) => {\r\n                completionPercent += model.get(\"_completionPercent\");\r\n            });\r\n            completionPercent /= Adapt.blocks.length;\r\n\r\n            this.$(\".sidenav__progress-indicator-bar\").css({\r\n                height: completionPercent + \"%\"\r\n            });\r\n        }\r\n\r\n        // Whenever the progress is clicked, scroll the user to the first incomplete component.\r\n        onClick() {\r\n\r\n            this.scrollToFirstIncompleteComponent();\r\n        }\r\n\r\n        scrollToFirstIncompleteComponent() {\r\n\r\n            let incompleteComponent = Adapt.components.find((model) => {\r\n                return !model.get(\"_isComplete\") && model.getParent().get(\"_isAvailable\"); // Its block must be available (rendered).\r\n            });\r\n            if (!incompleteComponent) return;\r\n\r\n            Adapt.navigateToElement(\".\" + incompleteComponent.get(\"_id\"), {duration: 400});\r\n        }\r\n\r\n        scrollToFirstIncompleteBlock() {\r\n\r\n            let incompleteBlock = Adapt.blocks.find((model) => {\r\n                return !model.get(\"_isComplete\") && model.get(\"_isAvailable\"); // Must be available (rendered).\r\n            });\r\n            if (!incompleteBlock) return;\r\n\r\n            Adapt.navigateToElement(\".\" + incompleteBlock.get(\"_id\"), {duration: 400});\r\n        }\r\n        \r\n    };\r\n\r\n    return SideNavProgressView;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * FIXME: Doesn't support blocks with _isAvailable: false.\r\n     */\r\n\r\n    class BlocknumView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"sidenav__blocknum\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click\" : \"onClick\",\r\n                \"focus .js-sidenav-blocknum-input\" : \"onInputFocus\",\r\n                \"change .js-sidenav-blocknum-input\" : \"onInputChange\",\r\n                \"oninput .js-sidenav-blocknum-input\" : \"onInputChange\",\r\n                \"keydown .js-sidenav-blocknum-input\" : \"onInputChange\",\r\n                \"keyup .js-sidenav-blocknum-input\" : \"onInputKeyup\"\r\n                //\"click .btn__next\" : \"onNextClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.maxInputLength = 2;\r\n\r\n            this.setupEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        render(){\r\n            var template = Handlebars.templates['sideNavBlocknum'];\r\n            this.$el.html(template(/*this.model.toJSON()*/));\r\n        }\r\n\r\n        onInputFocus(event) {\r\n            let input = event.currentTarget;\r\n\r\n            // Store the value that was in the input upon focusing (in case the user cancels).\r\n            this.inputVal = input.value;\r\n        }\r\n\r\n        onInputChange(event) {\r\n            this.updateInput();\r\n        }\r\n\r\n        /**\r\n         * Limit the character length inside the input.\r\n         */\r\n        updateInput() {\r\n            let input = this.$(\".js-sidenav-blocknum-input\")[0];\r\n            if (input.value.length > this.maxInputLength) {\r\n                input.value = input.value.slice(0, this.maxInputLength);\r\n            }\r\n        }\r\n\r\n        onInputKeyup(event) {\r\n\r\n            this.updateInput();\r\n\r\n            // Special behaviour based on the character pushed.\r\n            let input = this.$(\".js-sidenav-blocknum-input\")[0];\r\n            if (event.which === 27) { // Esc\r\n\r\n                // Revert the value to whatever it was before the input was focused on.\r\n                input.value = this.inputVal;\r\n\r\n                // Unfocus the input.\r\n                $(input).blur();\r\n                \r\n                return false;\r\n            }\r\n            if (event.which === 13) { // Return\r\n\r\n                // Unfocus the input.\r\n                $(input).blur();\r\n\r\n                // If the value was deleted, restore the previous one and do nothing else.\r\n                if (!input.value)\r\n                {\r\n                    input.value = this.inputVal;\r\n                    return false;\r\n                }\r\n\r\n                // Only whole numbers allowed.\r\n                // FIXME: \"pattern\" HTML attribute only seems to do things on submit, which this doesn't.\r\n                let blockNum = parseInt(input.value); \r\n\r\n                // Find the block with the corresponding blockNum\r\n                let targetBlock = Adapt.blocks.find((block) => {\r\n                    return block.get(\"_blockNum\") == blockNum;\r\n                });\r\n                \r\n                // Block wasn't found, go to either the first or last block.\r\n                if (!targetBlock) {\r\n                    let firstBlock = _.first(Adapt.blocks.models);\r\n\r\n                    if (blockNum < firstBlock.get(\"_blockNum\")) targetBlock = firstBlock;\r\n                    else targetBlock = _.last(Adapt.blocks.models);\r\n                }\r\n\r\n                Adapt.scrollTo(\".\" + targetBlock.get(\"_id\"), {duration: 400});\r\n                this.setInputVal(targetBlock.get(\"_blockNum\"));\r\n\r\n                return;\r\n\r\n                var b = _this._findByBlockNum(val);\r\n                \r\n                // Block number provided doesn't correspond to any block. Take the user to the nearest alternative.\r\n                if (!b) {\r\n                    var firstBlock = _.first(Adapt[\"blocks\"].models);\r\n\r\n                    if (val < firstBlock.get(\"blockNum\")) b = firstBlock;  // Value is too low.\r\n                    else b = _.last(Adapt[\"blocks\"].models);               // Value is too high.\r\n                    \r\n                    val = b.get(\"blockNum\");\r\n                }\r\n\r\n                Adapt.pageLevelProgress.scrollToPageElement(b.get(\"_id\"));\r\n                _this._updateBlockNum(b); // Update the blockNum bar as soon as the user submits the value.\r\n\r\n                // Update the text value as soon as it is submitted.\r\n                $(this).val(val);\r\n            }\r\n        }\r\n\r\n        setInputVal(val) {\r\n            let input = this.$(\".js-sidenav-blocknum-input\")[0];\r\n            input.value = val;\r\n            this.inputVal = val;\r\n        }\r\n\r\n        // If the user clicks the blocknum, highlight the input field for editing.\r\n        onClick() {\r\n            let $input = this.$(\".js-sidenav-blocknum-input\");\r\n            $input.select();\r\n        }\r\n\r\n        setupEventListeners(){\r\n\r\n            this.listenTo(this.model, \"change:_inviewBlock\", this.onInviewBlockChange);\r\n        }\r\n\r\n        onInviewBlockChange(model, blockModel) {\r\n            \r\n            // Set the blockNum input value to be that of the currently onscreen blockNum.\r\n            this.setInputVal(blockModel.get(\"_blockNum\"));\r\n\r\n            // Stop listening for changes to _completionPercent on the previous blockModel.\r\n            if (this.model.get(\"_curBlock\")) {\r\n                this.stopListening(this.model.get(\"_curBlock\"), \"change:_completionPercent\");\r\n            }\r\n\r\n            // Set the progress value, and start listening for changes to it.\r\n            this.setProgressPercent(blockModel.get(\"_completionPercent\"));\r\n            this.model.set(\"_curBlock\", blockModel);\r\n            this.listenTo(this.model.get(\"_curBlock\"), \"change:_completionPercent\", this.onCurBlockCompletionPercentChange);\r\n        }\r\n\r\n        setProgressPercent(percentage) {\r\n            var $r = this.$(\".sidenav__blocknum-half-rot\");\r\n            var r = ((1 - percentage/100) * 180);\r\n\r\n            $r.eq(0).css({\r\n                \"transform\": \"rotate(\" + r + \"deg)\"\r\n            });\r\n            $r.eq(1).css({\r\n                \"transform\": \"rotate(\" + (-r) + \"deg)\"\r\n            });\r\n        }\r\n        \r\n        onCurBlockCompletionPercentChange(blockModel, completionPercent){\r\n            this.setProgressPercent(completionPercent);\r\n        }\r\n        \r\n    };\r\n\r\n    return BlocknumView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './sideNavProgressView',\r\n    './sideNavBlocknumView'\r\n], function(Adapt, SideNavProgressView, SideNavBlocknumView) {\r\n\r\n    /**\r\n     * This will be placed at the bottom / right of the sideNav bar and will contain the SideNavBlockView and the SideNavProgressView.\r\n     */\r\n\r\n    class SideNavWidgetView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"sidenav__widget\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                //\"click .btn__prev\" : \"onPrevClick\",\r\n                //\"click .btn__next\" : \"onNextClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setupEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        render(){\r\n            this.$el.append(new SideNavProgressView({model: this.model}).$el);\r\n            this.$el.append(new SideNavBlocknumView({model: this.model}).$el);\r\n        }\r\n\r\n        setUpModelData(){\r\n            this.model.set(\"_inviewBlock\", Adapt.blocks.models[0]);\r\n        }\r\n\r\n        // Listen for whenever a block moves into view.\r\n        setupEventListeners(){\r\n\r\n            this.listenTo(Adapt, \"blockView:postRender\", this.setUpBlockInview);\r\n        }\r\n\r\n        setUpBlockInview(view) {\r\n\r\n            view.$el.off(\"onscreen.sideNavBlockView\");\r\n            view.$el.on(\"onscreen.sideNavBlockView\", (event, m) => {\r\n\r\n                const threshold = 50;\r\n                \r\n                if (m.percentFromTop < threshold && m.percentFromBottom < threshold) {\r\n\r\n                    // Only one child will be active at once; the one that's closest to the vertical center of the screen.\r\n                    if (this.model.get(\"_inviewBlock\") && this.model.get(\"_inviewBlock\") !== view.model) {\r\n                        this.model.get(\"_inviewBlock\").set(\"_isInview\", false); // FIXME: Used by SideMenu.\r\n                    }\r\n\r\n                    this.model.set(\"_inviewBlock\", view.model);\r\n                    this.model.get(\"_inviewBlock\").set(\"_isInview\", true);\r\n                }\r\n            });\r\n        }\r\n\r\n        remove() {\r\n            Adapt.blocks.each((blockModel) => {\r\n                Adapt.findViewByModelId(blockModel.get(\"_id\")).$el.off(\"onscreen.sideNavBlockView\");\r\n            });\r\n\r\n            Backbone.View.remove.apply(this, arguments);\r\n        }\r\n        \r\n    };\r\n\r\n    return SideNavWidgetView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './SideNavCollection',\r\n    './SideNavWidgetView'\r\n], function(Adapt, SideNavCollection, SideNavWidgetView) {\r\n\r\n    /**\r\n     * (Code based on implementation of adapt-contrib-pageLevelProgress extension).\r\n     */\r\n\r\n    class SlideNav extends Backbone.Controller{\r\n\r\n        initialize() {\r\n\r\n            Adapt.on({\r\n                'app:dataReady': this.onDataReady.bind(this)\r\n            });\r\n\r\n            \r\n        }\r\n\r\n        onDataReady() {\r\n\r\n            Adapt.scrolling.isLegacyScrolling = false;\r\n\r\n            // Do not proceed if pageLevelProgress is not enabled in course.json\r\n            /*var coursePLPConfig = this.getCourseConfig();\r\n            if (!coursePLPConfig || !coursePLPConfig._isEnabled) {\r\n                return;\r\n            }*/\r\n            this.setUpBlocks();\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        // Assign sequential block numbers to all blocks in the course.\r\n        // These will be how the student / tutor will identify them.\r\n        setUpBlocks() {\r\n            Adapt.blocks.each((block, index) => {\r\n                \r\n                // Block numbers.\r\n                block.set(\"_blockNum\", index + 1);\r\n\r\n                // Block completion percent (based on the number of completed child components).\r\n                block.set(\"_completionPercent\", 0);\r\n            });\r\n        }\r\n      \r\n        setUpEventListeners() {\r\n\r\n            /*var headerIndicatorTypes = [\r\n              'menu',\r\n              'menuItem',\r\n              'page',\r\n              'article',\r\n              'block',\r\n              'component'\r\n            ];\r\n      \r\n            var headerIndicatorEventNames = headerIndicatorTypes\r\n              .concat(['']).join('View:render ');\r\n      \r\n            this.listenTo(Adapt, headerIndicatorEventNames, this.renderHeaderIndicatorView);*/\r\n      \r\n            this.listenTo(Adapt, {\r\n              //'menuItemView:postRender': this.renderMenuItemIndicatorView,\r\n              'router:page': this.renderNavigationView\r\n            });\r\n\r\n            // Keep track of each block's completion percentage.\r\n            \r\n            //this.listenTo(Adapt.course, 'bubble:change:_isComplete', this.onCompletionChange);\r\n            this.listenTo(Adapt.components, \"change:_isComplete\", this.onComponentCompletionChange);\r\n        }\r\n\r\n        /*onCompletionChange() {\r\n\r\n            if (!Adapt.location._currentId) return;\r\n            console.log(Adapt.location);\r\n\r\n            var currentModel = Adapt.findById(Adapt.location._currentId);\r\n            var completionState = {\r\n                currentLocation: CompletionCalculations.calculatePercentageComplete(currentModel),\r\n                course: CompletionCalculations.calculatePercentageComplete(Adapt.course)\r\n            };\r\n\r\n            console.log(currentModel.get(\"_id\") + \" \" + completionState.currentLocation);\r\n        }*/\r\n\r\n        onComponentCompletionChange(componentModel, isComplete) {\r\n            \r\n            // Update the percentage complete on the parent block based on the completion percentage of its child components.\r\n            let block = componentModel.getParent();\r\n            let blockPercentCompletion = 0;\r\n\r\n            block.getChildren().each((componentModel) => {\r\n\r\n                blockPercentCompletion += (componentModel.get(\"_isComplete\") /*|| componentModel.get(\"_isOptional\")*/) ? 1 : 0;\r\n            });\r\n\r\n            blockPercentCompletion /= block.getChildren().length;\r\n            block.set(\"_completionPercent\", blockPercentCompletion*100);\r\n        }\r\n\r\n        renderNavigationView(pageModel){\r\n\r\n            var collection = new SideNavCollection(null, {\r\n                pageModel: pageModel\r\n            });\r\n\r\n            this.collection = collection;\r\n\r\n            $(\".nav[role='navigation']\").addClass(\"sidenav\"); \r\n            \r\n            this.renderSideNavWidget();\r\n\r\n            /*.append(new SideNavView({\r\n                model: pageModel,\r\n                collection: collection\r\n            }).$el);\r\n\r\n            $('.slidenav__progress').after(new SideNavBlocknumView({\r\n                //model: pageModel,\r\n                //collection: collection\r\n            }).$el);*/\r\n        }\r\n\r\n        renderSideNavWidget() {\r\n            $('.nav__inner').append(new SideNavWidgetView({\r\n                model: new Backbone.Model()\r\n                //collection: collection\r\n            }).$el);\r\n        }\r\n    };\r\n\r\n    Adapt.sideNav = new SlideNav();\r\n    \r\n    //var slideNav = new SlideNav();\r\n\r\n    /*Adapt.on('pageView:ready', function(view) {\r\n        $(\".nav\").addClass(\"sidenav\");\r\n    });*/\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * adapt-events\r\n     * ============\r\n     * \r\n     * Description:\r\n     * ------------\r\n     * Core Adapt doesn't seem to have any way of listening for a preRender / postRender on individual models,\r\n     * instead requiring the events be listened to globally.\r\n     * \r\n     * Warning:\r\n     * --------\r\n     * There could be a good reason why core Adapt doesn't come with these events.\r\n     * Try to avoid using too much until they've been fully tested.\r\n     */\r\n\r\n    class Events extends Backbone.Controller{\r\n\r\n        initialize() {\r\n            \r\n            Adapt.on({\r\n                'app:dataReady': this.onDataReady.bind(this)\r\n            });\r\n        }\r\n\r\n        onDataReady() {\r\n            // Make global events listenable on an individual level.\r\n            Adapt.on(\"componentView:preRender\", this.componentViewPreRender.bind(this));\r\n            Adapt.on(\"componentView:postRender\", this.componentViewPostRender.bind(this));\r\n            Adapt.on(\"blockView:preRender\", this.blockViewPreRender.bind(this));\r\n            Adapt.on(\"blockView:postRender\", this.blockViewPostRender.bind(this));\r\n\r\n            // New helper events:\r\n            // -----------------------------------\r\n\r\n            // blockView:childrenReady\r\n            Adapt.blocks.each((blockModel) => {\r\n                \r\n                blockModel.listenTo(blockModel.getChildren(), {\r\n                    \"change:_isReady\": (model) => {\r\n\r\n                        // Check if the block's children have any !isReady members remaining.\r\n                        let notReadyChild = blockModel.getChildren().find((child) => {\r\n                            return !child.get(\"_isReady\");\r\n                        });\r\n                        // If there is, then don't trigger the event yet.\r\n                        if (notReadyChild) {\r\n                            return;\r\n                        }\r\n\r\n                        // All children are ready.\r\n                        let blockView = Adapt.findViewByModelId(blockModel.get(\"_id\"));\r\n                        blockModel.trigger(\"blockView:childrenReady\", blockView);\r\n                        Adapt.trigger(\"blockView:childrenReady view:childrenReady\", blockView); // Trigger globally too.\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n        componentViewPreRender(view) {view.model.trigger(\"componentView:preRender\", view);}\r\n        componentViewPostRender(view) {view.model.trigger(\"componentView:postRender\", view);}\r\n        blockViewPreRender(view) {view.model.trigger(\"blockView:preRender\", view);}\r\n        blockViewPostRender(view) {view.model.trigger(\"blockView:postRender\", view);}\r\n    }\r\n\r\n    new Events();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class ExtraLearningPopupView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"extralearning-popup \" + (this.model.get(\"_classes\") || \"\");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .js-extralearning-icon\" : \"closePopup\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenToOnce(Adapt, \"notify:opened\", this.onOpened);\r\n            this.listenTo(Adapt, \"notify:closed\", this.onNotifyClosed);\r\n        }\r\n\r\n        closePopup() {\r\n            Adapt.trigger('notify:close');\r\n        }\r\n\r\n        onOpened() {\r\n            \r\n            // Hide the icon in the popup until it has been fully transformed.\r\n            this.$(\".js-extralearning-icon\").addClass(\"u-visibility-hidden\");\r\n\r\n            // Set up the large popup icon to be in the same location and the same size as the parent button's icon.\r\n            this.$el.imageready(_.debounce(this.setUpIconTransition.bind(this), 0));\r\n        }\r\n\r\n        onNotifyClosed(notifyView) {\r\n\r\n            // Check that the notify that was just closed was the one that contained this view.\r\n            // (Prevents bugs caused by stacking multiple notifys).\r\n            if (notifyView.model.get(\"_view\") !== this) return;\r\n\r\n            this.$el.addClass(\"is-closed\");\r\n            this.alignIconToParent(); // Re-align the icon just in case.\r\n            this.$(\".js-extralearning-icon\").removeClass(\"is-active\"); // Have the icon animate back to the parentView.\r\n        }\r\n\r\n        remove() {\r\n            this.model.trigger(\"remove\");\r\n            super.remove();\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['extraLearningPopup'];\r\n            this.$el.html(template(data));\r\n        }\r\n\r\n        setUpIconTransition() {\r\n            this.alignIconToParent();\r\n            this.$(\".js-extralearning-icon\")\r\n                .hide(0)\r\n                .removeClass(\"u-visibility-hidden\")\r\n                .show(0) // Skip the initial CSS transition for the icon.\r\n                .addClass(\"is-active\");\r\n        }\r\n\r\n        /**\r\n         * Notify revealing animation:\r\n         * ---------------------------\r\n         * Have the .extralearning__icon element in the popup look like the one from the parentView's button\r\n         * initially, then grow to the final reveal size (making it look like one and the same).  \r\n         */\r\n        alignIconToParent() {\r\n\r\n            let parentView = this.model.get(\"_parentView\"); // This value is set by ExtraLearningView.\r\n\r\n            let $icon = this.$(\".js-extralearning-icon\");\r\n            let $parentIcon = parentView.$(\".js-extralearning-icon\");\r\n\r\n            $icon.css({\r\n                \"transform\": \"\"\r\n            })\r\n\r\n            // FIXME: Throws errors if element missing.\r\n            let iconBB = $icon[0].getBoundingClientRect();\r\n            let parentIconBB = $parentIcon[0].getBoundingClientRect();\r\n\r\n            // Transform the $icon to place it over the $parentIcon (and make it look like it's the same thing).\r\n            let offset = {\r\n                top: parentIconBB.top - iconBB.top,\r\n                left: parentIconBB.left - iconBB.left\r\n            }\r\n\r\n            // Uniform scaling only.\r\n            let scale = parentIconBB.width / iconBB.width;\r\n\r\n            $icon.css({\r\n                \"transform\": \"translate(\" + offset.left + \"px, \" + offset.top + \"px) scale(\" + scale + \")\"\r\n            });\r\n\r\n            // Make the parentIcon invisible until this notify is closed.\r\n            $parentIcon.addClass(\"u-visibility-hidden\");\r\n\r\n            return $icon;\r\n        }\r\n    };\r\n\r\n    return ExtraLearningPopupView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './extraLearningPopupView'\r\n], function(Adapt, ExtraLearningPopupView) {\r\n\r\n    /**\r\n     * TODO: https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/button_role (scrolldown and see Note: section).\r\n     */\r\n\r\n    class ExtraLearningView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"extralearning extralearning-btn\";\r\n        }\r\n\r\n        tagName() {\r\n            return \"div\"\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .js-extralearning-btn\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            //this.setUpViewData();\r\n            this.render();\r\n        }\r\n\r\n        setUpViewData() {\r\n            this.popupView = null;\r\n            this._isPopupOpen = false;\r\n        }\r\n\r\n        render(){\r\n            let template = Handlebars.templates['extraLearning'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n        }\r\n\r\n        onClick(){\r\n            this.openPopup();\r\n        }\r\n\r\n        /**\r\n         * Open a popup using the default Adapt notify functionality.\r\n         */\r\n        openPopup() {\r\n\r\n            if (this._isPopupOpen) return;\r\n            this._isPopupOpen = true;\r\n    \r\n            let popupModel = new Backbone.Model(_.extend(\r\n                {},\r\n                this.model.get(\"_popupData\"),\r\n                {\r\n                    // VERY IMPORTANT! Used by Handlebars.getComponentModelFromContext()\r\n                    _parent: this.model.get(\"_componentParent\"), \r\n\r\n                    _parentView: this,\r\n                    _type: this.model.get(\"_type\")\r\n                }) // The popup uses a reference to this View to set up its icon animation.\r\n            );\r\n\r\n            this.popupView = new ExtraLearningPopupView({\r\n                model: popupModel\r\n            });\r\n    \r\n            this.notifyView = Adapt.notify.popup({\r\n                _view: this.popupView,\r\n                _isCancellable: true,\r\n                _showCloseButton: true,\r\n                _classes: 'extralearning'// + (this.model.get('_classes') || \"\")\r\n            });\r\n            //this.listenTo(notifyView.model, \"change:_isReady\", (model, isReady) => {console.log(isReady);});\r\n\r\n            this.listenTo(Adapt, {\r\n                // Important to use notify:closed instead of popup:closed (the former has a better callback).\r\n                'notify:closed': this.onPopupClosed\r\n            });\r\n\r\n            // Wait for the popup to be fully removed before swapping the graphic visibilities.\r\n            this.listenToOnce(popupModel, \"remove\", this.onPopupRemoved);\r\n        }\r\n\r\n        onPopupClosed(notifyView) {\r\n\r\n            // If the popup that was just closed was NOT this one, do nothing.\r\n            if (notifyView.model.get(\"_view\") !== this.popupView) return;\r\n\r\n            // Popup is closed; stop listening for it.\r\n            this.stopListening(Adapt, \"notify:closed\", this.onPopupClosed);\r\n\r\n            this.$el.addClass(\"is-visited\");\r\n            this._isPopupOpen = false;\r\n        }\r\n\r\n        onPopupRemoved() {\r\n            this.$(\".js-extralearning-icon\").removeClass(\"u-visibility-hidden\");\r\n        }\r\n    };\r\n\r\n    return ExtraLearningView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './extraLearningView'\r\n], function(Adapt, ExtraLearningView) {\r\n\r\n    /**\r\n     * adapt-extraLearning\r\n     * --------------------------------------\r\n     * This extension renders an inline extraLearning button which shows a popup for optional learning material when clicked.\r\n     * \r\n     * LIMITATIONS:\r\n     * - Can only be used within componentViews (and any notify popups they create) at this time.\r\n     * \r\n     * FIXME:\r\n     * - If the button is double-clicked, will cause the animation to bug out (does not break the content though).\r\n     */\r\n\r\n    Adapt.on('router:page', () => {\r\n\r\n        Handlebars.registerHelperEl(\"extraLearning\", function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n            let hash = context.hash;\r\n\r\n            // Find the componentModel that this Helper was placed in.\r\n            let componentModel = Handlebars.getComponentModelFromContext(context);\r\n\r\n            // Find the corresponding popup data that was added in the \"partial\" to the component's data.\r\n            let id = hash.id;\r\n            let popupData = _.find(componentModel.get(\"_extraLearning\")._items, (extraLearningItem) => {\r\n                return extraLearningItem._id == id;\r\n            });\r\n            if (!popupData) throw \"{{#extraLearning}}: Could not find _extraLearning._items element with _id: \\\"\" + id + \"\\\"\";\r\n\r\n            // Set the text on the button to what was defined in course.json\r\n            let _default = Adapt.course.get(\"_extraLearning\");\r\n            if (!_default) {\r\n                throw \"No \\\"_extraLearning\\\" property defined in course.json.\\n\\nSee src/extensions/adapt-extraLearning/example.json for instructions.\";\r\n            }\r\n\r\n            let type = popupData._type;\r\n            let title = \"MISSING_TITLE_ERROR\";\r\n            if (!_default[type]) {\r\n                throw \"Could not find course._extraLearning data with key(\\\"_type\\\"): \\\"\" + type + \"\\\".\";\r\n            }\r\n            title = _default[type].title;\r\n            let content = context.fn ? context.fn(this).trim() : undefined;\r\n\r\n            let modelJSON = {\r\n                content: content,\r\n                title: content || popupData.title || title,\r\n                _type: type,\r\n                _componentParent: componentModel,\r\n                _popupData: popupData\r\n            };\r\n\r\n            return new ExtraLearningView({\r\n                model: new Backbone.Model(_.extend({}, hash, modelJSON))\r\n            }).$el;\r\n        });\r\n    });\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * Keeps track of the Lottie animation object and updates model values accordingly.\r\n     */\r\n\r\n    class LottieModel extends Backbone.Model{\r\n\r\n        defaults() {\r\n            return {\r\n                \"anim\": null,               // Lottie animation object. LottieView assigns it once it has been loaded.\r\n                \r\n                // Settings passed through Handlebars helper\r\n                // -----------------------------------------\r\n                \"loops\": 1,                 // How many times the animation should play before stopping (supports decimal values).\r\n                \"_controlsType\": \"none\",    // What style of controls the Lottie should have.\r\n                \"isDecorative\": true,       // TBA: Non-decorative animations to have proper video controls.\r\n                \r\n                // Calculated\r\n                // -----------------------------------------\r\n                \"_isPlaying\": true,\r\n                \"_duration\": 0,             // Animation duration in seconds.\r\n                \"_loopsNum\": 0,             // How manu full loops the animation has completed.\r\n                \"_isComplete\": false,       // == true when the animation pauses after completing all of its loops.\r\n                \r\n                // FIXME: Weird implementation...\r\n                \"_resetOnOutview\": true,    // If true, the Lottie will reset itself whenever it's scrolled out of view\r\n                \"_resetOnOutviewEnabled\": true,  // Will be toggled on and off by other scripts.\r\n            }\r\n        }\r\n        \r\n        initialize() {\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            \r\n            // Wait for the animation to load before proceeding.\r\n            this.listenToOnce(this, \"change:anim\", this.onAnimLoad);\r\n            \r\n            // Playback events.\r\n            this.listenTo(this, \"change:_isPlaying\", this.onIsPlayingChange);\r\n            this.listenTo(this, \"change:_isComplete\", this.onIsCompleteChange);\r\n        }\r\n\r\n        onIsPlayingChange(model, isPlaying) {\r\n            let anim = this.get(\"anim\");\r\n            if (!anim) return; // Wait for the animation to be loaded before affecting it.\r\n\r\n            if (!isPlaying) {anim.pause();}\r\n            else {anim.play();}\r\n        }\r\n\r\n        onIsCompleteChange(model, isComplete) {\r\n            \r\n            /**\r\n             * If the animation completes, and has a reset button, don't reset it when it's scrolled out of view anymore.\r\n             * FIXME: This rule could be implemented more clearly.\r\n             */\r\n            if (isComplete) {\r\n\r\n                if (this.get(\"_controlsType\") == \"basic\") {\r\n                    this.set(\"_resetOnOutviewEnabled\", false);\r\n                }\r\n            }\r\n            else {\r\n\r\n                if (this.get(\"_controlsType\") == \"basic\") {\r\n                    this.set(\"_resetOnOutviewEnabled\", true);\r\n                }\r\n            }\r\n        }\r\n\r\n        checkResetOnOutview() {\r\n            return this.get(\"_resetOnOutview\") && this.get(\"_resetOnOutviewEnabled\");\r\n        }\r\n\r\n        setUpAnimEventListeners() {\r\n\r\n            let anim = this.get(\"anim\");\r\n\r\n            anim.addEventListener('loopComplete', this.onAnimLoopComplete.bind(this));\r\n            anim.addEventListener('enterFrame', this.onAnimEnterFrame.bind(this));\r\n        }\r\n\r\n        onAnimLoopComplete() {\r\n            // Increment the loop count\r\n            this.set(\"_loopsNum\", this.get(\"_loopsNum\") + 1);\r\n\r\n            // Pause if at the end of the loop\r\n            // (only works if this.get(\"loops\") is a whole number, otherwise onAnimEnterFrame handles it).\r\n            if (this.get(\"_loopsNum\") >= this.get(\"loops\")) {\r\n                this.pause(this.get(\"_duration\") - 1);\r\n                this.set(\"_isComplete\", true);\r\n            }\r\n        }\r\n\r\n        // Returns the location in the animation from 0-1.\r\n        getProgressPercent() {\r\n            let anim = this.get(\"anim\");\r\n            if (!anim) return 0;\r\n            \r\n            return anim.currentFrame / anim.totalFrames;\r\n        }\r\n\r\n        onAnimEnterFrame(event) {\r\n\r\n            // Only respond to frame changes while playing.\r\n            if (!this.get(\"_isPlaying\")) return;\r\n\r\n            // Note: event.currentTime = the current FRAME the animation's on.\r\n\r\n            let currentProgressPercent = event.currentTime / event.totalTime;\r\n            this.set(\"_currentProgressPercent\", currentProgressPercent);\r\n\r\n            // Pause the animation when the final loop is reached (only if \"loops\" isn't a whole number).\r\n            // (If \"loops\" is = to 1.5, the animation will play 1.5 times).\r\n            if (this.get(\"loops\") % 1 !== 0 && this.get(\"_loopsNum\") + currentProgressPercent > this.get(\"loops\")) {\r\n\r\n                let duration = this.get(\"_duration\");\r\n                let pauseTime = duration * (this.get(\"loops\") % 1) - 1;\r\n                if (pauseTime < 0) pauseTime = duration - 1; // If the time is < 0, then pause at the end of the duration.\r\n\r\n                this.pause(pauseTime);\r\n                this.set(\"_isComplete\", true);\r\n            }\r\n        }\r\n\r\n        onAnimLoad(model, anim) {\r\n            \r\n            if (!anim) throw \"lottieModel: an unexpected error has occured (Lottie animation object is falsy).\";\r\n\r\n            this.set(\"_duration\", anim.getDuration() * 1000); // Returns duration in seconds; needs to be converted to milliseconds.\r\n\r\n            // If an external script has changed the value of _isPlaying, then play the animation as soon as it's ready.\r\n            this.onIsPlayingChange(this, this.get(\"_isPlaying\"));\r\n\r\n            this.setUpAnimEventListeners();\r\n        }\r\n\r\n        pause(time) {\r\n            this.set(\"_isPlaying\", false);\r\n            if (time !== undefined) {\r\n                this.get(\"anim\")?.goToAndStop(time, false); // Stop the animation at the specific time (in milliseconds).\r\n            \r\n            }\r\n        }\r\n\r\n        play(time) {\r\n            this.set(\"_isPlaying\", true);\r\n            if (time !== undefined) {\r\n                this.get(\"anim\")?.goToAndPlay(time, false); // Play the animation at the specific time (in milliseconds).\r\n            }\r\n        }\r\n\r\n        toggle() {\r\n            this.set(\"_isPlaying\", !this.get(\"_isPlaying\"));\r\n        }\r\n\r\n        /** Legacy */\r\n        isLoopsComplete(){\r\n            return Boolean(this.get(\"_isComplete\"));\r\n        }\r\n\r\n        isComplete() {\r\n            return Boolean(this.get(\"_isComplete\"));\r\n        }\r\n\r\n        isDecorative(){\r\n            return Boolean(this.get(\"isDecorative\"));\r\n        }\r\n\r\n        reset() {\r\n            this.set(\"_loopsNum\", 0);           // Reset loop counter.\r\n            this.set(\"_isComplete\", false);\r\n            this.play(0);\r\n        }\r\n    }\r\n\r\n    return LottieModel;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    // FIXME: Improve element naming.\r\n\r\n    class LottieControlsView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"lottie__controls\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .js-controls-playpause\" : \"onPlayPauseClick\"\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        onPlayPauseClick() {\r\n\r\n            // If all the loops have finished, reset the animation from the start.\r\n            if (this.model.isLoopsComplete()) {\r\n                this.model.reset();\r\n                return;\r\n            }\r\n\r\n            // If the animation is decorative, don't allow any interaction until it's finished.\r\n            if (this.model.isDecorative()) return;\r\n\r\n            // Otherwise, pause the animation instead.\r\n            this.model.toggle();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            \r\n        }\r\n\r\n        render() {\r\n            this.$el.html(new Handlebars.SafeString(Handlebars.templates['lottieControls'](this.model.toJSON())).string);\r\n        }\r\n    };\r\n\r\n    return LottieControlsView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    'libraries/lottie.min.js',\r\n    './lottieControlsView'\r\n], function(Adapt, Lottie, LottieControlsView) {\r\n\r\n    /**\r\n     * Guide: https://airbnb.io/lottie/#/web\r\n     * \r\n     * FIXME:\r\n     * - If possible, set up NPM to automatically keep the lottie.min.js file in the libraries up to date.\r\n     * - If in EPUB mode, then the mutationObserver MUST ignore this element.\r\n     */\r\n\r\n    const INTERSECTION_THRESHOLD = 0.99; // Setting to 1 breaks on small devices, so this is used instead.\r\n\r\n    Lottie.setQuality('high');\r\n\r\n    class LottieView extends Backbone.View {\r\n\r\n        className() {\r\n\r\n            let classNames = [\r\n                \"lottie\",\r\n                this.model.get(\"theme\") ? \"theme-\" + this.model.get(\"theme\") : \"\",\r\n                this.model.get(\"_controlsType\") ? \"controls-type-\" + this.model.get(\"_controlsType\") : \"\",\r\n                this.model.get(\"isDecorative\") ? \"is-decorative\" : \"\"\r\n            ]\r\n\r\n            return classNames.join(' ');\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                name: this.model.get(\"name\"),\r\n                \"aria-busy\": true\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.setUpModelData();\r\n            this.setUpEventListeners();\r\n            this.render();\r\n\r\n            // Reset autoplaying Lotties whenever they're scrolled into view.\r\n            if (this.model.get(\"autoplay\")) {\r\n                this.setUpIntersectionObserver();\r\n            }\r\n        }\r\n\r\n        setUpModelData() {\r\n            \r\n            // Always start off paused.\r\n            // If \"autoplay\": true, then the Lottie will start playing once it's scrolled into view.\r\n            this.model.set(\"_isPlaying\", false);\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(this.model, \"change:_isPlaying\", this.onIsPlayingChange);\r\n            this.listenTo(this.model, \"change:_isComplete\", this.onIsCompleteChange);\r\n            this.listenTo(this.model, \"change:_isReady\", this.onIsReadyChange);\r\n\r\n            // adapt-stickyBlock compatibility\r\n            // -------------------------------\r\n            // If this animation is set to be decorative, and is inside a graphic component belonging to a stickyBlock.\r\n            // have it reset each time it's scrolled into view.\r\n            this.listenTo(this.model.get(\"_parent\"), \"stickyBlock:inview\", this.onParentStickyBlockInview);\r\n            this.listenTo(this.model.get(\"_parent\"), \"stickyBlock:outview\", this.onParentStickyBlockOutview);\r\n\r\n\r\n            // adapt-annotation compatibility\r\n            // -------------------------------\r\n            // Start playing if activated by an annotation.\r\n            this.$el.on(\"annotation:active\", () => {\r\n                this.model.reset();\r\n            });\r\n            // Reset and pause if deactivated.\r\n            this.$el.on(\"annotation:inactive\", () => {\r\n                this.model.reset();\r\n                this.model.pause(0);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Observe when the Lottie is inview and reset its animation if applicable.\r\n         */\r\n        setUpIntersectionObserver(){\r\n\r\n            // Observe when the Lottie is inview.\r\n            const observer = new IntersectionObserver((entries) => {\r\n                entries.forEach(this.onAutoplayIntersection.bind(this));\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                rootMargin: '0px',\r\n                // Only start autoplaying once the entire View element is visible.\r\n                // Only pause once the entire View element is hidden.\r\n                threshold: [INTERSECTION_THRESHOLD,0]\r\n            });\r\n            observer.observe(this.$(\".js-lottie-container\")[0]);\r\n        }\r\n\r\n        onAutoplayIntersection(entry) {\r\n\r\n            if (entry.isIntersecting && entry.intersectionRatio >= INTERSECTION_THRESHOLD) this.onAutoplayInview();\r\n            else if (!entry.isIntersecting && entry.intersectionRatio == 0) this.onAutoplayOutview();\r\n        }\r\n\r\n        // When scrolled out of view, stop playing.\r\n        onAutoplayOutview() {\r\n\r\n            if (this.model.checkResetOnOutview()) {\r\n                this.model.reset();\r\n                this.model.pause(0);\r\n            }\r\n        }\r\n\r\n        onAutoplayInview() {\r\n\r\n            // Only reset if not already playing.\r\n            if (!this.model.get(\"_isPlaying\")) {\r\n                if (this.model.checkResetOnOutview()) {\r\n                    this.model.reset();\r\n                }\r\n            }\r\n        }\r\n\r\n        // Reset and play when the stickyBlock (if there is one) shows the component this LottieView is in.\r\n        onParentStickyBlockInview() {\r\n\r\n            // BUGFIX: StickyBlock triggers an inview on every item when rendered in mobile view.\r\n            // Ignore that trigger. FIXME: Poor encapsulation. \r\n            if (Adapt.device.screenSize !== 'large') return;\r\n\r\n            // In certain states; we DON'T want the Lottie to reset when scrolled out of view.\r\n            if (this.model.checkResetOnOutview()) {\r\n                this.model.reset();\r\n            }\r\n        }\r\n\r\n        // Reset and pause if the stickyBlock is fully out of view.\r\n        onParentStickyBlockOutview() {\r\n\r\n            // BUGFIX: StickyBlock triggers an inview on every item when rendered in mobile view.\r\n            // Ignore that trigger. FIXME: Poor encapsulation.\r\n            if (Adapt.device.screenSize !== 'large') return;\r\n\r\n            // In certain states; we DON'T want the Lottie to reset when scrolled out of view.\r\n            if (this.model.checkResetOnOutview()) {\r\n                this.model.reset();\r\n                this.model.pause(0);\r\n            }\r\n        }\r\n\r\n        onIsReadyChange(model, isReady) {\r\n\r\n            this.$el.toggleClass(\"is-ready\", isReady);\r\n        }\r\n\r\n        onIsPlayingChange(model, isPlaying) {\r\n            this.$el.toggleClass(\"is-playing\", isPlaying);\r\n            this.$el.toggleClass(\"is-paused\", !isPlaying);\r\n        }\r\n\r\n        onIsCompleteChange(model, isComplete) {\r\n            this.$el.toggleClass(\"is-complete\", isComplete);\r\n        }\r\n\r\n        render() {\r\n            this.$el.html(new Handlebars.SafeString(Handlebars.templates['lottie'](this.model.toJSON())).string);\r\n            this.renderLottie();\r\n        }\r\n\r\n        renderLottie() {\r\n\r\n            let startLoadTime = new Date();\r\n            let anim;\r\n\r\n            try {\r\n                anim = Lottie.loadAnimation({\r\n                    container: this.$(\".js-lottie-container\")[0],\r\n                    path: this.model.get(\"src\"),\r\n                    renderer: 'svg',\r\n                    \r\n                    // Optional\r\n                    loop: true,\r\n                    autoplay: false, //this.model.get(\"autoplay\"),\r\n                    name: this.model.get(\"src\"),\r\n                });\r\n            }\r\n            catch (err) {\r\n\r\n            }\r\n\r\n            // Wait for the animation to fully load, then callback.\r\n            anim.addEventListener('DOMLoaded', () => {\r\n\r\n                let callback = () => {\r\n\r\n                    this.$el.attr(\"aria-busy\", false);\r\n\r\n                    // Initialize LottieControlsView.\r\n                    this.model.set(\"anim\", anim);\r\n                    this.model.set(\"_isReady\", true);\r\n                    \r\n                    this.$(\".lottie__controls-container\").html(new LottieControlsView({model: this.model}).$el);\r\n                };\r\n                \r\n                callback();\r\n            }, () => {\r\n                \r\n            });\r\n        }\r\n\r\n    };\r\n\r\n    return LottieView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './lottieModel',\r\n    './lottieView'\r\n], function(Handlebars, Adapt, LottieModel, LottieView) {\r\n\r\n    /**\r\n     * adapt-lottie\r\n     * --------------------------------------\r\n     * Embeds a AirBNB Lottie (https://airbnb.io/lottie/) animation using a Handlebars helper.\r\n     * \r\n     * TBA: Allow for more customization.\r\n     */\r\n\r\n    /**\r\n     * context.hash properties:\r\n     * ------------------------\r\n     * @param {string}  src                 Location of the Lottie animation .json.\r\n     * @param {string}  controls            Which style of controls to use. Possible values: \"\" | \"none\" (default) | \"basic\" | \"full\" \r\n     * @param {boolean} [autoplay=false]    If false, the user will need to click to start the animation.\r\n     */\r\n    Handlebars.registerHelperEl(\"lottie\", function() {\r\n        let context = arguments[arguments.length-1];\r\n\r\n        // Check for mandatory properties.\r\n        if (!context.hash.src) throw \"{{{lottie}}} helper: the \\\"src\\\" property must be defined.\";\r\n\r\n        let componentModel = Handlebars.getComponentModelFromContext(context);\r\n\r\n        // Pass all properties to the model.\r\n        let modelJSON = _.extend({\r\n            _parent: componentModel,\r\n            _controlsType: context.hash.controls || \"none\",\r\n            autoplay: false,\r\n            loops: context.hash.loops !== undefined ? context.hash.loops : 1,\r\n            theme: context.hash.theme || \"\" // Set the theme for the Lottie animation.\r\n        }, context.hash);\r\n\r\n        return new LottieView({\r\n            model: new LottieModel(modelJSON)\r\n        }).$el\r\n    });\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n\r\n    class MarkChainModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                \"_name\": \"\",        // Name assigned to all Models belonging to this group.\r\n                \"_isReady\": false,  // Set externally by adapt-markChain once all models in the same collection as this one are ready.\r\n                \r\n                \"_prev\": null,      // Reference to the prev MarkChainModel in the chain (if any).\r\n                \"_next\": null       // Reference to the next MarkChainModel in the chain (if any).\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n\r\n            this.setUpLabel();\r\n            this.setUpEventListeners();    \r\n        }\r\n\r\n        // Niche: if the label's length is between 1-3 characters, indicate it with a class.\r\n        setUpLabel() {\r\n            let label = this.get(\"label\");\r\n            if (!label) return;\r\n\r\n            if (label.length >= 1 && label.length <= 3) {\r\n                this.set(\"_isSmallLabel\", true);\r\n            }\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenToOnce(this, \"change:_isReady\", this.onReadyChange);\r\n        }\r\n\r\n        onReadyChange(model, isReady) {\r\n            if (!isReady) throw \"An unexpected error has occurred (\\\"_isReady\\\" should not be false).\";\r\n\r\n            let prev = this.collection.at(this.collection.indexOf(this) - 1);\r\n            this.set(\"_prev\", prev);\r\n\r\n            let next = this.collection.at(this.collection.indexOf(this) + 1);\r\n            this.set(\"_next\", next);\r\n        }\r\n    };\r\n\r\n    return MarkChainModel;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt'\r\n], function(Handlebars, Adapt) {\r\n\r\n    class MarkChainView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"markchain\",\r\n                this.model.get(\"theme\") ? `theme-${this.model.get(\"theme\")}` : \"\",\r\n                this.model.get(\"class\") || \"\"\r\n            ];\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        attributes() {\r\n\r\n            let attr = {\r\n                \"name\": this.model.get(\"name\"),\r\n                \"style\": this.model.get(\"style\"),\r\n                \"data-markchain-idx\": this.model.get(\"_idx\") || -1  // Optional _idx property.\r\n            }\r\n\r\n            // adapt-stickyElement compatibility.\r\n            // EDIT: Nevermind; this doesn't work.\r\n            /*if (this.model.get(\"se_hide\")) {\r\n                attr[\"data-stickyelement-mark-idx\"] = this.model.get(\"se_hide\");\r\n            }*/\r\n\r\n            return attr;\r\n        }\r\n\r\n        tagName() {\r\n            return \"span\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \r\n            }\r\n        }\r\n\r\n        async initialize() {\r\n            \r\n            this.render();\r\n            this.setUpEventListeners();\r\n        }\r\n        \r\n        setUpEventListeners() {\r\n\r\n            // Slightly delay the callback (there may be other, higher priority resize callbacks that need to be called first before markChain's size is recalculated).\r\n            this.onDeviceResized = _.debounce(this.onDeviceResized.bind(this), 50);\r\n\r\n            this.listenTo(this.model, \"change:_next\", this.onNextChanged);\r\n            this.listenTo(Adapt, \"device:resize\", this.onDeviceResized);\r\n        }\r\n\r\n        render() {\r\n\r\n            let data = this.model.toJSON();\r\n            let template = Handlebars.templates[\"markChain\"];\r\n            this.$el.html(new Handlebars.SafeString(template(data)).string);\r\n        }\r\n\r\n        // If this View starts off hidden after it's rendered, it will need to be resized once it becomes visible again.\r\n        setUpHiddenObserver() {\r\n\r\n            this.$el.onUnhidden(() => {\r\n\r\n                // This delay is important. If it's not added, then the _hiddenObserver will detect the updateArrow()\r\n                // mutation and reset the debounce timer.\r\n                _.delay(() => {\r\n                    this.updateArrow();\r\n                }, 0);\r\n            });\r\n        }\r\n\r\n        // Update the arrows whenever the device is resized (as the MarkChainViews will likely have moved).\r\n        onDeviceResized() {\r\n            this.updateArrow();\r\n        }\r\n\r\n        /**\r\n         * Once the next MarkChainModel in the chain becomes known, update the .js-markchain-arrow belonging to this view to point to it.\r\n         * @param {*} model \r\n         * @param {*} nextModel \r\n         */\r\n        onNextChanged(model, nextModel) {\r\n            this.updateArrow();\r\n\r\n            // If this markChain has another markChain connected to it, it will need to recalculate itself differently if\r\n            // it starts off \":hidden\".\r\n            if (!nextModel) return;\r\n            this.setUpHiddenObserver();\r\n        }\r\n\r\n        _getVectorIntersection(p0, v0, p1, v1) {\r\n\r\n            let c = -v1.x * v0.y + v0.x * v1.y;\r\n            let s = (-v0.y * (p0.x - p1.x) + v0.x * (p0.y - p1.y)) / c;\r\n            let t = ( v1.x * (p0.y - p1.y) - v1.y * (p0.x - p1.x)) / c;\r\n\r\n            if (s >= 0 && s <= 1 && t >= 0 && t <= 1)\r\n            {\r\n                return {\r\n                    x: p0.x + (t * v0.x),\r\n                    y: p0.y + (t * v0.y)\r\n                }\r\n            }\r\n\r\n            // No collision was detected (shouldn't happen).\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Returns where the provided vector intersects the provided boundingClientRect.\r\n         * If no intersection is found, the middle of the boundingClientRect is returned as a fallback.\r\n         * @param {*} p0 \r\n         * @param {*} v0 \r\n         * @param {*} bb \r\n         */\r\n        _getVectorBoxIntersection(p0, v0, bb) {\r\n\r\n            // Top edge\r\n            let intersection = this._getVectorIntersection(p0, v0, \r\n                {x: bb.left, y: bb.top},\r\n                {x: bb.width, y: 0}\r\n            );\r\n            // Bottom edge\r\n            if (!intersection) intersection = this._getVectorIntersection(p0, v0, \r\n                {x: bb.left + bb.width, y: bb.top + bb.height}, \r\n                {x: -bb.width, y: 0}\r\n            );\r\n            // Right edge\r\n            if (!intersection) intersection = this._getVectorIntersection(p0, v0, \r\n                {x: bb.left + bb.width, y: bb.top}, \r\n                {x: 0, y: bb.height}\r\n            );\r\n            // Left edge\r\n            if (!intersection) intersection = this._getVectorIntersection(p0, v0, \r\n                {x: bb.left, y: bb.top + bb.height}, \r\n                {x: 0, y: -bb.height}\r\n            );\r\n            // No intersection found; default to the center.\r\n            if (!intersection) intersection = {\r\n                x: bb.left + bb.width/2,\r\n                y: bb.top + bb.height/2\r\n            };\r\n\r\n            return intersection;\r\n        }\r\n\r\n        _getVectorLength(v) {\r\n            return Math.sqrt(Math.pow(v.x, 2) + Math.pow(v.y, 2));;\r\n        }\r\n\r\n        _subtractVector(v0, v1) {\r\n            return {\r\n                x: v0.x - v1.x,\r\n                y: v0.y - v1.y\r\n            }\r\n        }\r\n\r\n        updateArrow() {\r\n\r\n            let nextModel = this.model.get(\"_next\");\r\n            let $arrow = this.$(\".js-markchain-arrow\");\r\n\r\n            // If there is no nextModel in this chain (meaning this is the last node in the chain), don't draw the arrow.\r\n            if (!nextModel) {\r\n                $arrow.hide();\r\n                return;\r\n            }\r\n\r\n            // If this markChain is inside of a JavaScript transformed element, adjust values accordingly.\r\n            // (This ajusts markChains that are inside of scaled figureItem lightboxes).\r\n            let $scaled = this.$el.closest(\"[style*='scale('\");\r\n            let scale = 1;\r\n            if ($scaled.length) {\r\n                let transform = $scaled.css(\"transform\");\r\n                var matrix = transform.replace(\"matrix(\", \"\").split(\",\");\r\n                scale = parseFloat(matrix[0]); // scaleX (assume uniform scaling).\r\n            }\r\n\r\n            // Transform the arrow to point to the next View in the chain.\r\n            $arrow.show();\r\n\r\n            let fromBB = _.extend({}, this.$(\".js-markchain-sizing\")[0].getBoundingClientRect());\r\n            let toBB = _.extend({}, nextModel.get(\"_view\").$(\".js-markchain-sizing\")[0].getBoundingClientRect());\r\n\r\n            let fromMid = {\r\n                x: fromBB.left + fromBB.width/2,\r\n                y: fromBB.top + fromBB.height/2\r\n            }\r\n            let toMid = {\r\n                y: toBB.top + toBB.height/2,\r\n                x: toBB.left + toBB.width/2\r\n            }\r\n\r\n            // Create a direction vector between the two points.\r\n            let v = {\r\n                x: toMid.x - fromMid.x,\r\n                y: toMid.y - fromMid.y\r\n            }\r\n            // Find the closest edge of the Next View that the vector will intersect.\r\n            // (Edges calculated going clockwise from the top-left corner of the toBB).\r\n            // There should only be one intersection, so stop searching after finding it.\r\n            \r\n            let fromIn = this._getVectorBoxIntersection(fromMid, v, fromBB);\r\n            let toIn = this._getVectorBoxIntersection(fromMid, v, toBB);\r\n\r\n            // Create a vector going between the two intersections.\r\n            let final = {\r\n                x: toIn.x - fromIn.x,\r\n                y: toIn.y - fromIn.y\r\n            }\r\n\r\n            let angle = Math.atan2(final.y, final.x) * 180 / Math.PI;\r\n            let length = this._getVectorLength(final);\r\n            let offset = this._getVectorLength(this._subtractVector(fromMid, fromIn));\r\n\r\n            $arrow.css({\r\n                \"width\": length/scale,\r\n                \"transform\": `rotate(${angle}deg) translateX(${offset/scale}px)`\r\n            });\r\n\r\n            // Rotate the label (if it exists).\r\n            let $label = this.$(\".js-markchain-label\");\r\n            $label.css({\r\n                \"transform\": `translateY(-50%) rotate(${-angle}deg)`\r\n            });\r\n        }\r\n    };\r\n\r\n    return MarkChainView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './markChainModel',\r\n    './markChainView'\r\n], function(Adapt, MarkChainModel, MarkChainView) {\r\n\r\n    class MarkChain extends Backbone.Controller {\r\n\r\n        initialize() {\r\n            Adapt.on('router:page', this.setUpHelpers.bind(this));\r\n        }\r\n\r\n        setUpHelpers() {\r\n\r\n            // StickyBlock compatibility.\r\n            Adapt.stickyBlock?.addResetOnReRender(\"_markChain\");\r\n\r\n            let t = this;\r\n\r\n            // Very important to use function() instead of () => here, as we need the access to the context provided by Handlebars.\r\n            Handlebars.registerHelperEl(\"markChain\", function() {\r\n        \r\n                let context = arguments[arguments.length-1];\r\n                let data = Handlebars.getContextHash.apply(this, arguments);\r\n\r\n                if (!data.name) throw \"{{#markChain}}: \\\"name\\\" property must be defined!\";\r\n\r\n                // Find the componentModel that this Helper was placed in.\r\n                let componentModel = Handlebars.getComponentModelFromContext(context);\r\n\r\n                /**\r\n                 * Set up the _markChain property for the componentModel.\r\n                 * \r\n                 * Here's a visualization:\r\n                 * \r\n                 *  ComponentModel\r\n                 *      _markChain:\r\n                 *          _groups(Collection): [\r\n                 *              {\r\n                 *                  _name: data.name,\r\n                 *                  _items(Collection): [\r\n                 *                      markChainModel,\r\n                 *                      markChainModel,\r\n                 *                      markChainModel\r\n                 *                  ]\r\n                 *              },\r\n                 *              {\r\n                 *                  etc.\r\n                 *              }\r\n                 *          ]\r\n                 */\r\n\r\n                if (!componentModel.get(\"_markChain\")) {\r\n                    componentModel.set(\"_markChain\", {});\r\n                }\r\n\r\n                // Add a property to the parent componentModel.\r\n                let groupsCollection = componentModel.get(\"_markChain\")._groups;\r\n                if (!groupsCollection) {\r\n                    componentModel.get(\"_markChain\")._groups = new Backbone.Collection();\r\n                    groupsCollection = componentModel.get(\"_markChain\")._groups;\r\n                }\r\n                \r\n                // All MarkChains with the same name need to know about their siblings.\r\n                let group = groupsCollection.find((g) => {return g.get(\"_name\") == data.name});\r\n                \r\n                // Compatibility with Component reRendering:\r\n                // -----------------------------------------\r\n                // If a component is reRendered, its markChain groups aren't cleared.\r\n                // The following fixes this. If the first model in the chain is somehow already rendered while the others are still being added, assume a re-render has occured.\r\n                /*if (group) {\r\n                    if (group.get(\"_items\").first()?.get(\"_isRendered\")) {\r\n                        groupsCollection.remove(group);\r\n                        group = undefined;\r\n                        console.log(\"REDO\");\r\n                    }\r\n                }*/\r\n\r\n                // No group found for this name, make a new one.\r\n                if (!group) {\r\n\r\n                    group = new Backbone.Model({\r\n                        _name: data.name,\r\n                        _items: new Backbone.Collection(null, {\r\n                            model: MarkChainModel,\r\n                            // Developers can explicitly specify \"idx\" values (to indicate the order that markChains connect).\r\n                            comparator: '_idx'\r\n                        })\r\n                    });\r\n                    groupsCollection.push(group);\r\n\r\n                    // FIXME: Bad design. Assumes all models belonging to the group will be made after the delay\r\n                    // (though this is usually the case).\r\n                    // Wait for all MarkChain models belonging to this group to be added to it, then sort it.\r\n                    _.delay(() => {\r\n\r\n                        let items = group.get(\"_items\");\r\n                        items.sort();\r\n                        items.each(markChainModel => {\r\n                            markChainModel.set(\"_isReady\", true);\r\n                        });\r\n                    }, 1);\r\n                }\r\n\r\n                // Add this model to this specific group's collection\r\n                data._idx = data.idx;\r\n                if (!data.content || !data.content.length) data.content = \"&#8203;\"; // Use a zero width space if the mark has no content.\r\n                let model = new MarkChainModel(data);\r\n                \r\n                group.get(\"_items\").push(model);\r\n\r\n                let view = new MarkChainView({\r\n                    model: model\r\n                });\r\n\r\n                // Let the model know of which view it controls (FIXME: I think this is bad design, but saves a lot of time on development).\r\n                model.set(\"_view\", view);\r\n\r\n                return view.$el;\r\n            });\r\n        }\r\n    }\r\n\r\n    let markChain = new MarkChain();\r\n    Adapt.markChain = markChain;\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * Component Models which contain other nested components get assigned this model.\r\n     * \r\n     * This model will prevent its _parentView from being ready before all of its nestComponent _children are.\r\n     */\r\n\r\n    class NestComponentParentModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                _parentView: undefined,                     // Reference to the componentView that this NestComponentParentModel corresponds to.\r\n                _isReady: false,                            // Only set to true when all children's _isReady values are set to true.\r\n                _children: new Backbone.Collection()        // Collection of all stickyElementItemModels with this _id.\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            this.extendParentView();\r\n            this.listenTo(this.get(\"_children\"), \"change:_isReady\", this.onChildReadyChange);\r\n        }\r\n\r\n        registerChild(componentModel) {\r\n            this.get(\"_children\").add(componentModel);\r\n        }\r\n\r\n        onChildReadyChange(childModel, isReady) {\r\n\r\n            // Set _isReady: true only if ALL children are ready.\r\n            this.set(\"_isReady\", !Boolean(this.get(\"_children\").find((child) => {return !child.get(\"_isReady\");})));\r\n            this.get(\"_parentView\").setReadyStatus();\r\n        }\r\n\r\n        extendParentView() {\r\n\r\n            let parentView = this.get(\"_parentView\");\r\n\r\n            let _setReadyStatus = parentView.setReadyStatus;\r\n            if (!_setReadyStatus.prototype._nestComponentOverride) { \r\n                parentView.setReadyStatus = () => {\r\n\r\n                    // Only set ready once all children have been set ready.\r\n                    if (this.get(\"_isReady\")) {\r\n                        return _setReadyStatus.apply(parentView, arguments);\r\n                    }\r\n                }\r\n                parentView.setReadyStatus.prototype._nestComponentOverride = true; // Override only once.\r\n            }\r\n        }\r\n    };\r\n\r\n    return NestComponentParentModel;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    \"./nestComponentParentModel\"\r\n], function(Handlebars, Adapt, nestComponentParentModel) {\r\n\r\n    /**\r\n     * nestComponent helper\r\n     * --------------------\r\n     * The component with an \"_id\" equal to the one in this element will be rendered inside of it instead of in its block\r\n     * where it's meant to go (the default component render location).\r\n     */\r\n    Adapt.on('router:page', () => {\r\n        Handlebars.registerHelperEl(\"nestComponent\", function() {\r\n            \r\n            let context = arguments[arguments.length-1];\r\n            let hash = context.hash;\r\n            \r\n            let id = hash.id;\r\n            if (!id) throw \"{{#nestComponent}} helper must have an \\\"id\\\" property.\";\r\n\r\n            // Find the componentModel with the provided \"_id\".\r\n            let childModel = Adapt.findById(id);\r\n            if (!childModel) throw \"{{#nestComponent}} could not find component with \\\"_id\\\": \\\"\" + id + \"\\\"\";\r\n\r\n            let parentModel = Handlebars.getComponentModelFromContext(context);\r\n\r\n            // Set properties on the models (Views which detect these properties will modify their core behaviour).\r\n\r\n            // Parent\r\n            // -----------------------------------\r\n            let parentNestComponent = parentModel.get(\"_nestComponent\");\r\n            if (!parentNestComponent) {\r\n                throw '{{#nestComponent}}: Component with \"_id\": \"' + parentModel.get(\"_id\") + '\" contains {{#nestComponent}} elements, but does not have the \"_nestComponent\" partial added.';\r\n            }\r\n            try {\r\n                parentNestComponent.registerChild(childModel);\r\n            }\r\n            catch (err) {\r\n                throw \"adapt-nestComponent: parent component \\\"_nestComponent\\\" incorrectly applied. Must be: \\\"_nestComponent\\\": {\\\"_isParent\\\": true}\"\r\n            }\r\n\r\n            // Child\r\n            // -----------------------------------\r\n            if (childModel.get(\"_nestComponent\"))\r\n                throw \"{{#nestComponent}}: Child with \\\"_id\\\": \\\"\" + id + \"\\\" cannot also be a nestComponent parent / cannot be nested in multiple parents at once.\";\r\n            if (childModel.get(\"_layout\") != \"full\")\r\n                throw '{{#nestComponent}} only supports components with \"_layout\": \"full\" at this time (\"' + id + '\").';\r\n            childModel.set(\"_nestComponent\", {\r\n                _isChild: true,\r\n                _parent: parentModel\r\n            });\r\n\r\n            return $(\"<div class='nestcomponent' data-nestcomponent-id='\" + id + \"'>\");\r\n        });\r\n    });\r\n\r\n\r\n    /**\r\n     * adapt-nestComponent\r\n     * ===================\r\n     * \r\n     * Description:\r\n     * ------------\r\n     * THIS EXTENSION IS EXPERIMENTAL AND SUBJECT TO CHANGE.\r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * - Check that this works when hosted online (as CHILD components may take a while to render. SET_RW-20 is good for testing).\r\n     * - Check that component completion still operates correctly.\r\n     * - If the PARENT is re-rendered, the CHILD components need to be re-rendered too!\r\n     *   (This may be fixable by using the adaptView addChildren() function to assign the child components).\r\n     * - Will likely cause issues when used with the default pageLevelProgress extension (which the DD isn't using).\r\n     * - Needs to trigger a device:resize on all child components once they are appended.\r\n     * \r\n     * Notes:\r\n     * ------\r\n     * - Components intended for nesting must be declared AFTER their parent in components.json.\r\n     * - This feature goes against the core structure of Adapt, and should be monitored to ensure it doesn't cause any issues.\r\n     * \r\n     */\r\n\r\n    class NestComponent extends Backbone.Controller{\r\n\r\n        initialize() {\r\n            \r\n            Adapt.on({\r\n                'app:dataReady': this.onDataReady.bind(this)\r\n            });\r\n        }\r\n\r\n        onDataReady() {\r\n            Adapt.on(\"componentView:preRender\", this.onParentComponentViewPreRender.bind(this));\r\n            Adapt.on(\"componentView:postRender\", this.onChildComponentViewPostRender.bind(this));\r\n            //Adapt.on(\"questionView:showFeedback\", this.onQuestionViewShowFeedback.bind(this));\r\n        }\r\n\r\n        /**\r\n         * Parent extension\r\n         * @param {*} componentView \r\n         */\r\n        onParentComponentViewPreRender(componentView) {\r\n\r\n            let componentModel = componentView.model;\r\n            let nestComponent = componentModel.get(\"_nestComponent\");\r\n\r\n            // Only extend nested component parents.\r\n            if (!nestComponent || !nestComponent._isParent) return;\r\n\r\n            // Have the parent component only setReadyStatus once its child components are ready.\r\n            // ----------------------------------------------------------------------------------\r\n            componentModel.set(\"_isReady\", false);\r\n            componentModel.set(\"_nestComponent\", new nestComponentParentModel({_parentView: componentView}));\r\n        }\r\n\r\n        onChildComponentViewPostRender(componentView) {\r\n\r\n            let componentModel = componentView.model;\r\n            let nestComponent = componentModel.get(\"_nestComponent\");\r\n\r\n            // Only extend nested component children.\r\n            if (!nestComponent || !nestComponent._isChild) return;\r\n\r\n            // Have the child component append itself inside the parent component's nestComponent element.\r\n            // ----------------------------------------------------------------------------------\r\n            let parentView = Adapt.findViewByModelId(nestComponent._parent.get(\"_id\"));\r\n            // Compatible with adapt-componentRow.\r\n            parentView.$(\".nestcomponent[data-nestcomponent-id=\" + componentModel.get(\"_id\") + \"]\").append(componentModel.get(\"_componentRow\") ? componentView.$el.closest(\".componentrow\") : componentView.$el);\r\n        }\r\n    }\r\n\r\n    new NestComponent();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    class ResourcePopupPopupView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"resourcepopup-popup \" + (this.model.get(\"_classes\") || \"\");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \r\n            }\r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenToOnce(Adapt, \"notify:closed\", this.onClosed);\r\n        }\r\n\r\n        onClosed() {\r\n            this.$el.addClass(\"is-closed\");\r\n        }\r\n\r\n        render() {\r\n            var data = this.model.toJSON();\r\n            data.view = this;\r\n            var template = Handlebars.templates['resourcePopupPopup'];\r\n            this.$el.html(template(data));\r\n        }\r\n    };\r\n\r\n    return ResourcePopupPopupView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './resourcePopupPopupView'\r\n], function(Adapt, ResourcePopupPopupView) {\r\n\r\n    class ResourcePopupBtnView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"resourcepopup-btn btn-text\";\r\n        }\r\n\r\n        tagName() {\r\n            return \"button\"\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.setUpViewData();\r\n            this.render();\r\n        }\r\n\r\n        setUpViewData() {\r\n            this.popupView = null;\r\n            this._isPopupOpen = false;\r\n        }\r\n\r\n        render(){\r\n            this.$el.html(new Handlebars.SafeString(this.model.get(\"buttonText\")).string);\r\n        }\r\n\r\n        onClick(){\r\n            this.openPopup();\r\n        }\r\n\r\n        /**\r\n         * Open a popup using the default Adapt notify functionality.\r\n         */\r\n        openPopup() {\r\n\r\n            if (this._isPopupOpen) return;\r\n            this._isPopupOpen = true;\r\n    \r\n            this.popupView = new ResourcePopupPopupView({\r\n                model: this.model\r\n            });\r\n    \r\n            Adapt.trigger(\"notify:popup\", {\r\n                _view: this.popupView,\r\n                _isCancellable: true,\r\n                _showCloseButton: true,\r\n                _classes: 'resourcepopup ' + (this.model.get('_classes') || \"\")\r\n            });\r\n\r\n            this.listenToOnce(Adapt, {\r\n                'popup:closed': this.onPopupClosed\r\n            });\r\n        }\r\n\r\n        onPopupClosed() {\r\n            this.$el.addClass(\"is-visited\");\r\n            this._isPopupOpen = false;\r\n        }\r\n    };\r\n\r\n    return ResourcePopupBtnView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './resourcePopupBtnView'\r\n], function(Handlebars, Adapt, ResourcePopupBtnView) {\r\n\r\n    /**\r\n     * adapt-resourcePopup\r\n     * --------------------------------------\r\n     * This extension sets up resource buttons in the content to show fullscreen popup resources.\r\n     * \r\n     * TODO:\r\n     *  - May be changed to being a normal Component; depends on how frequently it's seen inside of other Components.\r\n     * \r\n     * FIXME:\r\n     * - Won't work if the resource is inside of another fullscreen reveal (like a HotgraphicPlus).\r\n     * - A bit tedious to use (needs a partial to work).\r\n     */\r\n\r\n    // Helpers\r\n    // ---------------------\r\n    \r\n    /**\r\n     * Use these to create the inline tags for the resource button.\r\n     * \r\n     * Note:\r\n     * -----\r\n     * Using Handlebars fixes the issue previous extensions developed for DD had, that being that\r\n     * they couldn't be used inside of dynamically generated HTML (like inside of a popup for example).\r\n     * Now, whenever the Handlebars is compiled, it knows to create the appropriate View for the thing.\r\n     * Plus, it keeps the components.json tidy and consistant to use Handlebars expressions for such things.\r\n     * (And no need for custom HTML tags).\r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * Had to use a weird workaround to get this one working. Monitor for possible bugs.\r\n     */\r\n\r\n    var helpers = {\r\n\r\n        /**\r\n         * Creates a resource button.\r\n         * \r\n         * Note:\r\n         * \"this\" returns the context of the JSON. If the {{}} is inside of an _item element, it returns the ITEM, not its component.\r\n         * \r\n         * @param {string} resourceId       The ID of the resourcePopup item.\r\n         */\r\n        resourcePopup: function(resourceId, context) {\r\n\r\n            // Find the closest component view.\r\n            // FIXME: Only works for one level of nesting, and only in items.\r\n            let componentView = this.view;\r\n            if (this.view.model.get(\"_type\") != \"component\")\r\n                componentView = Adapt.findViewByModelId(this.view.model.get(\"_parent\").get(\"_id\"));\r\n\r\n            // If the component has no _resourcePopup partial, show an error.\r\n            let resourcePopup = componentView.model.get(\"_resourcePopup\");\r\n            if (!resourcePopup) {\r\n                throw componentView.model.get(\"_id\") + \" component uses a _resourcePopup, but has not defined it as a partial.\";\r\n            }\r\n\r\n            let _uniqueId = _.uniqueId(\"resourcepopup\");\r\n            let btnHTML = \"<div class='resourcepopup-btn-container' data-resourcepopup-id='\" + _uniqueId + \"'></div>\";\r\n\r\n            // Wait for the HTML to render, then apply a view + model to the button.\r\n            _.debounce(() => {\r\n\r\n                // Find the resource item in _resourcePopup which matches the resourceId.\r\n                let modelJSON = _.find(resourcePopup._items, (item) => {return item._id == resourceId});\r\n                if (!modelJSON) {\r\n                    throw componentView.model.get(\"_id\") + \" component could not find _resourcePopup item with \\\"_id\\\": \\\"\" + resourceId + \"\\\".\";\r\n                }\r\n\r\n                // Extend the model properties.\r\n                modelJSON = _.extend(modelJSON, {\r\n                    buttonText: context.fn(),\r\n                    _id: _uniqueId,\r\n                    _parentView: componentView\r\n                })\r\n\r\n                let $btnContainer = componentView.$(\"[data-resourcepopup-id='\" + _uniqueId + \"']\");\r\n                $btnContainer.html(new ResourcePopupBtnView({\r\n                    model: new Backbone.Model(modelJSON)\r\n                }).$el);\r\n            })();\r\n\r\n            return new Handlebars.SafeString(btnHTML);\r\n        }\r\n\r\n    };\r\n\r\n    for (var name in helpers) {\r\n        if (helpers.hasOwnProperty(name)) {\r\n            Handlebars.registerHelper(name, helpers[name]);\r\n        }\r\n    }\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    'core/js/a11y/scroll',\r\n    'libraries/jquery-ui.scrollParent.js' // Standalone jquery-ui library which only includes the functionality this needs. \r\n], function(Adapt, Scroll) {\r\n\r\n    // TODO: Convert to Backbone Controller for consistency.\r\n\r\n    const SCROLL_MARGIN = 48;           // Margin used for align: inview scrolling. FIXME: Hardcoded.\r\n    const IPHONE_FIX = true;     // Hardcoded fix for iPhone Safari (remove if unnecessary).\r\n    const SCROLL_DURATION = 400;\r\n\r\n    let isScrolling = false; // True while the scrolling animation is playing.\r\n    let scrollPriority = -Infinity; // NavigateToEl calls won't be called if a higher scrollPriority is scrolling.\r\n\r\n    Adapt.scrollfix = {};\r\n\r\n    /**\r\n     * Set up _scrollingContainer._isEnabled\r\n     * -------------------------------------\r\n     * - When not on a mobile device, we (DD) want this to be enabled, due to the way we've set up the notify popup element.\r\n     * - On mobile devices, it should be disabled, as having it enabled prevents overscroll behaviour hiding the navbar.\r\n     * - 'offlineStorage:prepare' event used to ensure this is triggered BEFORE core/js/scrolling.js has a chance to initialize.\r\n     */\r\n    Adapt.on(\"offlineStorage:prepare\", () => {\r\n        \r\n        // Adapt.device doesn't seem to have an inbuilt way to check if we're using a mobile device or not, so use this method instead.\r\n        if( /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {\r\n            Adapt.log.info(\"adapt-scrollfix.js: Mobile device detected.\");\r\n            \r\n            // FIXME: This was breaking StickyBlocks (if the mobile device was wide enough to be considered not-small).\r\n            // FIXME: This does however, mean that overscroll behaviour will stop working.\r\n            /*if (Adapt.config.get('_scrollingContainer')) {\r\n                Adapt.config.get('_scrollingContainer')._isEnabled = false;\r\n            }*/\r\n\r\n            // FIXME: Adding this class; should it be in a different extension?\r\n            $(\"html\").addClass('device-mobile');\r\n\r\n            return;\r\n        }\r\n    });\r\n\r\n    Adapt.on(\"app:dataReady\", () => {\r\n        overrideNavigateToElement();\r\n        overridePreventScroll();\r\n        Adapt.navigateToRelOffset = navigateToRelOffset;\r\n    });\r\n\r\n    /**\r\n     * EXPERIMENTAL OVERRIDE:\r\n     * \r\n     * BUG: Adapt's code scroll.js introduces the following error in some instances of notify:\r\n     * \"Ignored attempt to cancel a touchmove event with cancelable=false, for example because scrolling is in progress\r\n     * and cannot be interrupted.\"\r\n     * \r\n     * This error can be disabled manually using the following.\r\n     * This feature is currently needed for the ddImg lightbox feature to scroll properly on phones.\r\n     * \r\n     * FIXME: Names could use improvement.\r\n     */\r\n    let disableA11yPreventScroll = false;\r\n    function overridePreventScroll() {\r\n        let _preventScroll = Adapt.a11y._scroll._preventScroll;\r\n        Adapt.a11y._scroll._preventScroll = function() {\r\n            if (disableA11yPreventScroll) return;\r\n            return _preventScroll.apply(Adapt.a11y._scroll, arguments);\r\n        };\r\n\r\n        Adapt.scrollfix.disableA11yScroll = function(){disableA11yPreventScroll = true;}\r\n        Adapt.scrollfix.enableA11yScroll = function(){disableA11yPreventScroll = false;}\r\n    }\r\n\r\n    \r\n    /**\r\n     * New function. When called, will scroll the page to the offset provided (no need to provide an element).\r\n     * \r\n     * @param {Object} [offset.top]\r\n     * @param {Object} [offset.left]\r\n     * @param {Object} settings settings can be provided here in the same way as for Adapt.navigateToElement. \r\n     */\r\n    function navigateToRelOffset(offset, settings) {\r\n        \r\n        // Adapt requires all scrolling to use navigateToElement, so to achieve the scroll we want,\r\n        // create a temporary element for Adapt to scroll to.\r\n        let $target = $(\"<div class='scrollfix__target'>\");\r\n        $(\"#app\").append($target);\r\n        $target.offset({\r\n            top: offset.top ? ($(window).scrollTop() + offset.top) : undefined,\r\n            left: offset.left ? ($(window).scrollLeft() + offset.left) : undefined\r\n        });\r\n\r\n        // Nagivate to it.\r\n        let s = _.extend({\r\n            offset: {\r\n                top: 0,\r\n                left: 0\r\n            },\r\n            ignoreNav: true\r\n        }, settings);\r\n        Adapt.navigateToElement($target, s);\r\n\r\n        // And remove the temporary target.\r\n        $target.remove();\r\n    }\r\n\r\n    function overrideNavigateToElement() {\r\n        let _navigateToElement = Adapt.navigateToElement;\r\n        \r\n        // FIXME: Adapt's code navigateToElement logs a warning due to this not being a collection element.\r\n        Adapt.navigateToElement = function(selector, settings) {\r\n\r\n            // PDF mode: if in PDF mode, don't scroll to anything.\r\n            if (Adapt.isPDFMode()) return;\r\n\r\n            // New: scroll priorities.\r\n            // Don't scroll if there's currently an animation with a higher priority animating.\r\n            // FIXME: Crudely implemented. Scrollfix should be a Backbone Model/Controller.\r\n            // FIXME: A high priority call will not interrupt an already animating low priority call.\r\n            // FIXME: Low priority scrolls can still sometimes get through if the high priority scroll target is already inview.\r\n            settings.priority = settings.priority || 0;\r\n            if (!isScrolling) {\r\n                scrollPriority = settings.priority;\r\n            }\r\n            else {\r\n                if (settings.priority < scrollPriority) return;\r\n                scrollPriority = settings.priority;\r\n            }\r\n\r\n            if (!settings) settings = {};\r\n            if (settings.duration === undefined) settings.duration = SCROLL_DURATION;\r\n            if (settings.offset === undefined) settings.offset = {top: -SCROLL_MARGIN, left: 0};\r\n            if (settings.fail === undefined) settings.fail = onScrollFail;\r\n            if (settings.onAfter === undefined) {\r\n                settings.onAfter = onScrollAfter;\r\n            }\r\n            else {\r\n                // Extend the onAfter call.\r\n                let onAfter = settings.onAfter;\r\n                settings.onAfter = function() {\r\n                    onAfter();\r\n                    onScrollAfter();\r\n                }\r\n            }\r\n\r\n            // Adjust the top offset to accomodate for the navbar being at the top.\r\n            // FIXME: This check is specific to the DD implementation only.\r\n            if (!settings.ignoreNav && Adapt.device.screenSize !== 'large') {\r\n                settings.offset.top -= $(\".nav\").height();\r\n            }\r\n\r\n            let $obj = $(); \r\n            let uniqueId = _.uniqueId(\"scrollfix\");\r\n\r\n            // Allow for jQuery objects to be used instead of selectors.\r\n            if (selector instanceof jQuery) {\r\n                $obj = selector.addClass(uniqueId);\r\n                selector = \".\" + uniqueId;\r\n                arguments[0] = selector;\r\n            }\r\n            // FIXME: I think this will break if a string is passed to \"selector\" parameter.\r\n\r\n            // If scrollNested, check if the target is inside a nested scrolling element, and scroll that too.\r\n            // (Supports horizontal scrolling only (at this time)).\r\n            /*if (settings.scrollNested === true) {\r\n                let $scrollParent = $obj.scrollParent();\r\n                // Ignore if the scroll parent is the app or the nav.\r\n                // FIXME: Hardcoded selection.\r\n                if ($scrollParent.attr(\"id\") != \"app\" && !$scrollParent.hasClass(\"notify__popup\")) {\r\n                    // Scroll the $obj into view.\r\n                    $scrollParent.scrollTo($obj, {\r\n                        axis: 'x',\r\n                        duration: $.scrollTo.defaults.duration\r\n                    });\r\n                }\r\n            }*/\r\n\r\n\r\n            /**\r\n             * If scrollNested, check if the target is inside a nested scrolling element, and scroll that too.\r\n             * (Supports vertical scrolling only (at this time)).\r\n             * \r\n             * TODO: At the moment, the scrolling always brings the target to the top of the $scrollParent;\r\n             * allow for inview type scrolling of the target.\r\n             */\r\n            let scrollNestedCallback = undefined;\r\n            if (settings.scrollNested === true) {\r\n                let $scrollParent = $obj.scrollParent();\r\n\r\n                /**\r\n                 * Ignore if the scroll parent is the #app, nav, or #adapt (<html>).\r\n                 * \r\n                 * FIXME: Hardcoded selection.\r\n                 */\r\n                let scrollParentId = $scrollParent.attr(\"id\");\r\n                if (\r\n                    scrollParentId != \"adapt\" &&                // <html> \r\n                    scrollParentId != \"app\" &&                  // app\r\n                    !$scrollParent.hasClass(\"notify__popup\")    // nav\r\n                ) {\r\n                    \r\n                    let scrollTop = $scrollParent.scrollTop();\r\n\r\n                    // Scroll the $obj into view instantly.\r\n                    $scrollParent.scrollTo($obj, {\r\n                        axis: 'y',\r\n                        duration: 0\r\n                    });\r\n\r\n                    // Create a callback to invoke after the remainder of this function has used the $scrollParent's\r\n                    // offset for its calculation.\r\n                    scrollNestedCallback = () => {\r\n\r\n                        let destScrollTop = $scrollParent.scrollTop();\r\n\r\n                        // Set the $scrollParent to the location it was previously in.\r\n                        $scrollParent.scrollTop(scrollTop);\r\n\r\n                        // Animate to the location it was just in.\r\n                        $scrollParent.scrollTo(destScrollTop, {\r\n                            axis: 'y',\r\n                            duration: SCROLL_DURATION //$.scrollTo.defaults.duration\r\n                        });\r\n                    };\r\n                }\r\n            }\r\n\r\n            // Call at the end of the function.\r\n            let cleanup = () => {\r\n                if (scrollNestedCallback) scrollNestedCallback();\r\n                $obj.removeClass(uniqueId);\r\n            }\r\n\r\n            // If the alignment is \"center\", try to center the elements in the viewport.\r\n            // Or if they're too tall for the viewport, change the alignment to \"inview\".\r\n            /*if (settings.align == \"center\") {\r\n\r\n            }*/\r\n\r\n            // If the alignment is \"inview\", don't do anything if it already is.\r\n            if (settings.align == \"inview\") {\r\n\r\n                let inview = getElementInview(selector, settings.offset);\r\n\r\n                // If both the top and bottom are inview, do nothing.\r\n                if (inview.inview === 0) {\r\n                    cleanup();\r\n                    onScrollAfter();\r\n                    return;\r\n                }\r\n\r\n                // Ensure only the top element has the selector.\r\n                // (_navigateToElement() call below has issues if its selector finds multiple elements).\r\n                $obj.removeClass(uniqueId);\r\n                inview.$topObj.addClass(uniqueId);\r\n\r\n                // FIXME:? manually specified offset.top values get overridden here.\r\n                // If the top is inview and the bottom isn't, scroll down just enough to focus on the bottom.\r\n                if (inview.inview === 1) {\r\n                    //let originalOffsetTop = settings.offset.top || 0;\r\n                    settings.offset.top = -Adapt.device.screenHeight + inview.height + SCROLL_MARGIN; //+ originalOffsetTop;\r\n\r\n                    // If on an iPhone, scroll down a bit further (FIXME: Temporary fix).\r\n                    if (_useIphoneFix()) {\r\n                        settings.offset.top += SCROLL_MARGIN*2;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // If the element being scrolled to is within a notify popup, scroll within that popup instead if set to do so.\r\n            // TODO: Improve the offset calculation for this feature.\r\n            if ($obj.closest(\".notify\").length && settings.notifyEnabled === true) {\r\n                $(\".notify__popup\").scrollTo($obj, _.extend(\r\n                    settings,\r\n                    {\r\n                        axis: 'y',\r\n                        duration: SCROLL_DURATION\r\n                    })\r\n                );\r\n            }\r\n            // Otherwise, navigate to the element normally.\r\n            else {\r\n                _navigateToElement.apply(this, arguments);\r\n            }\r\n\r\n            isScrolling = true;\r\n            cleanup();\r\n        }\r\n    }\r\n\r\n    // Called if the scrolling animation is interrupted.\r\n    function onScrollFail() {\r\n        isScrolling = false;\r\n        scrollPriority = -Infinity;\r\n    }\r\n\r\n    // Called when the scrolling animation completes.\r\n    function onScrollAfter() {\r\n        isScrolling = false;\r\n        scrollPriority = -Infinity;\r\n    }\r\n\r\n    function getScreenTop() {\r\n\r\n        // Adjust the top offset to accomodate for the navbar.\r\n        if (Adapt.device.screenSize === 'small') {\r\n            return SCROLL_MARGIN + $(\".nav\").height();\r\n        }\r\n        return SCROLL_MARGIN;\r\n    }\r\n\r\n    function _useIphoneFix() {\r\n        return IPHONE_FIX && $(\"html\").hasClass(\"iphone\");\r\n    }\r\n\r\n    function getScreenBottom(){\r\n\r\n        // If on an iPhone, give slightly more space on the bottom.\r\n        if (_useIphoneFix()) {\r\n            return Adapt.device.screenHeight - SCROLL_MARGIN*3;\r\n        }\r\n\r\n        return Adapt.device.screenHeight - SCROLL_MARGIN;\r\n    }\r\n    \r\n    /**\r\n     * Returns an object based on if the top & bottom of the selected element(s) are inview.\r\n     * @param {*} selector \r\n     */\r\n    function getElementInview(selector, offset) {\r\n        let $obj = $(selector);\r\n        if (!$obj.length) {\r\n            Adapt.log.error(\"adapt-scrollfix.getElementInview() could not find any elements with the provided selector: \" + selector);\r\n            return;\r\n        }\r\n\r\n        let bbs = [];\r\n        $obj.each((i, e) => {\r\n\r\n            // If a component is selected, allow it to specify their own custom boundingClientRect.\r\n            if ($(e).hasClass(\"component\") /*|| $(e).hasClass(\"block\")*/) {\r\n                let componentView = Adapt.findViewByModelId($(e).data(\"adapt-id\"));\r\n\r\n                if (componentView.getBoundingClientRect) {\r\n                    let bb = componentView.getBoundingClientRect();\r\n                    bb.$obj = $(e);\r\n                    bbs.push(bb);\r\n                }\r\n                else {\r\n                    let bb = $(e)[0].getBoundingClientRect();\r\n                    bb.$obj = $(e);\r\n                    bbs.push(bb);\r\n                }\r\n            }\r\n            // If a non-component element is selected, get the boundingClientRect normally.\r\n            else {\r\n                let bb = $(e)[0].getBoundingClientRect();\r\n                bb.$obj = $(e);\r\n                bbs.push(bb);\r\n            }\r\n        });\r\n\r\n        let minTop = Infinity;\r\n        let maxBottom = -Infinity;\r\n\r\n        // Reference to the topmost element of all selected elements.\r\n        //\r\n        // Explanation:\r\n        // --------------------------------------------------------\r\n        // If the core Adapt.navigateToElement function is called, and it finds multiple elements that match the selector it\r\n        // is provided, it can scroll unpredictable. This is done to fix this.\r\n        let $topObj = $obj.first(); \r\n\r\n        _.each(bbs, (bb) => {\r\n\r\n            if (bb.top < minTop) {\r\n                minTop = bb.top;\r\n                $topObj = bb.$obj;\r\n            }\r\n            if (bb.bottom > maxBottom) {\r\n                maxBottom = bb.bottom;\r\n            }\r\n        });\r\n\r\n        // 1 -/+ added to prevent this triggering after a scroll places it exactly where it needs to be.\r\n        let screenTop = getScreenTop()-1;\r\n        let screenBottom = getScreenBottom()+1;\r\n\r\n        let inview = 0;\r\n        let height = maxBottom - minTop;\r\n\r\n        // Increase the height if offset.height is specified.\r\n        if (offset.height !== undefined) {\r\n            height = Math.max(height, offset.height);\r\n        }\r\n\r\n        // If the selection is too tall for the viewport, always scroll to the top.\r\n        if (maxBottom - minTop > screenBottom - screenTop) {\r\n            inview = -1;\r\n        }\r\n        else {\r\n            // If the bottom of the element is off the bottom of the screen, then the view needs to scroll down.\r\n            if (maxBottom > screenBottom) inview = 1;\r\n            // If the top of the element is off the top of the screen, then it needs to scroll up.\r\n            // (This will override the above statement, as seeing the top of the element is more important than seeing the bottom).\r\n            if (minTop < screenTop) inview = -1;\r\n        }\r\n\r\n        return {\r\n            inview: inview,\r\n            /*topInview: minTop > screenTop && minTop < screenBottom,\r\n            bottomInview: maxBottom > screenTop && maxBottom < screenBottom,*/\r\n            height: height,\r\n            $topObj: $topObj\r\n        }\r\n    }\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * adapt-sizing\r\n     * ============\r\n     * \r\n     * Description:\r\n     * ------------\r\n     * Give the designers more control over the dimensions of components and other elements.\r\n     * \r\n     * TODO:\r\n     * -----\r\n     * - This extension may be renamed in the future.\r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * \r\n     * \r\n     * Notes:\r\n     * ------\r\n     * \r\n     */\r\n\r\n    class Sizing extends Backbone.Controller{\r\n\r\n        initialize() {\r\n            Adapt.on(\"componentView:postRender\", this.componentViewPostRender.bind(this));\r\n        }\r\n\r\n        /**\r\n         * Automatically apply classes to components based on their _sizing properties.\r\n         * @param {*} componentView \r\n         */\r\n        componentViewPostRender(componentView) {\r\n\r\n            let sizing = componentView.model.get(\"_sizing\");\r\n            if (!sizing || sizing._isEnabled === false) return;\r\n\r\n            componentView.$el.addClass(this.getSizingClasses(sizing));\r\n        }\r\n\r\n        /**\r\n         * Check that only valid values have been entered for the specified property.\r\n         * @param {*} sizingObj \r\n         * @param {*} propName \r\n         * @param {*} isBoolValid \r\n         */\r\n        _validateProperty(sizingObj, propName, isBoolValid) {\r\n\r\n            let prop = sizingObj[propName];\r\n            if (prop === undefined || prop === \"\" || (isBoolValid && prop === false)) return false;\r\n\r\n            if (prop == \"auto\") return true;\r\n\r\n            if ((isNaN(prop) && (isBoolValid ? typeof prop !== \"boolean\" : true)) || \r\n                prop <= 0 || \r\n                prop > 12) {\r\n                Adapt.log.error(\"Invalid value provided for _sizing.\" + propName + \": \" + prop + \"\\n(value must be: [1-12|\\\"auto\\\"]\" + (isBoolValid ? \" | true | false\" : \"\") +\").\");\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * Process various different formats that the sizing data can come in.\r\n         * MOST of the time, the \"sizing\" parameter will be a properly formatted object.\r\n         * \r\n         * These alternatives exist mainly for the sake ofm making helpers ({{#item sizing=\"*\"}} for example),\r\n         * easier to type out (as most of the time, the only value needed in a \"sizing\" object is \"_width\").\r\n         * \r\n         * Examples:\r\n         * {_width: 8, _maxWidth: true} -----> {_width: 8, _maxWidth: true}\r\n         * 8 --------------------------------> {_width: 8}\r\n         * \"8\" ------------------------------> {_width: 8}\r\n         * \"!8\"  ----------------------------> {_width: 8, _maxWidth: false}\r\n         * \"auto\" ---------------------------> {_width: \"auto\"}\r\n         * [8,true] -------------------------> {_width: 8, _maxWidth: true}\r\n         * @param {*} sizing Value taking on any of the above formats. \r\n         */\r\n        _getSizingObj(sizing) {\r\n\r\n            if (!sizing) return {};\r\n\r\n            // Array of values provided. Apply to _width, then _maxWidth.\r\n            if (Array.isArray(sizing)) return {_width: sizing[0], _maxWidth: sizing[1]};\r\n\r\n            // Correctly formatted object provided.\r\n            if (typeof sizing === \"object\") return sizing;\r\n\r\n            // Single number provided. Set _width to it.\r\n            if (typeof sizing === \"number\") return {_width: sizing};\r\n\r\n            // String provided. Set _width to it (parse if integer).\r\n            if (typeof sizing === \"string\") {\r\n\r\n                // Check if it's formatted as \"!12\":\r\n                if (sizing.match(/^![0-9]+$/g)) {\r\n                    sizing = sizing.substring(1);\r\n\r\n                    if (!isNaN(sizing)) return {_width: parseInt(sizing), _maxWidth: false};\r\n                    else {\r\n                        Adapt.log.error(\"adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\\n\\nSizing value provided: \" + JSON.stringify(sizing));\r\n                    }\r\n                }\r\n                \r\n                return {_width: isNaN(sizing) ? sizing : parseInt(sizing)};\r\n            }\r\n\r\n            Adapt.log.error(\"adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\\n\\nSizing value provided: \" + JSON.stringify(sizing));\r\n        }\r\n\r\n        /**\r\n         * Returns a string of sizing classes based on the options object provided.\r\n         * @param {*} options._width\r\n         * @param {*} options._maxWidth\r\n         */\r\n        getSizingClasses(sizing) {\r\n\r\n            sizing = this._getSizingObj(sizing);\r\n\r\n            let classNames = [];\r\n            classNames.push(\"col\");\r\n\r\n            // Width\r\n            // ----------------------------------------------\r\n            classNames.push(this._validateProperty(sizing, \"_width\", false) ? \"col-\" + sizing._width : undefined);\r\n            \r\n            // MaxWidthInner\r\n            // ----------------------------------------------\r\n            // EXPERIMENTAL! Should only be used on components for now.\r\n            // \r\n            // If _maxWidthInner === true:\r\n            // - Apply the current MaxWidth value to the inner element of the child at all times.\r\n            //\r\n            // If !isNaN(_maxWidthInner):\r\n            // - Override the sizing._maxWidth value with it.\r\n            if (sizing._maxWidthInner !== undefined) {\r\n                classNames.push(\"col-maxwidth-inner\");\r\n                if (\r\n                    sizing._maxWidth === undefined ||\r\n                    !isNaN(sizing._maxWidthInner)\r\n                ) {\r\n                    sizing._maxWidth = sizing._maxWidthInner;\r\n                }\r\n            }\r\n\r\n            // MaxWidth\r\n            // ----------------------------------------------\r\n            // New rule:\r\n            // - if _maxWidth is undefined:\r\n            //      - Set it to true if _width is defined and not \"auto\"\r\n            //      - Set it to false in all other instances.\r\n            // - if _maxWidth is true and _width is undefined, set _width to 6 (this used to be done with CSS).\r\n            if (sizing._maxWidth === undefined) {\r\n                sizing._maxWidth = sizing._width == \"auto\" ? false : sizing._width !== undefined; \r\n            }\r\n            else if (sizing._maxWidth === true && sizing._width === undefined) {\r\n                sizing._width = 6;\r\n            }\r\n            classNames.push(this._validateProperty(sizing, \"_maxWidth\", true) ? (\"col-maxwidth\" + (sizing._maxWidth === true ? \"\" : (\"-\" + sizing._maxWidth))) : undefined);\r\n\r\n            // MinWidth\r\n            // ----------------------------------------------\r\n            if (sizing._minWidth === undefined) sizing._minWidth = false; \r\n            classNames.push(this._validateProperty(sizing, \"_minWidth\", true) ? (\"col-minwidth\" + (sizing._minWidth === true ? \"\" : (\"-\" + sizing._minWidth))) : undefined);\r\n\r\n            // Float\r\n            // ----------------------------------------------\r\n            if (sizing._float) {\r\n                classNames.push(\"col-float\");\r\n                switch (sizing._float) {\r\n                    case \"left\":\r\n                        classNames.push(\"col-float-left\");\r\n                        break;\r\n                    default:\r\n                        classNames.push(\"col-float-right\");\r\n                }\r\n            }\r\n\r\n            // MinHeight\r\n            // ----------------------------------------------\r\n            // EXPERIMANTAL! Only used in HotgraphicFlip.\r\n            // Sets a minHeight value based on a % of @device-width-medium.\r\n            /*if (sizing._minHeight) {\r\n                classNames.push(this._validateProperty(sizing, \"_minHeight\", false) ? (\"col-minheight-\" + sizing._minHeight) : undefined);\r\n            }*/\r\n\r\n            return classNames.join(\" \").trim();\r\n        }\r\n\r\n        /**\r\n         * Note: _sizing._maxWidth will have no effect on the sizing grid classes.\r\n         * @param {*} sizing \r\n         */\r\n        getSizingGridClasses(sizing) {\r\n            let classNames = [];\r\n            \r\n            // MaxCols (has a similar effect as _maxWidth, except this is applied at all device sizes).\r\n            classNames.push(this._validateProperty(sizing, \"_maxCols\", false) ? \"sg-maxcols-\" + sizing._maxCols : undefined);\r\n\r\n            // Item widths\r\n            classNames.push(this._validateProperty(sizing, \"_width\", false) ? \"sg-cols-\" + sizing._width : undefined);\r\n\r\n            // MinHeight\r\n            // ----------------------------------------------\r\n            // EXPERIMANTAL! Only used in HotgraphicFlip.\r\n            // Sets a minHeight value based on a % of @device-width-medium.\r\n            //classNames.push(this._validateProperty(sizing, \"_minHeight\", false) ? (\"sg-minheight-\" + sizing._minHeight) : undefined);\r\n\r\n            return classNames.join(\" \").trim();\r\n        }\r\n\r\n        /**\r\n         * Whenever the device is resized, this function will check the items and apply a horizontal-centering fix for the last row.\r\n         * Needs to be called in POSTRENDER.\r\n         * @param {*} $grid \r\n         */\r\n        setUpGridListeners($grid) {\r\n\r\n            // If the grid isn't found, show an error and continue.\r\n            // (The grid will be slightly misaligned, but it doesn't break anything; it only looks a bit off).\r\n            if (!$grid.length) {\r\n                Adapt.log.error(\"adapt-sizing: Could not initialize $grid listeners ($grid element not found).\");\r\n                return;\r\n            }\r\n\r\n            Adapt.on(\"device:resize\", () => {this.updateGridEl($grid);});\r\n\r\n            // Initial resize.\r\n            _.delay(() => {\r\n                this.updateGridEl($grid);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Troubleshooting:\r\n         * ----------------\r\n         * If the items are misaligning, ensure that their grid item element DOES NOT have max-width set.\r\n         * The script below needs the $grid.children() to all use the full width available to them.\r\n         * It is however, perfectly fine to use max-width on inner elements of the items.\r\n         * \r\n         * @param {*} $grid \r\n         * @returns \r\n         */\r\n        updateGridEl($grid) {\r\n\r\n            let $items = $grid.children();\r\n            \r\n            // First, remove all orphan classes.\r\n            $items.removeClass(function(idx, className) {\r\n                return (className.match(/(^|\\s)sg-orphan-\\S+/g) || []).join(' ');\r\n            });\r\n\r\n            let columnGap = parseInt($grid.css(\"column-gap\"), 10);\r\n            const THRESHOLD = columnGap/2;\r\n            \r\n            let gridWidth = $grid.outerWidth();\r\n            let itemWidth = $items.first().outerWidth(); // All items should have the same width.\r\n            let itemCount = $items.length;\r\n\r\n            let w = -columnGap;\r\n            let columnCount = 0;\r\n            while (Math.round(w) < gridWidth - THRESHOLD) {\r\n                w += itemWidth + columnGap;\r\n                columnCount++;\r\n            }\r\n            //console.log(columnCount);\r\n            //if (w > gridWidth) columnCount--; // Adjust math.\r\n\r\n            //console.log(w + \" > \" + (gridWidth + THRESHOLD));\r\n\r\n            let orphanCount = itemCount % columnCount;\r\n            if (orphanCount == 0) return;\r\n\r\n            // Add an orphan class to the first child of the last row.\r\n            $items.eq(itemCount - orphanCount).addClass(\"sg-orphan-\" + (columnCount - orphanCount));\r\n        }\r\n\r\n        // Classes which should be applied to the parent element (the one which has \"display: flex;\").\r\n        getParentClasses(sizing) {\r\n\r\n            sizing = this._getSizingObj(sizing);\r\n            let classNames = [];\r\n            \r\n            // Float\r\n            if (Boolean(sizing._float)) {\r\n                classNames.push(\"par-contains-float\");\r\n                classNames.push(\"u-clearfix\"); // Also needed to ensure floats don't overflow.\r\n            }\r\n            else {\r\n                classNames.push(\"par-contains-flex\");\r\n            }\r\n\r\n            return classNames.join(\" \").trim();\r\n        }\r\n\r\n        // Synonym\r\n        getSizingClass() {\r\n            return this.getSizingClasses.apply(this, arguments);\r\n        }\r\n\r\n        hasFloatingChildren(sizing){\r\n            return Boolean(sizing._float);\r\n        }\r\n\r\n        // Synonym\r\n        hasFloat(){\r\n            return this.hasFloatingChildren.apply(this, arguments);\r\n        }\r\n    }\r\n\r\n    let sizing = new Sizing();\r\n\r\n    Adapt.sizing = sizing;\r\n});\r\n","define(function() {\r\n\r\n  return new ENUM([\r\n    'SMALL',\r\n    'LARGE'\r\n  ]);\r\n\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './modeEnum'\r\n], function(Adapt, MODE) {\r\n\r\n    // Must be >= 50. \"85\" seems to be a good number here. \"70\" resulted in some inviews skipping if the user scrolled too fast.\r\n    // Note: the shorter the screen (vertically), the more likely some inview events will be skipped from fast scrolling.\r\n    const componentInviewThreshold = 85; \r\n\r\n    class StickyBlockView extends Backbone.View {\r\n\r\n        className() {\r\n            let classes = [\r\n                \"stickyblock\",\r\n                \"layout-\" + (this.model.get(\"_stickyBlock\")._layout || \"left\"),\r\n                (this.model.get(\"_stickyBlock\")._timeline?._isEnabled) ? \"has-timeline\" : \"\" // Optional timeline feature. \r\n            ];\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            \r\n        }\r\n\r\n        initialize(){\r\n            \r\n            this.setUpModelData();\r\n            this.setUpEventListeners();\r\n            this.render();\r\n            this.setUpIntersectionObserver();\r\n            this.setUpTimeline();\r\n        }\r\n\r\n        /**\r\n         * Set up additional model data needed to add the _timeline feature.\r\n         */\r\n        setUpTimeline() {\r\n\r\n            if (!this.model.get(\"_stickyBlock\")._timeline?._isEnabled) return;\r\n\r\n            // If the child model has a timeline title, customize its componentRow divider.\r\n            this.getStaticChildren().each(childModel => {\r\n                let timelineTitle = childModel.get(\"_stickyBlock\")?._timeline?.title;\r\n                if (timelineTitle) {\r\n                    childModel.get(\"_componentRow\").set(\"_divider\", {\r\n                        title: timelineTitle,\r\n                        _classes: \"is-stickyblock-timeline-divider\"\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * The IntersectionObserver will keep track of when the entire stickyBlockView.$el\r\n         * enters / exits the viewport.\r\n         * \r\n         * It's used to determine whether to show the first or last stickyBlockStickyChild when the\r\n         * user scrolls the element into view.\r\n         * \r\n         * TODO: IntersectionObservers are more efficient than scroll listeners. Implement them\r\n         * for the component children too when time permits.\r\n         */\r\n        setUpIntersectionObserver(){\r\n\r\n            // Observe when the sticky column is fully inview (stuck).\r\n            const stickyColObserver = new IntersectionObserver((entries) => {\r\n                entries.forEach(this.onStickyColIntersection.bind(this));\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                rootMargin: '-1px 0px 0px 0px',\r\n                threshold: [0.9]\r\n            });\r\n            stickyColObserver.observe(this.$(\".stickyblock__col.is-sticky\")[0]);\r\n\r\n            // Observe main stickyBlock.\r\n            const stickyBlockObserver = new IntersectionObserver((entries) => {\r\n                entries.forEach(this.onIntersection.bind(this));\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                rootMargin: '0px',\r\n                threshold: [0]\r\n            });\r\n            stickyBlockObserver.observe(this.$el[0]);\r\n        }\r\n\r\n        onStickyColIntersection(entry) {\r\n\r\n            // When true, it means that the \"graphic\" half of this template is fully visible.\r\n            this.model.set(\"_isStickyColInview\", entry.isIntersecting);\r\n            \r\n            if (!entry.isIntersecting) return;\r\n\r\n            // Trigger an inview event on the active sticky component.\r\n            this.triggerStickyChildInview(\r\n                true, \r\n                entry.intersectionRect.top <= 2 ? this.model.get(\"_stickyBlock\")._children.static.length-1 : 0\r\n            );\r\n        }\r\n\r\n        onIntersection(entry) {\r\n\r\n            let staticChildren = this.getStaticChildren();\r\n\r\n            // The user has just scrolled >=1px of the StickyBlock into view.\r\n            if (entry.isIntersecting) {\r\n\r\n                this.model.get(\"_stickyBlock\")._isInview = true;\r\n\r\n                // The user was scrolling up.\r\n                if (entry.boundingClientRect.top < 0) {\r\n\r\n                    // Ensure the last sticky child is shown.\r\n                    staticChildren.last().set(\"_stickyBlockStaticChildInview\", true);\r\n                }\r\n                // The user was scrolling down.\r\n                else {\r\n                    // Ensure the first sticky child is shown.\r\n                    staticChildren.first().set(\"_stickyBlockStaticChildInview\", true);\r\n                }\r\n            }\r\n            // The user has just scrolled the StickyBlock entirely out of view. \r\n            else {\r\n\r\n                this.model.get(\"_stickyBlock\")._isInview = false;\r\n\r\n                this.getStickyChildren().each(childModel => {\r\n                    childModel.trigger(\"stickyBlock:outview\");\r\n                });\r\n            }\r\n        }\r\n        \r\n        /**\r\n         * Create two collections to store all the left and right aligned components in this block.\r\n         */\r\n        setUpModelData(){\r\n\r\n            let _stickyBlock = this.model.get(\"_stickyBlock\");\r\n\r\n            // Determine which column will be static.\r\n            /*let _layout = _stickyBlock._layout;\r\n            if (_layout != \"left\" && _layout != \"right\") {\r\n                throw \"_stickyBlock._layout cannot = \\\"\" + _layout + \"\\\". MUST = either \\\"left\\\" | \\\"right\\\".\";\r\n            }*/\r\n            let _layout = \"left\"; // If the \"_layout\" property is set to \"right\", then the CSS will change the layouts itself.\r\n\r\n            let c = {};\r\n            c[\"left\"] = [];\r\n            c[\"right\"] = [];\r\n\r\n            // Populate the two collections using the block's componentRow values to determine pairings.\r\n            let blockComponentRow = this.model.get(\"_componentRow\");\r\n\r\n            blockComponentRow.get(\"_children\").each(componentRow => {\r\n\r\n                let _children = componentRow.get(\"_children\");\r\n                \r\n                let child0;\r\n                let child1;\r\n\r\n                // Allow for the same stickyChild to be held between multiple reveals (shared stickyChild).\r\n                if (_children.length !== 2) {\r\n\r\n                    child0 = _children.models[0];\r\n\r\n                    let layout = _children.models[0].get(\"_layout\");\r\n                    layout = layout == \"left\" ? \"right\" : \"left\";\r\n\r\n                    child1 = c[layout][c[layout].length-1];\r\n                }\r\n                else {\r\n                    child0 = _children.models[0];\r\n                    child1 = _children.models[1];\r\n                }\r\n\r\n                let layout0 = child0.get(\"_layout\");\r\n                let layout1 = child1.get(\"_layout\");\r\n\r\n                if (layout0 != \"left\" && layout0 != \"right\") {\r\n                    throw \"_stickyBlock can't have a component with \\\"_layout\\\": \\\"\" + _layout0 + \"\\\"\";\r\n                }\r\n                if (layout1 != \"left\" && layout1 != \"right\") {\r\n                    throw \"_stickyBlock can't have a component with \\\"_layout\\\": \\\"\" + _layout0 + \"\\\"\";\r\n                }\r\n\r\n                // Create easy links between the paired components.\r\n                if (!child0.get(\"_stickyBlockSiblings\")) child0.set(\"_stickyBlockSiblings\", new Backbone.Collection());\r\n                if (!child1.get(\"_stickyBlockSiblings\")) child1.set(\"_stickyBlockSiblings\", new Backbone.Collection());\r\n                child0.get(\"_stickyBlockSiblings\").push(child1);\r\n                child1.get(\"_stickyBlockSiblings\").push(child0);\r\n\r\n                // Only set if undefined (prevents shared stickyChildren being given the last index they use instead of the first).\r\n                if (child0.get(\"_stickyBlockIndex\") === undefined) child0.set(\"_stickyBlockIndex\", componentRow.get(\"_index\"));\r\n                if (child1.get(\"_stickyBlockIndex\") === undefined) child1.set(\"_stickyBlockIndex\", componentRow.get(\"_index\"));\r\n\r\n                c[layout0].push(child0);\r\n                c[layout1].push(child1);\r\n            });\r\n\r\n            c.left = new Backbone.Collection(c.left);\r\n            c.right = new Backbone.Collection(c.right);\r\n            c.static = c[_layout];\r\n            c.sticky = c[_layout == \"right\" ? \"left\" : \"right\"];\r\n\r\n            // adapt-sizing compatibility\r\n            // --------------------------\r\n            let _sizing = this.model.get(\"_sizing\");\r\n            _.each(c.sticky.models, (model) => {\r\n\r\n                // Apply the block's sizing properties to the components by default.\r\n                // Individual component's _sizing properties will extend them.\r\n                let modelSizing = model.get(\"_sizing\");\r\n                modelSizing = _.extend(\r\n                    {},         // Ensure a deep clone.\r\n                    _sizing,    // Inherit the sizing values assigned to the block.\r\n                    _sizing ? { // Apply the block's _maxWidth values.\r\n                        _maxWidth:_sizing._maxWidth === true ? _sizing._width : _sizing._maxWidth\r\n                    } : {},\r\n                    modelSizing // Finally, override with the component's _sizing properties. \r\n                );\r\n\r\n                model.set(\"_sizing\", modelSizing);\r\n            });\r\n\r\n            // ComponentRow override:\r\n            // No matter what, every single componentRow in the stickyBlock has \"two children\",\r\n            // (Either normally, or faked in the case of shared stickyChildren).\r\n            this.model.get(\"_componentRow\").get(\"_children\").each((componentRow) => {\r\n                componentRow.set(\"_isSingle\", false);\r\n            });\r\n\r\n            this.model.get(\"_stickyBlock\")._children = c;\r\n        }\r\n\r\n        setUpEventListeners(){\r\n\r\n            this.listenTo(this.model.getChildren(), {\r\n                \"change:_stickyBlockStaticChildInview\": this.onStaticChildInviewChange.bind(this),\r\n                \"change:_isVisible\": this.onChildVisibleChange.bind(this)\r\n            });\r\n\r\n            // Wait for all children to be ready, then decide whether to enable/disable the stickyBlockView.\r\n            // adapt-events provided this event.\r\n            this.listenToOnce(this.model, \"blockView:childrenReady\", this.onChildrenReady.bind(this));\r\n        }\r\n\r\n        onChildrenReady() {\r\n            this.listenTo(Adapt, {'device:changed': this.onDeviceChanged});\r\n            this.listenTo(this.model, \"change:_mode\", this.reRender);\r\n            \r\n            // Set up initial mode.\r\n            this.calculateMode();\r\n        }\r\n\r\n        calculateMode() {\r\n            let mode = Adapt.device.screenSize === 'large' ?\r\n                MODE.LARGE :\r\n                MODE.SMALL;\r\n            this.model.set('_mode', mode);\r\n        }\r\n\r\n        onDeviceChanged(width) {\r\n            this.calculateMode();\r\n        }\r\n\r\n        /**\r\n         * Whenever a child in the sticky column changes its visibility, toggle a class on its closest .js-stickyblock-item.\r\n         * \r\n         * FIXME: Will trigger on static children if an external script changes their \"_isVisible\" value.\r\n         * \r\n         * FIXME?: May need to rework stickyBlock to not use \"_isVisible\" and to instead toggle a custom value\r\n         * (in case another script changes the component's \"_isVisible\" value in future).\r\n         * @param {*} model \r\n         * @param {*} isVisible \r\n         */\r\n        onChildVisibleChange(model, isVisible) {\r\n            \r\n            let $child = Adapt.findViewByModelId(model.get(\"_id\")).$el;\r\n            $child.closest(\".js-stickyblock-item\")\r\n                .toggleClass(\"is-visible\", isVisible)\r\n                .toggleClass(\"is-hidden\", !isVisible);\r\n        }\r\n\r\n        reRender(model, mode) {\r\n\r\n            // Small\r\n            // ---------------------------------------------\r\n            // Disable the stickyBlockView on small devices.\r\n            if (!this.isLargeMode()) {\r\n                this.renderModeSmall();\r\n                //this.$el.removeClass(\"u-visibility-hidden\");\r\n                return;\r\n            }\r\n            \r\n            // Large\r\n            // ---------------------------------------------\r\n            // Re-enable the stickyBlockView on large devices.\r\n            this.renderModeLarge();\r\n\r\n            // Trigger another resize (since the components have just been repositioned).\r\n            Adapt.trigger('device:resize');\r\n            Adapt.trigger('device:changed');\r\n        }\r\n\r\n        /**\r\n         * Removes all clone views created for renderModeSmall().\r\n         */\r\n        removeClones() {\r\n\r\n            let $block = this.$el.closest(\".block\"); // Store a reference to the parent blockView's element.\r\n            $block.find(\".js-stickyblock-clone\").remove();\r\n        }\r\n\r\n        /**\r\n         * Hide the stickyBlockView entirely on small devices (including its events).\r\n         */\r\n        renderModeSmall() {\r\n            \r\n            let $container = Adapt.findViewByModelId(this.model.get(\"_id\")).$(\".component__container\");\r\n\r\n            // Move all componentViews out of this view's containment, make them visible, and remove their events.\r\n            this.model.getChildren().each((model) => {\r\n                let view = Adapt.findViewByModelId(model.get(\"_id\"));\r\n                model.set(\"_isVisible\", true); // In small view, all components are always visible (due to it being static).\r\n                $container.append(view.$el);\r\n\r\n                this.removeChildInview(view);\r\n\r\n                // Set their an attribute on each of them (makes it easier to determine their index in debug).\r\n                view.$el.attr(\"data-stickyblock-index\", model.get(\"_stickyBlockIndex\"));\r\n            });\r\n\r\n            this.$el.hide(0);\r\n            this.removeClones();\r\n\r\n            // Enable componentRow (it will automatically wrap itself around the components inside this block again).\r\n            this.model.get(\"_componentRow\").set(\"_isEnabled\", true);\r\n            \r\n\r\n            // Shared stickyChild functionality:\r\n            // -----------------------------------------------------------------------------------------------------------------\r\n            // WARNING: Keep an eye on this. Has the potential to cause errors if used with complex components.\r\n            // For each componentRow which has only one child, create a temporary view clone of the previous stickyChild's model.\r\n            let $block = this.$el.closest(\".block\"); // Store a reference to the parent blockView's element.\r\n            this._cloneModels = new Backbone.Collection();\r\n            this.model.get(\"_componentRow\").get(\"_children\").each((componentRow) => {\r\n                \r\n                // If this componentRow has two children, then it's a normal static + sticky child pair.\r\n                // No cloning needed.\r\n                if (componentRow.getChildren().length != 1) return;\r\n\r\n                let componentRowIndex = componentRow.get(\"_index\");\r\n\r\n                // If the componentRow has only one child, it will ALWAYS be the static child.\r\n                let staticChild = componentRow.getChildren().first();\r\n\r\n                // Get the shared stickyChild the staticChild is paired with.\r\n                let stickyChild = staticChild.get(\"_stickyBlockSiblings\").first();\r\n                \r\n                let view = Adapt.getViewClass(stickyChild.get(\"_component\"));\r\n\r\n                // CUSTOM:\r\n                // Clear any \"resetOnReRender\" properties that may have been explicitly specified by other plugins.\r\n                _.each(Adapt.stickyBlock.getResetOnReRender(), propertyName => {stickyChild.set(propertyName, null);});\r\n\r\n                // Clone the model too (having all the cloneViews share the same model results in many issues with other helpers.\r\n                let cloneModel = stickyChild.clone();\r\n                this._cloneModels.push(cloneModel);\r\n                \r\n                let cloneView = new view({ model: cloneModel }); \r\n                let $componentRow = $block.find(\".componentrow\").filter(\"[data-componentrow-index=\" + componentRowIndex + \"]\");\r\n\r\n                // Note: if componentRow's componentView:postRender event is triggered on a componentView with .isClone == true,\r\n                // it will stop the componentRow callback (intentional). \r\n                cloneView.isClone = true;\r\n                let $container = $componentRow.find(\".js-componentrow-items\");\r\n\r\n                cloneView.$el\r\n                    .addClass(\"js-stickyblock-clone\")\r\n                    .attr(\"data-adapt-id\", cloneModel.get(\"_id\") + \"--stickyblock-clone\")\r\n                    .attr(\"data-stickyblock-index\", staticChild.get(\"_stickyBlockIndex\")); // (Used by custom scripts).\r\n\r\n                // Determine whether to append or prepend the clone to the componentRow based on the original componentModels index in the original componentRow.\r\n                let cr = cloneModel.get(\"_componentRow\");\r\n                let originalIndex = cr.getChildren().indexOf(cloneModel);\r\n\r\n                if (originalIndex == 0) { // The original componentModel was the first element in its componentRow. Prepend.\r\n                    $container.prepend(cloneView.$el);\r\n                }\r\n                else { // The original componentModel was the second element in its componentRow. Append.\r\n                    $container.append(cloneView.$el);\r\n                }\r\n            });\r\n\r\n            // Log which properties were just reset,\r\n            Adapt.log.info(`StickyBlock: Cleared component properties on reRender: [${Adapt.stickyBlock.getResetOnReRender().join(\",\")}]`);\r\n\r\n            // Trigger an inview on ALL the stickyComponents and ALL clones (since they're ALL technically inview now).\r\n            _.delay(() => {\r\n                this.getStickyChildren().each((stickyChild) => {\r\n                    stickyChild.trigger(\"stickyBlock:inview\");\r\n                    //stickyChild.trigger(\"stickyBlock:reRender\");\r\n                });\r\n                this._cloneModels.each((model) => {\r\n                    model.trigger(\"stickyBlock:inview\");\r\n                    //model.trigger(\"stickyBlock:reRender\");\r\n                });\r\n            }, 0);\r\n            \r\n            return;\r\n        }\r\n\r\n        /**\r\n         * Moves components inside the stickyBlockView containers and enables events.\r\n         */\r\n        renderModeLarge() {\r\n            \r\n            this.removeClones();\r\n            this.$el.show(0);\r\n            this.model.get(\"_componentRow\").set(\"_isEnabled\", false); // Will automatically move all components out of the componentRow elements before deleting them.\r\n            \r\n            let staticChildren = this.getStaticChildren();\r\n\r\n            // Inview calculations.\r\n            let viewportHeight = window.innerHeight;\r\n            let scrollTop = window.scrollY;\r\n            let onscreenView = undefined;\r\n\r\n            this.model.getChildren().each((model, i) => {\r\n                let _id = model.get(\"_id\");\r\n                let view = Adapt.findViewByModelId(_id);\r\n                this.$(\".js-stickyblock-item.\" + _id).find(\".stickyblock__item-inner\").append(view.$el);\r\n\r\n                // Set an attribute on each of them (makes it easier to determine their index in debug).\r\n                view.$el.attr(\"data-stickyblock-index\", model.get(\"_stickyBlockIndex\"));\r\n                \r\n                // This model is a static child.\r\n                // Have the childView start listening for inview events on the scrolling sibling.\r\n                if (staticChildren.includes(model)) {\r\n                    this.initChildInview(view);\r\n                    model.set(\"_stickyBlockStaticChildInview\", false);\r\n\r\n                    // Hide all sticky children, and then reveal the one closest to the center of the viewport.\r\n                    // (This only needs to happen once each resize, after which point the scroll event will take over).\r\n                    let bb = view.$el[0].getBoundingClientRect();\r\n                    let offsetTop = bb.top;\r\n                    let height = bb.height;\r\n\r\n                    let inviewTop = scrollTop + viewportHeight - offsetTop;\r\n                    let inviewPercent = inviewTop / ((viewportHeight + height) / 100);\r\n\r\n                    // Record the value to the view.\r\n                    view.inviewPercent = inviewPercent;\r\n\r\n                    // Store a reference to the view that's closest to the center of the screen.\r\n                    if (onscreenView == undefined || Math.abs(view.inviewPercent) < Math.abs(onscreenView.inviewPercent)) {\r\n                        onscreenView = view;\r\n                    }\r\n                }\r\n                // This model is a sticky child.\r\n                else {\r\n                    model.set(\"_isVisible\", false); // Fallback to ensure all sticky children are hidden when _stickyBlockStaticChildInview:change turns on visiblity for one of them.\r\n                }\r\n            });\r\n\r\n            // Show the sticky child component that's paired with the onscreenView.\r\n            onscreenView.model.set(\"_stickyBlockStaticChildInview\", true);\r\n        }\r\n\r\n        isLargeMode () {\r\n            return Adapt.device.screenSize === \"large\";\r\n        }\r\n\r\n        getStickyBlockData(){\r\n            return this.model.get(\"_stickyBlock\");\r\n        }\r\n\r\n        getStaticChildren(){\r\n            return this.getStickyBlockData()._children.static;\r\n        }\r\n\r\n        getStickyChildren(){\r\n            return this.getStickyBlockData()._children.sticky;\r\n        }\r\n\r\n        /**\r\n         * Listen to inview events on the components in the static column.\r\n         * https://github.com/adaptlearning/jquery.onscreen\r\n         */\r\n        initChildInview(view) {\r\n\r\n            view.$el.on('onscreen.stickyBlockView', (event, m) => {\r\n\r\n                const threshold = componentInviewThreshold;\r\n                \r\n                // Only one child will be active at once; the one that's closest to the vertical center of the screen.\r\n                if (m.percentFromTop < threshold && m.percentFromBottom < threshold) {\r\n                    view.model.set(\"_stickyBlockStaticChildInview\", true);\r\n                }\r\n            });\r\n        }\r\n\r\n        removeChildInview(view) {\r\n            view.$el.off(\"onscreen.stickyBlockView\");\r\n        }\r\n\r\n        /**\r\n         * If this view is removed, be sure to remove the onscreen event listeners too.\r\n         */\r\n        remove() {\r\n            this.getStaticChildren().each((model) => {\r\n                this.removeChildInview(Adapt.findViewByModelId(model.get(\"_id\")));\r\n            });\r\n\r\n            Backbone.View.remove.apply(this, arguments);\r\n        }\r\n\r\n        getActiveStaticChild(){\r\n            return this.getStaticChildren().find(childModel => {\r\n                return childModel.get(\"_stickyBlockStaticChildInview\");\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @param {int} staticChildIndex The index of the staticChild currently inview.\r\n         * @returns \r\n         */\r\n        triggerStickyChildInview(isInview, staticChildIndex){\r\n\r\n            // Don't trigger if the stickyColumn isn't inview.\r\n            if (!this.model.get(\"_isStickyColInview\")) return;\r\n\r\n            let activeStaticChild = this.getActiveStaticChild();\r\n            if (!activeStaticChild) return;\r\n\r\n            // Trigger an event on the stickyChild (allows for custom extensions).\r\n            activeStaticChild.get(\"_stickyBlockSiblings\").each((model) => {\r\n\r\n                let view = Adapt.findViewByModelId(model.get(\"_id\"));\r\n                view.$el.attr(\"data-stickyblock-index\", staticChildIndex); // Update the attribute on the view.\r\n\r\n                model.trigger(\"stickyBlock:inview\", staticChildIndex /* LEGACY! DO NOT REFERENCE THE staticChildIndex PARAMETER ANYMORE */);\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Whenever a static child is inview, show the corresponding sticky child.\r\n         * Also, make all other children not inview.\r\n         * @param {*} model \r\n         * @param {*} isInview \r\n         */\r\n        onStaticChildInviewChange(childModel, isInview) {\r\n\r\n            childModel.get(\"_stickyBlockSiblings\").each(model => {\r\n                \r\n                // Only hide the stickyChild sibling of this staticChild only if all of its siblings are hidden.\r\n                // (This is done in case multiple staticChildred share the same stickyChild).\r\n                let isVisible = false;\r\n                model.get(\"_stickyBlockSiblings\").find(staticChildModel => {\r\n                    if (staticChildModel.get(\"_stickyBlockStaticChildInview\")) {\r\n                        isVisible = true;\r\n                        return;\r\n                    }\r\n                });\r\n\r\n                model.set(\"_isVisible\", isVisible);\r\n            });\r\n\r\n            if (!isInview) return;\r\n            \r\n            // adapt-annotation compatibility: toggle off any active annotations, as this is an item change.\r\n            Adapt.trigger(\"annotation:toggle\");\r\n\r\n            // Record which static child is active.\r\n            this.model.get(\"_stickyBlock\").activeItem = childModel;\r\n\r\n            _.each(this.getStaticChildren().models, (model) => {\r\n                if (childModel == model) return; // Don't affect self.\r\n                model.set(\"_stickyBlockStaticChildInview\", false);\r\n            });\r\n\r\n            // FIXME:? _.defer() was causing a single frame of flicker with Lotties.\r\n            // I commented it out, but it's possible that it may cause other problems now.\r\n            //_.defer(() => {\r\n                // Inform the stuck component that it is active (that component can listen for changes to this value for custom functionality).\r\n                this.triggerStickyChildInview(isInview, childModel.get(\"_stickyBlockIndex\"));\r\n            //});\r\n        }\r\n\r\n        render(){\r\n            \r\n            var template = Handlebars.templates['stickyBlock'];\r\n            let data = this.model.toJSON();\r\n            data._stickyBlock._children.left = data._stickyBlock._children.left.toJSON();\r\n            data._stickyBlock._children.right = data._stickyBlock._children.right.toJSON();\r\n            this.$el.html(template(data));\r\n        }\r\n\r\n    };\r\n\r\n    return StickyBlockView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './stickyBlockView'\r\n], function(Adapt, StickyBlockView) {\r\n\r\n    /**\r\n     * StickyBlockEpubView\r\n     * -------------------\r\n     * An extension of the normal StickyBlockView that explicitly sticks/unsticks the sticky column using JavaScript instead of \r\n     * the default CSS \"position: sticky\" method.\r\n     * \r\n     * Explanation:\r\n     * ------------\r\n     * When Adapt is converted to EPUB for use with the Desktop and Online Bookshelf apps, the StickyBlockView \"sticking\" behaviour breaks.\r\n     * In order to fix the issue, the following needs to be done:\r\n     * \r\n     * - For the Desktop Bookshelf app, IntersectionObservers are used on a helper element to determine when to stick/unstick.\r\n     *   jQuery's \"inview\" listener was used, but didn't seem to work for Desktop Bookshelf.\r\n     * \r\n     * - For the Online Bookshelf app, the jQuery \"inview\" listener is used on the helper element instead, since the\r\n     *   IntersectionObservers don't seem to be working correctly in Online Bookshelf.\r\n     * \r\n     * IMPORTANT:\r\n     * ----------\r\n     * VitalSource Bookshelf's Desktop app does NOT support BoundingClientRect.x or y. Use top/left instead.\r\n     */\r\n\r\n    class StickyBlockEpubView extends StickyBlockView {\r\n\r\n        className() {\r\n            let classes = super.className();\r\n            return classes + \" is-epub-stickyblock\";\r\n        }\r\n\r\n        initialize() {\r\n            this.model.get(\"_stickyBlock\")._isEpubMode = true;\r\n            super.initialize();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            super.setUpEventListeners();\r\n            this.listenTo(this.model, \"change:_epubHelperInview\", this.onEpubHelperInviewChange);\r\n        }\r\n\r\n        /**\r\n         * Append an \"inview helper\" element after rendering; which will be used by the IntersectionObserver and the jQuery listener\r\n         * to determine when to stick/unstick the sticky column.\r\n         */\r\n        render() {\r\n            super.render();\r\n\r\n            let $inviewHelper = $(\"<div>\", {class: \"stickyblock__epub-inview-helper\"});\r\n            let $blockPar = Adapt.findViewByModelId(this.model.get(\"_id\")).$el;                \r\n            $blockPar.append($inviewHelper);\r\n\r\n            this.$inviewHelper = $inviewHelper;\r\n\r\n            // Start off unstuck and aligned to the top.\r\n            this.setEpubHelperInview(false, true);\r\n        }\r\n\r\n        /**\r\n         * Sets the values of the _epubHelperInview property.\r\n         * FIXME:? Use of strings is weird.\r\n         * \r\n         * @param {Boolean} isInview Should the sticky column be stuck (true) or unstuck (false)\r\n         * @param {Boolean} isTop    Should the sticky column move to the start (true) or end (false) of the StickyBlockEpubView (only applicable if !isInview).\r\n         */\r\n        setEpubHelperInview(isInview, isTop) {\r\n            \r\n            if (isInview) {\r\n                this.model.set(\"_epubHelperInview\", \"inview\" + (isTop ? \"Top\" : \"Bottom\"));\r\n            }\r\n            else {\r\n                this.model.set(\"_epubHelperInview\", \"outview\" + (isTop ? \"Top\" : \"Bottom\"));\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Add an IntersectionObserver to monitor the helper element. \r\n         * \r\n         * EDIT: This may not be necessary; I think I got the jQuery event working in Desktop Bookshelf too.\r\n         */\r\n        /*setUpIntersectionObserver() {\r\n            super.setUpIntersectionObserver();\r\n\r\n            // IMPORTANT: Do NOT use negative % values for the 'rootMargin' setting. For example: '0px 0px -100% 0px'.\r\n            // Due to the way that Bookshelf nests its iframes, these values do not work accurately.\r\n                \r\n            const epubBlockObserver = new IntersectionObserver((entries) => {\r\n                entries.forEach(this.onEpubIntersection.bind(this));\r\n            }, {\r\n                root: null, // Browser viewport.\r\n                rootMargin: '0px', // Detect when the top of this view goes off the top of the viewport.\r\n                threshold: [0]\r\n            });\r\n            epubBlockObserver.observe(this.$inviewHelper[0]);\r\n        }*/\r\n\r\n        onEpubIntersection(entry) {\r\n\r\n            if (!this.isLargeMode()) return; // Completely ignore this callback if the sticky is in single column (static) view.\r\n\r\n            // Bugfix: Ignore a \"fake\" intersection that sometimes triggers when slow loading.\r\n            if (!entry.rootBounds) return;\r\n            \r\n            let isIntersecting = entry.isIntersecting;\r\n            if (isIntersecting) {\r\n                // If the top of the $inviewHelper is off the top of the viewport when coming into view, it means that the user \r\n                // is looking at the bottom of the stickyBlock.\r\n                let isBottom = entry.boundingClientRect.top <= 0;\r\n                this.setEpubHelperInview(true, !isBottom);\r\n            }\r\n            else {\r\n                // When the bottom of the observer helper is off the top of the viewport, stick the column to the\r\n                // bottom of the StickyBlockView.\r\n                let isBottom = entry.boundingClientRect.bottom <= 0;\r\n                this.setEpubHelperInview(false, !isBottom);\r\n            }\r\n        }\r\n\r\n        _isInview() {\r\n            return Boolean(this.model.get(\"_epubHelperInview\").match(/^inview/g));\r\n        }\r\n\r\n        _isTop() {\r\n            return Boolean(this.model.get(\"_epubHelperInview\").match(/Top$/g));\r\n        }\r\n        \r\n        /**\r\n         * Epub mode exclusive inview observer.\r\n         * Used as a workaround for \"position: sticky;\" not working when used with the root scrollbar.\r\n         * \r\n         * TODO: If an alternative to this approach is found, swap to it (using the onscreen observer is more costly and has worse \r\n         * performance than position: sticky).\r\n         * @returns \r\n         */\r\n        initEpubHelperInview() {\r\n\r\n            this._isEpubHelperInview = undefined;\r\n\r\n            this.$inviewHelper.on('inview.stickyBlockHelper', (event, isInview) => {\r\n\r\n                if (!this.isLargeMode()) return; // Completely ignore this callback if the sticky is in single column (static) view.\r\n\r\n                //let isInview = m.onscreen;\r\n\r\n                // Don't do anything if this is the same inview state from last time.\r\n                if (this._isInview() === isInview) return;\r\n\r\n                let helperBB = this.$inviewHelper[0].getBoundingClientRect();\r\n                \r\n                if (isInview) {\r\n\r\n                    // If the top of the $inviewHelper is off the top of the viewport when coming into view, it means that the user \r\n                    // is looking at the bottom of the stickyBlock.\r\n                    let isBottom = helperBB.top <= 0;\r\n                    this.setEpubHelperInview(true, !isBottom);\r\n                }\r\n                else {\r\n                    // When the bottom of the inview helper is off the top of the viewport, stick the column to the\r\n                    // bottom of the StickyBlockView.\r\n                    let isBottom = helperBB.bottom <= 0;\r\n                    this.setEpubHelperInview(false, !isBottom);\r\n                }\r\n            });\r\n        }\r\n\r\n        removeEpubHelperInview() {\r\n            this.$(\".stickyblock__epub-inview-helper\").off(\"inview.stickyBlockHelper\");\r\n        }\r\n\r\n        renderModeSmall() {\r\n            this.removeEpubHelperInview();\r\n            super.renderModeSmall();\r\n\r\n            // Fallback: Sometimes the child elements don't properly reset their visibility after a resize.\r\n            /*this.model.getChildren().each((model) => {\r\n                model.set(\"_isVisible\", true);\r\n            });*/\r\n        }\r\n\r\n        renderModeLarge() {\r\n            super.renderModeLarge();\r\n            this.initEpubHelperInview();\r\n        }\r\n\r\n        remove() {\r\n            super.remove();\r\n            this.removeEpubHelperInview();\r\n        }\r\n\r\n        onEpubHelperInviewChange(model, epubHelperInview) {\r\n\r\n            Adapt.log.debug(\"StickyBlockEpubView: \" + epubHelperInview);\r\n            //console.log(\"StickyBlockEpubView: \" + epubHelperInview);\r\n\r\n            // Whenever the stickyBlock becomes stuck/unstuck using this callback, there's a high chance that it will sharply\r\n            // \"jump\" between two y (top) values. This jump can't be prevented (without making the entire page run slower), but it can be smoothed.\r\n            let staticChildren = this.getStaticChildren();\r\n\r\n            let isInview = this._isInview();\r\n            let isBottom = !this._isTop();\r\n\r\n            let $componentContainer = this.$(\".js-stickyblock-epub-component-container\");\r\n            let fromTop = $componentContainer[0].getBoundingClientRect().top;\r\n            \r\n            this.$el\r\n                .toggleClass(\"is-epub-stuck\", isInview)\r\n                .toggleClass(\"is-epub-free\", !isInview);\r\n\r\n            // The \"this.setUpIntersectionObserver()\" observers don't work consistently in some EPUB contexts.\r\n            // This is the fallback.\r\n            if (isInview) {\r\n                \r\n                // The user just scrolled up to the stickyBlockView.\r\n                if (isBottom) {\r\n\r\n                    // Ensure the last sticky child is shown.\r\n                    staticChildren.last().set(\"_stickyBlockStaticChildInview\", true);\r\n                    \r\n                    // Trigger an inview event on the active sticky component.\r\n                    this.triggerStickyChildInview(true, staticChildren.length-1);\r\n                }\r\n                // The user just scrolled down to the stickyBlockView.\r\n                else {\r\n\r\n                    // Ensure the first sticky child is shown.\r\n                    staticChildren.first().set(\"_stickyBlockStaticChildInview\", true);\r\n\r\n                    // Trigger an inview event on the active sticky component.\r\n                    this.triggerStickyChildInview(true, 0);\r\n                }\r\n            }\r\n\r\n            /**\r\n             * If the sticky column is to become \"free\" (non-'position: fixed;'), determine which end (top/bottom)\r\n             * of the stickyBlockView to stick it to.\r\n             * Only do this on the initial change from isInview -> !isInview.\r\n             */\r\n            if (!isInview) {\r\n                this.$el\r\n                    .toggleClass(\"is-top\", !isBottom)\r\n                    .toggleClass(\"is-bottom\", isBottom);\r\n            }\r\n\r\n            // Smoothly transition the .js-stickyblock-epub-block to reduce the y (top) \"snap\".\r\n            let toTop = $componentContainer[0].getBoundingClientRect().top;\r\n            let topDiff = fromTop - toTop;\r\n\r\n            let $epubBlock = this.$(\".js-stickyblock-epub-block\");\r\n            \r\n            // Go to this transform immediately (skip transitions).\r\n            $epubBlock.css(\"transform\", \"translateY(\" + topDiff + \"px)\").hide(0).show(0);\r\n            \r\n            // Then smoothly transition to the untransformed state.\r\n            $epubBlock.css(\"transform\", \"translateY(0px)\");\r\n        }\r\n\r\n    };\r\n\r\n    return StickyBlockEpubView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    \"./stickyBlockView\",\r\n    \"./stickyBlockEpubView\"\r\n], function(Handlebars, Adapt, StickyBlockView, StickyBlockEpubView) {\r\n\r\n    /**\r\n     * adapt-stickyBlock\r\n     * --------------------------------------\r\n     * ! BE SURE TO INCLUDE ALL REQUIRED EXTENSIONS (see bower.json) FOR THIS EXTENSION !\r\n     * \r\n     * Modifies specific blocks to display their content in a \"sticky scroll\" fashion.\r\n     * \r\n     * How to use:\r\n     * -----------\r\n     * - All components inside the block will be affected.\r\n     * - Components with _layout == _stickyBlock._layout will scroll (put text here).\r\n     * - Components with _layout != _stickyBlock._layout will stick to the screen (put graphics here).\r\n     * - Basically, set up components as normal \"left\" + \"right\" pairs. The block will make one side sticky, the other side scroll.\r\n     * \r\n     * TODO:\r\n     * -----\r\n     * - If possible, have the first/last reveal of the sticky be \"disguised\" as a normal componentRow until the user starts scrolling.\r\n     *   (basically, have the spacing between the sticky and the surrounding blocks expand while it's stuck).\r\n     * - Have the stuck column offer scrolling if necessary (as a fallback).\r\n     * \r\n     * FIXME:\r\n     * ------\r\n     * - Add support for stickyElement.\r\n     */\r\n\r\n    // adapt-componentRow compatibility\r\n    // ------------------------------------------------------------\r\n    // Don't let the components be wrapped with the componentRow extension if the block is sticky.\r\n    Adapt.on(\"app:dataReady\", () => {\r\n\r\n        Adapt.blocks.each((model) => {\r\n            let _stickyBlock = model.get(\"_stickyBlock\");\r\n            if (!_stickyBlock || _stickyBlock._isEnabled === false) return;\r\n            \r\n            let _componentRow = model.get(\"_componentRow\");\r\n            model.set(\"_componentRow\", _.extend(_componentRow || {}, {_isEnabled: false}));\r\n        });\r\n    });\r\n\r\n    Adapt.on(\"blockView:postRender\", (blockView) => {\r\n\r\n        let blockModel = blockView.model;\r\n        let _stickyBlock = blockModel.get(\"_stickyBlock\");\r\n        if (!_stickyBlock || _stickyBlock._isEnabled === false) return;\r\n\r\n        blockView.$el.addClass(\"is-stickyblock\");\r\n        \r\n        let view = StickyBlockView;\r\n        if (Adapt.isEpubMode()) view = StickyBlockEpubView;\r\n\r\n        // Create and append the view which will rearrange the block's components.\r\n        blockView.$(\".component__container\").append(new view({\r\n            model: blockModel\r\n        }).$el);\r\n    });\r\n\r\n    /**\r\n     * Allows any element to get the stickyBlock index of the component they're currently in (if applicable).\r\n     */\r\n    $.fn.getParentStickyBlockIndex = function() {\r\n\r\n        let $component = $(this).closest(\".component\");\r\n        if (!$component.length) Adapt.log.error(\"$.fn.getStickyBlockIndex(): could not find closest \\\".component\\\" for selector:\", $(this));\r\n        \r\n        return $component.attr(\"data-stickyblock-index\");\r\n    }\r\n\r\n    class StickyBlock extends Backbone.Controller {\r\n        \r\n        initialize() {\r\n\r\n            this._resetOnReRender = [];\r\n\r\n            // Globals\r\n            this.inviewEvent = \"stickyBlock:inview\"\r\n        }\r\n\r\n        /**\r\n         * CUSTOM:\r\n         * The following properties will be cleared on componentModels whenever they are re-rendered by StickyBlock.\r\n         * This needs to be explicitly called by other plugins.\r\n         */\r\n        addResetOnReRender(propertyName) {\r\n            this._resetOnReRender.push(propertyName);\r\n            this._resetOnReRender = _.uniq(this._resetOnReRender);\r\n        }\r\n\r\n        getResetOnReRender() {\r\n            return this._resetOnReRender;\r\n        }\r\n    }\r\n\r\n    Adapt.stickyBlock = new StickyBlock();\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    /**\r\n     * FIXME:\r\n     * Known bugs:\r\n     * - Multiple and/or nested elements with StickyElementAttributes will likely cause errors in the animation.\r\n     * \r\n     * TODO:\r\n     * - Have all stickyElementItems in a group synchronise their scrollbars.\r\n     */\r\n\r\n    /**\r\n     * FIXME: These are copies of the attributes created by the Handlebars helpers in adapt-stickyElement.js\r\n     */\r\n    const StickyElementAttributeClasses = {\r\n        \"data-stickyelement-active-idx\": \"is-se-active\",\r\n        \"data-stickyelement-mark-idx\": \"is-se-mark\",\r\n        \"data-stickyelement-hide-idx\": \"is-se-hide\",\r\n        \"data-stickyelement-fold-idx\": \"is-se-fold\",\r\n        \"data-stickyelement-slideleft-idx\": \"is-se-slideleft\",\r\n        \"data-stickyelement-slidedown-idx\": \"is-se-slidedown\" // Requires JS to fully animate.\r\n    }\r\n\r\n    class StickyElementItemView extends Backbone.View {\r\n\r\n        className() {\r\n            return \"stickyelement u-visibility-hidden\";\r\n        }\r\n\r\n        attributes() {\r\n            return {\r\n                \"data-stickyelement-id\" : this.model.get(\"_id\"),\r\n                \"data-item-index\" : this.model.get(\"_componentItem\").get(\"_index\")\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            // Keeps track of how many times toggleAttributes has been called.\r\n            // FIXME: Done for the sake of slidedown for now.\r\n            this._toggleCount = 0;\r\n\r\n            //this.toggleAttributes = _.debounce(this.toggleAttributes.bind(this), 0);\r\n            this.setUpEventListeners();\r\n\r\n            // Ensure the initial state of the stickyElement is correct.\r\n            this.render();\r\n\r\n            // Trigger intiial state for the {{#se_*}} elements within.\r\n            if (this.model.get(\"_isActive\")) {\r\n                this.onActiveChange(\r\n                    this.model,\r\n                    this.model.get(\"_isActive\")\r\n                );\r\n            }\r\n            else {\r\n                // This call sets up the states of hidden {{#se_*}} elements.\r\n                // Is necessary to properly adjust the sizing of {{#se_fold}} helpers inside of an adapt-narrative component.\r\n                _.delay(() => {\r\n                    this.toggleAttributes(\r\n                        this.$el,\r\n                        this.model.get(\"_componentItemIndex\"),\r\n                        this._stickyBlockPrevIdx\r\n                    );\r\n                }, 0);\r\n            }\r\n        }\r\n\r\n        render() {\r\n            let template = Handlebars.templates['stickyElement'];\r\n            this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);\r\n\r\n            this.postRender();\r\n        }\r\n\r\n        postRender() {\r\n\r\n            // FIXME:\r\n            // Delay used to delay this in time for any inner HandlebarsEls. There should be a more elegant way of doing this.\r\n            _.delay(this.setUpScrolling.bind(this), 0);\r\n        }\r\n\r\n        setUpEventListeners(){\r\n\r\n            if (this.model.get(\"_parentHasTransitions\")) {\r\n                this.onActiveChange = _.debounce(this.onActiveChange.bind(this), 0); // Makes the transition slightly smoother.\r\n            }\r\n            \r\n            this.listenTo(this.model, \"change:_isActive\", this.onActiveChange);\r\n\r\n            // adapt-stickyBlock compatibility.\r\n            this.listenTo(this.model, \"change:_componentItemIndex\", this.onComponentItemIndexChange);\r\n\r\n            // Synchronize scrolling.\r\n            this.listenTo(this.getParentModel(), \"change:_itemScrollTop\", this.synchronizeScrollTop.bind(this));\r\n            this.listenTo(this.getParentModel(), \"change:_itemScrollLeft\", this.synchronizeScrollLeft.bind(this));\r\n\r\n            // Adjust {{#se_fold}} elements.\r\n            /*this.listenTo(Adapt, {\r\n                'device:resize': this.onDeviceResize\r\n            });*/\r\n        }\r\n\r\n        /*onDeviceResize() {\r\n            \r\n        }*/\r\n\r\n        _isPropertyScrollable(propertyVal) {\r\n            if (propertyVal == \"auto\" || propertyVal == \"scroll\") return true;\r\n            return false;\r\n        }\r\n\r\n        synchronizeScrollLeft(model, scrollLeft) {\r\n            if (!this.$scroll?.length) return;\r\n            // Synchronize the element to the global scroll values.\r\n            this.$scroll[0].scrollLeft = scrollLeft;\r\n        }\r\n\r\n        synchronizeScrollTop(model, scrollTop) {\r\n            if (!this.$scroll?.length) return;\r\n            // Synchronize the element to the global scroll values.\r\n            this.$scroll[0].scrollTop = scrollTop;\r\n        }\r\n\r\n        setUpScrolling() {\r\n\r\n            // Find the first scrolling element in this view and record it.\r\n            let found = false;\r\n            this.$scroll = this.$(\"*\").filter((i, e) => {\r\n                if (found) return;\r\n                if (this._isPropertyScrollable($(e).css(\"overflow\"))) {\r\n                    found = true;\r\n                    return true;\r\n                }\r\n                if (this._isPropertyScrollable($(e).css(\"overflow-x\"))) {\r\n                    found = true;\r\n                    return true;\r\n                }\r\n                if (this._isPropertyScrollable($(e).css(\"overflow-y\"))) {\r\n                    found = true;\r\n                    return true;\r\n                }\r\n                return false;\r\n            }).first();\r\n\r\n            // If no scrolling element, don't set up a listener.\r\n            // FIXME: If the element somehow gains a scrollbar after loading, then this listener won't be set up (only results in minor graphical bugs).\r\n            if (!this.$scroll.length) return;\r\n\r\n            this.$scroll.addClass(\"js-stickyelement-scroll\"); // Used by $clones.\r\n\r\n            // Listen for scroll events.\r\n            this.$scroll[0].addEventListener(\"scroll\",\r\n            _.debounce((event) => {\r\n                this.getParentModel().set(\"_itemScrollTop\", event.target.scrollTop);\r\n                this.getParentModel().set(\"_itemScrollLeft\", event.target.scrollLeft);\r\n            }, 100), {\r\n                passive: true\r\n            });\r\n        }\r\n\r\n        onComponentItemIndexChange(model, itemIdx) {\r\n\r\n            this._stickyBlockPrevIdx = model.previous(\"_componentItemIndex\");\r\n            this.onActiveChange(this.model, true);\r\n        }\r\n\r\n        onActiveChange(model, isActive, _force) {\r\n            \r\n            // Always make sure the active element is visible.\r\n            if (isActive) {\r\n                this.$el.toggleClass(\"u-visibility-hidden\", false);\r\n            }\r\n            else {\r\n                if (this.$clone) this.$clone.remove();\r\n            }\r\n            this.$el.toggleClass(\"is-stickyelement-active\", isActive);\r\n\r\n            // Ignore if not currently active.\r\n            if (!isActive) return;\r\n\r\n            let curCIndex = this.model.get(\"_componentItemIndex\");\r\n            this.$el.attr(\"data-stickyelement-curidx\", curCIndex);\r\n\r\n            // If this is the first component item activated, do nothing.\r\n            let itemPrevModel = this.model.getItemPrev();\r\n            if (\r\n                !itemPrevModel //&&\r\n                //!this.model.get(\"_isStickyBlock\") // StickyBlock compatibility.\r\n            ) {\r\n                this.toggleAttributes(this.$el, curCIndex, this._stickyBlockPrevIdx); // Set the initial attribute states immediately.\r\n                return;\r\n            }\r\n\r\n            // Get the index of the previous item's componentItem.\r\n            let prevCIndex = itemPrevModel.get(\"_componentItemIndex\");\r\n\r\n            // Align this view to the previous itemModel's view, them immidiately revert it.\r\n            // This can be made smooth by applying a CSS transition on the \"transform\" property.\r\n            if (curCIndex == prevCIndex) return; // Don't do anything if it's the same item.\r\n\r\n            //this.$el.imageready(() => {\r\n                this.transitionFromEl(itemPrevModel.get(\"_view\").$el, curCIndex, prevCIndex);\r\n            //});\r\n        }\r\n\r\n        // TODO: Tidy up + add more ways to select indexes.\r\n        getActiveIdxs(attrString) {\r\n            \r\n            let itemsCount = this.model.getItemsCount();\r\n\r\n            // If the first character is a '!', invert the selection.\r\n            let inverted = false;\r\n            if (attrString[0] == '!') {\r\n                inverted = true;\r\n                attrString = attrString.substring(1);\r\n            }\r\n\r\n            let _idxs = attrString.split(\",\");\r\n            let idxs = [];\r\n            _.each(_idxs, (idx) => {\r\n                \r\n                // x+\r\n                if (idx.includes(\"+\")) {\r\n                    let from = idx.split(\"+\")[0];\r\n                    for (let i = parseInt(from); i < itemsCount; i++){\r\n                        idxs.push(i + \"\");\r\n                    }\r\n                }\r\n                // x-y\r\n                else if (idx.includes(\"-\")) {\r\n                    let from = idx.split(\"-\")[0];\r\n                    let to = idx.split(\"-\")[1];\r\n                    for (let i = parseInt(from); i <= parseInt(to); i++){\r\n                        idxs.push(i + \"\");\r\n                    }\r\n                }\r\n                // x\r\n                else {\r\n                    idxs.push(idx + \"\");\r\n                }\r\n            });\r\n\r\n            if (!inverted) return idxs;\r\n\r\n            // Invert selection.\r\n            let invertedIdxs = [];\r\n            for (let i = 0; i < itemsCount; i++) invertedIdxs.push(i + \"\");\r\n            invertedIdxs = _.filter(invertedIdxs, e => {return !_.contains(idxs, e);});\r\n            return invertedIdxs;\r\n        }\r\n\r\n        toggleAttributes($targetEl, curCIndex, prevCIndex) {\r\n            \r\n            let isStickyBlock = this.model.get(\"_isStickyBlock\");\r\n\r\n            _.each(StickyElementAttributeClasses, (className, attrName) => {\r\n\r\n                // Find all elements with this attribute.\r\n                let $els = $targetEl.find(\"[\" + attrName + \"]\");\r\n\r\n                $els.each((i, e) => {\r\n\r\n                    // Get the indexes that this attribute applies its classes for.\r\n                    let activeIdxs = this.getActiveIdxs($(e).attr(attrName));\r\n\r\n                    // Determine the state this element was in on the previous and current views.\r\n                    let curActive = _.includes(activeIdxs, \"\" + curCIndex);\r\n\r\n                    // If this is the first active StickyElementItemView, then immediately set the classes with no transitions. \r\n                    if (\r\n                            prevCIndex === undefined\r\n                        ) {\r\n                        $(e)\r\n                            .toggleClass(className + \"-transition\", false)\r\n                            .toggleClass(className, curActive);\r\n\r\n                        // FIXME: Hardcoded functionality for slidedown.\r\n                        // FIXME: Is incorrectly triggering on pageload.\r\n                        if (className == \"is-se-slidedown\") {\r\n                            if (this._toggleCount === 0) {\r\n                                $(e).toggle(curActive);\r\n                            }\r\n                            else {\r\n                                if (curActive) {\r\n                                    $(e).hide(0).slideDown(400);\r\n                                }\r\n                                else {\r\n                                    $(e).show(0).slideUp(400);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        return;\r\n                    }\r\n\r\n                    // Determine the state this element was in on the previous and current views.\r\n                    let prevActive = _.includes(activeIdxs, \"\" + prevCIndex);\r\n\r\n                    // If the last view's state matches this one, no transition.\r\n                    let hasTransition = prevActive != curActive;\r\n                    if (isStickyBlock) hasTransition = true; // If in StickyBlock mode, always use transitions.\r\n\r\n                    // If there is a transition, ensure that the classes are set correctly to trigger it.\r\n                    if (hasTransition){\r\n\r\n                        if (!isStickyBlock){\r\n                            $(e)\r\n                                .toggleClass(className + \"-transition\", false) \r\n                                .toggleClass(className, !curActive);\r\n                        }\r\n\r\n                        // Trigger the transition.\r\n                        _.debounce(() => {\r\n                            $(e)\r\n                                .toggleClass(className + \"-transition\", hasTransition)\r\n                                .toggleClass(className, curActive);\r\n                        }, 0)();\r\n\r\n                        // FIXME: Hardcoded functionality for slidedown.\r\n                        if (className == \"is-se-slidedown\") {\r\n                            if (curActive) {\r\n                                $(e).hide(0).slideDown(400);\r\n                            }\r\n                            else {\r\n                                $(e).show(0).slideUp(400);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n\r\n                        $(e)\r\n                            .toggleClass(className + \"-transition\", hasTransition)\r\n                            .toggleClass(className, curActive);\r\n\r\n                        // FIXME: Hardcoded functionality for slidedown.\r\n                        if (className == \"is-se-slidedown\") {\r\n                            $(e).toggle(curActive);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            this._toggleCount++;\r\n        }\r\n\r\n        getParentModel() {\r\n            return this.model.get(\"_parent\");\r\n        }\r\n\r\n        transitionFromEl($otherEl, curCIndex, prevCIndex) {\r\n\r\n            // Remove any previous clones created for this group of stickyElements.\r\n            if (this.getParentModel().get(\"_$clone\")?.length) {\r\n                this.getParentModel().get(\"_$clone\").remove();\r\n            }\r\n\r\n            // Create a clone of this $el (that the user will see).\r\n            let $clone = this.$el.clone();\r\n            this.$clone = $clone;\r\n            $clone.width(this.$el.width());\r\n\r\n            this.$el.closest(\".component__widget\").append($clone.addClass(\"is-clone\"));\r\n            this.getParentModel().set(\"_$clone\", this.$clone);\r\n\r\n            // Synchronize the scroll on the clone.\r\n            let $cloneScroll = $clone.find(\".js-stickyelement-scroll\");\r\n            if ($cloneScroll.length) {\r\n                $cloneScroll[0].scrollTop = this.getParentModel().get(\"_itemScrollTop\");\r\n                $cloneScroll[0].scrollLeft = this.getParentModel().get(\"_itemScrollLeft\");\r\n            }\r\n\r\n            let removeClone = () => {\r\n                $clone.remove();\r\n                this.$el.toggleClass(\"u-visibility-hidden\", false).hide(0).show(0);\r\n            }\r\n\r\n            /**\r\n             * Fallback:\r\n             * Sometimes the transitionend trigger can be missed (if the user clicks too fast).\r\n             * If this happens, then the stickyElement may get rendered off-screen (very bad).\r\n             * This fallback has been added to at least snap it into place after a delay if the 'transitionend' trigger doesn't come\r\n             * after a while.\r\n             */\r\n            if (this.getParentModel().get(\"_fallbackTimeout\")) {\r\n                clearTimeout(this.getParentModel().get(\"_fallbackTimeout\"));\r\n            }\r\n            let fallbackTimeout = setTimeout(removeClone, 1500);\r\n            this.getParentModel().set(\"_fallbackTimeout\", fallbackTimeout);\r\n\r\n            // Remove the $clone after the transition.\r\n            $clone.on('transitionend', (event) => {\r\n                if (event.target != event.currentTarget) return;\r\n\r\n                // Wait for the transition to come to a COMPLETE stop before swapping the $clone for the original.\r\n                // This debounce ensures this (otherwise, there's sometimes a millisecond of jitter on transition).\r\n                _.debounce(removeClone, 50)();\r\n\r\n                clearTimeout(this.getParentModel().get(\"_fallbackTimeout\"));\r\n                this.getParentModel().set(\"_fallbackTimeout\", undefined);\r\n            });\r\n\r\n            // Hide this and the other element.\r\n            // Delay slightly (helps prevent flickering on item change).\r\n            _.delay(() => {\r\n                this.$el.toggleClass(\"u-visibility-hidden\", true);\r\n                $otherEl.toggleClass(\"u-visibility-hidden\", true);\r\n            }, 0);\r\n\r\n            // Clear any transform CSS on this View's element.\r\n            //this.$el.css({\"transform\": \"\"/*, \"position\": \"fixed\"*/}).hide(0).show(0);\r\n\r\n            // FIXME: Throws errors if element missing.\r\n            let thisBB = this.$el[0].getBoundingClientRect();\r\n            let cloneBB = $clone[0].getBoundingClientRect();\r\n            let otherBB = $otherEl[0].getBoundingClientRect();\r\n\r\n            // Transform this clone's element to place it over the $otherEl.\r\n            let cloneOffsetBefore = {\r\n                top: Math.round(otherBB.top - cloneBB.top),\r\n                left: Math.round(otherBB.left - cloneBB.left)\r\n            }\r\n            let cloneOffsetAfter = {\r\n                top: Math.round(thisBB.top - cloneBB.top),\r\n                left: Math.round(thisBB.left - cloneBB.left)\r\n            }\r\n\r\n            // Uniform scaling only.\r\n            //let scale = otherBB.width / thisBB.width;\r\n            let scale = 1;\r\n\r\n            // translateZ added to ensure a transition ALWAYS occurs.\r\n            $clone.css({\r\n                \"transform\": \"translate(\" + cloneOffsetBefore.left + \"px, \" + cloneOffsetBefore.top + \"px) translateZ(1px) scale(\" + scale + \")\"\r\n            });\r\n\r\n            // Specific template offset (fixes alignment issues on \"narrativeplus\" component).\r\n            cloneOffsetAfter.left += otherBB.left - thisBB.left;\r\n\r\n            // Apply the CSS immediately (skip transitions), then revert it (if there are any transitions, they will play here).\r\n            $clone.hide(0).show(0);\r\n            \r\n            $clone.css(\"transform\", \"translate(\" + (cloneOffsetAfter.left) + \"px, \" + cloneOffsetAfter.top + \"px)  translateZ(0px) scale(\" + scale + \")\");\r\n\r\n            this.toggleAttributes($clone, curCIndex, prevCIndex);\r\n            this.toggleAttributes(this.$el, curCIndex, undefined);\r\n        }\r\n    };\r\n\r\n    return StickyElementItemView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n], function(Adapt) {\r\n\r\n    class StickyElementItemModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                _parent: undefined,             // StickyElementModel parent.\r\n\r\n                _id: \"\",                        // Inherited from StickyElementModel parent.\r\n                _componentItemIndex: \"\",        // The Component item index.\r\n\r\n                _componentItem: undefined,      // Component item that contains the StickyElement (or the componentModel itself if the item is in a StickyBlock).\r\n                _view: undefined,               // Reference to the view (done because the StickyElementItemViews need to access each other).\r\n\r\n                _isActive: false,               // Whether this model + view is currently visible.\r\n\r\n                _isStickyBlock: false           // This is item will behave slightly differently if using StickyBlock mode.\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            this.set(\"_componentItemIndex\", this.get(\"_componentItem\").get(\"_index\"));\r\n            this.set(\"_isActive\", this.get(\"_componentItem\").get(this.get(\"_isStickyBlock\") ? \"_isVisible\" : \"_isActive\"));\r\n\r\n            //console.log(this.get(\"_componentItem\").toJSON());\r\n\r\n            this.setUpEventListeners();\r\n        }\r\n\r\n        // Return the amount of items belonging to this group.\r\n        getItemsCount() {\r\n\r\n            // adapt-stickyBlock compatibility.\r\n            // Return the amount of siblings this component has if being used in a stickyBlock.\r\n            if (this.get(\"_isStickyBlock\")) {\r\n                return this.get(\"_componentItem\").get(\"_stickyBlockSiblings\")?.length;\r\n            }\r\n\r\n            return this.get(\"_parent\").get(\"_items\").length;\r\n        }\r\n\r\n        setUpEventListeners() {\r\n\r\n            if (!this.get(\"_isStickyBlock\")) {\r\n                this.listenTo(this.get(\"_componentItem\"), `change:_isActive`, this.onComponentItemActiveChange);\r\n            }\r\n            // adapt-stickyBlock compatibility:\r\n            else {\r\n                this.listenTo(this.get(\"_componentItem\"), `stickyBlock:inview`, this.onStickyBlockInview);\r\n            }\r\n\r\n            this.listenTo(this, \"change:_isActive\", this.onActiveChange);\r\n        }\r\n\r\n        onComponentItemActiveChange(itemModel, isActive) {\r\n            this.set(\"_isActive\", isActive);\r\n        }\r\n\r\n        /**\r\n         * adapt-stickyBlock compatibility.\r\n         * @param {*} activeIndex \r\n         */\r\n         onStickyBlockInview() {\r\n\r\n            let view = this.get(\"_view\");\r\n            if (!view) return;\r\n\r\n            // Determine the StickyBlock's active item index (the index of the stickyChild that is inview right now).\r\n            let activeIndex = view.$el.getParentStickyBlockIndex();\r\n\r\n            this.set(\"_isActive\", true);\r\n            this.set(\"_componentItemIndex\", activeIndex); // This value normally doesn't change; but in stickyBlocks it can.\r\n        }\r\n\r\n        onActiveChange(model, isActive) {\r\n            if (isActive) this.get(\"_parent\").setItemActive(this);\r\n        }\r\n\r\n        /**\r\n         * Returns the previously active StickyElementItemModel.\r\n         * Returns undefined if the previously active ComponentItem didn't contain a StickyElementItemModel with the same \"_id\" as this one.\r\n         */\r\n        getItemPrev() {\r\n            return this.get(\"_parent\").get(\"_itemPrev\");\r\n        }\r\n\r\n        /**\r\n         * Trigger's a stickyElement:itemShow on the currently active item model.\r\n         * Used by the stickyElementItemView to set its initial state.\r\n         */\r\n        refresh(){\r\n            console.log(\"REFRESH WON'T DO ANYTHING YET\");\r\n            //this.get(\"_parent\").refresh();\r\n        }\r\n\r\n        /**\r\n         * Get the StickyElementItemModel that was active before the current one (or null if there was none).\r\n         */\r\n        getPrevActiveStickyElementItem() {\r\n\r\n        }\r\n    };\r\n\r\n    return StickyElementItemModel;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    './stickyElementItemView',\r\n    './stickyElementItemModel'\r\n], function(Adapt, StickyElementItemView, StickyElementItemModel) {\r\n\r\n    /**\r\n     * Each stickyElementModel shall be used by multiple stickyElementViews (that have the same id).\r\n     */\r\n\r\n    // StickyElement will only work when inside the following components.\r\n    // TBA: Expand this dictionary as more components are tested with this extension.\r\n    // FIXME: Components should register themselves as valid in their own scripts.\r\n    const CompatibleComponents = {\r\n        \"tabs\": {\r\n            \"_hasTransitions\": false\r\n        },\r\n        \"narrativePlus\": {\r\n            \"_hasTransitions\": true\r\n        }\r\n    }\r\n\r\n    class StickyElementModel extends Backbone.Model {\r\n\r\n        defaults() {\r\n            return {\r\n                _parent: undefined,                     // Reference to the ComponentModel that this model is in.\r\n                _id: \"\",                                // Sticky element id.\r\n                body: \"\",                               // Body HTML for each view.\r\n                \r\n                _items: new Backbone.Collection(),      // Collection of all stickyElementItemModels with this _id.\r\n                _itemScrollTop: 0,                      // All _items views need to synchronize their scrolling elements (if applicable),\r\n                _itemScrollLeft: 0,                     \r\n                                                        // to make them all seem as one.\r\n\r\n                _itemActive: undefined,                 // Reference to the currently active StickyElementItemModel with the same _id (if any).\r\n                _itemPrev: undefined,                   // Reference to the StickyElementItemModel that was active before the current one.\r\n            }\r\n        }\r\n\r\n        initialize(){\r\n\r\n            this.listenTo(this.get(\"_parent\").getChildren(), \"change:_isActive\", this.onComponentItemActiveChange);\r\n            this.listenTo(this, \"change:_itemActive\", this.onItemActiveChange);\r\n        }\r\n\r\n        checkValidParent() {\r\n\r\n            let parentType = this.get(\"_parent\").get(\"_component\");\r\n\r\n            let cc = CompatibleComponents[parentType];\r\n            if (cc === undefined) {\r\n                throw \"adapt-stickyElement: this extension is not compatible with the \\\"\" + parentType + \"\\\" component.\";\r\n            }\r\n\r\n            // Record whether the items the parent has animate as they reveal, or if they're instantaneous.\r\n            this.set(\"_parentHasTransitions\", cc._hasTransitions);\r\n        }\r\n\r\n        // Called by StickyElementItemModel whenever its parent ComponentItem becomes _isActive.\r\n        setItemActive(itemActiveModel) {\r\n            this.set(\"_itemActive\", itemActiveModel);\r\n        }\r\n\r\n        onComponentItemActiveChange(componentItem, isActive) {\r\n            \r\n            // If one of this model's _items is inside of this ComponentItem, do nothing.\r\n            if (this.get(\"_items\").find(item => {return item.get(\"_componentItem\") === componentItem})) return;\r\n\r\n            // This ComponentItem has none of this StickyElementModel's items in it. Clear _itemActive.\r\n            this.setItemActive(undefined);\r\n        }\r\n\r\n        // Update the _itemPrev property whenever the next _itemActive is set.\r\n        onItemActiveChange(model) {\r\n            this.set(\"_itemPrev\", model._previousAttributes._itemActive);\r\n        }\r\n\r\n        /**\r\n         * \r\n         * @param {*} componentItemModel \r\n         * @param {*} options \r\n         * @param {Boolean} options._isStickyBlock If true, the StickyElement will use \"StickyBlock\" mode. \r\n         * @returns \r\n         */\r\n        registerComponentItemModel(componentItemModel, options) {\r\n\r\n            let model = new StickyElementItemModel({\r\n                _parent: this,\r\n                _id: this.get(\"_id\"),\r\n                body: this.get(\"body\"),\r\n                _componentItem: componentItemModel,\r\n                _isStickyBlock: Boolean(options?._isStickyBlock)\r\n            });\r\n\r\n            let view = new StickyElementItemView({\r\n                model: model\r\n            });\r\n\r\n            model.set(\"_view\", view);\r\n            this.get(\"_items\").push(model);\r\n\r\n            return view;\r\n        }\r\n\r\n        /**\r\n         * Trigger's a stickyElement:itemShow on the currently active item model.\r\n         * Used by the stickyElementItemView to set its initial state.\r\n         */\r\n        refresh(){\r\n            this.get(\"_itemModels\").find((model) => {\r\n                if (model.get(\"_isActive\")){\r\n\r\n                    this.trigger(\"stickyElement:itemShow\", model.get(\"_index\"));\r\n                    this.set(\"_itemCur\", model);\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return StickyElementModel;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './stickyElementModel'\r\n], function(Handlebars, Adapt, StickyElementModel) {\r\n\r\n    /**\r\n     * adapt-stickyElement\r\n     * --------------------------------------\r\n     * This extension is experimental at this time.\r\n     * Please read the provided README.txt for more information.\r\n     * \r\n     * FIXME:\r\n     * - Known bug: will not work if the item gets re-rendered. Should work if the component gets re-rendered though.\r\n     * - Major bug: dd-Helpers using createHelperCallback used inside of an _item body break it!\r\n     */\r\n\r\n    /**\r\n     * stickyElement helper\r\n     * --------------------\r\n     * These helpers will populate with the body of corresponding component._stickyElement._items\r\n     */\r\n    Adapt.on('router:page', () => {\r\n        Handlebars.registerHelperEl(\"stickyElement\", function() {\r\n            \r\n            let context = arguments[arguments.length-1];\r\n            let hash = context.hash;\r\n\r\n            // Check that all properties have been defined.\r\n            let id = hash.id;\r\n            if (id === undefined) throw \"{{#stickyElement}} helper must have the \\\"id\\\" parameter defined.\";\r\n\r\n            // New: added adapt-stickyBlock compatibility.\r\n            let itemIdx = hash.itemIdx;\r\n            let isStickyBlock = itemIdx == \"stickyBlock\";\r\n\r\n            if (!isStickyBlock) {\r\n                itemIdx = parseInt(itemIdx);\r\n                if (hash.itemIdx === undefined) throw \"{{#stickyElement}} helper must have the \\\"itemIdx\\\" parameter defined.\";\r\n            }\r\n\r\n            // Find the componentModel that this Helper was placed in.\r\n            let componentModel = Handlebars.getComponentModelFromContext(context);\r\n\r\n            // Find the component._stickyElement._items that contains the HTML for this helper.\r\n            let se = componentModel.get(\"_stickyElement\");\r\n            if (!se) {\r\n                throw \"Could not render {{#stickyElement}} helper in component \" + componentModel.get(\"_id\") + \": component has no \\\"_stickyElement\\\" property defined.\";\r\n            }\r\n            // The parent component's _stickyElements have been disabled. Don't render this helper.\r\n            if (!se._isEnabled) return $();\r\n\r\n            // Find the ID in the _stickyElement._items.\r\n            let item = _.find(se._items, (item) => {\r\n                return item._id == id;\r\n            });\r\n            // Error check.\r\n            if (item === undefined) {\r\n                throw componentModel.get(\"_id\") + \": component._stickyElement._items does not have an item with \\\"_id\\\": \\\"\" + id + \"\\\"\";\r\n            }\r\n\r\n            // -------------------------------------\r\n            \r\n            // Create the StickyElementModel for this id if none exists yet.\r\n            if (!item._model) {\r\n                item._model = new StickyElementModel({\r\n                    _id: id,\r\n                    _parent: componentModel,\r\n                    body: item.body\r\n                });\r\n            }\r\n\r\n            // Register the ComponentItemModel that this stickyElement resides in.\r\n            if (componentModel.getChildren === undefined) throw \"The {{#stickyElement}} helper cannot be used in a \\\"\" + componentModel.get(\"_component\") + \"\\\" component.\";\r\n\r\n            // If inside a stickyBlock, use the component as the itemModel instead.\r\n            if (isStickyBlock) {\r\n                return item._model.registerComponentItemModel(componentModel, {\r\n                    _isStickyBlock: true\r\n                }).$el;\r\n            }\r\n            \r\n            return item._model.registerComponentItemModel(componentModel.getChildren().models[itemIdx]).$el;\r\n        });\r\n    });\r\n\r\n    // StickyElement transition helpers\r\n    // ---------------------------------------------------------\r\n    // TODO: Allow for {{{se_mark \"1\"}}} instead of {{{se_mark idx=\"1\"}}} (saves on characters).\r\n    var helpers = {\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * For example:\r\n         * <div {{{se_active idx=\"0,2\"}}}>Activate me</div>\r\n         * \r\n         * Will toggle the \"is-se-active\" class on the element on and off as the itemIdx changes. \r\n         */\r\n        se_active: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            return 'data-stickyelement-active-idx=\"' + _idx + '\"';\r\n        },\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * \r\n         * Mark selected element when itemIdx == provided value(s)\r\n         * \r\n         * @param {string} idx The index(es) that the element this attribute is placed on should be active for.\r\n         * @param {string} hash.theme (Optional) theme name for the mark (allows for using different styles of marks).\r\n         *                            Had to add this one as an attribute instead of a class (else I would run the risk of having two\r\n         *                            class attributes on an element at once).\r\n         */\r\n        se_mark: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            \r\n            return `data-stickyelement-mark-idx=\"${_idx}\"${context.hash.theme ? `data-theme=\"${context.hash.theme}\"` : \"\"}`;\r\n        },\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * \r\n         * Show selected element only when itemIdx != provided value(s)\r\n         */\r\n        se_hide: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            return 'data-stickyelement-hide-idx=\"' + _idx + '\"';\r\n        },\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * \r\n         * Show selected element only when itemIdx != provided value(s).\r\n         * Uses a jQuery fold animation to do so.\r\n         */\r\n        se_fold: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            return 'data-stickyelement-fold-idx=\"' + _idx + '\"';\r\n        },\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * \r\n         * Slides selected element in left only when itemIdx != provided value(s).\r\n         */\r\n        se_slideleft: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            return 'data-stickyelement-slideleft-idx=\"' + _idx + '\"';\r\n        },\r\n\r\n        /**\r\n         * Needs to be added as an ATTRIBUTE to a HTML element.\r\n         * \r\n         * Slides selected element in down only when itemIdx != provided value(s).\r\n         */\r\n         se_slidedown: function(idx) {\r\n            let context = arguments[arguments.length-1];\r\n            let _idx = context.hash.idx !== undefined ? context.hash.idx : idx;\r\n            return 'data-stickyelement-slidedown-idx=\"' + _idx + '\"';\r\n        }\r\n    }\r\n\r\n    for (var name in helpers) {\r\n        if (!helpers.hasOwnProperty(name)) continue;\r\n        Handlebars.registerHelper(name, helpers[name]);\r\n    }\r\n});\r\n","define([\r\n    'core/js/adapt'\r\n], function(Adapt) {\r\n\r\n    const CLICK_ANYWHERE_EVENTS = \"click touch mouseup touchend\";\r\n\r\n    class TooltipPopupView extends Backbone.View {\r\n\r\n        tagName() {\r\n            return \"div\";\r\n        }\r\n\r\n        className() {\r\n            let classes = [\r\n                \"tooltip-popup\",\r\n                (this.model.get(\"type\") || this.model.get(\"_type\")) ? (\"is-\" + (this.model.get(\"type\") || this.model.get(\"_type\"))) : \"\"\r\n            ]\r\n            return classes.join(\" \");\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                //\"click .js-tooltip\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            \r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n\r\n            this.listenTo(Adapt, {'device:resize': this.onDeviceResize});\r\n\r\n            _.debounce(() => {\r\n                // The user clicking anywhere or scrolling is enough to close the tooltip popup.\r\n                this.onClickAnywhereEvent = this.onClickAnywhere.bind(this);\r\n                $(document).on(CLICK_ANYWHERE_EVENTS, this.onClickAnywhereEvent);\r\n            }, 0)();\r\n        }\r\n\r\n        onClickAnywhere(event) {\r\n\r\n            let innerEl = this.$(\".tooltip-popup__inner\")[0];\r\n\r\n            if (event.target == innerEl || $.contains(innerEl, event.target)) return; // Clicks on or inside the popup won't close it.\r\n            this.close();\r\n        }\r\n\r\n        onDeviceResize() {\r\n            this.close();\r\n        }\r\n\r\n        close() {\r\n            this.model.set(\"_isActive\", false);\r\n            this.remove();\r\n        }\r\n\r\n        // Override default remove function.\r\n        remove() {\r\n            this.model.set(\"_isActive\", false);\r\n            $(document).off(CLICK_ANYWHERE_EVENTS, this.onClickAnywhereEvent); // Remove the global event this made.\r\n            Backbone.View.prototype.remove.apply(this, arguments);\r\n        }\r\n\r\n        render() {\r\n            this.$el.html(new Handlebars.SafeString(Handlebars.templates['tooltipPopup'](this.model.toJSON())).string);\r\n            \r\n            // Append self to the page, or if in notify_popup, append to that instead (whichever is closest to the $target).\r\n            // FIXME: Not the best way to do this, but this does fix several issues the tooltipPopupView was having.\r\n            // FIXME: Minor bugs if the tooltip is inside a nested scrollbar (however, this is a very rare occurence).\r\n            // FIXME: Can be resolved if instead, the closest scrolling element was found (using jQuery-ui)?\r\n            this.$parent = this.model.get(\"$target\").closest(\".notify__popup, #app, .sidemenu\");\r\n            this.$parent.append(this.$el);\r\n            this.alignToTarget();\r\n        }\r\n\r\n        alignToTarget() {\r\n            let $target = this.model.get(\"$target\");\r\n            if (!$target || !$target.length) {\r\n                throw \"toolipPopupView needs an existing $target element to align to\";\r\n            }\r\n            $target = $target.first();\r\n\r\n            // EPUB bugfix:\r\n            // ------------\r\n            // Due to how the scrolling of the .notify__popup element is set up, the getBoundingClientRect() function has a bug\r\n            // where it sometimes returns incorrect values if used on elements inside of it.\r\n            // \r\n            // To resolve this, temporarily disable the scrolling of the closest .notify__popup, then re-enable it.\r\n\r\n            /**\r\n             * Try to center the popup over the target horizontally.\r\n             * If this would result in it clipping off the left/right of the viewport, move it slightly off-center\r\n             * to fix.\r\n             * \r\n             * \"getClientRects\" is used instead of \"getBoundingClientRect\" because it accounts for the\r\n             * $target wrapping across multiple lines.\r\n             */\r\n\r\n            let targetBB = $target[0].getClientRects()[0]; //$target[0].getBoundingClientRect();\r\n            let elBB = this.el.getBoundingClientRect();\r\n\r\n            let parentWidth = this.$parent[0].clientWidth; // Element width - scrollbar.\r\n\r\n            let left = targetBB.left - ((elBB.width - targetBB.width) / 2);\r\n            let _left = left;\r\n            left = Math.min(parentWidth - elBB.width, left); // Fix clipping off the right side.\r\n            left = Math.max(0, left); // Fix clipping off the left side.\r\n\r\n            // Determine the tail offset.\r\n            let tailOffset = _left - left;\r\n            this.$(\".tooltip-popup__tail-container\").css({\r\n                \"transform\": \"translateX(\" + tailOffset + \"px)\"\r\n            });\r\n\r\n            this.$el.offset({\r\n                left: left,\r\n                top: $target.offset().top\r\n            });\r\n\r\n            // Ensure that the tooltip is focused on (scroll it into view).\r\n            try {\r\n                Adapt.navigateToElement(this.$(\".tooltip-popup__inner\"), {\r\n                    duration: 400,\r\n                    align: \"inview\",\r\n                    notifyEnabled: true\r\n                });\r\n            }\r\n            catch (err) {\r\n                // Done to prevent errors if a tooltip is used in the sidemenu.\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    return TooltipPopupView;\r\n});\r\n","define([\r\n    'core/js/adapt',\r\n    \"./tooltipPopupView\"\r\n], function(Adapt, TooltipPopupView) {\r\n\r\n    // FIXME: Some of the functionality in this view is somewhat redundant due to the new Adapt.createTooltip function I added.\r\n\r\n    class TooltipView extends Backbone.View {\r\n\r\n        tagName() {\r\n            return \"span\";\r\n        }\r\n\r\n        className() {\r\n            return \"tooltip\";\r\n        }\r\n\r\n        events() {\r\n            return {\r\n                \"click .js-tooltip\" : \"onClick\"\r\n            }\r\n        }\r\n\r\n        initialize() {\r\n            \r\n            this.setUpEventListeners();\r\n            this.render();\r\n        }\r\n\r\n        setUpEventListeners() {\r\n            this.listenTo(this.model, \"change:_isActive\", this.onActiveChange);\r\n        }\r\n\r\n        render() {\r\n            this.$el.html(new Handlebars.SafeString(Handlebars.templates['tooltip'](this.model.toJSON())).string);\r\n        }\r\n\r\n        onClick(event) {\r\n            // Prevent clicking the tooltip also toggling the navbar in Online Bookshelf.\r\n            if (Adapt.config.get(\"_isEpub\")) {event.stopPropagation();}\r\n\r\n            Adapt.createTooltip(this.$(\".js-tooltip-target\"), this.model.attributes);\r\n        }\r\n\r\n        onActiveChange(model, isActive) {\r\n\r\n            this.$(\".tooltip__content\").toggleClass(\"is-active\", isActive);\r\n\r\n            if (isActive) {\r\n\r\n                Adapt.createTooltip(this.$el, this.model.attributes);\r\n                return;\r\n            }\r\n\r\n            /*if (this.tooltipPopupView) {\r\n                this.tooltipPopupView.remove();\r\n            }*/\r\n        }\r\n\r\n    };\r\n\r\n    return TooltipView;\r\n});\r\n","define([\r\n    'handlebars',\r\n    'core/js/adapt',\r\n    './tooltipView',\r\n    './tooltipPopupView'\r\n], function(Handlebars, Adapt, TooltipView, TooltipPopupView) {\r\n\r\n    /**\r\n     * adapt-tooltip\r\n     * --------------------------------------\r\n     * - Creates inline tooltip popups that are activated by clicking on specific highlighted text.\r\n     * - Can be given an optional icon after the highlighted text.\r\n     */\r\n\r\n    // Helpers\r\n    // ---------------------\r\n    // Hardcoded for DD functionality.\r\n\r\n    Adapt.on('router:page', () => {\r\n\r\n        /**\r\n         * Reference\r\n         * -----------------------------------------------\r\n         */\r\n        Handlebars.registerHelperEl(\"reference\", function() {\r\n            let context = arguments[arguments.length-1];\r\n\r\n            // PDF mode override\r\n            // ---------------------------------\r\n            if (Adapt.isPDFMode()) {\r\n                \r\n                // Instead of showing a clickable book icon, show the popup text inline with the text,\r\n                // preceeded by the book icon.\r\n                let html = Handlebars.templates[\"reference-pdf\"]({\r\n                    // Insert data that the template will need to use here.\r\n                    example: \"EXAMPLE\"\r\n                });\r\n\r\n                return new Handlebars.SafeString(html);\r\n            }\r\n            \r\n            let modelJSON = _.extend({}, context.hash, {\r\n                buttonText: \"\",\r\n                content: context.fn(this),\r\n                _img: \"reference\", // FIXME: Uses .svg for the icon.\r\n                type: \"reference\"\r\n            });\r\n\r\n            return new TooltipView({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el\r\n        });\r\n\r\n        /**\r\n         * Glossary\r\n         * -----------------------------------------------\r\n         * @param {string} context.term The glossary term (MUST match the glossary item title in contentObjects.json).\r\n         * @param {string} context.fn() The text the user clicks on to show the glossary. context.term will be set to this if it's not defined.\r\n         */\r\n        Handlebars.registerHelperEl(\"glossary\", function() {\r\n            let context = arguments[arguments.length-1];\r\n\r\n            // Determine the glossary term provided.\r\n            let glossaryTerm = context.hash.term || context.fn(this);\r\n            glossaryTerm = glossaryTerm.trim();\r\n\r\n            if (!glossaryTerm) throw \"{{#glossary}}: Must have a valid \\'term\\' property.\";\r\n\r\n            // Replace the href with the external URL.\r\n            let pageModel = Adapt.findById(Adapt.location._currentId);\r\n            let glossaries = pageModel.get(\"_menuData\")._glossaries;\r\n            \r\n            let glossaryData = _.find(glossaries._items, (g) => {\r\n                return g.title.toLowerCase() == glossaryTerm.toLowerCase();\r\n            });\r\n            if (!glossaryData) throw \"{{#glossary}}: Could not find glossary definition for \\\"\" + glossaryTerm + \"\\\".\";\r\n\r\n            let modelJSON = _.extend({}, context.hash, {\r\n                buttonText:     context.fn(this),\r\n                title:          glossaryData.title,\r\n                content:        glossaryData.body,\r\n                _icon:           \"\",\r\n                type:           \"glossary\"\r\n            });\r\n\r\n            return new TooltipView({\r\n                model: new Backbone.Model(modelJSON)\r\n            }).$el\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * Adapt plugin\r\n     * -------------\r\n     * Allow tooltips to be manually created by other scripts over any element.\r\n     * FIXME: Will likely need some reworking in the future.\r\n     * @param {jQuery object} element   The element to render and center the tooltip over.\r\n     * @param {string} settings.content The innerHTML of the tooltip popup.\r\n     * @returns \r\n     */\r\n    Adapt.createTooltip = function(element, settings = {}){\r\n        \r\n        // Allow a HTML string to just be passed as the second parameter as a shortcut.\r\n        if (typeof settings === \"string\") {\r\n            settings = {\r\n                content: settings\r\n            }\r\n        }\r\n\r\n        let tooltipPopupView = new TooltipPopupView({model: new Backbone.Model(_.extend(\r\n            settings || {},\r\n            {$target: $(element)}\r\n            )\r\n        )});\r\n\r\n        return tooltipPopupView;\r\n    }\r\n});\r\n","import AdaptView from 'core/js/views/adaptView';\r\n\r\nclass MenuItemView extends AdaptView {\r\n\r\n  attributes() {\r\n    return AdaptView.resultExtend('attributes', {\r\n      'role': 'listitem',\r\n      'aria-labelledby': this.model.get('_id') + '-heading'\r\n    }, this);\r\n  }\r\n\r\n  className() {\r\n    return [\r\n      'menu-item',\r\n      this.constructor.className,\r\n      this.model.get('_id'),\r\n      this.model.get('_classes'),\r\n      this.setVisibility(),\r\n      this.setHidden(),\r\n      (this.model.get('_isVisited') ? 'is-visited' : ''),\r\n      (this.model.get('_isComplete') ? 'is-complete' : ''),\r\n      (this.model.get('_isLocked') ? 'is-locked' : ''),\r\n      (this.model.get('_isOptional') ? 'is-optional' : '')\r\n    ].join(' ');\r\n  }\r\n\r\n  preRender() {\r\n    this.model.checkCompletionStatus();\r\n    this.model.checkInteractionCompletionStatus();\r\n  }\r\n\r\n  postRender() {\r\n    this.$el.imageready(this.setReadyStatus.bind(this));\r\n  }\r\n\r\n}\r\n\r\nMenuItemView.type = 'menuItem';\r\n\r\nexport default MenuItemView;\r\n","import ContentObjectView from 'core/js/views/contentObjectView';\r\nimport MenuItemView from 'core/js/views/menuItemView';\r\n\r\nclass MenuView extends ContentObjectView {}\r\n\r\nObject.assign(MenuView, {\r\n  /**\r\n   * TODO:\r\n   * child view here should not be fixed to the MenuItemView\r\n   * menus may currently rely on this\r\n   */\r\n  childContainer: '.js-children',\r\n  childView: MenuItemView,\r\n  type: 'menu',\r\n  template: 'menu'\r\n});\r\n\r\nexport default MenuView;\r\n","define([\r\n  \"core/js/views/menuItemView\"\r\n], function(MenuItemView) {\r\n\r\n  var BoxMenuItemView = MenuItemView.extend({\r\n\r\n    events: {\r\n      'click .js-btn-click' : 'onClickMenuItemButton'\r\n    },\r\n\r\n    onClickMenuItemButton: function(event) {\r\n      if (event && event.preventDefault) event.preventDefault();\r\n      if (this.model.get('_isLocked')) return;\r\n      Backbone.history.navigate('#/id/' + this.model.get('_id'), {trigger: true});\r\n    }\r\n\r\n  }, {\r\n    className: 'boxmenu-item',\r\n    template: 'boxMenuItem'\r\n  });\r\n\r\n  return BoxMenuItemView;\r\n\r\n});\r\n","define([\r\n  'core/js/adapt',\r\n  'core/js/views/menuView',\r\n  \"./adapt-contrib-boxMenuItemView\"\r\n], function(Adapt, MenuView, BoxMenuItemView) {\r\n\r\n  var BoxMenuView = MenuView.extend({\r\n\r\n    initialize: function() {\r\n      MenuView.prototype.initialize.apply(this);\r\n      this.setStyles();\r\n\r\n      this.listenTo(Adapt, {\r\n        \"device:changed\": this.onDeviceResize\r\n      });\r\n    },\r\n\r\n    onDeviceResize: function() {\r\n      this.setStyles();\r\n    },\r\n\r\n    setStyles: function() {\r\n      this.setBackgroundImage();\r\n      this.setBackgroundStyles();\r\n      this.processHeader();\r\n    },\r\n\r\n    setBackgroundImage: function() {\r\n      var config = this.model.get('_boxMenu');\r\n      var backgroundImages = config && config._backgroundImage;\r\n\r\n      if (!backgroundImages) return;\r\n\r\n      var backgroundImage;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          backgroundImage = backgroundImages._large;\r\n          break;\r\n        case \"medium\":\r\n          backgroundImage = backgroundImages._medium;\r\n          break;\r\n        default:\r\n          backgroundImage = backgroundImages._small;\r\n      }\r\n\r\n      if (backgroundImage) {\r\n        this.$el\r\n          .addClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"url(\" + backgroundImage + \")\");\r\n      } else {\r\n        this.$el\r\n          .removeClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"\");\r\n      }\r\n    },\r\n\r\n    setBackgroundStyles: function () {\r\n      var config = this.model.get('_boxMenu');\r\n      var styles = config && config._backgroundStyles;\r\n\r\n      if (!styles) return;\r\n\r\n      this.$el.css({\r\n        'background-repeat': styles._backgroundRepeat,\r\n        'background-size': styles._backgroundSize,\r\n        'background-position': styles._backgroundPosition\r\n      });\r\n    },\r\n\r\n    processHeader: function() {\r\n      var config = this.model.get('_boxMenu');\r\n      var header = config && config._menuHeader;\r\n\r\n      if (!header) return;\r\n\r\n      var $header = this.$('.menu__header');\r\n\r\n      this.setHeaderBackgroundImage(header, $header);\r\n      this.setHeaderBackgroundStyles(header, $header);\r\n      this.setHeaderMinimumHeight(header, $header);\r\n    },\r\n\r\n    setHeaderBackgroundImage: function(config, $header) {\r\n      var backgroundImages = config._backgroundImage;\r\n\r\n      if (!backgroundImages) return;\r\n\r\n      var backgroundImage;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          backgroundImage = backgroundImages._large;\r\n          break;\r\n        case \"medium\":\r\n          backgroundImage = backgroundImages._medium;\r\n          break;\r\n        default:\r\n          backgroundImage = backgroundImages._small;\r\n      }\r\n\r\n      if (backgroundImage) {\r\n        $header\r\n          .addClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"url(\" + backgroundImage + \")\");\r\n      } else {\r\n        $header\r\n          .removeClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"\");\r\n      }\r\n    },\r\n\r\n    setHeaderBackgroundStyles: function (config, $header) {\r\n      var styles = config._backgroundStyles;\r\n\r\n      if (!styles) return;\r\n\r\n      $header.css({\r\n        'background-repeat': styles._backgroundRepeat,\r\n        'background-size': styles._backgroundSize,\r\n        'background-position': styles._backgroundPosition\r\n      });\r\n    },\r\n\r\n    setHeaderMinimumHeight: function(config, $header) {\r\n      var minimumHeights = config._minimumHeights;\r\n\r\n      if (!minimumHeights) return;\r\n\r\n      var minimumHeight;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          minimumHeight = minimumHeights._large;\r\n          break;\r\n        case \"medium\":\r\n          minimumHeight = minimumHeights._medium;\r\n          break;\r\n        default:\r\n          minimumHeight = minimumHeights._small;\r\n      }\r\n\r\n      if (minimumHeight) {\r\n        $header\r\n          .addClass(\"has-min-height\")\r\n          .css(\"min-height\", minimumHeight + \"px\");\r\n      } else {\r\n        $header\r\n          .removeClass(\"has-min-height\")\r\n          .css(\"min-height\", \"\");\r\n      }\r\n    }\r\n\r\n  }, {\r\n    childView: BoxMenuItemView,\r\n    className: 'boxmenu',\r\n    template: 'boxMenu'\r\n  });\r\n\r\n  Adapt.on('router:menu', function(model) {\r\n    $('#wrapper').append(new BoxMenuView({model: model}).$el);\r\n\r\n    // Listen to when Adapt hits a menu and navigate to a page. Make sure the string here is the page ID you're trying to route too.\r\n    _.debounce(() => {\r\n      Adapt.router.model.set( '_canNavigate', true, { pluginName: 'adapt' } )\r\n      var newRouteId = 'co-05';\r\n      Backbone.history.navigate('#/id/' + newRouteId, true);\r\n    }, 0)();\r\n  });\r\n\r\n});\r\n","define([\r\n  \"core/js/adapt\"\r\n], function(Adapt) {\r\n\r\n  var ThemeView = Backbone.View.extend({\r\n\r\n    className: function() {},\r\n\r\n    initialize: function() {\r\n      this.init();\r\n      this.setStyles();\r\n\r\n      this.listenTo(Adapt, {\r\n        \"device:changed\": this.onDeviceResize,\r\n        \"remove\": this.remove\r\n      });\r\n    },\r\n\r\n    onDeviceResize: function() {\r\n      this.setStyles();\r\n    },\r\n\r\n    remove: function() {\r\n      Backbone.View.prototype.remove.call(this);\r\n\r\n      this.onRemove();\r\n    },\r\n\r\n    setStyles: function() {\r\n      this.setClasses();\r\n      this.setBackgroundImage();\r\n      this.setBackgroundStyles();\r\n      this.setMinimumHeight();\r\n      this.setCustomStyles();\r\n    },\r\n\r\n    setClasses: function() {\r\n      this.$el.addClass(this.className());\r\n    },\r\n\r\n    setBackgroundImage: function() {\r\n      var backgroundImages = this.model.get(\"_backgroundImage\");\r\n\r\n      if (!backgroundImages) return;\r\n\r\n      var backgroundImage;\r\n      // FIXME: Hardcoded.\r\n      let backgroundRepeat = backgroundImages._repeat ? \"repeat\" : \"\";\r\n      let backgroundSize = backgroundImages._repeat ? \"auto\" : \"\";\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          backgroundImage = backgroundImages._large;\r\n          break;\r\n        case \"medium\":\r\n          backgroundImage = backgroundImages._medium;\r\n          break;\r\n        default:\r\n          backgroundImage = backgroundImages._small;\r\n      }\r\n\r\n      if (backgroundImage) {\r\n        this.$el\r\n          .addClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"url(\" + backgroundImage + \")\")\r\n          .css(\"background-repeat\", backgroundRepeat)\r\n          .css(\"background-size\", backgroundSize);\r\n      } else {\r\n        this.$el\r\n          .removeClass(\"has-bg-image\")\r\n          .css(\"background-image\", \"\")\r\n          .css(\"background-repeat\", \"\")\r\n          .css(\"background-size\", \"\");\r\n      }\r\n    },\r\n\r\n    setBackgroundStyles: function () {\r\n      var styles = this.model.get(\"_backgroundStyles\");\r\n\r\n      if (!styles) return;\r\n\r\n      this.$el.css({\r\n        'background-repeat': styles._backgroundRepeat,\r\n        'background-size': styles._backgroundSize,\r\n        'background-position': styles._backgroundPosition\r\n      });\r\n    },\r\n\r\n    setMinimumHeight: function() {\r\n      var minimumHeights = this.model.get(\"_minimumHeights\");\r\n\r\n      if (!minimumHeights) return;\r\n\r\n      var minimumHeight;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          minimumHeight = minimumHeights._large;\r\n          break;\r\n        case \"medium\":\r\n          minimumHeight = minimumHeights._medium;\r\n          break;\r\n        default:\r\n          minimumHeight = minimumHeights._small;\r\n      }\r\n\r\n      if (minimumHeight) {\r\n        this.$el\r\n          .addClass(\"has-min-height\")\r\n          .css(\"min-height\", minimumHeight + \"px\");\r\n      } else {\r\n        this.$el\r\n          .removeClass(\"has-min-height\")\r\n          .css(\"min-height\", \"\");\r\n      }\r\n    },\r\n\r\n    init: function() {},\r\n    setCustomStyles: function() {},\r\n\r\n    onRemove: function() {}\r\n\r\n  });\r\n\r\n  return ThemeView;\r\n\r\n});\r\n","define([\r\n  './themeView',\r\n  'core/js/adapt'\r\n], function(ThemeView, Adapt) {\r\n\r\n  var ThemePageView = ThemeView.extend({\r\n\r\n    className: function() {},\r\n\r\n    setCustomStyles: function() {\r\n      this.processHeader();\r\n    },\r\n\r\n    processHeader: function() {\r\n      var header = this.model.get('_pageHeader');\r\n      if (!header || header._isEnabled === false) {\r\n        this.$('.page__header, .page__overview').hide(); // Hide the page header entirely.\r\n        return;\r\n      }\r\n\r\n      var $header = this.$('.page__header');\r\n      var $headerBG = this.$('.page__header-bg');\r\n\r\n      this.setHeaderBackgroundImage(header, $headerBG);\r\n      this.setHeaderBackgroundStyles(header, $headerBG);\r\n      this.setHeaderMinimumHeight(header, $header);\r\n    },\r\n\r\n    setHeaderBackgroundImage: function(config, $header) {\r\n      var backgroundImages = config._backgroundImage;\r\n\r\n      if (!backgroundImages) return;\r\n\r\n      var backgroundImage;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          backgroundImage = backgroundImages._large;\r\n          break;\r\n        case \"medium\":\r\n          backgroundImage = backgroundImages._medium;\r\n          break;\r\n        default:\r\n          backgroundImage = backgroundImages._small;\r\n      }\r\n\r\n      if (backgroundImage) {\r\n        $header\r\n          .css(\"background-image\", \"url(\" + backgroundImage + \")\")\r\n          .parent()\r\n          .addClass(\"has-bg-image\");\r\n      } else {\r\n        $header\r\n          .css(\"background-image\", \"\")\r\n          .parent()\r\n          .removeClass(\"has-bg-image\");\r\n      }\r\n    },\r\n\r\n    setHeaderBackgroundStyles: function (config, $header) {\r\n      var styles = config._backgroundStyles;\r\n\r\n      if (!styles) return;\r\n\r\n      $header.css({\r\n        'background-repeat': styles._backgroundRepeat,\r\n        'background-size': styles._backgroundSize,\r\n        'background-position': styles._backgroundPosition\r\n      });\r\n    },\r\n\r\n    setHeaderMinimumHeight: function(config, $header) {\r\n      var minimumHeights = config._minimumHeights;\r\n\r\n      if (!minimumHeights) return;\r\n\r\n      var minimumHeight;\r\n\r\n      switch (Adapt.device.screenSize) {\r\n        case \"large\":\r\n          minimumHeight = minimumHeights._large;\r\n          break;\r\n        case \"medium\":\r\n          minimumHeight = minimumHeights._medium;\r\n          break;\r\n        default:\r\n          minimumHeight = minimumHeights._small;\r\n      }\r\n\r\n      if (minimumHeight) {\r\n        $header\r\n          .addClass(\"has-min-height\")\r\n          .css(\"min-height\", minimumHeight + \"px\");\r\n      } else {\r\n        $header\r\n          .removeClass(\"has-min-height\")\r\n          .css(\"min-height\", \"\");\r\n      }\r\n    },\r\n\r\n    onRemove: function() {}\r\n\r\n  });\r\n\r\n  return ThemePageView;\r\n\r\n});\r\n","define([\r\n  \"./themeView\",\r\n  \"core/js/adapt\"\r\n], function(ThemeView, Adapt) {\r\n\r\n  var ThemeArticleView = ThemeView.extend({\r\n\r\n    className: function() {},\r\n\r\n    setCustomStyles: function() {},\r\n\r\n    onRemove: function() {}\r\n\r\n  });\r\n\r\n  return ThemeArticleView;\r\n\r\n});\r\n","define([\r\n  \"./themeView\",\r\n  \"core/js/adapt\"\r\n], function(ThemeView, Adapt) {\r\n\r\n  var ThemeBlockView = ThemeView.extend({\r\n\r\n    className: function() {\r\n      return this.model.get(\"_isDividerBlock\") ? \"is-divider-block\" : \"\";\r\n    },\r\n\r\n    setCustomStyles: function() {},\r\n\r\n    onRemove: function() {}\r\n\r\n  });\r\n\r\n  return ThemeBlockView;\r\n\r\n});\r\n","define([\r\n  \"./themeView\",\r\n  \"core/js/adapt\"\r\n], function(ThemeView, Adapt) {\r\n\r\n  var ThemeComponentView = ThemeView.extend({\r\n\r\n    className: function() {\r\n      return this.model.get(\"_isDividerBlock\") ? \"is-divider-block\" : \"\";\r\n    },\r\n\r\n    init: function() {\r\n\r\n    },\r\n\r\n    onRemove: function() {}\r\n\r\n  });\r\n\r\n  return ThemeComponentView;\r\n\r\n});\r\n","define([\r\n  \"core/js/adapt\",\r\n  \"./themePageView\",\r\n  \"./themeArticleView\",\r\n  \"./themeBlockView\",\r\n  \"./themeComponentView\",\r\n  \"./themeView\"\r\n], function(Adapt, ThemePageView, ThemeArticleView, ThemeBlockView, ThemeComponentView, ThemeView) {\r\n\r\n  function onDataReady() {\r\n    $(\"html\").addClass(Adapt.course.get(\"_courseStyle\"));\r\n\r\n    // Log which overrides were applied (by the grunt \"prop-override\" task).\r\n    let propOverrides = Adapt.course.get(\"_propOverride\")?._items || [];\r\n    Adapt.log.debug(\"Build overrides: \", propOverrides);\r\n  }\r\n\r\n  function onPostRender(view) {\r\n    var model = view.model;\r\n    var theme = model.get(\"_didasko\");\r\n\r\n    if (!theme) return;\r\n\r\n    switch (model.get(\"_type\")) {\r\n      case \"page\":\r\n        new ThemePageView({ model: new Backbone.Model(theme), el: view.$el });\r\n        break;\r\n      case \"article\":\r\n        new ThemeArticleView({ model: new Backbone.Model(theme), el: view.$el });\r\n        break;\r\n      case \"block\":\r\n        new ThemeBlockView({ model: new Backbone.Model(theme), el: view.$el });\r\n        break;\r\n      case \"component\":\r\n        new ThemeComponentView({ model: new Backbone.Model(theme), el: view.$el });\r\n        break;\r\n      default:\r\n        new ThemeView({ model: new Backbone.Model(theme), el: view.$el });\r\n    }\r\n  }\r\n\r\n  Adapt.on({\r\n    \"app:dataReady\": onDataReady,\r\n    \"pageView:postRender articleView:postRender blockView:postRender componentView:postRender\": onPostRender//,\r\n    //\"blockView:preRender\": onBlockViewPreRender\r\n  });\r\n});\r\n","define([\r\n\t\"core/js/adapt\"\r\n  ], function(Adapt) {\r\n\r\n\t/**\r\n\t * Define helpers and/or partials specific to this project here.\r\n\t * Be SURE to prefix them all with \"c-\".\r\n\t */\r\n\r\n\t// Handlebars Helpers\r\n\t// ----------------------------------------\r\n\tvar helpers = {\r\n\r\n        \"c-example\": function() {\r\n\r\n            let context = arguments[arguments.length-1];\r\n\t\t\tlet content = context.fn(this); // Get the contents of the helper.\r\n\r\n            let html = Handlebars.templates[\"c-example\"](_.extend(\r\n\t\t\t\tcontext.hash,\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent: content\r\n\t\t\t\t}\r\n\t\t\t));\r\n            return new Handlebars.SafeString(html);\r\n\t\t}\r\n\t}\r\n\r\n\tfor (var name in helpers) {\r\n        if (helpers.hasOwnProperty(name)) {\r\n            Handlebars.registerHelper(name, helpers[name]);\r\n        }\r\n    }\r\n\r\n\r\n\t/**\r\n\t * Handlebars Partials\r\n\t * ----------------------------------------\r\n\t * Notes:\r\n\t * ------\r\n\t * - Partials exist to make shortcuts for commonly re-used HTML in a topic. \r\n\t * - Partials support named parameters.\r\n\t * - Partials can contain other Handlebars partials and/or helpers.\r\n\t * \r\n\t * Examples:\r\n\t * ---------\r\n\t * <p>Here's an example {{> c-partial}} and how to use it!</p>\r\n\t * <p>Here's an example {{> c-withParam param=\"with parameters!\"}} and how to use it!</p>\r\n\t */\r\n\tvar partials = {\r\n\t\t\"c-partial\": \"<strong><u>Shortcut!</u></strong>\",\r\n\t\t\"c-withParam\": \"<strong><u>{{./param}}</u></strong>\",\r\n\t}\r\n\r\n\tfor (var name in partials) {\r\n\t\tHandlebars.registerPartial(name, partials[name]);\r\n\t}\r\n});","import Adapt from 'core/js/adapt';\r\nimport React, { useRef } from 'react';\r\nimport { html, prefixClasses, compile, helper } from 'core/js/reactHelpers';\r\n\r\n/**\r\n * Content header for displayTitle, body, instruction text, etc.\r\n * instruction and mobileInstruction will switch automatically\r\n * @param {Object} props\r\n * @param {string} [props.displayTitle]\r\n * @param {string} [props.body]\r\n * @param {string} [props.instruction]\r\n * @param {string} [props.mobileInstruction]\r\n * @param {string} [props._type]\r\n * @param {string} [props._component]\r\n * @param {string} [props._disableAccessibilityState]\r\n */\r\nexport default function Header(props) {\r\n  // Create references to un-controlled view containers\r\n  const jsxHeading = useRef(null);\r\n  const jsxComponentDescription = useRef(null);\r\n  const {\r\n    _id,\r\n    displayTitle,\r\n    body,\r\n    instruction,\r\n    mobileInstruction,\r\n    _type,\r\n    _component,\r\n    _disableAccessibilityState,\r\n    classNamePrefixes = [\r\n      _type && _type.toLowerCase(),\r\n      _component && _component.toLowerCase()\r\n    ].filter(Boolean)\r\n  } = props;\r\n  const sizedInstruction = (mobileInstruction && Adapt.device.screenSize !== 'large') ?\r\n    mobileInstruction :\r\n    instruction;\r\n  const isSet = (displayTitle || body || sizedInstruction);\r\n  if (!isSet) return null;\r\n  return (\r\n    <div id={`${_id}-header`} className={prefixClasses(classNamePrefixes, ['__header'])}>\r\n      <div className={prefixClasses(classNamePrefixes, ['__header-inner'])}>\r\n        {displayTitle &&\r\n        <div className={prefixClasses(classNamePrefixes, ['__title'])}>\r\n\r\n          {!_disableAccessibilityState &&\r\n          <div className=\"js-heading\" ref={jsxHeading}></div>\r\n          }\r\n\r\n          <div className={prefixClasses(classNamePrefixes, ['__title-inner'])} aria-hidden={!_disableAccessibilityState}>\r\n            {html(compile(displayTitle, props))}\r\n          </div>\r\n\r\n        </div>\r\n        }\r\n\r\n        {html(helper('component_description', props), jsxComponentDescription)}\r\n\r\n        {body &&\r\n        <div className={prefixClasses(classNamePrefixes, ['__body'])}>\r\n          <div className={prefixClasses(classNamePrefixes, ['__body-inner'])}>\r\n            {html(compile(body, props))}\r\n          </div>\r\n        </div>\r\n        }\r\n\r\n        {sizedInstruction &&\r\n        <div className={prefixClasses(classNamePrefixes, ['__instruction'])}>\r\n          <div className={prefixClasses(classNamePrefixes, ['__instruction-inner'])}>\r\n            {html(compile(sizedInstruction, props))}\r\n          </div>\r\n        </div>\r\n        }\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport React from 'react';\r\nimport { html, classes, prefixClasses } from 'core/js/reactHelpers';\r\n\r\n/**\r\n * Size switching content image\r\n * @param {Object} props\r\n * @param {Array} props.classNamePrefixes\r\n * @param {Array} [props.attributionClassNamePrefixes]\r\n */\r\nexport default function Image(props) {\r\n  const screenSize = Adapt.device.screenSize;\r\n  const src = (props[`_${screenSize}`] || props[`${screenSize}`] || props._src || props.src);\r\n  const hasSource = Boolean(src);\r\n  if (!hasSource) return null;\r\n  const attributionClassNamePrefixes = (props.attributionClassNamePrefixes || props.classNamePrefixes);\r\n  return (\r\n    <div className={classes([\r\n      prefixClasses(props.classNamePrefixes, ['-image-container']),\r\n      props.attribution && 'has-attribution'\r\n    ])}>\r\n\r\n      <img\r\n        className={prefixClasses(props.classNamePrefixes, ['-image'])}\r\n        src={src}\r\n        aria-label={Adapt.a11y.normalize(props.alt)}\r\n        aria-hidden={!props.alt}\r\n        loading='eager'\r\n      />\r\n\r\n      {props.attribution &&\r\n      <div className={prefixClasses(attributionClassNamePrefixes, ['__attribution'])}>\r\n        <div className={prefixClasses(attributionClassNamePrefixes, ['__attribution-inner'])}>\r\n          {html(props.attribution)}\r\n        </div>\r\n      </div>\r\n      }\r\n\r\n    </div>\r\n  );\r\n}\r\n","import Adapt from 'core/js/adapt';\r\nimport 'core/js/templates';\r\nimport 'core/js/fixes';\r\nimport 'core/js/accessibility';\r\nimport 'core/js/data';\r\nimport 'core/js/offlineStorage';\r\nimport 'core/js/logging';\r\nimport 'core/js/tracking';\r\nimport 'core/js/device';\r\nimport 'core/js/drawer';\r\nimport 'core/js/notify';\r\nimport 'core/js/router';\r\nimport 'core/js/models/lockingModel';\r\nimport 'core/js/mpabc';\r\nimport 'core/js/helpers';\r\nimport 'core/js/scrolling';\r\nimport 'core/js/headings';\r\nimport 'core/js/navigation';\r\nimport 'plugins';\r\n\r\n$('body').append(Handlebars.templates.loading());\r\n\r\nAdapt.data.on('ready', function triggerInit() {\r\n  Adapt.log.debug('Calling Adapt.init');\r\n\r\n  Adapt.init();\r\n\r\n  Adapt.off('adaptCollection:dataLoaded courseModel:dataLoaded');\r\n}).init();\r\n"],"names":["_waitCount","_callbackHandle","being","begin","bind","end","isWaiting","trigger","clearTimeout","setTimeout","callback","Promise","resolve","once","_","defer","Backbone","Controller","attrName","attrVal","options","stopProcessing","isLocking","arguments","isSettingValueForSpecificPlugin","pluginName","console","error","defaults","undefined","_lockedAttributes","lockingValue","isAttemptingToLock","setLockState","skipcheck","totalLockValue","getLockCount","defaultLockValue","_lockedAttributesValues","Object","keys","length","isCheckingGeneralLockingState","isUsingLockedAttributes","Boolean","lockedAttributes","result","isAttributeALockingAttribute","hasOwnProperty","shouldSkipCheck","isGettingValueForSpecificPlugin","lockingAttributeValues","values","lockingAttributeValuesSum","reduce","sum","value","Model","AdaptSingleton","loadScript","window","__loadScript","location","store","setupWait","_canScroll","_outstandingCompletionChecks","_pluginWaitCount","_isStarted","_shouldDestroyContentObjects","log","deprecated","addDirection","disableAnimation","deferUntilCompletionChecked","History","started","history","start","set","outstandingChecks","get","checkIfAnyChecksOutstanding","model","off","on","wait","Wait","beginWait","endWait","ready","isEventListening","_events","listenTo","isWaitingForPlugins","name","object","Array","isArray","forEach","register","split","view","View","template","isModelSetAndInvalid","prototype","Function","Error","isViewSetAndInvalid","assign","nameModelViewOrData","toJSON","foundName","entries","key","entry","names","_view","_component","_type","filter","find","pop","getViewName","warnOnce","isBackboneView","nameModelOrData","isViewOnlyQuestion","_isQuestionType","_model","getModelName","isBackboneModel","id","data","findById","parentView","idPathToView","currentLocationId","_currentId","currentLocationModel","getAncestorModels","modelId","unshift","warn","foundView","currentId","childViews","getChildViews","trackingPosition","findByTrackingPosition","relativeString","splitIndex","search","type","slice","replace","offset","parseInt","trim","defaultDirection","config","$","addClass","attr","disableAnimationArray","i","l","is","toggleClass","currentView","setOnChildren","queue","destroy","LockingModel","mode","args","onRender","cb","intercept","Handlebars","templates","partials","preRenderEvent","TemplateRenderEvent","Adapt","postRenderEvent","_imgLazyLoad","applyImgLoadingFix","findImgTag","hasLoadingAttr","event","imgTagsFound","match","img","test","loading","_onBlur","_onClick","$body","_attachEventListeners","addEventListener","a11y","_isEnabled","_options","_isFocusNextOnDisabled","$element","target","removeAttr","currentTarget","focusNext","preventDefault","stopImmediatePropagation","_isFocusOnClickEnabled","$stack","toArray","parents","$focusable","_tabbableElements","focus","preventScroll","_onKeyDown","$html","showOnKeys","document","_start","_isFocusOutlineDisabled","_isFocusOutlineKeyboardOnlyEnabled","keyCode","_focusOutlineKeyboardOnlyIgnore","removeClass","_warned","_warnFirstOnly","hash","map","String","join","_warn","_canWarn","concat","_hasWarned","removed","_onTouchStart","_onTouchEnd","_onScrollEvent","_scrollDisabledElements","$window","_preventScrollOnKeys","_ignoreKeysOnElementsMatching","_isRunning","_touchStartEventObject","$elements","add","_checkRunning","clear","not","_stop","passive","fix","_preventScroll","$target","isGesture","touches","scrollingParent","_getScrollingParent","scroll","isTouchEvent","hasTouchStartEvent","originalEvent","directionY","_getScrollDirection","$parent","_isScrollable","_isScrolling","scrollType","css","pointerEvents","scrollTop","Math","ceil","innerHeight","outerHeight","scrollHeight","hasScrollingSpace","deltaY","_getScrollDelta","startOriginalEvent","currentY","pageY","previousY","hasDeltaY","wheelDeltaY","wheelDelta","removeEventListener","bindAll","_focusguard","_onWrapAround","_isPopupWrapFocusEnabled","stopPropagation","focusFirst","_floorStack","_focusStack","_tabIndexes","_ariaHiddens","_elementUIDIndex","ignoreInternalTrigger","opened","closed","$popupElement","silent","activeElement","_addPopupLayer","_isPopupManagementEnabled","push","_tabbableElementsExcludes","$branch","$siblings","siblings","each","index","item","$item","elementUID","a11y_uid","tabindex","ariaHidden","_isPopupTabIndexManagementEnabled","_isPopupAriaHiddenManagementEnabled","$items","_ariaHiddenExcludes","$focusElement","$previousFocusElement","_removeLastPopupLayer","previousTabIndex","previousAriaHidden","$original","fn","isFixedPostion","a11y_aria_label","limitedScrollTo","a11y_text","a11y_selected","a11y_on","isOn","$tabbable","findTabbable","toggleAccessible","a11y_only","scrollDisable","_isScrollDisableEnabled","scrollEnable","a11y_popup","popupOpened","a11y_cntrl","withDisabled","toggleEnabled","a11y_cntrl_enabled","toggleAccessibleEnabled","isReadable","findForward","selector","_findFirstForward","findWalk","_findFindForwardDescendant","focusNoScroll","returnOnly","findFirstReadable","focusOrNext","a11y_focus","dontDefer","a11y_alert","a11y_update","text","toggleHidden","a11y_popdown","$focusTarget","popupClosed","a11y_normalize","html","normalize","a11y_remove_breaks","removeBreaks","A11y","_isFocusAssignmentEnabled","_isAriaHiddenManagementEnabled","_focusableElements","_readableElements","_wrapStyleElements","isTabbable","_htmlCharRegex","_browserFocus","BrowserFocus","_keyboardFocusOutline","KeyboardFocusOutline","_wrapFocus","WrapFocus","_popup","Popup","_scroll","Scroll","Log","_removeLegacyElements","listenToOnce","_onDataLoaded","_setupNoSelect","_onNavigationStart","_onNavigationEnd","_isActive","offlineStorage","isEnabled","_addFocuserDiv","_isReady","_disableTextSelectOnClasses","classes","isMatch","some","className","append","$legacyElements","children","$navigationElements","remove","isHidden","isAccessibleEnabled","first","element","checkParents","isNotVisible","hasNativeFocusOrIsScreenReadable","childNodes","c","cl","childNode","isTextNode","nodeType","isOnlyWhiteSpace","nodeValue","iterator","$tag","$found","_findFirstForwardDescendant","nextAll","sibling","$sibling","reverse","parent","$notFound","stack","stackIndexPosition","childIndexPosition","stackEntry","$stackItem","splice","FocusOptions","perform","y","e","device","browser","scrollTo","htmls","isString","$div","stackIndex","outputs","nodes","usable","node","isStyleElement","apply","rtnText","outerHTML","textContent","enable","disable","setCloseTo","defineProperty","models","loadedData","Collection","LOG_LEVEL","ENUM","Logging","_config","_level","INFO","asLowerCase","_console","onLoadConfigData","loadConfig","debug","has","checkQueryStringOverride","matches","override","toUpperCase","_log","DEBUG","WARN","ERROR","FATAL","level","configLevel","isLogLevelAllowed","_logToConsole","shouldLogToConsole","asUpperCase","jsonext","attrs","url","fetch","success","isLoaded","version","semver","satisfies","includePrerelease","plugin","screenSize","large","medium","small","_forceRouteLocking","_canLoadData","_disableAnimation","paramMappings","dir","lang","params","URLSearchParams","passedVal","setValuesFromURLParams","canBubble","deepPath","timeStamp","json","attributes","_children","_parent","extend","_canShowFeedback","_classes","_canReset","_canRequestChild","_isComplete","_isInteractionComplete","_isA11yRegionEnabled","_isA11yCompletionDescriptionEnabled","_requireCompletionOf","_isResetOnRevisit","_isAvailable","_isOptional","_isRendered","_isVisible","_isLocked","_isHidden","firstDescendant","getAllDescendantModels","nearestTrackingIdModel","trackingId","trackingIdDescendants","indexInTrackingIdDescendants","findIndex","descendant","trackingIdAncestors","ancestorDistance","ancestor","hasManagedChildren","setupChildListeners","init","checkCompletionStatus","checkInteractionCompletionStatus","checkLocking","setupTrackables","originalTrackableStateFunction","triggerTrackableState","compose","isQueued","debounce","changed","trackablePropertyNames","changedPropertyNames","isTrackable","includes","getChildren","onAll","bubble","checkReadyStatus","onIsComplete","trackable","resultExtend","pick","state","getTrackableState","force","getAvailableChildModels","child","checkingCompletion","checkCompletionStatusFor","completionAttribute","completed","requireCompletionOf","every","checkedCompletion","typeGroup","hasUpperCase","isPluralized","lowerCased","toLowerCase","singular","singularLowerCased","pluralizedLowerCaseTypes","typeGroups","getTypeGroups","intersection","_typeGroups","parentClass","getPrototypeOf","getTypeGroup","call","uniq","s","ancestorType","getParent","isTypeGroup","findAncestor","descendants","allDescendantsModels","returnedDescendants","where","property","isParentFirst","subDescendants","rootModel","limitParentId","course","relativeDescriptor","parseRelativeString","searchBackwards","moveBy","abs","movementCount","hasDescendantsOfType","findDescendantModels","pageDescendants","modelIndex","pageDescendant","isFilterFunction","loop","totalOfType","count","isSelf","_childrenCollection","childrenCollection","comparator","sort","setChildren","_parentModel","parentId","setParent","shouldIncludeChild","context","passSiblingsAndIncludeSelf","_hasSiblingsAndSelf","siblingsCollection","lockType","setSequentialLocking","setUnlockFirstLocking","setLockLastLocking","setCustomLocking","j","isFirstChildComplete","lastIndex","shouldLock","lockedBy","isResetOnRevisit","reset","modifier","ModelClass","constructor","clonedModel","clonedId","hasId","shouldAssignUniqueId","cid","uniqueId","cidPrefix","deepClone","clone","setupModel","ModelEvent","addPath","isParentCourse","AdaptModel","MenuModel","ContentObjectModel","CourseModel","StartController","replaceState","getStartHash","startIds","startId","_skipIfComplete","alwaysForce","getStartId","isRouteSpecified","href","indexOf","shouldForceStartId","shouldNavigateToStartId","_className","skipIfComplete","_id","hasClass","startController","loadCourseData","setStartLocation","returnToStartLocation","Data","getModelClass","parse","onAdded","onRemoved","_byAdaptID","build","BuildModel","whenReady","loadConfigData","ConfigModel","onLoadCourseData","onLanguageChange","onDirectionChange","direction","language","newLanguage","courseFolder","loadManifestFiles","triggerDataLoaded","triggerDataReady","triggerInit","path","reject","getJSON","__path__","fail","languagePath","manifestPath","manifest","all","filePath","allFileData","allModelData","fileData","modelData","router","navigate","isReady","trackingIdModel","AdaptCollection","OfflineStorage","handler","_handler","save","serialize","JSON","stringify","deserialize","COMPLETION_STATE","Tracking","_requireContentCompleted","_requireAssessmentCompleted","_assessmentState","setupEventListeners","onAssessmentComplete","onAssessmentRestored","checkCompletion","assessmentState","completionData","getCompletionData","status","INCOMPLETE","assessment","isPass","PASSED","FAILED","COMPLETED","tracking","Device","touch","Modernizr","touchevents","screenWidth","getScreenWidth","screenHeight","getScreenHeight","Bowser","OS","getOperatingSystem","osVersion","osversion","renderingEngine","getRenderingEngine","onWindowResize","onConfigDataLoaded","browserString","getAppleDeviceType","pixelDensity","checkScreenSize","orientation","screenSizeConfig","screensizeEmThreshold","baseFontSize","mediumEmBreakpoint","smallEmBreakpoint","fontSize","parseFloat","screenSizeEmWidth","isAppleDevice","getAppleScreenWidth","innerWidth","width","getAppleScreenHeight","height","flags","os","platform","navigator","previousWidth","previousHeight","newScreenSize","userAgent","MSStream","screen","devicePixelRatio","DrawerItemView","role","render","el","appendTo","eventCallback","DrawerView","drawerDir","drawerDuration","_duration","toggleDrawer","openCustomView","onCloseDrawer","onRemove","onKeyUp","setupEscapeKey","which","drawer","_globals","prependTo","shadowTemplate","shadow","postRender","checkIfDrawerIsAvailable","hasBackButton","_hasBackButton","_isCustomViewVisible","showDrawer","isEmptyDrawer","collection","hideDrawer","$toElement","emptyDrawer","$el","renderItems","hideDrawerBackButton","complete","addShadowEvent","velocity","opacity","duration","easing","_showEasing","empty","_hideEasing","removeShadowEvent","one","childContainer","childView","DrawerCollection","Drawer","addItem","drawerObject","triggerCustomView","updateIndexPosition","updatePushPosition","preRender","hasBeenRemoved","delay","closePush","elementHeight","navigationHeight","currentIndex","flippedIndex","positionLowerPush","_showIcon","_timeout","NotifyModel","onPushAdded","onRemovePush","checkPushCanShow","canShowPush","showPush","availablePushNotifications","NotifyPushView","inactivePushNotifications","isForced","isStoppedImmediate","isStoppedNext","hasRequestChild","immediate","stopNext","component","original","React","createElement","ref","HTMLReactParser","cloneElement","compile","output","helper","helpers","string","flatten","prefixClasses","prefixes","prefixed","prefix","AdaptView","toggleVisibility","onIsCompleteChange","isJSX","_classSet","Set","_isRemoved","setupOnScreenHandler","addChildren","eventName","startsWith","props","Template","updateViewProperties","ReactDOM","classesToAdd","classesToRemove","delete","_setAttributes","onscreen","m","minVerticalInview","_percentInviewVertical","percentInviewVertical","nthChild","addDescendants","addedCount","_getAddChildEvent","subsequentModels","_nthChild","ChildView","getViewClass","addChildView","setChildViews","$parentContainer","addedDescendantCount","onReadyChange","stopListening","isRequestChild","ChildEvent","canRequestChild","close","findDescendantViews","descendantComponents","preRemove","for","unmountComponentAtNode","isComplete","_childViews","indexBy","isOpen","hasOpened","closeNotify","resetNotifySize","cancelNotify","notify","showNotify","resizeNotify","windowHeight","notifyHeight","isFullWindow","addSubView","$previousActiveElement","imageready","onLoaded","onOpened","inview","subView","prepend","check","stackItem","onCloseReady","removeSubView","views","Notify","_stack","notifyPushes","NotifyPushCollection","_deprecated","notifyObject","create","_isCancellable","_showCloseButton","_closeOnShadowClick","NotifyView","_canNavigate","_shouldNavigateFocus","Router","_isBackward","_navigationRoot","_isCircularNavigationInProgress","showLoading","$wrapper","setDocumentTitle","navigateToArguments","show","hide","currentModel","_currentModel","hasSubTitle","title","escapedTitle","v","handleRoute","handleId","handlePluginRouter","isDebugEnabled","action","pluginLocation","updateLocation","isContentObject","navigateToId","isRoot","_isMenuDisabled","_previousId","navigateBack","isCourse","handleNavigationFocus","ViewClass","isMenu","invoke","isScrolling","navigateToElement","currentLocation","_previousModel","_previousContentType","_contentType","_currentLocation","_lastVisitedType","_lastVisitedMenu","_lastVisitedPage","setGlobalClasses","htmlClasses","currentClasses","_previousClasses","back","route","previousModel","navigateToParent","parentModel","settings","currentModelId","shouldReplace","contentObject","contentObjectId","isNotInCurrentContentObject","renderTo","disableScrollToAnimation","offsetTop","scrolling","isLegacyScrolling","top","left","axis","RouterModel","loadSubset","groupBy","ArticleModel","BlockModel","ComponentModel","_isA11yComponentDescriptionEnabled","_userAnswer","_attemptStates","onAdaptInitialize","restoreUserAnswers","resetUserAnswer","trackables","types","trackableType","n","booleans","numbers","Number","arrays","getAttemptState","shift","getAttemptObject","attemptStates","states","PageModel","setVisibility","lock","isReact","_isTriggeredReady","performIsReady","unlock","styleOptions","isRenderToSelf","ids","forceUntilId","addingId","PageView","$pageLabel","ContentObjectView","ArticleView","setHidden","BlockView","MPABC","waitForDataLoaded","loaded","onDataLoaded","setupSubsetCollections","contentObjects","AdaptSubsetCollection","articles","blocks","components","mpabc","defaultAriaLevels","lowercase","capitalise","charAt","inc","dec","odd","equals","block","compare","operator","inverse","math","lvalue","rvalue","any","specified","none","toString","root","compile_a11y_text","compile_a11y_normalize","compile_a11y_remove_breaks","import_globals","import_adapt","adapt","directImport","indexedImport","importArray","importIndex","i1","l1","component_description","isNotDefined","_components","hasOverride","description","ariaRegion","SafeString","a11y_aria_label_relative","a11y_aria_image","texts","a11y_wrap_focus","cfg","a11y_attrs_heading","levelOrType","_ariaLevel","isNaN","_ariaLevels","a11y_attrs_tabbable","a11y_alt_text","visible","alternatives","if_value_equals","lowerCase","registerHelper","Scrolling","$app","_checkApp","_loadConfig","limitTo","_limitToSelector","isIncluded","_addStyling","_fixJQuery","_fixScrollTo","_fixBrowser","selectorScrollTop","body","selectorOffset","coordinates","elementOffset","isCorrectedContainer","scrollLeft","appOffset","selectorScrollTo","app","x","HeadingView","updateAria","customHeadingType","$rendered","Headings","onViewRender","$headingSeats","NavigationView","hideNavigationButton","_accessibility","insertBefore","currentEvent","navigateToPreviousRoute","navigateToHomeRoute","skipNavigation","shouldHide","NavigationController","addNavigationBar","adaptConfig","_isDefaultNavigationDisabled","navigation","ComponentView","inviewElementSelector","setCompletionStatus","$inviewElement","inviewCallback","onInview","visiblePartX","visiblePartY","hasSeenTop","hasSeenBottom","removeInviewListener","ActivatorView","initialize","setUpEventListeners","onActivatorActiveChange","isPDFMode","info","isActive","scrollToTargets","$targets","$getTargets","align","priority","err","setReadyStatus","ActivatorTargetModel","_activatorModel","_activationType","onToggle","ActivatorComponentTargetModel","setupActivatorTarget","toggleActivatorTarget","findViewByModelId","ActivatorElementTargetModel","annotation","toggleEl","blockView","ActivatorModel","_isActivatorActive","onDataReady","initTargets","onTargetReadyChange","targetModel","notReadyModel","targets","_targets","componentId","_name","activatorTarget","_index","componentModel","toggleTargets","targetModels","toggle","ac_mark","ac_show","componentView","onActivatorToggle","setUpDefaultTargetComponent","getBoundingClientRect","bb","slideDown","slideUp","PlaybackControlsView","onFrameIdxChange","onIsPlayingChange","frameIdx","val","pause","framesCount","togglePlayPause","isPlaying","TimelineModel","frameCount","frameDuration","position","_prevTimestamp","setupFrames","onPositionChange","requestAnimationFrame","step","floor","timestamp","delta","modelSettings","PlaybackControlsModel","CAInspectorVarView","onValChange","onVisibleChange","vals","idx","isVisible","CodeAnimView","setUpViewData","animation","onActivatorActivate","navigateSettings","playbackControlsView","play","$anim","animHeight","$codeAnimContainer","_lang","htmlConsole","codeBox","renderPlaybackControls","PlaybackControls","_frameDuration","_frames","frames","onPlaybackControlsFrameChange","renderInspectorVars","$container","varModels","_inspectorVars","varModel","CodeAnimInspectorVarView","targetFrame","playbackControlsModel","frame","_getAnimationFrame","line","anim","$consolePrints","UNDEFINED","CAInspectorVarModel","_playbackControlsModel","_vals","lastFrameIdx","addVal","substring","convertVal","$1","$2","$3","_val","CodeAnimModel","setUpAnimation","_animation","_isInspectorEnabled","keyframes","_keyframes","keyframe","k","allLines","_stringToNumbers","lines","f","_maxNameLength","inspectorVars","vars","CodeAnimInspectorVarModel","str","nums","allNums","_isVisited","isVisited","_items","setUpItems","booleanArray","items","ItemModel","findWhere","getVisitedItems","storeUserAnswer","areAllItemsCompleted","toggleActive","getItem","activeItem","getActiveItem","AccordionModel","ItemsComponentModel","_shouldCollapseItems","_toggleSpeed","toggleItemsState","previousActiveItem","toggleVisited","AccordionView","events","checkIfResetOnRevisit","setUpModelData","resetActiveItems","onItemsActiveChange","onItemsVisitedChange","sizing","globalSizing","graphic","_graphic","itemSizing","_sizing","getSizingClass","_parClasses","getParentClasses","setupInviewCompletion","onClick","toggleItem","getItemElement","shouldExpand","stop","AssessmentResultsModel","onAssessmentReset","assessmentModel","getState","allowResetIfPassed","_state","attempts","attemptsSpent","attemptsLeft","score","scoreAsPercent","maxScore","setFeedbackBand","checkRetryEnabled","setFeedbackText","scoreProp","isPercentageBased","bands","sortBy","isScoreInBandRange","_score","canResetInPage","feedbackBand","isRetryEnabled","_allowRetry","isAttemptsLeft","showRetry","_isRetryEnabled","retryFeedback","feedback","isVisibleBeforeCompletion","wasVisible","isAttemptInProgress","attemptInProgress","hasHadAttempt","resetType","_feedbackBand","AssessmentResultsView","setLocking","unsetLocking","addClassesToArticle","checkIfAssessmentComplete","wasReset","_routeToAssessment","articleId","BlankView","BUTTON_STATE","textPropertyName","onButtonStateChanged","onFeedbackMessageChanged","onAttemptsChanged","onCanSubmitChange","buttons","refresh","isSubmitted","buttonState","checkResetSubmittedState","SHOW_CORRECT_ANSWER","correctAnswer","getCorrectAnswerAsText","updateAnswerLiveRegion","HIDE_CORRECT_ANSWER","userAnswer","getUserAnswerAsText","SHOW_FEEDBACK","changedAttribute","updateAttemptsCount","$buttonsAction","CORRECT","INCORRECT","propertyName","asString","ariaLabel","buttonText","canShowFeedback","isInteractionComplete","shouldDisplayAttempts","attemptsString","remainingAttemptText","remainingAttemptsText","showMarking","answer","shouldShowMarking","isCorrect","ariaLabels","_ariaLabels","answeredCorrectly","answeredIncorrectly","checkFeedbackState","QuestionModel","_shouldDisplayAttempts","_canShowModelAnswer","_canShowMarking","_canSubmit","_isSubmitted","_questionWeight","setupDefaultSettings","setupWeightSettings","setupButtonSettings","globalButtons","componentButtons","canSubmit","canShowModelAnswer","SUBMIT","RESET","setupCorrectFeedback","isPartlyCorrect","setupPartlyCorrectFeedback","setupIncorrectFeedback","feedbackTitle","getFeedbackTitle","feedbackMessage","correct","_partlyCorrect","final","setAttemptSpecificFeedback","_incorrect","notFinal","_attemptsLeft","_isCorrect","_buttonState","addAttemptObject","QuestionView","isInteractive","onEnabledChanged","_runModelCompatibleFunction","setupQuestion","disableQuestion","enableQuestion","resetQuestionOnRevisit","onHideCorrectAnswerClicked","onResetClicked","addButtonsView","onQuestionRendered","buttonsView","ButtonsView","onButtonStateUpdate","onSubmitClicked","onShowCorrectAnswerClicked","showFeedback","showInstructionError","onCannotSubmit","removeInstructionError","recordInteraction","resize","onSubmitted","setQuestionAsSubmitted","checkQuestionCompletion","setQuestionAsReset","resetQuestion","checkCanSubmit","getButtonState","setQuestionAsShowCorrect","showCorrectAnswer","setQuestionAsHideCorrect","hideCorrectAnswer","lookForViewOnlyFunction","ViewOnlyQuestionViewCompatibilityLayer","getInteractionObject","getResponse","getResponseType","updateAttempts","_isInViewOnlyCompatibleMode","markQuestion","setScore","updateButtons","setupFeedback","checkForFunction","hasCompatibleVersion","usingCompatibleVersion","McqView","isCorrectAnswerShown","update","setupRandomisation","onKeyPress","onItemSelect","onItemFocus","onItemBlur","itemModel","shouldSelect","isSingleSelect","isAtActiveLimit","getLastActiveItem","updateMarking","resetItems","updateSelection","modelEnabled","isSelected","prop","canShowMarking","$itemInput","shouldBeSelected","$itemlabel","incorrect","selectedAnswer","unselectedAnswer","BlendedItemsComponentQuestionModel","getOwnPropertyNames","itemModels","shuffle","activeItems","getActiveItems","a","b","allChildren","activeChildren","isItemCorrect","isItemPartlyCorrect","isItemIncorrect","list","predicate","_numberOfRequiredAnswers","_numberOfCorrectAnswers","_numberOfPartlyCorrectAnswers","_numberOfIncorrectAnswers","_isAtLeastOneCorrectSelection","numberOfSelectableAnswers","hasSelectableCorrectAnswers","hasAllCorrectAnswers","hasCorrectAnswers","hasIncorrectAnswers","hasPartlyCorrectAnswers","questionWeight","setupIndividualFeedback","selectedItem","selectedItems","interactions","correctResponsesPattern","choices","correctItems","activeIndexes","globals","ariaAnswer","ariaCorrectAnswer","correctOption","_shouldBeSelected","ariaCorrectAnswers","correctOptions","ariaUserAnswer","ariaUserAnswers","McqModel","ItemsQuestionModel","_feedback","instruction","_correct","itemCorrectFeedback","globalCorrectFeedback","itemFeedback","questionPlus","setUpFeedback","Gmcq","Mcq","resizeImage","onDeviceResize","setUpColumns","imageWidth","$img","newSrc","columns","isLarge","GraphicView","setupInView","imageSrc","HotgraphicPopupView","onControlClick","applyNavigationClasses","updatePageCount","handleTabs","itemCount","canCycleThroughPagination","shouldEnableBack","shouldEnableNext","$controls","_hotgraphic","popupPagination","labelText","itemNumber","totalItems","applyItemClasses","handleFocus","closePopup","getNextIndex","setItemState","nextItem","HotGraphicView","popupView","_isPopupOpen","reRender","replaceWithNarrative","NarrativeView","prepareNarrativeModel","newNarrative","setupNarrative","$pin","visitedLabel","visited","innerHTML","onPinClicked","openPopup","onPopupClosed","HotgraphicView","DropDownItem","$inner","isPlaceholder","select","$button","getValue","deselectAll","setActiveDescendantId","selected","$input","deselect","removeActiveDescendantId","reselect","getIndex","option","getNext","getPrevious","getFirst","getLast","scrollToItem","placeholder","DropDown","getDefaults","setUpElements","addEventListeners","toggleOpen","load","openList","closeList","$list","$options","DropDownOption","onStartInteraction","click","onButtonClick","onListBlur","onKeyDown","wasOpen","getFirstSelectedItem","open","blurTimeout","handleBlur","toggleDisabled","isEmpty","removeEventListeners","offsetLeft","outerWidth","isOffscreen","clientHeight","pos","MatchingView","dropdowns","dropdown","onPostRemove","onOptionSelected","setUpDropdowns","selectedOption","_isSelected","itemIndex","optionIndex","setOptionSelected","eq","resetAll","selectValue","_selected","answerArray","MatchingModel","setupQuestionItemIndexes","tempUserAnswer","o","_tempUserAnswer","numberOfCorrectAnswers","itemLength","source","questionIndex","responses","correctAnswerTemplate","_matching","itemText","userAnswerTemplate","mepPrototype","mejs","MediaElementPlayer","detectFullscreenMode","vendorPrefix","getVendorPrefix","fsEventName","fullScreenEventHandler","elementName","t","fullscreenMode","froogaloopAdded","purge","d","MepDefaults","keyActions","defaultSeekForwardInterval","defaultSeekBackwardInterval","MediaView","playerOptions","toggleCaptionsButtonWhenOnlyOne","onScreenSizeChanged","onDeviceChanged","onMediaStop","media","protocol","setupPlayer","addMejsButtonClass","modelOptions","pluginPath","flashName","flashScriptAccess","features","onPlayerReady","startLanguage","checkForSupportedCCLanguage","alwaysShowControls","hideVideoControlsOnLoad","addMediaTypeClass","addThirdPartyFixes","createPlayer","mediaelementplayer","cleanUpPlayer","_media","mp3","mp4","ogv","webm","typeClass","getScript","done","completionEvent","mediaElement","onMediaElementSeeking","onMediaElementTimeUpdate","onMediaElementPlay","onMediaElementPause","onMediaElementEnded","listenForCaptionsChange","srclang","player","selectedTrack","onCaptionsChanged","setTrack","$inputs","cc","queueGlobalEvent","onMediaElementInview","isInView","paused","maxViewed","currentTime","setupPlayPauseToggle","clickToPlayPause","onOverlayClick","onMediaElementClick","isPaused","isRemoved","playerId","players","src","pluginElement","domObject","hasTouch","MediaFeatures","addThirdPartyAfterFixes","cleanUpPlayerAfter","setVolume","onSkipToTranscript","onToggleInlineTranscript","$transcriptBodyContainer","$buttonText","inlineTranscriptButton","inlineTranscriptCloseButton","_setCompletionOnView","onExternalTranscriptClicked","eventType","Date","now","lastEvent","time","timeSinceLastEvent","debounceTime","eventTimeout","triggerGlobalEvent","eventObj","pluginType","isVideo","_isInitial","renderMode","calculateWidths","setStage","calculateMode","MODE","LARGE","SMALL","isLargeMode","replaceInstructions","resizeControl","previousMode","evaluateNavigation","replaceWithHotgraphic","evaluateCompletion","componentStore","hotgraphic","prepareHotgraphicModel","newHotgraphic","moveSliderToIndex","cssValue","$sliderElm","$straplineHeaderElm","onTransitionEnd","$slideGraphics","active","currentStage","isAtStart","isAtEnd","currentItem","onNavigationClicked","stage","setActiveItem","onProgressClicked","clickedIndex","SliderView","setAllItemsEnabled","deselectAllItems","selectItem","getIndexFromValue","setupRangeslider","$sliderScaleMarker","$slider","rangeslider","polyfill","onSlide","handleSlide","oldValue","_deferEnable","pixels","mapIndexToPixels","animateToPosition","setScalePositions","showScaleMarker","newPosition","mobileHA","itemValue","scaleStart","scaleEnd","round","mapValue","$widthObject","numberOfItems","mapPixelsToIndex","normalise","low","high","range","inputLow","inputHigh","outputLow","outputHigh","normal","onHandleFocus","onHandleBlur","newItemIndex","max","min","setSliderValue","getValueFromIndex","onNumberSelected","resetControlStyles","animate","change","normalisedPosition","showScale","$markers","display","visibility","$scaler","showScaleNumbers","$numbers","scaleWidth","$number","newLeft","showLabels","remapSliderBar","answers","bottom","_bottom","_top","topOfRange","middleAnswer","showModelAnswers","correctAnswerArray","$parentDiv","startingLeft","fadeIn","userAnswerIndex","noFocus","showNumber","$scaleMarker","SliderModel","setupModelItems","getDecimalPlaces","num","dp","toFixed","_selectedItem","TextView","setupInview","getInviewElementSelector","TextInputView","clearValidationError","showValidationError","correctAnswers","_answers","onInputChanged","setItemUserAnswer","TextInputModel","genericAnswerIndexOffset","_answerIndex","genericAnswers","answerIndex","markGenericAnswers","markSpecificAnswers","contains","pluck","usedAnswerIndexes","answerGroup","checkAnswerIsCorrect","cleanupUserAnswer","possibleAnswers","uAnswer","matched","cAnswer","answerIsCorrect","TextInputPlusView","onUserInputChange","onShowingAnswerChange","userInput","_min","_max","isShowingAnswer","attemptsBeforeHint","clearItemState","TextInputPlusModel","customFeedback","incorrectText","correText","userInputLength","incorrectItems","found","_terms","term","termFound","RegExp","_correctItems","_incorrectItems","EssayView","EssayModel","DESELECT_INCORRECT_DELAY","FinderView","setUpGridSize","onFeedbackClosed","deselectIncorrectAnswers","updateContainer","$itemLabel","isDisabled","isAtLeastOneIncorrect","FinderModel","_isAtLeastOneIncorrectSelection","hasRightNumberOfCorrectAnswers","hasNoIncorrectAnswers","FlipCardView","onFlipCardActiveChange","isFlipCardActive","FlipCardModel","flipCardModel","flipCardView","FreeThinkingView","_buttons","_hideCorrectAnswer","_showCorrectAnswer","FreeThinkingModel","parentClasses","freeThinkingModel","freeThinkingView","NAVIGATE_DURATION","GLabelPopupView","onClosed","onTooltipChange","onIsSelectedChange","onIncorrectChange","onOptionSelectedChange","tooltip","isIncorrect","optionModel","$label","alignEverything","playContentAnim","myBB","targetBB","$content","contentWidth","containerWidth","itemWidth","itemLeftCenter","$graphic","$parGraphic","getParentView","getAlignOffset","$parItem","getParentItemEl","yDiff","yDiffTarget","yDiffMin","yDiffMax","closest","yOffset","navigateToRelOffset","$tooltip","alignContentToItem","alignViewport","alignImg","relativeTop","notifyView","GLabelView","onItemActiveChange","onItemFocusedChange","onItemSelectedChange","onItemCorrectChange","onItemIncorrectChange","onItemTooltipChange","isFocused","openItemPopup","itemPopupView","onItemPopupClosed","setUpInteract","itemIdx","_optionsSelected","optionIdx","_optionsCorrect","inputText","_optionsVisited","GLabelModel","setupQuestionItems","setupQuestionOptions","_toggleOption","isRadio","optionIndexes","itemAnswer","resp","HotgraphicFlipView","_width","_maxWidthInner","_itemClasses","recalcItemHeight","h","_h","minHeightRatio","_minHeightRatio","w","HotgraphicMiniView","getSizingGridClasses","setUpGridListeners","recalcContentMargins","setUpSizingListeners","$contents","CLOSE_TIMEOUT","HotgraphicPlusPopupView","_canUserClose","_hasAltImg","srcPopup","getSizingClasses","onClickClose","onClickBG","setupGraphicTransition","alignGraphicToPin","$tran","pinBB","imgBB","scale","tranBB","HotGraphicPlusView","itemPopupSizing","finderData","counterSizing","_counter","updateFinderCounter","itemsRemaining","onFinderCounterClick","nonVisitedItem","clearFinderHints","onItemsVisibleChange","isTabsMode","onDeviceResizeTabs","_isTabsOpen","setUpDebug","$pinItems","showTab","updateTabTail","itemBB","widgetBB","$tail","tailLeft","$tabs","onPopupRemoved","HotgraphicPlusView","ImgFinderOutlineModel","_left","_height","calcSize","sizeType","getAvgOutlineSize","isOverGuess","calcOverlappedItems","guess","getGuesses","accuracy","getVectorToItem","proximity","getVectorLengthSquared","itemObj","getPosition","_outline","vector","sqrt","pow","sizeMod","avg","DRAGGING_BUFFER","ImgFinderOutlineView","onDraggingChange","onMouseDownChange","onCorrectChange","onIsIncorrectChange","onLockedChange","onIsRemovedChange","isLocked","draggable","isMouseDown","isDragging","setupDraggable","containment","ui","_isDragging","recalcPosition","$area","$getArea","ImgFinderView","onIsSubmittedChange","onIsCorrectChange","changedTouches","clientX","clientY","addOutline","_position","outlineModel","outlineView","ImgFinderItemModel","setupModelData","FEEDBACK_HINT","MAX_GUESSES","ImgFinderModel","outlines","g","onOutlinesModified","outline","myOutline","myProximity","Infinity","getOverlappingItemData","pairWithItem","addGuess","getGuessObj","validateOutlines","correctOutlines","incorrectOutlines","MatchingPlusModel","onItemOptionsSelectedChange","incompleteItem","globalOptions","isOptionsShared","goOptionsCorrect","go","goIndex","hasSharedUniqueOptions","optionsSelected","optionsCorrect","selectedIdx","_isIncorrect","otherItem","otherOptions","otherOption","_isEliminated","CLICK_ANYWHERE_EVENTS","MatchingPlusDropdownView","onActiveChange","onOptionsSelectedChange","onDisabledChange","onClickAnywhereEvent","onClickAnywhere","toggleDropdown","$option","anyIncorrect","triggerText","triggerIncorrect","$trigger","$triggerText","MIN_OPTION_LENGTH","MatchingPlusView","dropdownViews","getItemEl","optionLength","onItemDisabledChange","dropdownView","updateItemState","anyCorrect","$select","getItemByIndex","lastVal","MCQCodeView","feedbackHTML","annotationHTML","MCQ","MCQCodeModel","preSetUpItems","code","getLines","_lineNum","_stringToSeconds","seconds","MediaPlusModel","setUpDefaultData","chapters","_time","_allowFullScreen","_setCompletionOn","_showVolumeControl","_pauseWhenOffScreen","_transcript","_inlineTranscript","_externalTranscript","transcriptLinkButton","transcriptLink","_playerOptions","iPadUseNativeControls","iPhoneUseNativeControls","AndroidUseNativeControls","enableProgressTooltip","Media","MediaPlusView","renderChaptersTimeFloat","renderChaptersMenu","renderChaptersDividers","onTimeFloatTimeChange","setUpTimeFloat","$timeFloat","$timeFloatCur","observer","MutationObserver","observe","childList","$rail","$divider","class","setCurrentTime","MmcqView","onDeviceChange","resizeHeaderLabels","$labelsInner","minWidth","maxWidth","inputIndex","toggleOptionsSelected","MmcqModel","getHasUniqueOptions","hasUniqueOptions","itemOptions","optionText","optionsCount","fill","_optionIndex","optionSelected","NarrativePlusView","_isUninteracted","_debounceTransitionEnd","cancel","scrollIntoView","JITTER_THRESHOLD","VIEWPORT_SCROLL_THRESHOLD","VIEWPORT_SCROLL_SPEED","ReorderView","itemElementTopCache","onItemGrabbedChange","onItemUserIndexChange","onItemVisitedChange","onItemLockedChange","onItemPositionTopChange","getItemModel","$itemElement","isGrabbed","userIndex","positionTop","translate","setUpItem","arr","curTop","lastTop","offsetY","drag","throttle","refreshItemElementTopCache","scrollPage","movement","newItemOrder","itemsAbove","itemsBelow","curMiddle","eModel","eTop","getItemElementTop","eBottom","_getFirstEmptyIdx","itemGrabbedTop","itemGrabbedOffset","dragDir","draggableTop","draggableBottom","ReorderItemModel","_userIndex","_visitedIndexes","_isGrabbed","_positionTop","onUserIndexChange","visitedIndexes","ReorderItemCollection","ReorderModel","setUpLabels","legacyHeader","legacyFooter","labels","header","footer","temp","_isAtLeastOneCorrectAnswer","setVisited","Tabs","itemGraphic","setLayout","replaceWithAccordion","accordion","prepareAccordionModel","newAccordion","tabLayout","setTabLayoutVertical","setTabLayoutHorizontal","onTabItemClicked","dataFilter","$tabButton","$tabPanel","setUpInputFields","$inputFields","inputField","findViewByEl","getAnswers","_inputFieldModel","disableHint","enableRequireSubmit","enableHint","setUpQuestionItemInputWidths","maxAnswerLength","inputWidthExtra","answerLength","_inputWidth","submit","getAnswerIndex","TryHtmlView","onIframeUserLoad","onIframeCorrectLoad","codeMirror","CodeMirror","fromTextArea","theme","tabSize","tabUnit","lineWrapping","resetSelectionOnContextMenu","scrollY","_html","onSubmit","isEpubMode","$iframe","fadeOut","setUpIframeHTML","contents","tryHtml","_user","_update","disabledText","TryHtmlModel","TryThisView","Accordion","TryThisModel","reflect","AnnotationView","classNames","onVisitedChange","onAdaptAnnotationToggle","$getForTargets","renderTooltipFallback","$tooltipFallback","tooltipPopupView","createTooltip","content","_for","$for","forName","$f","$forTargets","Annotation","onRouterPage","initHelpers","annotationNum","registerHelperEl","hasIcon","modelJSON","_tooltip","_hasIcon","_number","getComponentModelFromContext","mark","absolute","_tag","markBlock","fade","fadeBlock","tooltipFallback","scrollNested","VIEWPORT_MARGIN","BlockBackgroundView","setUpItemGraphics","updateClipMask","updateItemGraphics","coords","$group","onActiveItemIdxChange","onIsInviewChange","prevBlockBackground","onPrevBlockBackgroundIsInviewChange","setUpObservers","isInview","pbb","mainObserver","IntersectionObserver","isIntersecting","threshold","onGroupInview","rootMargin","$groups","BlockBackgroundModel","_activeItemIdx","setUpId","setUpGroups","componentRows","childIds","_child","groups","curGroup","componentRow","_componentRows","cloneItem","cr","BlockBackground","_blockBackgrounds","onBlockViewPostRender","onComponentRowViewPostRender","blockModel","legacyBG","_backgroundImage","_large","_small","prevBlockBB","_legacyBlockBGFix","_prevBlockBackground","blockBackground","color","onParentPostRender","componentRowView","bbgItemId","CodeBoxFadeBlockView","require","shim","exports","DESKTOP_BOOKSHELF_TAB_STRING","LANG_SCRIPTS","CodeBoxView","sizingClasses","escapeHTMLContent","renderContent","renderPrettify","BR_REGEX","langRequired","Prettify","PR","prettyPrintOne","renderLineContainers","blockHTML","htmlLines","htmlLine","$codeBoxInner","$divs","_getLinesHTMLArray","$first","prevUntil","wrapAll","openingTagHtml","$next","nextUntil","$codeBoxLines","renderFadeBlocks","$fadeBlocks","$headerLine","$contentLines","CodeBoxIframeView","updateIframeSize","onIframeLoad","doc","contentWindow","scripts","inlineScripts","documentElement","appendChild","createTextNode","readyState","waitUpdateIframeContent","_formSubmitMessageEnabled","alert","$imgs","remainingImages","decrementCounter","$clone","actual","waitIframeImgLoad","getContextHash","_default","_style","style","_filename","filename","_wrappingEnabled","wrapping","pseudocode","TAB_REGEX","codeString","ComponentRowModel","_prevSibling","_isReverse","_isSingle","_hasDivider","setUpTitle","setUpReverse","setUpDivider","setUpQuestionType","setUpIsComplete","setUpSizing","onParentEnabledChange","available","childModel","ComponentRow","updateIsComplete","componentWithTitle","prevCR","ComponentRowCollection","_blockModel","repopulate","componentModels","curPair","_layout","isComponentSingleton","pairComponents","componentArray","crModel","last","ComponentRowView","validateChildren","onEnabledChange","onDividerChange","hasDivider","setupComponentRowData","renderComponentRowViews","onComponentPostRender","_getChildren","_componentRowOverride","componentRowCollection","appendComponentRowViews","componentRowModel","appendComponentView","blockComponentRow","isAvailable","isClone","_componentRow","isFirst","AssessmentView","AdaptArticleView","isAssessmentEnabled","_setupEventListeners","getConfig","_questions","_onAssessmentComplete","_onAssessmentReset","_onRemove","_removeEventListeners","QuestionBank","quizBankid","numQuestionBlocks","uniqueQuestions","_articleId","_numQuestionBlocks","_uniqueQuestions","questionBlocks","unUsedQuestionBlocks","usedQuestionBlocks","getID","addBlock","getRandomQuestionBlocks","checkResetUnunsedBlocks","question","getRandomQuestion","random","questionBlock","givenIdCount","assessmentConfigDefaults","_resetType","_suppressMarking","_isPercentageBased","_scoreToPass","_includeInTotalScore","_assessmentWeight","_reloadPageOnReset","_attempts","_allowResetIfPassed","AssessmentModel","_postInitialize","assessmentConfig","_currentQuestionComponents","_originalChildModels","_questionBanks","_forceResetOnRevisit","_currentQuestionComponentIds","_assessmentCompleteInSession","_attemptInProgress","_isAssessmentComplete","_numberOfQuestionsAnswered","_lastAttemptScoreAsPercent","_attemptsSpent","_onDataReady","comp","_setAssessmentOwnershipOnChildrenModels","childConfig","_isPartOfAssessment","_assessmentId","_setupAssessmentData","shouldResetAssessment","shouldResetQuestions","quizModels","_banks","_split","_setupBankedAssessment","_randomisation","_setupRandomisedAssessment","_resetQuestions","finalise","_overrideQuestionComponentSettings","_setupQuestionListeners","_checkNumberOfQuestionsAnswered","_updateQuestionsState","saveState","_setupBanks","questionModels","bankId","questionBank","questions","banks","bank","blockAssessmentConfig","_quizBankID","randomisationModel","blockModels","_blockCount","newSettings","_getMarkingSettings","questionConfig","questionComponents","_onQuestionCompleted","numberOfQuestionsAnswered","_removeQuestionListeners","questionModel","_checkAssessmentComplete","allQuestionsAnswered","_spendAttempt","_getScoreAsPercent","_getScore","_getMaxScore","_scoreAsPercent","_maxScore","_checkIsPass","_isMarkingSuppressionEnabled","_isAttemptsLeft","_overrideMarkingSettings","_refreshQuestions","questionComponent","scoreToPass","markingSettings","_shouldSuppressMarking","newMarkingSettings","_getLastAttemptScoreAsPercent","_checkReloadPage","_reloadPage","syncIterations","qs","len","_setCompletionStatus","_checkIfQuestionsWereRestored","wereQuestionsRestored","_isResetInProgress","isPageReload","getSaveState","banksActive","randomisationActive","isInteger","blockTrackingIds","blockCompletion","blockData","dataPackage","setRestoreState","restoreState","_trackingId","blockIndex","blockQuestions","pageId","includeInTotalScore","assessmentWeight","lastAttemptScoreAsPercent","assessmentsConfigDefaults","_isDefaultsLoaded","_assessments","_byPageId","_byAssessmentId","_onAssessmentsComplete","_checkResetAssessmentsOnRevisit","_handleRoute","assessmentId","_getStateByAssessmentId","_setPageProgress","_checkAssessmentsComplete","_restoreModelState","_saveStateModel","toObject","pageAssessmentModels","_getAssessmentByPageId","resetAllAssessments","allAssessmentHaveReset","numberOfAssessments","numberOfResetAssessments","forceAssessmentReset","haveAllModelsReset","_restoredCount","allAssessmentsComplete","assessmentToPostBack","_getStatesByAssessmentId","assessmentStates","_setupSingleAssessmentConfiguration","assessmentsConfig","assessments","assessmentsTotal","assessmentsPassed","pageModel","_subProgressTotal","_subProgressComplete","_addToAssessmentIdMap","_setupQuestionNumbering","getRelatedQuestions","currentAssessmentId","currentAssessment","getQuestionNumber","related","getTotalQuestions","totalAssessments","assessmentsComplete","Events","ArticleViewInitialize","AdaptAssessmentArticleView","ArticleModelInitialize","AdaptAssessmentArticleModel","returnValue","Bookmarking","bookmarkLevel","watchViewIds","watchViews","restoredLocationID","currentLocationID","checkIsEnabled","checkRestoreLocation","courseBookmarkModel","_onScroll","checkLocation","setupMenu","setupPage","restoreLocation","locationOnscreen","isLocationOnscreen","percentInview","isLocationFullyInview","_showPrompt","navigateToPrevious","showPrompt","yes","no","navigateCancel","promptObject","_prompts","promptText","_callbackEvent","accessibility","prompt","isSinglePage","resetLocationID","setLocationID","menuView","menuModel","getBookmarkLevel","defaultLevel","bookmarkModel","isInherit","pageView","pageBookmarkModel","desc","captureViews","releaseViews","highestOnscreen","highestOnscreenLocation","isViewAPageChild","measurements","setupHelpers","LanguagePickerView","initializeNavigation","onLanguageClick","destroyNavigation","setLanguage","navigationView","LanguagePickerDrawerView","onDoChangeLanguage","onDontChangeLanguage","getLanguageDetails","_attributes","_direction","warningTitle","warningMessage","$finishFocus","focusStack","setTrackedData","LanguagePickerNavView","tagName","customClass","LanguagePickerModel","displayTitle","_languages","trackedData","locationId","markLanguageAsSelected","_language","mapById","isTrackedDataEmpty","setTrackableState","isEqual","compact","stateObject","restoreModel","languagePickerModel","onConfigLoaded","setupNavigationView","onOfflineStorageReady","storedLanguage","showLanguagePickerView","languagePickerView","courseGlobals","_extensions","navigationBarLabel","_languagePicker","languagePickerNavView","Completion","subProgressCompleted","subProgressTotal","nonAssessmentCompleted","nonAssessmentTotal","assessmentCompleted","assessmentTotal","calculateCompletion","contentObjectModel","completion","viewType","availableChildren","filterAvailableChildren","getPageLevelProgressEnabledModels","nonAssessmentComponents","getNonAssessmentComponents","getComponentsCompleted","assessmentComponents","getAssessmentComponents","getComponentsInteractionCompleted","_excludeAssessments","showPageCompletionCourse","_showPageCompletion","showPageCompletionPage","completionObject","unavailableInHierarchy","calculatePercentageComplete","total","percentageComplete","PageLevelProgressIndicatorView","calculatePercentage","addClasses","setPercentageComplete","checkAria","getRenderData","percentage","PageLevelProgressItemView","addIndicator","PageLevelProgressView","scrollToPageElement","currentComponentSelector","$children","PageLevelProgressNavigationView","deferredUpdate","updateProgressBar","refreshProgressBar","indicatorView","_getPageCompletionPercentage","_pageLevelProgress","pageLevelProgressIndicatorBar","completionCalculations","PageLevelProgressCollection","_pageModel","allDescendants","currentPageItems","availableItems","enabledProgressItems","PageLevelProgress","getCourseConfig","coursePLPConfig","headerIndicatorTypes","headerIndicatorEventNames","renderHeaderIndicatorView","renderMenuItemIndicatorView","renderNavigationView","onCompletionChange","completionState","hasChanged","_previousCompletionState","_isCompletionIndicatorEnabled","pageConfig","$headings","insertAfter","pageLevelProgress","_getMenuItemCompletionPercentage","pageLevelProgressMenuBar","_isShownInNavigationBar","pagePLPConfig","after","ResourcesView","resources","onFilterClicked","resources_has_type","hasType","matcher","resources_has_multiple_types","allSameType","resources_get_column_count","resources_force_download","resource","_forceDownload","setupResources","resourcesData","resourcesModel","resourcesCollection","initResources","courseResources","drawerOrder","_drawerOrder","Logger","logArr","registeredViews","LOG_TYPE_INFO","updateViews","LOG_TYPE_WARN","LOG_TYPE_ERROR","LOG_TYPE_DEBUG","instance","ScormWrapper","setCompletedWhenFailed","commitOnStatusChange","commitOnAnyChange","timedCommitFrequency","maxCommitRetries","commitRetryDelay","commitRetryPending","commitRetries","lastCommitSuccessTime","exitStateIfIncomplete","exitStateIfComplete","timedCommitIntervalID","retryCommitTimeoutID","logOutputWin","startTime","endTime","lmsConnected","finishCalled","logger","getInstance","scorm","pipwerks","SCORM","handleExitMode","suppressErrors","debouncedCommit","commit","__debug","showDebugWindow","API","__offlineAPIWrapper","API_1484_11","initTimedCommit","handleError","isSCORM2004","setValue","setIncomplete","setCompleted","setPassed","setFailed","_minScore","scaledScore","isSupported","_location","_data","initRetryCommit","_errorCode","getCode","_errorMsg","getInfo","getDiagnosticInfo","clearInterval","convertToSCORM2004Time","getTime","getExitState","convertToSCORM12Time","quit","response","latency","recordInteractionMultipleChoice","recordInteractionMatching","recordInteractionScorm2004","recordInteractionScorm12","recordInteractionFillIn","recordInteractionSequencing","_property","_value","_success","setInterval","doRetryCommit","_msg","confirm","cmiPrefix","getInteractionCount","getCMITime","getISO8601Timestamp","scormRecordInteraction","checkResponse","maxLength","substr","msConvert","msPerSec","msPerMin","msPerHour","ms","secs","mins","hrs","padWithZeroes","csConvert","csPerSec","csPerMin","csPerHour","csPerDay","days","hours","cs","hms","date","getHours","getMinutes","sec","getSeconds","toISOString","numToPad","padBy","responseType","self","checkIdentifier","r","identifiers","completionStatus","isIncomplete","exitState","ZeroString","makeZeroString","zeroPadRightToLength","padLength","zeroPadLeftToLength","zeroPadRightToMultiple","multiple","binaryToUnsignedInteger","binary","binaryLength","integer","shiftUnsignedIntegerFromBinary","shiftBinary","shifted","unsignedIntegerToBinary","byteArrayToString","array","arrayLength","fromCharCode","stringToByteArray","stringLength","charCodeAt","BYTE_BIT_LENGTH","binaryToBase64","bytesCount","charCodes","base64","btoa","base64ToBinary","atob","logs","usedTypes","typeLengths","binarySamples","AbstractValueType","binaryTypeLength","binaryType","FixedIntegerType","esType","valueBinaryLength","minValue","maxValue","logStats","FixedBooleanType","bool","LengthAndValueBinary","bitSizes","maxValues","sizeBinaryLength","parentName","sizeIndex","sizeBinary","valueLength","integerBinary","VariableIntegerType","isNegative","integerBitSizes","valueToBinary","shiftValueFromBinary","VariableArrayType","valueType","findValueTypeFromValues","shiftValueTypeFromBinary","VariableSignedIntegerType","signBinary","VariableDecimalType","isFloat","decimal","decimalBitSizes","float","parts","higherInteger","lowerInteger","integerValueBinary","decimalValueBinary","arrayType","booleanType","integerTypes","decimalTypes","ValueTypes","nameIndex","esTypeOf","findValueTypeFromName","findValueTypeFromValue","isValueInValueTypeRange","esTypes","uniqESTypes","isRangeInValueTypeRange","convertValuesToNumbers","Converter","typeName","clearLog","hasInitialType","printLog","valueFromBinary","SCORMSuspendData","ComponentSerializer","trackingIdType","isContainer","modelState","hasUserAnswer","isUserAnswerArray","hasAttemptStates","trackingIdMap","setAttemptObject","attemptObject","StatefulSession","_trackingIdType","_componentSerializer","_shouldStoreResponses","_shouldRecordInteractions","beginSession","restoreSession","spoor","_tracking","_advancedSettings","setVersion","_showDebugWindow","_scormVersion","_suppressErrors","_commitOnStatusChange","_commitOnAnyChange","isFinite","_timedCommitFrequency","_maxCommitRetries","_commitRetryDelay","_exitStateIfIncomplete","_exitStateIfComplete","setupLearnerInfo","restoreSessionState","_learnerInfo","sessionPairs","hasNoPairs","_isAssessmentPassed","q","debouncedSaveSession","saveSessionState","onLanguageChanged","onQuestionRecordInteraction","onTrackingComplete","advancedSettings","shouldCommitOnVisibilityChange","_commitOnVisibilityChangeHidden","onVisibilityChange","endSession","courseState","componentStates","printCompletionInformation","courseComplete","assessmentPassed","trackingIdModels","trackingIds","_reporting","_resetStatusOnLanguageChange","visibilityState","questionView","getLatency","stateModel","shouldSubmitScore","_shouldSubmitScore","scoreArgs","_onTrackingCriteriaMet","_onAssessmentFailure","finish","statefulSession","temporaryStore","suspendDataStore","suspendDataRestored","useTemporaryStore","getCustomStates","getLessonLocation","getScore","getStatus","student","getStudentName","learnerInfo","getLearnerInfo","getCustomState","stateArray","_isCourseComplete","questionsState","isObject","setLessonLocation","setStatus","dataAsString","setSuspendData","isSuspendDataStoreEmpty","getSuspendData","dataAsJSON","getStudentId","firstname","lastname","hasName","isNameCommaSeparated","isNameSpaceSeparated","separator","nameParts","part","Spoor","_prepare","onKeyCombo","TrickleView","isSteplocked","AdaptEvents","onKill","onPreRender","onPostRender","onStepLock","onStepUnlock","trickle","getCompletionAttribute","isElementEnabled","getModelConfig","isArticleWithOnChildren","_onChildren","continueToNext","isSteplocking","_stepLocking","detachFromElement","undelegateEvents","articleModel","currentDescendantIndex","currentLocksOnDescendant","currentDescendant","isPageEnabled","detachFromPage","setupDescendants","haveDescendantsGotTrickle","addClassToHtml","trickleConfig","descendantViews","getDescendants","descendantsChildFirst","descendantsParentFirst","setDescendantsTrickleDefaults","filterComponents","setModelConfig","setupArticleOnChildren","articleTrickleConfig","articleBlocks","blockTrickleConfig","_isFinal","_isStart","onDescendantPreRender","onUnwait","onWait","onContinue","onSkip","onPageReady","descendantView","gotoNextDescendant","finished","lastDescendant","TrickleButtonView","isStepLocking","hasStepLocked","isStepLocked","isStepLockFinished","hasStepPreCompleted","isWaitingForClick","allowVisible","allowEnabled","overlayShownCount","setupPreRender","setupButtonVisible","setupButtonEnabled","_button","_styleBeforeCompletion","_autoHide","_isFullWidth","_isCompletionRequired","_isDisabled","debounceCheckAutoHide","setupStepLocking","_completionAttribute","onOverlay","onUnoverlay","onUpdate","onCompletion","checkButtonAutoHideSync","checkButtonAutoHide","setButtonVisible","isJustOffscreen","checkButtonEnabled","setButtonEnabled","isSameNode","isViewMatch","isButtonEnabled","isCompleteAndShouldRelock","_isLockedOnRevisit","stepCompleted","setupOnScreenListener","_styleAfterClick","$newEl","replaceWith","setElement","TrickleButtonHandler","buttonViews","onAppDataReady","isTrickleEnabled","setupConfigDefaults","ButtonView","startText","finalText","_isLocking","TrickleCompletionHandler","isCompleted","stepModel","onDescendants","_wasCompletedPreRender","isModelComplete","TrickleNotifyHandler","isNotifyOpen","onNotifyOpened","onNotifyClosed","TrickleBodyResizeHandler","stepView","onAdaptInitialized","onResize","preventWrapperScroll","onTrickleResize","onFinished","wrapper","getElementById","pageYOffset","TrickleTutorHandler","stepLockedId","isTutorOpen","onTutorOpened","onTutorClosed","alertObject","isOriginStepLocked","hasStepLockedParent","TrickleVisibilityHandler","trickleModel","onVisibility","trickleModelId","trickleType","atIndex","TrickleDone","onDone","Trickle","getCourseModel","isCourseEnabled","setupListeners","onPagePreRender","fromModel","shouldScrollPage","isAutoScrollOff","_autoScroll","hasTrickleButton","_scrollTo","scrollToId","relativeModel","findRelativeModel","_scrollDuration","hasScrolled","ComponentLogo","_mode","_renderLogoSmall","_renderLogoNormal","$parents","componentLogo","DownloadView","_download","download","_icon","icon","rAbsoluteURL","externalURL","_externalMirrorURL","productionCode","topicNum","_isExternal","FigurePopupView","scrollfix","disableA11yScroll","enableA11yScroll","fixPlaceholders","HIDDEN_OBSERVER_DEBOUNCE","FigureItemView","setUpLightboxData","onTransformedChange","onHiddenChange","scaleDown","updateScaleDown","updateLightbox","updateScrolling","$itemInner","myWidth","isTransformed","lightbox","_backgroundEnabled","bg","isLightboxActive","openLightbox","onLightboxClosed","isLightboxEnabled","_hiddenObserver","closestEl","subtree","bbInner","xPadding","yPadding","renderFigureItem","scaledown","caption","figure","createCaptionData","captionPrefix","renderFigureText","FigureView","$marks","FigureModel","initCaption","CAPTION_COUNTS","Figure","increment","captionStr","isInvis","_getCaptionCount","isCaptionInvis","pdf","epub","onUnhidden","observerCallback","$e","isUnhidden","unhiddenObserver","attributeFilter","requirejs","onError","requireType","ddLoading","showError","helperElAttr","helperElData","mapObject","SQUOT_PLACEHOLDER","DQUOT_PLACEHOLDER","regex","$4","arg","from","zws","hyperlink","tel","kbd","clearfix","inlineIcon","iconType","blockquote","paper","registeredHelperEls","observePlaceholderRender","placeholderAttrId","mutationObserver","OBSERVER_TIMEOUT","observerTimeout","$placeholder","disconnect","mutations","mutation","addedNodes","placeholderEl","querySelector","getAttribute","$parentEl","$placeholders","helperName","helperCallback","postRenderCallback","_uniqueId","placeholderHTML","helperContext","componentData","isComponentModel","errMsg","getBlockModelFromContext","createHelperCallback","getComponentViewFromContext","ImgPopupView","setUpImgClasses","ImgView","MAX_RESIZE_ATTEMPTS","RESIZE_BUFFER","RespImgView","_fontSizeMulti","overflowing","pTop","pLeft","pRight","pBottom","right","$overflowingItem","_areItemsOverflowing","recalculate","svgWidth","em","jsonPath","ajax","dataType","cache","styles","_styles","transform","setUpRespImgEventListeners","_contain","contain","_widthAuto","InputFieldView","setUpInputAttributes","pattern","onIsLockedChange","onIsHintEnabledChange","onIsFocusedChange","isHintEnabled","showAnswer","getCorrectAnswer","InputFieldModel","_requireSubmit","_isHintEnabled","_allowsAnyCase","_allowsPunctuation","_incorrectUserAnswers","_submitCount","setUpWidth","checkGroupError","explicitWidth","groupItems","getGroupItems","checkAnswerInArray","iua","compareVals","getVal","group","val1","val2","decimals","v1","v2","num1","num2","maxCorrect","matchingItem","FN_REGEX","OutputFieldView","updateResult","updateValidationState","allItems","onInputFieldValChange","onInputFieldStateChange","onResultChange","onHasErrorChange","onIsVisitedChange","inputFieldModel","isAnyIncorrect","eqn","getNumber","eval","hasError","InputFieldController","setUpHelpers","_inputFieldViews","stickyBlock","addResetOnReRender","_group","allowsAnyCase","allowsPunctuation","_decimals","inputFieldCollection","warning","OPACITY","DDLoadingModel","onComponentReadyChange","loadingIcon","contentObjectView","clearText","componentsReady","_debugCommentEl","commentStr","readyComponentCount","waiting","createComment","errorText","DDLoadingView","onPercentLoadedChange","onHasLoadedChange","onTextChange","hasLoaded","percentLoaded","graphicCount","segment","$loading","getUrlVars","CLASSNAME_PREFIX","DEBUG_FORCED","DEBUG_DISABLED","PAGEMODE_ENABLED","debugIsolateBlock","disablePageNavigation","setUpDebugMode","navigationEnabled","blocksPlus","blockNums","blockId","disabledBlocks","article","isolatedBlocks","blockNum","sortIndex","_pageHeader","onDebugBlockViewPostRender","$debugBtn","$blockId","getComponentJSONSYNT","QuestionPlusMultiModel","hideQuestionRows","onQuestionComponentComplete","crVisible","nextIncompleteComponent","showNextQuestionComponent","_fixString","QuestionPlus","onBlockViewPrerender","onComponentViewPostRender","onQuestionViewShowFeedback","questionRowCount","questionRows","_onSubmitClicked","_questionPlusOverride","_onFeedbackMessageChanged","_getFeedbackTitle","formatMessage","SideMenuCategoryModel","SideMenuCategoryCollection","menuData","cat","SideMenuModel","_categories","SideMenuCategoryContentView","SideMenuCategoryNavView","onBlockCompleteChange","onBlockInviewChange","cancelable","$shadow","sideMenu","SideMenuCategoryView","SideMenuCategoryResourcesView","pdfDownloadName","_resources","_pdfDownloadName","_isPDFEnabled","SideMenuCategoryCreditsView","copyright","getDDCopyrightHtml","year","getFullYear","category_is_type","category","isType","SideMenuView","renderCategories","onIsActiveChange","onAccordionItemActiveChange","updateAccordion","updateScrollEnabled","unfocus","$btns","$accordion","accordionHeight","itemHeight","$activeItem","SideMenu","renderSideMenuBtn","categoryCollection","sideMenuModel","sideMenuView","SideNavCollection","allProgressItems","SideNavProgressView","onBlockCompletionChange","completionPercent","scrollToFirstIncompleteComponent","incompleteComponent","incompleteBlock","BlocknumView","maxInputLength","input","inputVal","updateInput","blur","targetBlock","firstBlock","setInputVal","onInviewBlockChange","setProgressPercent","onCurBlockCompletionPercentChange","$r","SideNavWidgetView","SideNavBlocknumView","setUpBlockInview","percentFromTop","percentFromBottom","SlideNav","setUpBlocks","onComponentCompletionChange","blockPercentCompletion","renderSideNavWidget","sideNav","componentViewPreRender","componentViewPostRender","blockViewPreRender","blockViewPostRender","notReadyChild","ExtraLearningPopupView","setUpIconTransition","alignIconToParent","$icon","$parentIcon","iconBB","parentIconBB","ExtraLearningView","popupModel","_parentView","popup","popupData","extraLearningItem","_componentParent","_popupData","LottieModel","onAnimLoad","onAnimLoopComplete","onAnimEnterFrame","currentFrame","totalFrames","currentProgressPercent","totalTime","pauseTime","getDuration","setUpAnimEventListeners","goToAndStop","goToAndPlay","LottieControlsView","isLoopsComplete","isDecorative","INTERSECTION_THRESHOLD","Lottie","setQuality","LottieView","setUpIntersectionObserver","onIsReadyChange","onParentStickyBlockInview","onParentStickyBlockOutview","onAutoplayIntersection","intersectionRatio","onAutoplayInview","onAutoplayOutview","checkResetOnOutview","renderLottie","loadAnimation","container","renderer","autoplay","_controlsType","controls","loops","MarkChainModel","setUpLabel","label","prev","at","next","MarkChainView","onDeviceResized","onNextChanged","updateArrow","nextModel","setUpHiddenObserver","p0","v0","p1","_getVectorIntersection","$arrow","$scaled","matrix","fromBB","toBB","fromMid","toMid","fromIn","_getVectorBoxIntersection","toIn","angle","atan2","PI","_getVectorLength","_subtractVector","MarkChain","groupsCollection","_groups","markChainModel","_idx","markChain","NestComponentParentModel","extendParentView","onChildReadyChange","_setReadyStatus","_nestComponentOverride","parentNestComponent","registerChild","_isChild","NestComponent","onParentComponentViewPreRender","onChildComponentViewPostRender","nestComponent","_isParent","nestComponentParentModel","ResourcePopupPopupView","ResourcePopupBtnView","resourcePopup","resourceId","btnHTML","$btnContainer","SCROLL_MARGIN","SCROLL_DURATION","scrollPriority","overrideNavigateToElement","overridePreventScroll","disableA11yPreventScroll","ignoreNav","_navigateToElement","onScrollFail","onAfter","onScrollAfter","$obj","jQuery","scrollNestedCallback","$scrollParent","scrollParent","scrollParentId","destScrollTop","cleanup","getElementInview","$topObj","_useIphoneFix","notifyEnabled","getScreenTop","getScreenBottom","bbs","minTop","maxBottom","screenTop","screenBottom","Sizing","sizingObj","propName","isBoolValid","_maxWidth","_getSizingObj","_validateProperty","_minWidth","_float","_maxCols","$grid","updateGridEl","columnGap","THRESHOLD","gridWidth","columnCount","orphanCount","hasFloatingChildren","componentInviewThreshold","StickyBlockView","_timeline","setUpTimeline","getStaticChildren","timelineTitle","stickyColObserver","onStickyColIntersection","stickyBlockObserver","onIntersection","triggerStickyChildInview","intersectionRect","static","staticChildren","_isInview","boundingClientRect","getStickyChildren","child0","child1","layout","layout0","layout1","_layout0","sticky","modelSizing","onStaticChildInviewChange","onChildVisibleChange","onChildrenReady","$child","renderModeSmall","renderModeLarge","$block","removeChildInview","removeClones","_cloneModels","componentRowIndex","staticChild","stickyChild","getResetOnReRender","cloneModel","cloneView","$componentRow","originalIndex","viewportHeight","onscreenView","initChildInview","inviewTop","inviewPercent","getStickyBlockData","staticChildIndex","activeStaticChild","getActiveStaticChild","staticChildModel","_stickyBlock","StickyBlockEpubView","_isEpubMode","onEpubHelperInviewChange","$inviewHelper","$blockPar","setEpubHelperInview","isTop","rootBounds","isBottom","_isEpubHelperInview","helperBB","removeEpubHelperInview","initEpubHelperInview","epubHelperInview","_isTop","$componentContainer","fromTop","toTop","topDiff","$epubBlock","getParentStickyBlockIndex","$component","StickyBlock","_resetOnReRender","inviewEvent","StickyElementAttributeClasses","StickyElementItemView","_toggleCount","toggleAttributes","_stickyBlockPrevIdx","setUpScrolling","onComponentItemIndexChange","getParentModel","synchronizeScrollTop","synchronizeScrollLeft","propertyVal","$scroll","_isPropertyScrollable","previous","_force","curCIndex","itemPrevModel","getItemPrev","prevCIndex","transitionFromEl","attrString","itemsCount","getItemsCount","inverted","_idxs","idxs","to","invertedIdxs","$targetEl","isStickyBlock","$els","activeIdxs","getActiveIdxs","curActive","prevActive","hasTransition","$otherEl","$cloneScroll","removeClone","fallbackTimeout","thisBB","cloneBB","otherBB","cloneOffsetBefore","cloneOffsetAfter","StickyElementItemModel","_componentItemIndex","_componentItem","_isStickyBlock","onComponentItemActiveChange","onStickyBlockInview","activeIndex","setItemActive","CompatibleComponents","StickyElementModel","_itemScrollTop","_itemScrollLeft","_itemActive","_itemPrev","parentType","_hasTransitions","itemActiveModel","componentItem","_previousAttributes","componentItemModel","se","registerComponentItemModel","se_active","se_mark","se_hide","se_fold","se_slideleft","se_slidedown","TooltipPopupView","innerEl","alignToTarget","getClientRects","elBB","parentWidth","clientWidth","tailOffset","TooltipView","example","_img","glossaryTerm","glossaries","_glossaries","glossaryData","MenuItemView","MenuView","BoxMenuItemView","onClickMenuItemButton","BoxMenuView","setStyles","setBackgroundImage","setBackgroundStyles","processHeader","backgroundImages","backgroundImage","_medium","_backgroundStyles","_backgroundRepeat","_backgroundSize","_backgroundPosition","_menuHeader","$header","setHeaderBackgroundImage","setHeaderBackgroundStyles","setHeaderMinimumHeight","minimumHeights","_minimumHeights","minimumHeight","newRouteId","ThemeView","setClasses","setMinimumHeight","setCustomStyles","backgroundRepeat","_repeat","backgroundSize","ThemePageView","$headerBG","ThemeArticleView","ThemeBlockView","ThemeComponentView","propOverrides","registerPartial","Header","jsxHeading","useRef","jsxComponentDescription","mobileInstruction","_disableAccessibilityState","classNamePrefixes","sizedInstruction","isSet","Image","_src","hasSource","attributionClassNamePrefixes","attribution","alt"],"mappings":"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"}